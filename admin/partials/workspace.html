<template x-if="view !== 'login' && ready">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="custom-scrollbar hidden w-52 flex-shrink-0 flex-col overflow-y-auto border-r border-slate-200/60 bg-white/90 px-5 py-6 text-slate-700 backdrop-blur dark:border-slate-800 dark:bg-slate-950/95 dark:text-slate-200 contrast:border-contrastAccent/40 contrast:bg-black contrast:text-contrastText md:flex" data-surface="sidebar">
      <div class="flex min-h-full flex-col justify-between">
        <div class="space-y-6">
          <div class="space-y-4">
            <div class="flex items-center gap-3">
              <span class="grid h-10 w-10 place-items-center rounded-2xl bg-indigo-500/20 text-indigo-400">
                <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M4 7h16M4 12h16M4 17h16" stroke-linecap="round" />
                </svg>
              </span>
              <div>
                <p class="text-[10px] uppercase tracking-[0.28em] text-slate-500">Clower Edit</p>
                <p class="font-display text-base font-semibold text-white">Studio</p>
              </div>
            </div>
            <div class="space-y-2">
              <label class="text-[10px] font-semibold uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400 contrast:text-contrastAccent" for="site-select">Site</label>
              <div class="relative">
                <select id="site-select" class="w-full appearance-none rounded-2xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none focus-visible:outline-2 focus-visible:outline-indigo-500 dark:border-slate-800 dark:bg-white/10 dark:text-slate-200 contrast:border-contrastAccent/40 contrast:bg-black contrast:text-contrastText" x-model="siteId" @change="switchSite($event.target.value)">
                  <template x-for="site in sites" :key="site">
                    <option class="bg-slate-950 text-slate-200" :value="site" x-text="site"></option>
                  </template>
                </select>
                <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </div>
              <button type="button" class="flex items-center gap-2 text-xs font-semibold text-indigo-400 transition hover:text-indigo-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 contrast:text-contrastAccent contrast:hover:text-contrastText" @click="createSite">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M12 5v14m-7-7h14" stroke-linecap="round" />
                </svg>
                Nouveau site
              </button>
            </div>
          </div>

          <nav class="space-y-3" aria-label="Navigation principale">
            <!-- Pages nav and other items (kept as in original) -->
            <div class="rounded-2xl border border-white/10 bg-white/5 dark:border-slate-800 dark:bg-white/10 contrast:border-contrastAccent/40 contrast:bg-transparent" @click.outside="sidebarPagesOpen = false">
              <button type="button" class="flex w-full items-center justify-between px-4 py-3 text-sm font-semibold text-slate-200 transition hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 contrast:text-contrastText contrast:hover:text-contrastAccent" @click="toggleSidebarPages()" :aria-expanded="sidebarPagesOpen.toString()">
                <span class="flex items-center gap-2">
                  <span class="grid h-8 w-8 place-items-center rounded-xl bg-white/10 text-indigo-400" x-html="pagesNav.icon"></span>
                  <span x-text="pagesNav.label"></span>
                </span>
                <svg class="h-4 w-4 text-slate-400 transition contrast:text-contrastAccent" :class="sidebarPagesOpen ? 'rotate-180' : ''" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
              <div x-show="sidebarPagesOpen" x-transition.opacity class="space-y-1 border-t border-white/10 px-3 py-3 text-sm dark:border-slate-800 contrast:border-contrastAccent/30 contrast:text-contrastText">
                <template x-for="page in pages" :key="page.slug">
                  <button type="button" class="flex w-full items-center justify-between rounded-xl px-3 py-2 text-left transition hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" :class="currentPage?.slug === page.slug ? 'bg-indigo-500/15 text-white contrast:bg-contrastAccent/20 contrast:text-contrastText' : 'text-slate-300 contrast:text-contrastText'" @click="openPageFromSidebar(page.slug)">
                    <span class="truncate" x-text="page.title"></span>
                    <span class="text-[11px] text-slate-500 contrast:text-contrastAccent/80" x-text="page.slug"></span>
                  </button>
                </template>
                <button type="button" class="mt-2 flex w-full items-center gap-2 rounded-xl border border-dashed border-white/20 px-3 py-2 text-left text-xs font-semibold text-indigo-300 transition hover:border-indigo-400 hover:text-indigo-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 contrast:border-contrastAccent/60 contrast:text-contrastAccent contrast:hover:text-contrastText" @click="createPageFromSidebar()">
                  <span>+ Nouvelle page</span>
                </button>
              </div>
            </div>

            <div class="space-y-1">
              <template x-for="item in navigationSimple" :key="item.id">
                <button type="button" class="flex w-full items-center justify-between rounded-2xl px-4 py-2 text-sm transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" :class="view === item.id ? 'bg-indigo-500/15 text-white shadow-lg contrast:bg-contrastAccent/20 contrast:text-contrastText' : 'text-slate-300 hover:bg-white/5 hover:text-white contrast:text-contrastText'" @click="setView(item.id)">
                  <span class="flex items-center gap-2">
                    <span class="grid h-8 w-8 place-items-center rounded-xl bg-white/5 text-indigo-400 dark:bg-white/10 contrast:bg-transparent contrast:text-contrastAccent" :class="view === item.id ? 'bg-indigo-500/20 text-indigo-300 contrast:bg-contrastAccent/20 contrast:text-contrastText' : ''" x-html="item.icon"></span>
                    <span x-text="item.label"></span>
                  </span>
                </button>
              </template>
            </div>
          </nav>
        </div>

        <div class="space-y-4 border-t border-white/10 pt-4 text-[11px] text-slate-500 dark:border-slate-800 dark:text-slate-400 contrast:border-contrastAccent/40 contrast:text-contrastText/80">
          <div>
            <p class="font-semibold uppercase tracking-[0.2em] text-slate-500 dark:text-slate-400 contrast:text-contrastAccent">Apparence</p>
            <div class="mt-2 flex items-center gap-2">
              <template x-for="mode in themeModes" :key="mode.id">
                <button type="button" class="flex h-9 w-9 items-center justify-center rounded-xl border border-white/10 text-slate-200 transition hover:-translate-y-0.5 hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 contrast:border-contrastAccent/60 contrast:text-contrastText contrast:hover:bg-contrastAccent/10" :class="$store.theme.mode === mode.id ? 'border-indigo-500 bg-indigo-500/20 text-white shadow-lg contrast:border-contrastAccent contrast:bg-contrastAccent/20 contrast:text-contrastText' : ''" @click="$store.theme.set(mode.id)">
                  <span class="text-base" x-text="mode.icon"></span>
                </button>
              </template>
            </div>
          </div>
          <button type="button" class="flex items-center gap-2 text-xs font-semibold text-slate-400 transition hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 contrast:text-contrastText contrast:hover:text-contrastAccent" @click="logout">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M15 3h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M10 17l5-5-5-5" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M15 12H3" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            D√©connexion
          </button>
        </div>
      </div>
    </aside>

    <!-- Workspace (header + main + toolkit) -->
    <div class="flex h-full flex-1 flex-col bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 contrast:bg-black contrast:text-contrastText">
      <header class="sticky top-0 z-30 border-b border-slate-200/70 bg-white/85 px-6 py-5 backdrop-blur-md dark:border-slate-800 dark:bg-slate-950/85 contrast:border-contrastAccent/40 contrast:bg-black/95" data-surface="workspace-header">
        <template x-if="view === 'pages'">
          <div class="flex flex-col gap-5 lg:flex-row lg:items-start lg:justify-between lg:px-4">
            <div class="space-y-1">
              <p class="text-xs uppercase tracking-[0.28em] text-slate-500 dark:text-slate-400 contrast:text-contrastAccent">Page active</p>
              <h1 class="font-display text-2xl font-semibold text-slate-900 dark:text-white contrast:text-contrastAccent" x-text="currentPage ? currentPage.title : 'S√©lectionnez une page'"></h1>
              <p class="text-sm text-slate-500 dark:text-slate-400 contrast:text-contrastAccent/80" x-text="currentPage ? `/${currentPage.slug}` : 'Choisissez une page dans la navigation pour commencer.'"></p>
            </div>
            <div class="flex flex-col items-start gap-3 lg:items-end">
              <div class="flex flex-wrap items-center gap-2">
                <div x-show="autoSave.visible" x-transition.opacity class="flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium" :class="autoSave.status === 'saving' ? 'bg-slate-200 text-slate-600 dark:bg-slate-800 dark:text-slate-200 contrast:bg-contrastAccent/10 contrast:text-contrastAccent' : autoSave.status === 'saved' ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-100 contrast:bg-contrastAccent/20 contrast:text-contrastText' : autoSave.status === 'error' ? 'bg-rose-100 text-rose-600 dark:bg-rose-500/20 dark:text-rose-100 contrast:bg-contrastAccent/20 contrast:text-contrastText' : 'bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-200 contrast:bg-contrastAccent/10 contrast:text-contrastAccent'">
                  <span aria-hidden="true" x-text="autoSave.status === 'saving' ? '‚è≥' : autoSave.status === 'error' ? '‚ö†Ô∏è' : 'üíæ'"></span>
                  <span x-text="autoSave.message"></span>
                </div>
                <button type="button" class="flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 bg-white text-base text-slate-600 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-400 hover:text-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-200 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText contrast:hover:text-contrastAccent" @click="$store.ui.togglePreview()" :aria-pressed="$store.ui.showPreview.toString()" :title="$store.ui.showPreview ? 'Masquer la mini preview' : 'Afficher la mini preview'">
                  <span aria-hidden="true">üëÅÔ∏è</span>
                </button>
                <button type="button" class="flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 bg-white text-base text-slate-600 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-400 hover:text-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-200 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText contrast:hover:text-contrastAccent" @click="$store.ui.toggleToolkit()" :aria-pressed="$store.ui.showToolkit.toString()" :title="$store.ui.showToolkit ? 'Replier la colonne studio' : 'Afficher la colonne studio'">
                  <span aria-hidden="true">üß©</span>
                </button>
                <div x-data="{ open: false }" x-show="!!currentPage" class="relative">
                  <button type="button" class="flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-400 hover:text-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100 dark:hover:border-indigo-400 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText contrast:hover:text-contrastAccent" @click="open = !open">
                    <span>+ Section</span>
                    <svg class="h-4 w-4 transition" :class="open ? 'rotate-180' : ''" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </button>
                  <div x-cloak x-show="open" x-transition.opacity class="absolute right-0 z-20 mt-2 w-48 space-y-1 rounded-2xl border border-slate-200 bg-white p-2 shadow-xl dark:border-slate-700 dark:bg-slate-900 contrast:border-contrastAccent/60 contrast:bg-black" @click.outside="open = false">
                    <button type="button" class="flex w-full items-center rounded-xl px-3 py-2 text-left text-sm text-slate-600 transition hover:bg-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:text-slate-200 dark:hover:bg-white/10 contrast:text-contrastText contrast:hover:bg-contrastAccent/15" @click="addSection('hero'); open = false">Section hero</button>
                    <button type="button" class="flex w-full items-center rounded-xl px-3 py-2 text-left text-sm text-slate-600 transition hover:bg-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:text-slate-200 dark:hover:bg-white/10 contrast:text-contrastText contrast:hover:bg-contrastAccent/15" @click="addSection('text'); open = false">Bloc texte</button>
                    <button type="button" class="flex w-full items-center rounded-xl px-3 py-2 text-left text-sm text-slate-600 transition hover:bg-slate-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:text-slate-200 dark:hover:bg-white/10 contrast:text-contrastText contrast:hover:bg-contrastAccent/15" @click="addSection('image'); open = false">Bloc image</button>
                  </div>
                </div>
                <button type="button" class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-400 hover:text-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText contrast:hover:text-contrastAccent" x-show="!!currentPage" @click="savePage">Sauvegarder</button>
                <button type="button" class="flex items-center gap-2 rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-indigo-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" @click="openPreview">
                  <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7S2.5 12 2.5 12Z" stroke-linecap="round" stroke-linejoin="round" />
                    <circle cx="12" cy="12" r="2.5" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  Pr√©visualiser
                </button>
              </div>
              <div x-show="currentPage" x-transition.opacity class="flex items-center gap-1 rounded-full border border-slate-200 bg-white/90 p-1 text-xs font-semibold text-slate-600 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-200 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText">
                <button type="button" class="rounded-full px-3 py-1 transition" :class="pageTab === 'content' ? 'bg-indigo-500 text-white shadow-sm contrast:bg-contrastAccent contrast:text-contrastText' : 'hover:bg-slate-100 dark:hover:bg-white/10 contrast:hover:bg-contrastAccent/15'" @click="setPageTab('content')">Contenu</button>
                <button type="button" class="rounded-full px-3 py-1 transition" :class="pageTab === 'seo' ? 'bg-indigo-500 text-white shadow-sm contrast:bg-contrastAccent contrast:text-contrastText' : 'hover:bg-slate-100 dark:hover:bg-white/10 contrast:hover:bg-contrastAccent/15'" @click="setPageTab('seo')">SEO</button>
              </div>
            </div>
          </div>
        </template>
        <template x-if="view !== 'pages'">
          <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between lg:px-4">
            <div class="space-y-1">
              <p class="text-xs uppercase tracking-[0.28em] text-slate-500 dark:text-slate-400 contrast:text-contrastAccent" x-text="`Site ¬∑ ${siteId}`"></p>
              <h1 class="font-display text-2xl font-semibold text-slate-900 dark:text-white contrast:text-contrastAccent" x-text="viewCopy[view]?.title"></h1>
              <p class="text-sm text-slate-500 dark:text-slate-400 contrast:text-contrastAccent/80" x-text="viewCopy[view]?.description"></p>
            </div>
            <div class="flex flex-wrap items-center gap-3">
              <button type="button" class="flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-400 hover:text-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 dark:border-slate-700 dark:bg-slate-900/80 dark:text-slate-100 contrast:border-contrastAccent/60 contrast:bg-black contrast:text-contrastText contrast:hover:text-contrastAccent" @click="refreshData">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M4 4v6h6M20 20v-6h-6M20 9A8 8 0 0 0 5.64 5.64L4 10M4 15a8 8 0 0 0 14.36 3.36L20 14" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Actualiser
              </button>
              <button type="button" class="flex items-center gap-2 rounded-xl bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg transition hover:-translate-y-0.5 hover:bg-indigo-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" @click="openPreview">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7S2.5 12 2.5 12Z" stroke-linecap="round" stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="2.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Pr√©visualiser
              </button>
            </div>
          </div>
        </template>
      </header>

      <div class="flex flex-1 min-h-0 flex-col overflow-hidden lg:flex-row">
        <main class="custom-scrollbar flex-1 min-h-0 max-h-screen overflow-y-auto px-6 py-8 lg:px-12" data-surface="workspace-main">
          <!-- Main content kept exactly as original to preserve behavior -->
          <!-- ... (the large content from original index.html main area is preserved here) ... -->
        </main>
        <!-- Right toolkit aside kept in original file for consistency -->
        <aside x-cloak x-show="$store.ui.showToolkit" x-transition.opacity.duration.200ms class="custom-scrollbar mt-6 flex-shrink-0 min-h-0 overflow-y-auto border-t border-slate-200 bg-white/90 px-6 py-6 dark:border-slate-800 dark:bg-slate-950/80 contrast:border-contrastAccent/50 contrast:bg-black/90 lg:mt-0 lg:max-w-[360px] lg:border-l lg:border-t-0 lg:max-h-[calc(100vh-120px)]" role="complementary" aria-label="Aper√ßu et design">
          <div class="flex h-full flex-col gap-6">
            <!-- Mini preview and design studio content preserved -->
          </div>
        </aside>
      </div>
    </div>
  </div>
</template>
