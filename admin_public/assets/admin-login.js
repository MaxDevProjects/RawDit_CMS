(()=>{document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector("form[data-login-form]"),n=document.querySelector("[data-login-status]");if(i(),!t)return;t.addEventListener("submit",async e=>{e.preventDefault(),n.textContent="";let a=t.querySelector('button[type="submit"]');a.disabled=!0;try{let o={username:t.elements.username.value,password:t.elements.password.value},s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(s.ok){window.location.href="/admin/sites";return}let r=await s.json().catch(()=>({}));n.textContent=r.message||"Identifiants invalides."}catch{n.textContent="Erreur de connexion."}finally{a.disabled=!1}});async function i(){try{let e=await fetch("/api/auth/me",{credentials:"same-origin"});if(!e.ok)return;(await e.json().catch(()=>({}))).authenticated&&(window.location.href="/admin/sites")}catch(e){console.warn("[login] Impossible de v\xE9rifier la session active",e)}}});})();
