(()=>{document.addEventListener("DOMContentLoaded",()=>{var Lr;console.log("[admin] Atelier charg\xE9");let ko=document.querySelector("[data-logout]");ko&&ko.addEventListener("click",async()=>{ko.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(o){console.error("[admin] Impossible de se d\xE9connecter",o)}finally{window.location.href="/admin/index.html"}});let Ss=document.querySelector("[data-admin-sidebar]"),bt=document.querySelector("[data-admin-sidebar-overlay]"),ir=document.querySelectorAll("[data-admin-sidebar-toggle]"),Yr=document.querySelectorAll("[data-admin-sidebar-close]"),Co=document.body,Js=!1,Ws=()=>{if(!Ss)return;if(window.matchMedia("(min-width: 1024px)").matches){Ss.classList.remove("hidden"),bt==null||bt.classList.add("hidden"),Co.classList.remove("overflow-hidden");return}Js?(Ss.classList.remove("hidden"),bt==null||bt.classList.remove("hidden"),Co.classList.add("overflow-hidden")):(Ss.classList.add("hidden"),bt==null||bt.classList.add("hidden"),Co.classList.remove("overflow-hidden"))},Qr=()=>{Js=!0,Ws()},Eo=()=>{Js=!1,Ws()};Ss&&ir.length>0&&(ir.forEach(o=>{o.addEventListener("click",Qr)}),Yr.forEach(o=>{o.addEventListener("click",Eo)}),bt==null||bt.addEventListener("click",Eo),window.addEventListener("resize",Ws),window.addEventListener("keydown",o=>{o.key==="Escape"&&Js&&Eo()}),Ws());let lr="clower:currentSite",cr="clower:currentSiteName",te={slug:null,name:""};(()=>{try{let o=window.localStorage.getItem(lr);te.slug=o?Tt(Te(o)):null,te.name=window.localStorage.getItem(cr)||""}catch{te.slug=null,te.name=""}})();let qo=document.querySelectorAll("[data-site-card]"),Xr=document.querySelectorAll("[data-site-select]"),Ls=document.querySelector("[data-current-site-name]"),dr=document.querySelector("[data-workspace-site-name]"),ur=document.querySelector("[data-workspace-back-name]"),At=document.querySelector("[data-workspace-back-modal]"),en=document.querySelectorAll("[data-workspace-back]"),tn=document.querySelectorAll("[data-workspace-back-cancel]"),Ao=document.querySelector("[data-workspace-back-confirm]"),sn=document.querySelectorAll("[data-workspace-tab]"),To=document.querySelector("[data-site-toast]"),mr=document.querySelector("[data-site-toast-message]"),on=document.querySelectorAll("[data-site-create]"),dt=document.querySelector("[data-site-modal]"),at=document.querySelector("[data-site-form]"),Ye=at==null?void 0:at.querySelector('input[name="siteName"]'),Fe=at==null?void 0:at.querySelector('input[name="siteSlug"]'),Qe=document.querySelector("[data-site-slug-error]"),Xe=document.querySelector("[data-site-modal-error]"),rn=document.querySelectorAll("[data-site-modal-cancel]"),as=document.querySelector("[data-site-modal-submit]"),J=yn(),Gs=!1,Io=null,fr='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',is=[],pr=o=>Array.from(o.querySelectorAll(fr)).filter(n=>!n.hasAttribute("disabled")&&!n.getAttribute("aria-hidden")),nn=o=>{if(!is.length)return;let n=is[is.length-1],{modal:c,onClose:f}=n;if(o.key==="Escape"){o.preventDefault(),f==null||f();return}if(o.key!=="Tab")return;let p=pr(c);if(!p.length)return;let y=p[0],V=p[p.length-1];o.shiftKey?document.activeElement===y&&(o.preventDefault(),V.focus()):document.activeElement===V&&(o.preventDefault(),y.focus())};document.addEventListener("keydown",nn);let ks=(o,n)=>{if(!o)return;is.push({modal:o,onClose:n,trigger:document.activeElement instanceof HTMLElement?document.activeElement:null});let c=pr(o);window.setTimeout(()=>{var f,p;(p=(f=c[0]||o).focus)==null||p.call(f)},0)},Cs=o=>{var f,p;let n=is.findIndex(y=>y.modal===o);if(n===-1)return;let[c]=is.splice(n,1);(p=(f=c.trigger)==null?void 0:f.focus)==null||p.call(f)},oe=document.querySelector("[data-mobile-panels-overlay]"),fe=document.querySelector("[data-mobile-panels-layer]"),vt={left:document.querySelector('[data-mobile-panel="left"]'),right:document.querySelector('[data-mobile-panel="right"]')},Zt=null;fe!=null&&fe.parentElement&&(Zt=document.createComment("mobile-panels-layer-placeholder"),fe.parentElement.insertBefore(Zt,fe));let Kt=null;(Lr=vt.right)!=null&&Lr.parentElement&&(Kt=document.createComment("mobile-panel-right-placeholder"),vt.right.parentElement.insertBefore(Kt,vt.right));let gr=document.querySelectorAll("[data-mobile-panel-toggle]"),an=document.querySelectorAll("[data-mobile-panel-close]"),Es={left:null,right:null},kt=null,_t=()=>window.matchMedia("(min-width: 1024px)").matches,ln=()=>{if(!(!fe||!Zt)){if(_t()){let o=Zt.parentElement;if(!o)return;(fe.parentElement!==o||Zt.nextSibling!==fe)&&o.insertBefore(fe,Zt.nextSibling),fe.dataset.mobilePanelPlacement="sidebar";return}fe.parentElement!==document.body&&(document.body.appendChild(fe),fe.dataset.mobilePanelPlacement="overlay")}},cn=()=>{let o=vt.right;if(!(!o||!Kt)){if(_t()){let n=Kt.parentElement;if(!n)return;(o.parentElement!==n||Kt.nextSibling!==o)&&n.insertBefore(o,Kt.nextSibling),o.dataset.mobilePanelPlacement="sidebar";return}if(fe){let n=vt.left;n&&n.parentElement===fe?(o.parentElement!==fe||o.previousSibling!==n)&&fe.insertBefore(o,n.nextSibling):o.parentElement!==fe&&fe.appendChild(o),o.dataset.mobilePanelPlacement="overlay"}else o.parentElement!==document.body&&(document.body.appendChild(o),o.dataset.mobilePanelPlacement="overlay")}},hr=()=>{ln(),cn()};hr();let Zs={};Object.entries(vt).forEach(([o,n])=>{if(!n)return;let c=Number(window.getComputedStyle(n).zIndex)||0;Zs[o]=c});let dn=(Object.values(Zs).reduce((o,n)=>Math.max(o,n||0),0)||150)+5,Ks=(o,n)=>{let c=vt[o];if(c){if(_t()){c.style.removeProperty("z-index");return}n?c.style.zIndex=String(dn):Zs[o]?c.style.zIndex=String(Zs[o]):c.style.removeProperty("z-index")}},Dt=(o,n,c)=>{!o||!n||n.split(" ").map(f=>f.trim()).filter(Boolean).forEach(f=>o.classList[c](f))},$o=(o,n)=>{if(!o)return;let c=o.dataset.mobilePanelHidden||"",f=o.dataset.mobilePanelVisible||"translate-x-0";n?(Dt(o,f,"remove"),Dt(o,c,"add"),o.classList.add("pointer-events-none"),o.classList.remove("pointer-events-auto"),o.setAttribute("aria-hidden","true"),o.dataset.mobilePanelOpen="false"):(Dt(o,c,"remove"),Dt(o,f,"add"),o.classList.remove("pointer-events-none"),o.classList.add("pointer-events-auto"),o.setAttribute("aria-hidden","false"),o.dataset.mobilePanelOpen="true")},qs=(o=kt)=>{var f;if(!o||_t())return;let n=vt[o];if(!n)return;Ks(o,!1),$o(n,!0);let c=Es[o];c&&c.setAttribute("aria-expanded","false"),Es[o]=null,kt===o&&(oe==null||oe.classList.add("hidden"),oe==null||oe.classList.remove("pointer-events-auto"),oe==null||oe.classList.add("pointer-events-none"),oe==null||oe.setAttribute("aria-hidden","true"),fe==null||fe.classList.add("pointer-events-none"),document.body.classList.remove("overflow-hidden"),(f=c==null?void 0:c.focus)==null||f.call(c),kt=null)},un=(o,n)=>{if(!o||_t())return;let c=vt[o];if(!c)return;kt&&kt!==o&&qs(kt),$o(c,!1),Ks(o,!0),kt=o,Es[o]=n||null,n&&n.setAttribute("aria-expanded","true"),oe==null||oe.classList.remove("hidden","pointer-events-none"),oe==null||oe.classList.add("pointer-events-auto"),oe==null||oe.setAttribute("aria-hidden","false"),fe==null||fe.classList.remove("pointer-events-none"),document.body.classList.add("overflow-hidden");let f=c.querySelector(fr);window.setTimeout(()=>{var p;(p=f==null?void 0:f.focus)==null||p.call(f)},0)},yr=()=>{hr(),_t()?(oe==null||oe.classList.add("hidden"),fe==null||fe.classList.add("pointer-events-none"),document.body.classList.remove("overflow-hidden"),kt=null,Object.keys(vt).forEach(o=>{let n=vt[o];if(!n)return;Ks(o,!1),n.classList.remove("pointer-events-none"),n.classList.add("pointer-events-auto"),n.setAttribute("aria-hidden","false"),n.dataset.mobilePanelOpen="false";let c=Es[o];c==null||c.setAttribute("aria-expanded","false"),Es[o]=null})):(Object.entries(vt).forEach(([o,n])=>{n&&n.dataset.mobilePanelOpen!=="true"&&($o(n,!0),Ks(o,!1))}),kt||(oe==null||oe.classList.add("hidden","pointer-events-none"),oe==null||oe.classList.remove("pointer-events-auto"),oe==null||oe.setAttribute("aria-hidden","true"),fe==null||fe.classList.add("pointer-events-none")))};gr.length>0&&(gr.forEach(o=>{let n=o.dataset.mobilePanelToggle;o.addEventListener("click",()=>{kt===n?qs(n):un(n,o)})}),an.forEach(o=>{let n=o.dataset.mobilePanelClose;o.addEventListener("click",()=>qs(n))}),oe==null||oe.addEventListener("click",()=>qs()),window.addEventListener("keydown",o=>{o.key==="Escape"&&kt&&!_t()&&qs()}),window.addEventListener("resize",yr),yr());let M=o=>{!To||!mr||(mr.textContent=o,To.classList.remove("hidden"),Io&&clearTimeout(Io),Io=setTimeout(()=>{To.classList.add("hidden")},2500))};function Tt(o){if(!o)return"";let n=`${o}`.trim();if(!n)return"";let c=n.replace(/^\/+/,"");return c?`/${c}`:"/"}function Te(o){return o?`${o}`.replace(/^\/+/,""):""}let _s=(o,n)=>{let c=o?Tt(o):null;try{c&&(window.localStorage.setItem(lr,c),te.slug=c),typeof n=="string"&&n.length>0&&(window.localStorage.setItem(cr,n),te.name=n)}catch{te.slug=c||te.slug,te.name=n||te.name}},br=o=>{Ls&&o&&(Ls.textContent=o),dr&&o&&(dr.textContent=o),ur&&o&&(ur.textContent=o)},Bo=o=>{sn.forEach(n=>{let c=n.dataset.workspaceTab;if(!c)return;if(!o){n.href="#",n.classList.add("pointer-events-none","opacity-50","text-slate-400"),n.setAttribute("aria-disabled","true");return}let f=encodeURIComponent(Te(o));n.href=`/admin/site/${f}/${c}`,n.classList.remove("pointer-events-none","opacity-50","text-slate-400"),n.removeAttribute("aria-disabled")})},Ys=(o,n={})=>{if(!o)return;let c=Tt(o),f=n.siteName||te.name||(Ls==null?void 0:Ls.dataset.defaultSiteName)||"";qo.forEach(y=>{let U=Tt(y.dataset.siteCard||"")===c,O=y.querySelector("[data-site-active-badge]");U?(y.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),y.classList.remove("border-slate-200"),O==null||O.classList.remove("hidden"),f=y.dataset.siteName||f):(y.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),y.classList.add("border-slate-200"),O==null||O.classList.add("hidden"))}),n.persist!==!1&&_s(c,n.siteName||f);let p=n.siteName||f;br(p),Bo(c)},mn=async(o,n)=>{let c=Tt(o);try{let f=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:c})});if(!f.ok){let O=await f.json().catch(()=>({}));M(O.message||"Impossible de s\xE9lectionner ce site.");return}let p=await f.json().catch(()=>({})),y=Tt(p.slug||c),V=p.name||n;_s(y,V),Ys(y,{siteName:V,persist:!1});let U=encodeURIComponent(Te(y));window.location.href=`/admin/site/${U}/design`}catch(f){console.error("[admin] Impossible de s\xE9lectionner le site",f),M("Erreur inattendue lors de la s\xE9lection.")}},fn=async()=>{try{let o=await fetch("/api/sites/current",{credentials:"same-origin"});if(!o.ok){o.status===404&&J&&(window.location.href="/admin/sites");return}let n=await o.json(),c=Tt(n.slug);_s(c,n.name),Ys(c,{siteName:n.name,persist:!1})}catch(o){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",o)}};(()=>{if(te.slug){Ys(te.slug,{siteName:te.name,persist:!1});return}let o=document.querySelector('[data-site-card][data-site-default="true"]')||qo[0];o&&Ys(o.dataset.siteCard,{siteName:o.dataset.siteName||"",persist:!1})})(),fn(),J?Bo(J.slugValue):te.slug&&Bo(te.slug),Xr.forEach(o=>{o.addEventListener("click",()=>{if(o.disabled)return;let n=o.dataset.siteSelect,c=o.dataset.siteSelectName||"Ce site";n&&(o.disabled=!0,mn(n,c).finally(()=>{o.disabled=!1}))})});let Yt=o=>(o||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),pn=o=>{let n=Yt(o||"");return n?`/${n}`:""},gn=()=>{dt&&(dt.classList.remove("hidden"),dt.classList.add("flex"),Gs=!1,at==null||at.reset(),Qe&&(Qe.textContent=""),Xe&&(Xe.textContent=""),Fe&&Ye&&(Fe.value=Yt(Ye.value)),ks(dt,As),window.setTimeout(()=>{Ye==null||Ye.focus()},0))},As=()=>{dt&&(dt.classList.add("hidden"),dt.classList.remove("flex"),Gs=!1,at==null||at.reset(),Qe&&(Qe.textContent=""),Xe&&(Xe.textContent=""),Cs(dt))};on.forEach(o=>{o.addEventListener("click",gn)}),rn.forEach(o=>{o.addEventListener("click",As)}),dt==null||dt.addEventListener("click",o=>{o.target===dt&&As()}),Ye==null||Ye.addEventListener("input",()=>{Fe&&((!Gs||Fe.value.trim().length===0)&&(Fe.value=Yt(Ye.value)),Qe&&(Qe.textContent=""),Xe&&(Xe.textContent=""))}),Fe==null||Fe.addEventListener("focus",()=>{let o=(Fe==null?void 0:Fe.value)||"",n=(Ye==null?void 0:Ye.value)||"";!o.trim()&&n.trim()&&(Fe.value=Yt(n))}),Fe==null||Fe.addEventListener("input",()=>{Gs=!0,Qe&&(Qe.textContent=""),Xe&&(Xe.textContent="")});let hn=()=>new Set(Array.from(qo).map(o=>Tt(o.dataset.siteCard||"")));at==null||at.addEventListener("submit",async o=>{if(o.preventDefault(),console.log("[admin] Form submit - siteNameInput:",Ye,"siteSlugInput:",Fe),!Ye||!Fe){console.log("[admin] Missing inputs, aborting");return}let n=(Ye.value||"").trim(),c=(Fe.value||"").trim();console.log("[admin] nameValue:",n,"slugValue:",c),!c&&n&&(c=Yt(n),Fe.value=c,console.log("[admin] Auto-generated slug:",c));let f=pn(c);if(console.log("[admin] normalizedSlug:",f),!n){console.log("[admin] Name validation failed"),Xe&&(Xe.textContent="Le nom du site est requis."),Ye.focus();return}if(!f){console.log("[admin] Slug validation failed"),Qe&&(Qe.textContent="Le slug ne peut pas \xEAtre vide ou contenir uniquement des caract\xE8res sp\xE9ciaux."),Fe.focus();return}if(hn().has(f)){Qe&&(Qe.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}Qe&&(Qe.textContent=""),Xe&&(Xe.textContent=""),as&&(as.disabled=!0,as.textContent="Cr\xE9ation...");try{let y=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,slug:f})});if(!y.ok){let Z=await y.json().catch(()=>({})),w=Z.message||"Impossible de cr\xE9er ce site.";Xe&&(Xe.textContent=w),Z.field==="slug"&&Qe&&(Qe.textContent=w);return}let V=await y.json(),U=Tt((V==null?void 0:V.slug)||f),O=(V==null?void 0:V.name)||n;_s(U,O),As();let ee=encodeURIComponent(Te(U));window.location.href=`/admin/site/${ee}/design`}catch(y){console.error("[admin] Impossible de cr\xE9er le site",y),Xe&&(Xe.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{as&&(as.disabled=!1,as.textContent="Cr\xE9er")}}),window.addEventListener("keydown",o=>{o.key==="Escape"&&(dt&&!dt.classList.contains("hidden")&&As(),At&&!At.classList.contains("hidden")&&Qs(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function yn(){let o=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return o?{slugPart:decodeURIComponent(o[1]),slugValue:Tt(decodeURIComponent(o[1])),section:o[2]||"design"}:null}function bn(){return document.querySelector("[data-page-list]")?"design":document.querySelector("[data-collection-list]")?"content":document.querySelector("[data-media-grid]")?"media":document.querySelector("[data-deploy-form]")?"deploy":null}function vn(){if(!At){window.location.href="/admin/sites";return}At.classList.remove("hidden"),At.classList.add("flex"),ks(At,Qs)}function Qs(){At&&(At.classList.add("hidden"),At.classList.remove("flex"),Cs(At))}en.forEach(o=>{o.addEventListener("click",vn)}),tn.forEach(o=>{o.addEventListener("click",Qs)}),Ao==null||Ao.addEventListener("click",()=>{Qs(),window.location.href="/admin/sites"});let Qt="repeating-conic-gradient(#ccc 0% 25%, white 0% 50%) 50% / 8px 8px",xn=o=>{if(!o||typeof o!="string")return null;let n=o.trim().toLowerCase();if(n==="transparent")return null;let c=n.match(/^rgb\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)$/);if(c)return[Math.min(255,Math.max(0,Number(c[1]))),Math.min(255,Math.max(0,Number(c[2]))),Math.min(255,Math.max(0,Number(c[3])))];let f=n.match(/^#([a-f0-9]{3}|[a-f0-9]{6})$/);if(f){let p=f[1],y=p.length===3?p.split("").map(ee=>`${ee}${ee}`).join(""):p,V=parseInt(y.slice(0,2),16),U=parseInt(y.slice(2,4),16),O=parseInt(y.slice(4,6),16);return[V,U,O]}return null},Po=o=>{let n=xn(o);if(!n)return"#0f172a";let[c,f,p]=n;return(.2126*c+.7152*f+.0722*p)/255>.62?"#0f172a":"#ffffff"},Xs=o=>{o&&Array.from(o.options).forEach(n=>{var f;let c=(f=n.dataset)==null?void 0:f.color;if(c){if(c==="transparent"){n.style.background=Qt,n.style.color="#475569";return}n.style.background=c,n.style.color=Po(c)}})},Ts=(J==null?void 0:J.section)||bn();Ts==="design"&&wn(),Ts==="content"&&Sn(),Ts==="media"&&Cn(),Ts==="deploy"&&Ln(),Ts==="settings"&&kn(),J&&te.name&&br(te.name);function wn(){let o=document.querySelectorAll("[data-page-list]");if(o.length===0)return;let n=document.querySelector("[data-active-page-title]"),c=document.querySelector("[data-active-page-slug]"),f=document.querySelector("[data-page-preview-tags]"),p=document.querySelector("[data-page-preview-frame]"),y=document.querySelector("[data-page-preview-frame-wrapper]"),V=document.querySelector("[data-page-preview-shell]"),U=document.querySelectorAll("[data-preview-view-button]"),O=document.querySelector("[data-page-preview-current-view]"),ee=document.querySelector("[data-preview-open]"),Z=document.querySelector("[data-preview-status]"),w=document.querySelector("[data-preview-highlight]"),T=document.querySelector("[data-seo-toggle]"),B=document.querySelector("[data-seo-panel]"),F=document.querySelector("[data-seo-close]"),j=document.querySelector("[data-seo-form]"),R=document.querySelector("[data-seo-title]"),L=document.querySelector("[data-seo-description]"),S=document.querySelector("[data-seo-indexed]"),v=document.querySelector("[data-seo-feedback]"),A=document.querySelector("[data-seo-save]"),q=document.querySelector("[data-page-accessibility-toggle]"),H=document.querySelector("[data-page-accessibility-panel]"),W=document.querySelector("[data-page-accessibility-close]"),Y=document.querySelector("[data-page-accessibility-form]"),K=document.querySelector("[data-page-accessibility-nav]"),be=document.querySelector("[data-page-accessibility-main]"),Ce=document.querySelector("[data-page-accessibility-feedback]"),Je=document.querySelector("[data-page-accessibility-save]"),xe=document.querySelector("[data-page-props-toggle]"),_=document.querySelector("[data-page-props-panel]"),Pe=document.querySelector("[data-page-props-close]"),Ve=document.querySelector("[data-page-props-form]"),I=document.querySelector("[data-page-name]"),k=document.querySelector("[data-page-title-input]"),z=document.querySelector("[data-page-slug-input]"),pe=document.querySelector("[data-page-description]"),C=document.querySelector("[data-page-props-feedback]"),x=document.querySelector("[data-page-props-save]"),E=document.querySelector("[data-blocks-list]"),re=document.querySelector("[data-blocks-empty]"),Q=document.querySelector("[data-block-count]"),ge=document.querySelector("[data-block-library-toggle]"),ae=document.querySelector("[data-block-library]"),we=document.querySelectorAll("[data-block-add]"),de=document.querySelector("[data-block-delete-modal]"),He=document.querySelector("[data-block-delete-confirm]"),Ne=document.querySelector("[data-block-delete-cancel]"),ke=document.querySelector("[data-block-detail-empty]"),qe=document.querySelector("[data-block-detail-status]"),je=document.querySelector("[data-block-editor]"),Ht=document.querySelector("[data-block-editor-block-name]"),h=document.querySelector("[data-block-editor-block-type]"),$=document.querySelector("[data-block-editor-unsupported]"),g=document.querySelector("[data-block-form]"),ne=(e,t)=>{if(e){if(t==="transparent"){e.style.background=Qt,e.style.borderColor="#cbd5f5",e.style.boxShadow="";return}e.style.background=t,e.style.borderColor=t,e.style.boxShadow="0 0 0 1px rgba(15,23,42,0.15)"}},$t=(e,t)=>{if(!e||!t||Array.from(e.options).some(r=>r.value===t))return;let s=document.createElement("option");s.value=t,s.textContent="Couleur personnalis\xE9e",s.dataset.color=t,t==="transparent"?(s.style.background=Qt,s.style.color="#475569"):(s.style.background=t,s.style.color=Po(t)),e.appendChild(s),Xs(e)},Xt=e=>{var l,d,P;if(!e)return;let t=e.options[e.selectedIndex],s=((l=t==null?void 0:t.dataset)==null?void 0:l.color)||"#ffffff",r=(d=e.closest(".relative"))==null?void 0:d.querySelector("[data-color-preview]");r&&(s==="transparent"?r.style.background=Qt:r.style.background=s);let a=(P=e.closest(".relative"))==null?void 0:P.querySelector("[data-theme-color-chip]");ne(a,s)},oo=g?Array.from(g.querySelectorAll("[data-theme-color-select]")):[],Ho=e=>{var s;return(((s=e==null?void 0:e.getAttribute)==null?void 0:s.call(e,"name"))||"").endsWith("-bg")},Is=[{label:"Couleur primaire",value:"theme-primary",cssVar:"--color-primary"},{label:"Couleur secondaire",value:"theme-secondary",cssVar:"--color-secondary"},{label:"Couleur accent",value:"theme-accent",cssVar:"--color-accent"},{label:"Fond",value:"theme-background",cssVar:"--color-background"},{label:"Texte",value:"theme-text",cssVar:"--color-text"}],kr=(e,t="#ffffff")=>{if(!e)return t;let s=getComputedStyle(document.documentElement).getPropertyValue(e);return s?s.trim():t},ro=e=>{e&&(e.innerHTML="",Is.forEach(({label:t,value:s,cssVar:r})=>{let a=document.createElement("option");a.value=s;let l=kr(r);a.textContent=t,a.dataset.color=l,l==="transparent"?(a.style.background=Qt,a.style.color="#475569"):(a.style.background=l,a.style.color=Po(l)),e.appendChild(a)}),e.value=Is[0].value,e.removeAttribute("disabled"),Ho(e)&&Xs(e),Xt(e))},ut=()=>oo.forEach(ro);ut(),document.addEventListener("ai-theme-updated",ut);let Bt=g?Array.from(g.querySelectorAll("[data-editor-section]")):[],Ue=document.querySelectorAll("[data-block-tab]"),We="content",Re=document.querySelectorAll("[data-left-tab]"),mt=document.querySelector('[data-left-panel="blocks"]'),Vt=document.querySelector('[data-left-panel="pages"]'),Ot="blocks",$s=e=>{Ot=e,Re.forEach(t=>{let s=t.dataset.leftTab===e;t.setAttribute("aria-selected",s?"true":"false"),s?(t.classList.add("text-[#9C6BFF]"),t.classList.remove("text-slate-500","hover:text-slate-700"),t.classList.add("after:absolute","after:bottom-0","after:left-0","after:right-0","after:h-0.5","after:bg-[#9C6BFF]")):(t.classList.remove("text-[#9C6BFF]"),t.classList.add("text-slate-500","hover:text-slate-700"),t.classList.remove("after:absolute","after:bottom-0","after:left-0","after:right-0","after:h-0.5","after:bg-[#9C6BFF]"))}),mt&&mt.classList.toggle("hidden",e!=="blocks"),Vt&&Vt.classList.toggle("hidden",e!=="pages")};Re.forEach(e=>{e.addEventListener("click",()=>{$s(e.dataset.leftTab)})});let Bs=document.querySelector("[data-block-form-actions]"),Jt=document.querySelector("[data-block-form-autosave]"),cs=e=>{We=e,Ue.forEach(s=>{let r=s.dataset.blockTab===e;s.setAttribute("aria-selected",r?"true":"false"),r?(s.classList.add("text-[#9C6BFF]"),s.classList.remove("text-slate-500","hover:text-slate-700"),s.classList.add("after:absolute","after:bottom-0","after:left-0","after:right-0","after:h-0.5","after:bg-[#9C6BFF]")):(s.classList.remove("text-[#9C6BFF]"),s.classList.add("text-slate-500","hover:text-slate-700"),s.classList.remove("after:absolute","after:bottom-0","after:left-0","after:right-0","after:h-0.5","after:bg-[#9C6BFF]"))});let t=g==null?void 0:g.querySelector("[data-editor-section]:not(.hidden)");t&&t.querySelectorAll("[data-block-panel]").forEach(r=>{r.dataset.blockPanel===e?r.classList.remove("hidden"):r.classList.add("hidden")}),Bs&&Jt&&(e==="content"?(Bs.classList.remove("hidden"),Jt.classList.add("hidden")):(Bs.classList.add("hidden"),Jt.classList.remove("hidden")))};Ue.forEach(e=>{e.addEventListener("click",()=>{cs(e.dataset.blockTab)})});let $e=g==null?void 0:g.querySelector('[name="collection-grid-collection"]'),es=g==null?void 0:g.querySelector("[data-collection-selection-info]"),Wt=document.querySelector("[data-block-form-cancel]"),ds=g==null?void 0:g.querySelector("[data-group-preview-mobile]"),Ps=g==null?void 0:g.querySelector("[data-group-preview-desktop]"),gt=g==null?void 0:g.querySelector("[data-collection-preview-mobile]"),no=g==null?void 0:g.querySelector("[data-collection-preview-desktop]"),us={hero:{section:"hero",labelField:"title",descriptionField:"subtitle",fields:{title:"hero-title",subtitle:"hero-subtitle",ctaLabel:"hero-cta-label",ctaUrl:"hero-cta-url",image:"hero-image",layout:"hero-layout",imageWidth:"hero-image-width",imageHeight:"hero-image-height",imageObjectFit:"hero-image-object-fit",height:"hero-height",contentAlign:"hero-content-align",horizontalAlign:"hero-horizontal-align",textAlign:"hero-text-align",overlay:"hero-overlay",titleSize:"hero-title-size",bg:"hero-bg",borderRadius:"hero-border-radius",shadow:"hero-shadow",border:"hero-border"}},paragraphe:{section:"paragraph",labelField:"title",descriptionField:"content",fields:{title:"paragraph-title",content:"paragraph-content",align:"paragraph-align",titleSize:"paragraph-title-size",textSize:"paragraph-text-size",spacing:"paragraph-spacing",bg:"paragraph-bg",borderRadius:"paragraph-border-radius",shadow:"paragraph-shadow",border:"paragraph-border"}},image:{section:"image",labelField:"alt",fields:{src:"image-src",alt:"image-alt",showCaption:"image-caption-toggle",caption:"image-caption",rounded:"image-rounded",shadow:"image-shadow",maxWidth:"image-max-width",height:"image-height",objectFit:"image-object-fit",align:"image-align",bg:"image-bg",borderRadius:"image-border-radius",border:"image-border"}},groupe:{section:"group",fields:{columnsMobile:"group-columns-mobile",columnsDesktop:"group-columns-desktop",gap:"group-gap",itemsAlign:"group-items-align",mobileLayout:"group-mobile-layout",bg:"group-bg",borderRadius:"group-border-radius",shadow:"group-shadow",border:"group-border"}},collectiongrid:{section:"collection",fields:{collectionId:"collection-grid-collection",limit:"collection-grid-limit",columnsMobile:"collection-columns-mobile",columnsDesktop:"collection-columns-desktop",gap:"collection-gap",itemsAlign:"collection-items-align",cardRounded:"collection-card-rounded",mobileLayout:"collection-mobile-layout",bg:"collection-bg",borderRadius:"collection-border-radius",shadow:"collection-shadow",border:"collection-border"}},form:{section:"form",labelField:"formTitle",fields:{formTitle:"form-title",actionUrl:"form-action-url",method:"form-method",serviceName:"form-service-name",submitLabel:"form-submit-label",successMessage:"form-success-message",maxWidth:"form-max-width",align:"form-align",buttonRounded:"form-button-rounded",spacing:"form-spacing",bg:"form-bg",borderRadius:"form-border-radius",shadow:"form-shadow",border:"form-border"}},newsletterembed:{section:"newsletter",labelField:"title",fields:{title:"newsletter-title",serviceName:"newsletter-service-name",embedCode:"newsletter-embed-code",maxWidth:"newsletter-max-width",align:"newsletter-align",padding:"newsletter-padding",bg:"newsletter-bg",borderRadius:"newsletter-border-radius",shadow:"newsletter-shadow",border:"newsletter-border"}}},Uo={texte:"paragraphe",paragraph:"paragraphe",paragraphs:"paragraphe",paragraphes:"paragraphe",text:"paragraphe",hero:"hero",image:"image",groupe:"groupe",group:"groupe",collection:"collectiongrid",collectiongrid:"collectiongrid","collection-grid":"collectiongrid",form:"form",formulaire:"form",contact:"form",newsletterembed:"newsletterembed",newsletter:"newsletterembed",embed:"newsletterembed"},Ro={animation:"anim-type",animationDelay:"anim-delay",animationDuration:"anim-duration"};Object.values(us).forEach(e=>{e.fields={...e.fields,...Ro}});let js=(e,t)=>{if(!ds||!Ps)return;let s=r=>Array.from({length:Number(r)||1}).map(()=>'<span class="block h-2 w-full rounded-full bg-slate-300"></span>').join("");ds.innerHTML=s(e),Ps.innerHTML=s(t)},ao=(e,t)=>{if(!gt||!no)return;let s=r=>Array.from({length:Number(r)||1}).map(()=>'<span class="block h-2 w-full rounded-full bg-violet-300"></span>').join("");gt.innerHTML=s(e),no.innerHTML=s(t)},ms=async()=>{if(!St)return[];let e=await fetch(St,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Impossible de charger les pages.");let t=await e.json().catch(()=>[]);return Array.isArray(t)?t:[]},zo=async({name:e,title:t,slug:s})=>{if(!St)throw new Error("Site inconnu.");let r=await fetch(St,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,title:t,slug:s})});if(!r.ok){let a=await r.json().catch(()=>({}));throw new Error(a.message||"Impossible de cr\xE9er la page.")}return r.json().catch(()=>({}))},ts=async e=>{if(!(!St||!(e!=null&&e.id)))try{let t=await fetch(`${St}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let r=await t.json().catch(()=>({}));throw new Error(r.message||"Impossible de sauvegarder la page.")}let s=await t.json().catch(()=>({}));if(s!=null&&s.id){let r=rs(s);return le=le.map(a=>a.id===r.id?r:a),(u==null?void 0:u.id)===r.id&&(u=r),r}return s}catch(t){console.error("[design] Save page failed",t),M(t.message||"Sauvegarde impossible.")}},Vo=async()=>{if(!St){le=[],De=null,u=null,Gt(le,De),Lt(null),ke==null||ke.classList.remove("hidden"),je==null||je.classList.add("hidden");return}try{let e=await ms();if(le=(Array.isArray(e)?e:[]).map(t=>rs(t)),le.length===0){De=null,u=null,Gt(le,De),Lt(null),ke==null||ke.classList.remove("hidden"),je==null||je.classList.add("hidden"),p&&(p.srcdoc=i());return}De=On(le),qt(De)}catch(e){console.error("[design] Impossible de charger les pages",e),M("Impossible de charger les pages.")}},Oo=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),Pt=e=>{if(!e)return null;let t=Oo(e.type),s=Uo[t]||t;return us[s]||null},io=e=>{var r,a,l,d,P,G,ye;if(!g||!je)return;e&&!e.settings&&(e.settings={});let t=Pt(e);if(Ht&&(Ht.textContent=(e==null?void 0:e.label)||"Bloc"),h&&(h.textContent=(e==null?void 0:e.type)||"Bloc"),!t){g.classList.add("hidden"),$==null||$.classList.remove("hidden"),g.dataset.blockId="";return}if($==null||$.classList.add("hidden"),g.classList.remove("hidden"),g.reset(),g.dataset.blockId=e.id,Bt.forEach(se=>{se.dataset.editorSection===t.section?se.classList.remove("hidden"):se.classList.add("hidden")}),cs("content"),t.section==="collection"){let se=e.collectionId||((r=e.settings)==null?void 0:r.collectionId)||"";wo(se)}if(Object.entries(t.fields).forEach(([se,Ie])=>{var N,nt,Ae;let Me=g.querySelector(`[name="${Ie}"]`);if(!Me)return;let ce=(N=e.settings)==null?void 0:N[se];if(Me.type==="checkbox")Me.checked=!!ce;else if(Me.type==="number"){let he=(Ae=(nt=Me.dataset.default)!=null?nt:Me.defaultValue)!=null?Ae:"";Me.value=ce!=null?ce:he}else Me.tagName,Me.value=ce!=null?ce:""}),t.section==="group"){let se=((a=g.querySelector('[name="group-columns-mobile"]'))==null?void 0:a.value)||"1",Ie=((l=g.querySelector('[name="group-columns-desktop"]'))==null?void 0:l.value)||"3";js(se,Ie)}if(t.section==="collection"){let se=((d=g.querySelector('[name="collection-columns-mobile"]'))==null?void 0:d.value)||"1",Ie=((P=g.querySelector('[name="collection-columns-desktop"]'))==null?void 0:P.value)||"3";ao(se,Ie)}let s=(G=t.fields)==null?void 0:G.bg;if(s){let se=g.querySelector(`[name="${s}"]`);$t(se,(ye=e.settings)==null?void 0:ye.bg)}g.querySelectorAll("[data-color-select]").forEach(Xt)},ss=e=>{if(!g||!e)return{};let t={};return Object.entries(e.fields).forEach(([s,r])=>{var l,d;let a=g.querySelector(`[name="${r}"]`);if(a)if(a.type==="checkbox")t[s]=a.checked;else if(a.type==="number"){let P=Number(a.value);t[s]=Number.isFinite(P)?P:0}else if(a.tagName==="SELECT"){let P=(d=(l=a.dataset.default)!=null?l:a.value)!=null?d:"";t[s]=a.value||P}else a.tagName==="TEXTAREA"?t[s]=a.value||"":a.type==="select-one"?t[s]=a.value:t[s]=a.value||""}),t},Ct=e=>{if(Z){if(!e){Z.classList.add("hidden");return}Z.classList.remove("hidden"),Z.textContent=e}},lo=e=>{if(!e)return null;let t=s=>{var r;return{id:s.id,type:s.type,label:s.label,status:s.status,description:s.description,props:s.props||[],settings:s.settings||{},collectionId:s.collectionId||((r=s.settings)==null?void 0:r.collectionId)||"",children:(s.children||[]).map(t)}};return{id:e.id,name:e.name,title:e.title,slug:e.slug,description:e.description||"",badges:[...e.badges||[]],seo:e.seo||{},accessibility:e.accessibility||{},blocks:(e.blocks||[]).map(t)}},i=()=>'<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#475569;background:#fff;">Pr\xE9paration de la pr\xE9visualisation\u2026</body></html>',m=(e,t)=>{let s;return(...r)=>{clearTimeout(s),s=setTimeout(()=>e(...r),t)}},b=async()=>{if(!u||!_e)return;let e=vs(),t=Pt(e);if(!e||!t)return;let s=ss(t),r=(u.blocks||[]).map(l=>{if(l.id!==e.id)return l;let d={...l.settings||{},...s};return{...l,settings:d}}),a={...u,blocks:r};u=a;try{let l=await ts(a);if(l!=null&&l.id){let d=rs(l);u=d,le=le.map(P=>P.id===d.id?d:P)}}catch(l){console.warn("[design] auto-save appearance failed",l)}},D=(e,t)=>{!p||!p.contentWindow||p.contentWindow.postMessage({type:"updateBlockStyles",blockId:e,settings:t},"*")},X=m(()=>{u&&ie(u)},1500),ue=(e,t)=>{D(e,t),Ct("Modification\u2026"),b().then(()=>{Ct("Sauvegard\xE9"),setTimeout(()=>Ct("\xC0 jour"),1500)}).catch(()=>Ct("Erreur de sauvegarde")),X()},ie=e=>{if(!p||!e)return;let t=(J==null?void 0:J.slugValue)||te.slug||"",s=le.map(l=>({id:l.id,slug:l.slug,title:l.title,name:l.name,accessibility:l.accessibility})),r={page:lo(e),site:{title:te.name||"Site",slug:t,pages:s}};er=!1,Ct("Actualisation\u2026"),p.srcdoc=i(),zs&&zs.abort();let a=new AbortController;zs=a,fetch("/api/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:a.signal}).then(l=>{if(!l.ok)throw new Error("Preview error");return l.json()}).then(l=>{a.signal.aborted||(Xo=l.html||"",p.setAttribute("title",`Pr\xE9visualisation de la page ${e.title||""}`.trim()),p.srcdoc=Xo||i(),Ct("\xC0 jour"))}).catch(l=>{a.signal.aborted||(console.error("[preview] Impossible de rendre la page",l),Ct("Erreur preview"),p.srcdoc='<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#be123c;background:#fff;">Erreur lors du rendu de la pr\xE9visualisation.</body></html>')}).finally(()=>{zs===a&&(zs=null)})},me=e=>{var l;if(e.preventDefault(),!u||!_e)return;let t=vs(),s=Pt(t);if(!t||!s)return;let r=ss(s);if(s.section==="image"){let d=(r.alt||"").trim();if(r.alt=d,!d){M("Ajoute un texte alternatif pour cette image.","error"),(l=g==null?void 0:g.querySelector('[name="image-alt"]'))==null||l.focus();return}}if(s.section==="collection"){if(!r.collectionId){M("S\xE9lectionnez une collection.");return}r.limit=Math.max(1,Number(r.limit)||1)}let a=(u.blocks||[]).map(d=>{if(d.id!==t.id)return d;let P={...d.settings||{},...r},G={...d,settings:P};return s.labelField&&r[s.labelField]&&(G.label=r[s.labelField]),s.descriptionField&&r[s.descriptionField]&&(G.description=r[s.descriptionField]),s.section==="collection"&&(G.collectionId=r.collectionId,G.settings.collectionId=r.collectionId,G.settings.limit=r.limit),G});xs(a),M("Bloc mis \xE0 jour"),qt(u.id,{preserveBlock:!0})},Ee=document.querySelector("[data-page-drawer]"),Se=document.querySelector("[data-page-drawer-backdrop]"),et=document.querySelectorAll("[data-page-drawer-open]"),tt=document.querySelectorAll("[data-page-drawer-close]"),Be=document.querySelector("[data-add-page-toggle]"),ve=document.querySelector("[data-add-page-form]"),Oe=document.querySelector("[data-add-page-name]"),Et=document.querySelector("[data-add-page-title]"),st=document.querySelector("[data-add-page-slug]"),fs=document.querySelector("[data-add-page-cancel]"),Ge=document.querySelector("[data-add-page-error]"),Ut=ve==null?void 0:ve.querySelector('[type="submit"]'),ps=document.querySelector("[data-import-pages-toggle]"),lt=document.querySelector("[data-import-modal]"),co=document.querySelectorAll("[data-import-modal-close]"),ot=document.querySelector("[data-import-dropzone]"),gs=document.querySelector("[data-import-file-input]"),hs=document.querySelector("[data-import-file-list]"),Ms=document.querySelector("[data-import-file-names]"),Ze=document.querySelector("[data-import-results]"),Ke=document.querySelector("[data-import-results-content]"),rt=document.querySelector("[data-import-submit]"),ys=document.querySelectorAll("[data-import-tab]"),Fs=document.querySelectorAll("[data-import-panel]"),bs=document.querySelector("[data-copy-prompt]"),Jo=document.querySelector("[data-copy-template]"),Cr=document.querySelector("[data-template-json]"),Er=document.querySelector("[data-import-ai-prompt]"),ht=document.querySelector("[data-import-paste-json]"),Wo=document.querySelector("[data-format-json]"),jt=document.querySelector("[data-import-paste-error]"),Rt=[],os="upload",wt=document.querySelector("[data-delete-page-modal]"),qr=document.querySelector("[data-delete-page-name]"),Go=document.querySelector("[data-delete-page-cancel]"),zt=document.querySelector("[data-delete-page-confirm]"),Ns=null,Un=Te((J==null?void 0:J.slugValue)||te.slug||"default")||"default",Rn=(J==null?void 0:J.slugValue)||te.slug||"",uo=Te(Rn)||"",St=uo?`/api/sites/${encodeURIComponent(uo)}/pages`:null,Ar=uo?`/api/sites/${encodeURIComponent(uo)}/collections`:null,Tr={active:`clower:activePage:${Un}`},Zo=(e,t,s,r,a,l=[],d={})=>{let P={id:e,label:t,type:s,status:r,description:a,props:l,settings:{...d}};return P.settings.collectionId&&(P.collectionId=P.settings.collectionId),P},zn={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}],settings:{title:"Titre du hero",subtitle:"",ctaLabel:"D\xE9couvrir",ctaUrl:"#",image:"",align:"center"}},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}],settings:{title:"Titre du paragraphe",content:"",align:"left"}},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}],settings:{src:"",alt:"",showCaption:!1,caption:""}},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}],settings:{layout:"grid",columnsMobile:"1",columnsDesktop:"3",mobileLayout:"stack"}},collectiongrid:{type:"CollectionGrid",label:"Grille de contenus",description:"Affiche automatiquement les items d\u2019une collection.",status:"Brouillon",settings:{collectionId:"",limit:6,mobileLayout:"stack"}},form:{type:"Form",label:"Formulaire de contact",description:"Formulaire avec envoi vers un service externe.",status:"Brouillon",settings:{formTitle:"Contactez-nous",actionUrl:"",method:"POST",serviceName:"",submitLabel:"Envoyer",successMessage:"Merci pour votre message !"}},newsletterembed:{type:"NewsletterEmbed",label:"Newsletter / Embed",description:"Int\xE9gration d'un formulaire newsletter externe (Brevo, Mailchimp\u2026).",status:"Brouillon",settings:{title:"Restez inform\xE9",serviceName:"",embedCode:""}}},Vn=e=>{try{window.localStorage.setItem(Tr.active,e)}catch{}},On=e=>{var t;try{let s=window.localStorage.getItem(Tr.active);if(s&&e.some(r=>r.id===s))return s}catch{}return((t=e[0])==null?void 0:t.id)||null},Jn=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,Ir=e=>{if(!e||e==="/")return"/";let t=Yt(e.replace(/^\//,""));return t?`/${t}`:"/"},Ko=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,qa=(e,t)=>[Zo(Ko(e,"intro"),"Introduction","Paragraphe","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}],{title:`Introduction \xE0 ${t}`,content:"Ajoutez votre premier paragraphe de pr\xE9sentation.",align:"left"}),Zo(Ko(e,"content"),"Zone de contenu","Groupe","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}],{layout:"grid",columnsMobile:"1",columnsDesktop:"2",mobileLayout:"stack"})],$r=e=>{n&&(n.textContent=(e==null?void 0:e.name)||(e==null?void 0:e.title)||"Page"),c&&(c.textContent=(e==null?void 0:e.slug)||"/")},Wn=e=>{if(!f)return;f.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(s=>{let r=document.createElement("span");r.className="rounded-full bg-slate-100 px-3 py-1",r.textContent=s,f.appendChild(r)})},Gn=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},mo=e=>{if(!(!ke||!je)){if(!e){ke.classList.remove("hidden"),je.classList.add("hidden"),$==null||$.classList.add("hidden"),g==null||g.classList.add("hidden"),qe==null||qe.classList.add("hidden");return}ke.classList.add("hidden"),je.classList.remove("hidden"),qe&&(e.status?(qe.textContent=e.status,qe.className=`rounded-full px-3 py-1 text-xs font-semibold ${Gn(e.status)}`,qe.classList.remove("hidden")):qe.classList.add("hidden")),io(e)}},Zn=()=>{let e=getComputedStyle(document.documentElement).getPropertyValue("--color-accent");return e?e.trim():"#9C6BFF"},Ds=e=>{if(!p)return;let t=p.contentDocument;if(!t)return;if(t.querySelectorAll("[data-preview-block]").forEach(r=>{r.dataset.previewBlock===e?(r.classList.add("preview-block-active"),er&&e&&r.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):r.classList.remove("preview-block-active")}),w){let r=Zn();w.style.borderColor=e?r:"transparent",w.style.opacity=e?"0.5":"0"}},Br={desktop:{width:"100%",height:"640px",maxWidth:"",margin:"0"},mobile:{width:"375px",height:"780px",maxWidth:"375px",margin:"0 auto"}},Pr=e=>{let t=Br[e]?e:"desktop";U.forEach(r=>{let a=r.dataset.previewView===t;r.setAttribute("aria-pressed",a?"true":"false"),a?(r.classList.add("bg-slate-900","text-white"),r.classList.remove("bg-slate-200","text-slate-500")):(r.classList.remove("bg-slate-900","text-white"),r.classList.add("bg-slate-200","text-slate-500"))});let s=Br[t];p&&(p.style.width=s.width,p.style.height=s.height,p.style.maxWidth=s.maxWidth,p.style.margin=s.margin),y&&(y.style.width="100%",y.style.minHeight=s.height,y.style.maxWidth=s.maxWidth||"100%"),V&&(V.dataset.previewShellView=t),O&&(O.textContent=t==="mobile"?"Vue mobile":"Vue bureau")},jr=(e,t=!1,s=null)=>{var ar;let r=e.id===_e,a=(e.type||"").toLowerCase(),l=a==="groupe"||a==="group"||a==="sections"||a==="grid",d=document.createElement("div");d.dataset.blockItem="true",d.dataset.blockId=e.id,s&&(d.dataset.parentBlockId=s),l&&(d.dataset.isGroup="true"),d.setAttribute("role","option"),d.setAttribute("aria-selected",r?"true":"false"),d.setAttribute("draggable","true"),d.tabIndex=0,d.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition group",t?"ml-6 border-dashed":"",r?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let P=document.createElement("span");P.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${r?"":"hidden"}`,d.appendChild(P);let G=document.createElement("div");G.className="flex flex-1 items-center gap-3";let ye=document.createElement("div");ye.className="hidden lg:flex cursor-grab active:cursor-grabbing flex-shrink-0 items-center text-lg text-slate-400 hover:text-slate-600 transition-colors select-none",ye.innerHTML="\u22EE\u22EE",ye.setAttribute("title","Glisser pour r\xE9ordonner"),G.appendChild(ye);let se=document.createElement("div");se.className="flex-1";let Ie=document.createElement("div");Ie.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let Me=document.createElement("span");Me.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",Me.textContent=e.type;let ce=document.createElement("span");if(ce.className="text-slate-400",ce.textContent=e.status,Ie.appendChild(Me),l){let ft=(e.children||[]).length,ns=document.createElement("span");ns.className="rounded-full bg-violet-100 px-2 py-0.5 text-[10px] font-semibold text-violet-600",ns.textContent=`${ft} \xE9l\xE9ment${ft!==1?"s":""}`,Ie.appendChild(ns)}Ie.appendChild(ce);let N=document.createElement("p");N.className="mt-1 text-sm font-semibold text-slate-900";let nt=e.settings&&e.settings.title||e.label||"Bloc sans titre";if(N.textContent=nt,se.appendChild(Ie),se.appendChild(N),a==="collectiongrid"&&e.collectionId){let ft=((ar=Ft.find(Sa=>Sa.id===e.collectionId))==null?void 0:ar.name)||e.collectionId,ns=document.createElement("p");ns.className="text-xs text-slate-400",ns.textContent=`Collection : ${ft}`,se.appendChild(ns)}G.appendChild(se),d.appendChild(G);let Ae=document.createElement("div");Ae.className="flex flex-col gap-1 text-xs text-slate-400";let he=document.createElement("div");he.className="flex items-center gap-1 lg:hidden";let ct=document.createElement("button");ct.type="button",ct.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",ct.textContent="\u2191",ct.addEventListener("click",ft=>{ft.stopPropagation(),s?Dr(s,e.id,-1):Ur(e.id,-1)});let yt=document.createElement("button");yt.type="button",yt.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",yt.textContent="\u2193",yt.addEventListener("click",ft=>{ft.stopPropagation(),s?Dr(s,e.id,1):Ur(e.id,1)}),he.appendChild(ct),he.appendChild(yt),Ae.appendChild(he);let ze=document.createElement("button");return ze.type="button",ze.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",ze.innerHTML="\u{1F5D1}\uFE0F",ze.addEventListener("click",ft=>{ft.stopPropagation(),s?Qn(s,e.id):ia(e.id)}),Ae.appendChild(ze),d.appendChild(Ae),d.addEventListener("click",()=>{Mt(e.id,s)}),d.addEventListener("keydown",ft=>{(ft.key==="Enter"||ft.key===" ")&&(ft.preventDefault(),Mt(e.id,s))}),{item:d,isGroup:l,block:e}},Kn=e=>{let t=document.createElement("div");return t.dataset.groupDropZone=e.id,t.className="ml-6 border-2 border-dashed border-slate-200 rounded-xl p-3 text-center text-xs text-slate-400 hover:border-violet-300 hover:bg-violet-50/50 transition-colors cursor-pointer",t.innerHTML='<span class="pointer-events-none">\u{1F4E6} Glissez un bloc ici ou cliquez pour ajouter</span>',t.addEventListener("dragover",s=>{s.preventDefault(),s.stopPropagation(),t.classList.add("border-violet-400","bg-violet-50")}),t.addEventListener("dragleave",s=>{s.stopPropagation(),t.classList.remove("border-violet-400","bg-violet-50")}),t.addEventListener("drop",s=>{s.preventDefault(),s.stopPropagation(),t.classList.remove("border-violet-400","bg-violet-50");let r=s.dataTransfer.getData("text/plain");r&&r!==e.id&&Yn(r,e.id)}),t.addEventListener("click",()=>{ea(e.id)}),t},Lt=e=>{if(!E)return;E.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(Q&&(Q.textContent=Jn(t.length)),t.length===0){E.classList.add("hidden"),re==null||re.classList.remove("hidden");return}E.classList.remove("hidden"),re==null||re.classList.add("hidden"),t.forEach(s=>{let{item:r,isGroup:a}=jr(s,!1,null);if(E.appendChild(r),a){(s.children||[]).forEach(P=>{let{item:G}=jr(P,!0,s.id);E.appendChild(G)});let d=Kn(s);E.appendChild(d)}})},_n=e=>{if(!u||!e)return null;for(let t=0;t<u.blocks.length;t++){let s=u.blocks[t],r=((s==null?void 0:s.type)||"").toLowerCase();if(!(r==="groupe"||r==="group"||r==="sections"||r==="grid")||!Array.isArray(s.children))continue;let l=s.children.findIndex(d=>d.id===e);if(l!==-1)return{groupId:s.id,groupIndex:t,childIndex:l}}return null},Mr=e=>{if(!u||!e)return null;let t=u.blocks.findIndex(l=>l.id===e);if(t!==-1){let[l]=u.blocks.splice(t,1);return{block:l,from:{type:"root",index:t}}}let s=_n(e);if(!s)return null;let r=u.blocks.find(l=>l.id===s.groupId);if(!r||!Array.isArray(r.children))return null;let[a]=r.children.splice(s.childIndex,1);return{block:a,from:{type:"group",groupId:s.groupId,index:s.childIndex}}},fo=(e,t)=>{if(!u||!e)return;let s=Math.min(Math.max(0,t!=null?t:u.blocks.length),u.blocks.length);u.blocks.splice(s,0,e)},po=(e,t,s)=>{if(!u||!e||!t)return!1;let r=u.blocks.find(l=>l.id===t);if(!r)return!1;Array.isArray(r.children)||(r.children=[]);let a=Math.min(Math.max(0,s!=null?s:r.children.length),r.children.length);return r.children.splice(a,0,e),!0},Fr=(e,t,s=1)=>typeof e!="number"||e<0?null:t==="before"?e:e+s,go=(e=null,t=null,s=null)=>{Lt(u),savePageBlocks(),e&&Mt(e,t),s&&M(s)},Yn=(e,t)=>{var l,d,P;if(!u||!e||!t||e===t)return;let s=u.blocks.find(G=>G.id===t);if(!s)return;let r=Mr(e);if(!(r!=null&&r.block))return;let a=(r.block.type||"").toLowerCase();if(a==="groupe"||a==="group"){M("Impossible d'imbriquer des groupes","error"),((l=r.from)==null?void 0:l.type)==="root"?fo(r.block,r.from.index):((d=r.from)==null?void 0:d.type)==="group"&&po(r.block,r.from.groupId,r.from.index);return}if(((P=r.from)==null?void 0:P.type)==="group"&&r.from.groupId===t){po(r.block,r.from.groupId,r.from.index);return}Array.isArray(s.children)||(s.children=[]),s.children.push(r.block),go(r.block.id,t,"Bloc ajout\xE9 au groupe")},Qn=(e,t)=>{if(!u)return;let s=u.blocks.find(d=>d.id===e);if(!s||!s.children)return;let r=s.children.findIndex(d=>d.id===t);if(r===-1)return;let[a]=s.children.splice(r,1),l=u.blocks.findIndex(d=>d.id===e);u.blocks.splice(l+1,0,a),Lt(u),savePageBlocks(),M("Bloc sorti du groupe")},_o=(e,t,s)=>{if(!u)return;let r=u.blocks.find(d=>d.id===e);if(!r||!Array.isArray(r.children))return;let a=r.children.findIndex(d=>d.id===t);if(a===-1)return;let[l]=r.children.splice(a,1);fo(l,s),go(l.id,null,"Bloc sorti du groupe")},Xn=(e,t,s,r)=>{if(!u)return;let a=u.blocks.find(se=>se.id===e);if(!a||!Array.isArray(a.children))return;let l=a.children.findIndex(se=>se.id===t),d=a.children.findIndex(se=>se.id===s);if(l===-1||d===-1||t===s)return;let[P]=a.children.splice(l,1),G=l<d?d-1:d,ye=r==="before"?G:G+1;a.children.splice(ye,0,P),go(P.id,e,null)},Nr=(e,t,s,r)=>{var G,ye,se,Ie;if(!u||!e||!t)return;let a=Mr(e);if(!(a!=null&&a.block))return;let l=(a.block.type||"").toLowerCase();if(l==="groupe"||l==="group"){M("Impossible d'imbriquer des groupes","error"),((G=a.from)==null?void 0:G.type)==="root"?fo(a.block,a.from.index):((ye=a.from)==null?void 0:ye.type)==="group"&&po(a.block,a.from.groupId,a.from.index);return}let d=u.blocks.find(Me=>Me.id===t);if(!d){((se=a.from)==null?void 0:se.type)==="root"?fo(a.block,a.from.index):((Ie=a.from)==null?void 0:Ie.type)==="group"&&po(a.block,a.from.groupId,a.from.index);return}Array.isArray(d.children)||(d.children=[]);let P=d.children.length;if(s){let Me=d.children.findIndex(N=>N.id===s),ce=Fr(Me,r,1);ce!==null&&(P=ce)}d.children.splice(P,0,a.block),go(a.block.id,t,"Bloc ajout\xE9 au groupe")},Dr=(e,t,s)=>{if(!u)return;let r=u.blocks.find(P=>P.id===e);if(!r||!r.children)return;let a=r.children.findIndex(P=>P.id===t);if(a===-1)return;let l=a+s;if(l<0||l>=r.children.length)return;let[d]=r.children.splice(a,1);r.children.splice(l,0,d),Lt(u),savePageBlocks()},ea=e=>{Hs=e,openBlockPicker()},Hs=null,ta=e=>{!wt||!e||(Ns=e,qr&&(qr.textContent=e.title||e.id),wt.classList.remove("hidden"),wt.classList.add("flex"),ks(wt,ho))},ho=()=>{wt&&(wt.classList.add("hidden"),wt.classList.remove("flex"),Ns=null,Cs(wt))},sa=async()=>{if(!St||!Ns)return;let e=Ns.id,t=Ns.title||e;zt&&(zt.disabled=!0,zt.textContent="Suppression...");try{let s=await fetch(`${St}/${encodeURIComponent(e)}`,{method:"DELETE",credentials:"include"}),r=await s.json();if(!s.ok)throw new Error(r.message||"Erreur serveur");le=le.filter(a=>a.id!==e),De===e?le.length>0?qt(le[0].id):(De=null,u=null,Gt(le,null),Lt(null),ke==null||ke.classList.remove("hidden"),je==null||je.classList.add("hidden"),p&&(p.srcdoc=i())):Gt(le,De),ho(),M(`Page "${t}" supprim\xE9e`)}catch(s){console.error("[pages] delete failed",s),M(s.message||"Erreur suppression")}finally{zt&&(zt.disabled=!1,zt.textContent="Supprimer")}},Gt=(e,t)=>{o.forEach(s=>{s.innerHTML="",e.forEach(r=>{var se;let a=document.createElement("li");a.className="flex items-center gap-1";let l=document.createElement("button");l.type="button",l.dataset.pageId=r.id,l.className=["flex-1 flex items-center gap-3 px-3 py-2 text-left transition",t===r.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===r.id?l.setAttribute("aria-current","page"):l.removeAttribute("aria-current");let d=r.name||r.title,G=((se=r.accessibility)==null?void 0:se.showInMainNav)===!1?'<span class="text-[10px] font-semibold text-amber-600">Masqu\xE9 du menu</span>':"";l.innerHTML=`
            <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
              </svg>
            </span>
            <div class="flex flex-col">
              <span class="text-sm font-semibold">${d}</span>
              <span class="text-xs text-slate-500">${r.slug}</span>
              ${G}
            </div>
          `,l.addEventListener("click",()=>{qt(r.id),Yo()||Qo()}),a.appendChild(l);let ye=document.createElement("button");ye.type="button",ye.className="flex-shrink-0 p-2 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-lg transition",ye.title="Supprimer cette page",ye.setAttribute("aria-label",`Supprimer ${d}`),ye.innerHTML=`
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14ZM10 11v6M14 11v6"/>
            </svg>
          `,ye.addEventListener("click",Ie=>{Ie.stopPropagation(),ta(r)}),a.appendChild(ye),s.appendChild(a)})})},vs=()=>{if(!u||!Array.isArray(u.blocks))return null;let e=u.blocks.find(t=>t.id===_e);if(!e){for(let t of u.blocks)if(t.children&&(e=t.children.find(s=>s.id===_e),e))break}return e||null},Hr=null,Mt=(e,t=null)=>{if(!u)return;if(!e){_e=null,Hr=null,Lt(u),mo(null),Ds(null);return}let s=null;if(s=u.blocks.find(r=>r.id===e),!s&&t){let r=u.blocks.find(a=>a.id===t);r&&r.children&&(s=r.children.find(a=>a.id===e))}if(!s){for(let r of u.blocks)if(r.children){let a=r.children.find(l=>l.id===e);if(a){s=a,t=r.id;break}}}s||(s=u.blocks[0]||null,t=null),_e=(s==null?void 0:s.id)||null,Hr=t,Lt(u),mo(s),Ds(_e)},xs=e=>{if(!u)return;let t={...u,blocks:e};la(t)},yo=()=>window.matchMedia("(min-width: 1024px)").matches;function Ur(e,t){if(!u||!e||!t)return;let s=[...u.blocks||[]],r=s.findIndex(d=>d.id===e);if(r<0)return;let a=r+t;if(a<0||a>=s.length)return;let[l]=s.splice(r,1);s.splice(a,0,l),xs(s),qt(u.id,{preserveBlock:!0}),Mt(l.id)}function Aa(e,t){if(!u||!e||!t||e===t)return;let s=[...u.blocks||[]],r=s.findIndex(d=>d.id===e),a=s.findIndex(d=>d.id===t);if(r<0||a<0)return;let[l]=s.splice(r,1);s.splice(a,0,l),xs(s),qt(u.id,{preserveBlock:!0}),Mt(l.id)}function oa(e,t,s){if(!u||!e||!t||e===t)return;let r=[...u.blocks||[]],a=r.findIndex(G=>G.id===e),l=r.findIndex(G=>G.id===t);if(a<0||l<0)return;let[d]=r.splice(a,1);a<l&&l--;let P=s==="before"?l:l+1;r.splice(P,0,d),xs(r),qt(u.id,{preserveBlock:!0}),Mt(d.id)}function Rr(){if(!E)return;let e=yo();E.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function Us(){ae&&(ae.classList.add("hidden"),Rs=!1)}function ra(){ae&&(ae.classList.remove("hidden"),Rs=!0)}function na(){Rs?Us():ra()}function aa(e){var l;if(!u||!e)return;let t=zn[e];if(!t)return;let s=(u.blocks||[]).filter(d=>d.type===t.type).length+1,r=Zo(Ko(u.id,e),`${t.label} ${s}`,t.type,t.status,t.description,t.props,t.settings||{});if((t.type||"").toLowerCase()==="collectiongrid"){let d=((l=Ft[0])==null?void 0:l.id)||"";r.collectionId=d,r.settings.collectionId=d,r.settings.limit=r.settings.limit||6}if(Hs){let d=u.blocks.find(P=>P.id===Hs);if(d){d.children||(d.children=[]),d.children.push(r),Hs=null,Lt(u),savePageBlocks(),Mt(r.id,d.id),Us(),M("Bloc ajout\xE9 au groupe");return}Hs=null}let a=[...u.blocks||[],r];xs(a),qt(u.id,{preserveBlock:!0}),Mt(r.id),Us(),M("Bloc ajout\xE9")}function zr(e){var r,a;if(!u)return;let t=(u.blocks||[]).filter(l=>l.id!==e),s=e===_e?((r=t[0])==null?void 0:r.id)||null:_e||((a=t[0])==null?void 0:a.id)||null;xs(t),_e=s,qt(u.id,{preserveBlock:!0}),_e?Mt(_e):(mo(null),Ds(null)),M("Bloc supprim\xE9")}function bo(){de&&(de.classList.add("hidden"),de.classList.remove("flex"),xo=null,Cs(de))}function ia(e){if(!de){zr(e);return}xo=e,de.classList.remove("hidden"),de.classList.add("flex"),ks(de,bo)}let la=e=>{if(!e)return;let t=rs(e);le=le.map(s=>s.id===t.id?t:s),u=t,ts(t)},qt=(e,t={})=>{var a,l;let s=le.find(d=>d.id===e)||le[0]||null;u=s?rs(s):null,De=(s==null?void 0:s.id)||null,(!t.preserveBlock||!u||!u.blocks.some(d=>d.id===_e))&&(_e=((l=(a=u==null?void 0:u.blocks)==null?void 0:a[0])==null?void 0:l.id)||null),De&&Vn(De),Gt(le,De),$r(u),nr(),Wn(u),ie(u),Lt(u),mo(vs()),Ds(_e),Rr(),Rs&&Us()},Yo=()=>window.matchMedia("(min-width: 1024px)").matches,Vr=()=>{Ee&&(Yo()?(Ee.classList.add("is-open"),Se==null||Se.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):Ee.classList.remove("is-open"))},ca=()=>{!Ee||Yo()||(Ee.classList.add("is-open"),Se==null||Se.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Qo=()=>{Ee&&(Ee.classList.remove("is-open"),Se==null||Se.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},da=()=>{!ve||!Be||(ve.classList.remove("hidden"),Be.classList.add("hidden"),Ge&&(Ge.textContent=""),vo=!1,Oe&&(Oe.value="",Oe.focus()),Et&&(Et.value=""),st&&(st.value=""))},Or=()=>{!ve||!Be||(ve.classList.add("hidden"),Be.classList.remove("hidden"),Ge&&(Ge.textContent=""),vo=!1,ve.reset())},ua=()=>{!Oe||!st||vo&&st.value.trim().length>0||(st.value=Ir(Oe.value))},le=[],De=null,vo=!1,u=null,_e=null,Rs=!1,xo=null,Xo="",er=!1,zs=null,Ft=[],ma=e=>{let t={...e,props:Array.isArray(e.props)?e.props:[],settings:{...e.settings||{}}};return(t.type||"").toLowerCase()==="collectiongrid"&&(t.collectionId=t.collectionId||t.settings.collectionId||"",t.settings.collectionId=t.collectionId,t.settings.limit=t.settings.limit||6),t},rs=e=>{var t,s,r,a,l;return{...e,blocks:(e.blocks||[]).map(d=>ma(d)),seo:{title:(((t=e.seo)==null?void 0:t.title)||"").trim(),description:(((s=e.seo)==null?void 0:s.description)||"").trim(),indexed:typeof((r=e.seo)==null?void 0:r.indexed)=="boolean"?e.seo.indexed:null},accessibility:{showInMainNav:((a=e.accessibility)==null?void 0:a.showInMainNav)!==!1,mainLabel:(((l=e.accessibility)==null?void 0:l.mainLabel)||"").trim()}}},fa=async()=>{if(!Ar){Ft=[],wo();return}try{let e=await fetch(Ar,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Impossible de charger les collections.");let t=await e.json().catch(()=>[]);Ft=Array.isArray(t)?t:[];let s=($e==null?void 0:$e.value)||"";wo(s)}catch(e){console.error("[design] collections load",e),M("Collections indisponibles."),Ft=[],wo()}},tr=e=>{if(!es)return;if(!e){es.textContent=Ft.length?"S\xE9lectionnez une collection pour afficher ses informations.":"Aucune collection disponible. Ajoutez-en depuis l\u2019onglet Contenus.";return}let t=Ft.find(r=>r.id===e);if(!t){es.textContent=`Collection ${e}`;return}let s=[];t.description&&s.push(t.description),t.type&&s.push(`Type\xA0: ${t.type}`),es.textContent=s.join(" \xB7 ")||`Collection ${t.name||t.id}`},wo=(e="")=>{if($e){if($e.innerHTML="",!Ft.length){$e.disabled=!0;let t=document.createElement("option");t.value="",t.textContent="Aucune collection disponible",$e.appendChild(t),tr("");return}if($e.disabled=!1,e&&!Ft.some(t=>t.id===e)){let t=document.createElement("option");t.value=e,t.textContent=e,$e.appendChild(t)}Ft.forEach(t=>{let s=document.createElement("option");s.value=t.id;let r=t.name||t.id;s.textContent=t.type?`${r} \xB7 ${t.type}`:r,s.dataset.description=t.description||"",$e.appendChild(s)}),e&&($e.value=e),tr($e.value||"")}};fa(),Vr(),et.forEach(e=>{e.addEventListener("click",ca)}),tt.forEach(e=>{e.addEventListener("click",Qo)}),Se==null||Se.addEventListener("click",Qo),window.addEventListener("resize",()=>{Vr(),Rr()}),Be==null||Be.addEventListener("click",da),fs==null||fs.addEventListener("click",Or),Oe==null||Oe.addEventListener("input",ua),st==null||st.addEventListener("input",()=>{Ge&&(Ge.textContent=""),vo=!0}),ve==null||ve.addEventListener("submit",async e=>{if(e.preventDefault(),!St){Ge&&(Ge.textContent="Aucun site s\xE9lectionn\xE9.");return}if(!Oe||!st)return;let t=Oe.value.trim(),s=(Et==null?void 0:Et.value.trim())||t,r=Ir(st.value.trim()||t);if(!t||!r){Ge&&(Ge.textContent="Nom et slug sont requis.");return}Ge&&(Ge.textContent=""),Ut&&(Ut.disabled=!0,Ut.textContent="Cr\xE9ation...");try{let a=await zo({name:t,title:s,slug:r});if(!a||!a.id)throw new Error("R\xE9ponse invalide.");le=[...le,rs(a)],Or(),M("Page cr\xE9\xE9e"),qt(a.id)}catch(a){console.error("[design] create page failed",a),Ge&&(Ge.textContent=a.message||"Impossible de cr\xE9er la page.")}finally{Ut&&(Ut.disabled=!1,Ut.textContent="Cr\xE9er")}});let sr=()=>{ht&&(ht.value=""),jt&&(jt.classList.add("hidden"),jt.textContent="")},Jr=()=>{if(!ht)return null;let e=ht.value.trim();if(!e)return jt&&jt.classList.add("hidden"),null;try{let t=JSON.parse(e);return jt&&jt.classList.add("hidden"),t}catch(t){return jt&&(jt.classList.remove("hidden"),jt.textContent=`\u274C JSON invalide : ${t.message}`),null}},pa=()=>{if(!ht)return;let e=ht.value.trim();if(e)try{let t=JSON.parse(e);ht.value=JSON.stringify(t,null,2),Jr()}catch{}},Vs=()=>{if(rt)if(os==="upload")rt.disabled=Rt.length===0;else if(os==="paste"){let e=Jr();rt.disabled=!e}else rt.disabled=!0},ga=()=>{lt&&(lt.classList.remove("hidden"),lt.classList.add("flex"),Rt=[],os="upload",rr(),sr(),Ze&&Ze.classList.add("hidden"),Ke&&(Ke.innerHTML=""),Vs(),ys.forEach(e=>{e.dataset.importTab==="upload"?(e.classList.add("bg-[#9C6BFF]","text-white"),e.classList.remove("border","border-slate-200","text-slate-700")):(e.classList.remove("bg-[#9C6BFF]","text-white"),e.classList.add("border","border-slate-200","text-slate-700"))}),Fs.forEach(e=>{e.dataset.importPanel==="upload"?e.classList.remove("hidden"):e.classList.add("hidden")}),ks(lt,or))},or=()=>{lt&&(lt.classList.add("hidden"),lt.classList.remove("flex"),Rt=[],sr(),Cs(lt))},rr=()=>{if(!(!hs||!Ms)){if(Rt.length===0){hs.classList.add("hidden"),Vs();return}hs.classList.remove("hidden"),Ms.innerHTML=Rt.map(e=>`<li class="flex items-center gap-2"><span class="text-lg">\u{1F4C4}</span>${e.name}</li>`).join(""),Vs()}},Wr=e=>{let t=Array.from(e).filter(s=>s.type==="application/json"||s.name.endsWith(".json"));if(t.length===0){M("Aucun fichier JSON valide.");return}Rt=t,rr()},ha=async()=>{var s,r,a,l,d,P,G,ye,se,Ie,Me;if(!St)return;let e=[];if(console.log("[import] activeImportTab:",os),os==="paste"){let ce=(s=ht==null?void 0:ht.value)==null?void 0:s.trim();if(console.log("[import] paste text length:",ce==null?void 0:ce.length),!ce){M("Aucun JSON \xE0 importer."),Ze&&Ke&&(Ze.classList.remove("hidden"),Ke.innerHTML='<p class="text-amber-600">\u26A0 Le champ de texte est vide.</p>');return}try{let N=JSON.parse(ce);console.log("[import] parsed JSON:",N),console.log("[import] parsed type:",typeof N,Array.isArray(N)?"array":"not array"),N&&!Array.isArray(N)&&N.pages?(console.log("[import] detected pages+collections format"),e=N):Array.isArray(N)?e.push(...N):e.push(N),console.log("[import] pagesData prepared:",e)}catch(N){let nt=N.message.match(/position (\d+)/),Ae=N.message;if(nt){let he=parseInt(nt[1],10),ct=ce.substring(0,he).split(`
`),yt=ct.length,ze=ct[ct.length-1].length+1;Ae=`Ligne ${yt}, colonne ${ze}: ${N.message}`}M(`Erreur JSON : ${Ae}`,"error"),console.error("[import] paste parse error",N),Ze&&Ke&&(Ze.classList.remove("hidden"),Ke.innerHTML=`
              <div class="text-rose-600">
                <p class="font-medium">\u2717 Erreur de syntaxe JSON</p>
                <p class="text-xs mt-1">${Ae}</p>
                <p class="text-xs mt-2 text-slate-500">V\xE9rifiez les virgules, guillemets et accolades.</p>
              </div>
            `);return}}else if(os==="upload"){if(Rt.length===0)return;let ce=[];for(let N of Rt){let nt=await N.text();try{let Ae=JSON.parse(nt);Array.isArray(Ae)?e.push(...Ae):e.push(Ae)}catch(Ae){let he=Ae.message.match(/position (\d+)/),ct=Ae.message;if(he){let yt=parseInt(he[1],10);ct=`Ligne ${nt.substring(0,yt).split(`
`).length}: ${Ae.message}`}ce.push({file:N.name,error:ct}),console.error("[import] parse error",N.name,Ae)}}if(ce.length>0){if(Ze&&Ke){Ze.classList.remove("hidden");let N='<div class="text-rose-600"><p class="font-medium">\u2717 Erreurs de syntaxe JSON</p><ul class="ml-4 text-xs mt-1">';ce.forEach(nt=>{N+=`<li><strong>${nt.file}</strong>: ${nt.error}</li>`}),N+="</ul></div>",e.length>0&&(N+=`<p class="text-amber-600 mt-2 text-sm">\u26A0 ${e.length} page(s) valide(s) seront import\xE9e(s)</p>`),Ke.innerHTML=N}if(e.length===0){M("Tous les fichiers contiennent des erreurs JSON","error");return}}}else return;let t=Array.isArray(e)?e.length>0:e&&(((r=e.pages)==null?void 0:r.length)>0||e.title);if(console.log("[import] hasData check:",t,"pagesData:",e),!t){M("Aucune page valide \xE0 importer."),Ze&&Ke&&(Ze.classList.remove("hidden"),Ke.innerHTML=`
            <div class="text-amber-600">
              <p class="font-medium">\u26A0 Aucune page d\xE9tect\xE9e</p>
              <p class="text-xs mt-1">Le JSON doit contenir :</p>
              <ul class="text-xs ml-4 mt-1 list-disc">
                <li>Un objet page avec "title" : <code>{"title": "Ma page", ...}</code></li>
                <li>Un tableau de pages : <code>[{"title": "Page 1"}, {"title": "Page 2"}]</code></li>
                <li>Ou un objet combin\xE9 : <code>{"pages": [...], "collections": {...}}</code></li>
              </ul>
            </div>
          `);return}rt&&(rt.disabled=!0,rt.textContent="Import..."),console.log("[import] Sending to server:",JSON.stringify(e).substring(0,500));try{let ce=await fetch(`${St}/import`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});console.log("[import] Server response status:",ce.status);let N=await ce.json();if(console.log("[import] Server response body:",N),!ce.ok)throw Ze&&Ke&&(Ze.classList.remove("hidden"),Ke.innerHTML=`
              <div class="text-rose-600">
                <p class="font-medium">\u2717 Erreur serveur</p>
                <p class="text-xs mt-1">${N.message||"Erreur inconnue"}</p>
                ${N.details?`<p class="text-xs mt-1 text-slate-500">${N.details}</p>`:""}
              </div>
            `),new Error(N.message||"Erreur serveur");if(Ze&&Ke){Ze.classList.remove("hidden");let he="",ct=((a=N.imported)==null?void 0:a.length)>0||((l=N.collectionsCreated)==null?void 0:l.length)>0,yt=((d=N.errors)==null?void 0:d.length)>0;ct&&!yt?he+='<div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-2"><p class="text-green-800 font-medium">\u2713 Import r\xE9ussi</p></div>':ct&&yt?he+='<div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-2"><p class="text-amber-800 font-medium">\u26A0 Import partiel</p></div>':yt&&(he+='<div class="bg-rose-50 border border-rose-200 rounded-lg p-3 mb-2"><p class="text-rose-800 font-medium">\u2717 Import \xE9chou\xE9</p></div>'),N.collectionsCreated&&N.collectionsCreated.length>0&&(he+=`<p class="text-violet-700 mt-2">\u2713 ${N.collectionsCreated.length} collection(s) cr\xE9\xE9e(s)</p>`,he+='<ul class="ml-4 text-xs text-slate-600">',N.collectionsCreated.forEach(ze=>{he+=`<li>${ze.name} (${ze.itemsCount} item${ze.itemsCount>1?"s":""})</li>`}),he+="</ul>"),N.imported&&N.imported.length>0&&(he+=`<p class="text-green-700 mt-2">\u2713 ${N.imported.length} page(s) import\xE9e(s)</p>`,he+='<ul class="ml-4 text-xs text-slate-600">',N.imported.forEach(ze=>{he+=`<li><strong>${ze.title}</strong> \u2192 ${ze.slug} (${ze.action==="updated"?"mise \xE0 jour":"cr\xE9\xE9e"})</li>`}),he+="</ul>"),N.errors&&N.errors.length>0&&(he+=`<p class="text-rose-600 mt-3 font-medium">\u2717 ${N.errors.length} erreur(s)</p>`,he+='<ul class="ml-4 text-xs text-rose-600 space-y-1 mt-1">',N.errors.forEach(ze=>{he+=`<li class="bg-rose-50 p-2 rounded"><strong>${ze.title}</strong><br/><span class="text-rose-500">${ze.error}</span></li>`}),he+="</ul>"),Ke.innerHTML=he}let nt=((P=N.imported)==null?void 0:P.length)>0||((G=N.collectionsCreated)==null?void 0:G.length)>0,Ae=((ye=N.errors)==null?void 0:ye.length)>0;if(N.imported&&N.imported.length>0&&(le=await ms(),Gt(le,De),le.length>0&&!De&&qt(le[0].id)),nt&&!Ae){let he=(se=N.collectionsCreated)!=null&&se.length?` + ${N.collectionsCreated.length} collection(s)`:"";M(`\u2713 Import r\xE9ussi : ${((Ie=N.imported)==null?void 0:Ie.length)||0} page(s)${he}`,"success")}else nt&&Ae?M(`\u26A0 Import partiel : ${((Me=N.imported)==null?void 0:Me.length)||0} page(s), ${N.errors.length} erreur(s)`,"warning"):Ae&&M(`\u2717 Import \xE9chou\xE9 : ${N.errors.length} erreur(s)`,"error");Rt=[],rr(),sr()}catch(ce){console.error("[import] failed",ce),M(ce.message||"Erreur import","error")}finally{rt&&(rt.disabled=!1,rt.textContent="Importer")}};ps==null||ps.addEventListener("click",ga),co.forEach(e=>e.addEventListener("click",or)),lt==null||lt.addEventListener("click",e=>{e.target===lt&&or()}),gs==null||gs.addEventListener("change",e=>{Wr(e.target.files)}),ot==null||ot.addEventListener("dragover",e=>{e.preventDefault(),ot.classList.add("border-[#9C6BFF]","bg-[#9C6BFF]/10")}),ot==null||ot.addEventListener("dragleave",e=>{e.preventDefault(),ot.classList.remove("border-[#9C6BFF]","bg-[#9C6BFF]/10")}),ot==null||ot.addEventListener("drop",e=>{e.preventDefault(),ot.classList.remove("border-[#9C6BFF]","bg-[#9C6BFF]/10"),Wr(e.dataTransfer.files)}),rt==null||rt.addEventListener("click",ha),ht==null||ht.addEventListener("input",()=>{Vs()}),Wo==null||Wo.addEventListener("click",pa),ys.forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.importTab;os=t,ys.forEach(s=>{s.dataset.importTab===t?(s.classList.add("bg-[#9C6BFF]","text-white"),s.classList.remove("border","border-slate-200","text-slate-700")):(s.classList.remove("bg-[#9C6BFF]","text-white"),s.classList.add("border","border-slate-200","text-slate-700"))}),Fs.forEach(s=>{s.dataset.importPanel===t?s.classList.remove("hidden"):s.classList.add("hidden")}),Vs()})}),Jo==null||Jo.addEventListener("click",async()=>{if(!Cr)return;let e=Cr.textContent||"";try{await navigator.clipboard.writeText(e),M("Template copi\xE9 !")}catch(t){console.error("[import] copy failed",t),M("Erreur copie")}}),bs==null||bs.addEventListener("click",async()=>{if(!Er)return;let e=Er.textContent||"";try{await navigator.clipboard.writeText(e),M("Prompt copi\xE9 !")}catch(t){console.error("[import] copy prompt failed",t),M("Erreur copie")}}),Go==null||Go.addEventListener("click",ho),zt==null||zt.addEventListener("click",sa),wt==null||wt.addEventListener("click",e=>{e.target===wt&&ho()}),ge==null||ge.addEventListener("click",e=>{e.stopPropagation(),na()}),document.addEventListener("click",e=>{Rs&&(ae!=null&&ae.contains(e.target)||ge!=null&&ge.contains(e.target)||Us())}),we.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let s=e.dataset.blockAdd;aa(s)})}),Ne==null||Ne.addEventListener("click",()=>{bo()}),He==null||He.addEventListener("click",()=>{xo&&zr(xo),bo()}),de==null||de.addEventListener("click",e=>{e.target===de&&bo()}),g==null||g.addEventListener("input",e=>{var r,a,l,d;let t=e.target;if(!t||!t.name)return;if(t.name==="group-columns-mobile"||t.name==="group-columns-desktop"){let P=((r=g.querySelector('[name="group-columns-mobile"]'))==null?void 0:r.value)||"1",G=((a=g.querySelector('[name="group-columns-desktop"]'))==null?void 0:a.value)||"3";js(P,G)}if(t.name==="collection-columns-mobile"||t.name==="collection-columns-desktop"){let P=((l=g.querySelector('[name="collection-columns-mobile"]'))==null?void 0:l.value)||"1",G=((d=g.querySelector('[name="collection-columns-desktop"]'))==null?void 0:d.value)||"3";ao(P,G)}let s=t.closest("[data-block-panel]");if(s&&s.dataset.blockPanel==="appearance"){let P=vs(),G=Pt(P);if(P&&G){let ye=ss(G);ue(P.id,ye)}}}),g==null||g.addEventListener("change",e=>{var r,a;let t=e.target;if(!t||!t.name)return;if(t.hasAttribute("data-color-select")){let l=t.options[t.selectedIndex],d=((r=l==null?void 0:l.dataset)==null?void 0:r.color)||"#ffffff",P=(a=t.closest(".relative"))==null?void 0:a.querySelector("[data-color-preview]");P&&(d==="transparent"?P.style.background=Qt:P.style.background=d)}let s=t.closest("[data-block-panel]");if(s&&s.dataset.blockPanel==="appearance"){let l=vs(),d=Pt(l);if(l&&d){let P=ss(d);ue(l.id,P)}}}),$e==null||$e.addEventListener("change",e=>{let t=e.target;tr((t==null?void 0:t.value)||"")}),g==null||g.addEventListener("submit",me),Wt==null||Wt.addEventListener("click",e=>{e.preventDefault();let t=vs();t&&io(t)}),U.length>0&&(U.forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.previewView||"desktop";Pr(t)})}),Pr("desktop")),p==null||p.addEventListener("load",()=>{var r;er=!0,Ct("\xC0 jour"),Ds(_e);let e=p==null?void 0:p.contentDocument;if(!e||!u||e.documentElement.dataset.rawditPreviewSelectBound==="true")return;if(e.documentElement.dataset.rawditPreviewSelectBound="true",!e.getElementById("rawdit-preview-select-style")){let a=e.createElement("style");a.id="rawdit-preview-select-style",a.textContent=`
	          [data-preview-block]{ cursor:pointer; }
	          [data-preview-block]:hover{ outline:2px solid var(--color-accent, #9C6BFF); outline-offset:2px; }
	        `,(r=e.head)==null||r.appendChild(a)}let t=a=>{let l=((a==null?void 0:a.type)||"").toLowerCase();return l==="groupe"||l==="group"||l==="sections"||l==="grid"},s=a=>{if(!u||!a||(u.blocks||[]).some(l=>l.id===a))return null;for(let l of u.blocks||[])if(!(!t(l)||!Array.isArray(l.children))&&l.children.some(d=>d.id===a))return l.id;return null};e.addEventListener("click",a=>{var ye,se,Ie;let l=a.target,d=(ye=l==null?void 0:l.closest)==null?void 0:ye.call(l,"[data-preview-block]"),P=((se=d==null?void 0:d.getAttribute)==null?void 0:se.call(d,"data-preview-block"))||"";if(!P)return;a.preventDefault(),a.stopPropagation(),(Ie=a.stopImmediatePropagation)==null||Ie.call(a);let G=s(P);Mt(P,G)},!0)}),ee==null||ee.addEventListener("click",()=>{let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Xo||i()),t.close()});let Gr=e=>{var t,s,r;B&&(e?(B.classList.remove("hidden"),u&&(R&&(R.value=((t=u.seo)==null?void 0:t.title)||""),L&&(L.value=((s=u.seo)==null?void 0:s.description)||""),S&&(S.checked=((r=u.seo)==null?void 0:r.indexed)!==!1))):B.classList.add("hidden"))},So=(e,t="muted")=>{if(!v)return;let s=t==="success"?"text-emerald-600":t==="error"?"text-rose-600":"text-slate-500";v.textContent=e||"",v.className=`text-sm ${s}`};T==null||T.addEventListener("click",()=>{let e=B&&!B.classList.contains("hidden");Gr(!e)}),F==null||F.addEventListener("click",()=>Gr(!1)),j==null||j.addEventListener("submit",async e=>{var t;if(e.preventDefault(),!u){So("Aucune page active.","error");return}A&&(A.disabled=!0),So("");try{let s={title:((R==null?void 0:R.value)||"").trim(),description:((L==null?void 0:L.value)||"").trim(),indexed:(t=S==null?void 0:S.checked)!=null?t:!0},r={...u,seo:s},a=await ts(r);a&&(u=a,So("SEO enregistr\xE9.","success"),M("SEO mis \xE0 jour"),ie(u))}catch(s){console.error("[seo] save failed",s),So(s.message||"Erreur lors de la sauvegarde.","error")}finally{A&&(A.disabled=!1)}});let nr=()=>{var e,t;if(!(!K&&!be)){if(!u){K&&(K.checked=!0),be&&(be.value="");return}K&&(K.checked=((e=u.accessibility)==null?void 0:e.showInMainNav)!==!1),be&&(be.value=((t=u.accessibility)==null?void 0:t.mainLabel)||"")}},Zr=e=>{H&&(e?(nr(),H.classList.remove("hidden")):H.classList.add("hidden"))},Lo=(e,t="muted")=>{if(!Ce)return;let s=t==="success"?"text-emerald-600":t==="error"?"text-rose-600":"text-slate-500";Ce.textContent=e||"",Ce.className=`text-sm ${s}`};q==null||q.addEventListener("click",()=>{let e=H&&!H.classList.contains("hidden");Zr(!e)}),W==null||W.addEventListener("click",()=>Zr(!1)),Y==null||Y.addEventListener("submit",async e=>{var t;if(e.preventDefault(),!u){Lo("Aucune page active.","error");return}Je&&(Je.disabled=!0),Lo("");try{let s={showInMainNav:(t=K==null?void 0:K.checked)!=null?t:!0,mainLabel:((be==null?void 0:be.value)||"").trim()},r={...u,accessibility:s},a=await ts(r);a&&(u=a,nr(),Lo("Accessibilit\xE9 enregistr\xE9e.","success"),M("Accessibilit\xE9 mise \xE0 jour"),Gt(le,De),ie(u))}catch(s){console.error("[accessibility] save failed",s),Lo(s.message||"Erreur lors de la sauvegarde.","error")}finally{Je&&(Je.disabled=!1)}});let Kr=e=>{_&&(e?(_.classList.remove("hidden"),u&&(I&&(I.value=u.name||""),k&&(k.value=u.title||""),z&&(z.value=u.slug||""),pe&&(pe.value=u.description||""))):_.classList.add("hidden"))},ws=(e,t="muted")=>{if(!C)return;let s=t==="success"?"text-emerald-600":t==="error"?"text-rose-600":"text-slate-500";C.textContent=e||"",C.className=`text-sm ${s}`};xe==null||xe.addEventListener("click",()=>{let e=_&&!_.classList.contains("hidden");Kr(!e)}),Pe==null||Pe.addEventListener("click",()=>Kr(!1)),Ve==null||Ve.addEventListener("submit",async e=>{if(e.preventDefault(),!u){ws("Aucune page active.","error");return}x&&(x.disabled=!0),ws("");try{let t=((I==null?void 0:I.value)||"").trim(),s=((k==null?void 0:k.value)||"").trim(),r=((z==null?void 0:z.value)||"").trim(),a=((pe==null?void 0:pe.value)||"").trim();if(!s){ws("Le titre est requis.","error"),x&&(x.disabled=!1);return}if(!r||!r.startsWith("/")){ws("Le slug doit commencer par /.","error"),x&&(x.disabled=!1);return}let l={...u,name:t||s,title:s,slug:r,description:a},d=await ts(l);d&&(u=d,le=le.map(P=>P.id===d.id?d:P),ws("Propri\xE9t\xE9s enregistr\xE9es.","success"),M("Page mise \xE0 jour"),$r(u),Gt(le,De),ie(u))}catch(t){console.error("[page-props] save failed",t),ws(t.message||"Erreur lors de la sauvegarde.","error")}finally{x&&(x.disabled=!1)}});let ya=e=>{let t=e.target.closest("[data-block-item]");if(!t||!yo()){e.preventDefault();return}if(Nt=t.dataset.blockId||null,Os=t.dataset.parentBlockId||null,!Nt){e.preventDefault();return}e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",Nt),e.dataTransfer.setData("application/x-rawdit-parent",Os||""),requestAnimationFrame(()=>{t.classList.add("opacity-50","scale-[0.98]","shadow-lg","ring-2","ring-[#9C6BFF]")})},_r=()=>{E==null||E.querySelectorAll("[data-block-item]").forEach(e=>{e.classList.remove("opacity-50","scale-[0.98]","shadow-lg","ring-2","ring-[#9C6BFF]","border-t-4","border-b-4","border-t-[#9C6BFF]","border-b-[#9C6BFF]","pt-6","pb-6")})},ba=()=>{Nt=null,Os=null,_r()},va=e=>{if(!Nt||!yo())return;let t=e.target.closest("[data-block-item]");if(!t||t.dataset.blockId===Nt)return;e.preventDefault(),e.dataTransfer.dropEffect="move";let s=t.getBoundingClientRect(),r=s.top+s.height/2,a=e.clientY<r;E==null||E.querySelectorAll("[data-block-item]").forEach(l=>{l!==t&&l.dataset.blockId!==Nt&&l.classList.remove("border-t-4","border-b-4","border-t-[#9C6BFF]","border-b-[#9C6BFF]","pt-6","pb-6")}),t.classList.remove("border-t-4","border-b-4","border-t-[#9C6BFF]","border-b-[#9C6BFF]","pt-6","pb-6"),a?t.classList.add("border-t-4","border-t-[#9C6BFF]","pt-6"):t.classList.add("border-b-4","border-b-[#9C6BFF]","pb-6"),t.dataset.dropPosition=a?"before":"after"},xa=e=>{let t=e.target.closest("[data-block-item]");if(!t)return;let s=e.relatedTarget;s&&t.contains(s)||(t.classList.remove("border-t-4","border-b-4","border-t-[#9C6BFF]","border-b-[#9C6BFF]","pt-6","pb-6"),delete t.dataset.dropPosition)},wa=e=>{if(!Nt||!yo())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),s=Nt,r=Os,a=(t==null?void 0:t.dataset.dropPosition)||"after";Nt=null,Os=null,_r();let l=(t==null?void 0:t.dataset.blockId)||null;if(!u||!s)return;if(!l){r&&_o(r,s,u.blocks.length);return}if(s===l)return;let d=(t==null?void 0:t.dataset.parentBlockId)||null;if(r){if(d){if(d===r){Xn(r,s,l,a);return}Nr(s,d,l,a);return}let P=u.blocks.findIndex(ye=>ye.id===l);if(P===-1){_o(r,s,u.blocks.length);return}let G=Fr(P,a,1);_o(r,s,G!=null?G:u.blocks.length);return}if(d){Nr(s,d,l,a);return}oa(s,l,a)},Nt=null,Os=null;E==null||E.addEventListener("dragstart",ya),E==null||E.addEventListener("dragend",ba),E==null||E.addEventListener("dragover",va),E==null||E.addEventListener("dragleave",xa),E==null||E.addEventListener("drop",wa),Vo(),document.addEventListener("ai-page-updated",async e=>{var t;console.log("[design] Rafra\xEEchissement d\xE9clench\xE9 par IA",e.detail);try{let s=await ms();if(le=(Array.isArray(s)?s:[]).map(r=>rs(r)),(t=e.detail)!=null&&t.pageId){let r=le.find(a=>a.id===e.detail.pageId);r&&(u=r,De=r.id,ie(u),Lt(u),M("Page mise \xE0 jour par l'IA"))}else if(De){let r=le.find(a=>a.id===De);r&&(u=r,ie(u),Lt(u))}}catch(s){console.error("[design] Erreur rafra\xEEchissement IA:",s)}})}function Sn(){var ss,Ct,lo;let o=document.querySelector("[data-collection-list]");if(!o)return;let n={empty:document.querySelector('[data-content-view="empty"]'),header:document.querySelector('[data-content-view="header"]'),collection:document.querySelector('[data-content-view="collection"]'),footer:document.querySelector('[data-content-view="footer"]')},c=document.querySelectorAll("[data-content-section]"),f=document.querySelectorAll("[data-content-section-trigger]"),p=document.querySelector("[data-header-status]"),y=document.querySelector("[data-footer-status]"),V=document.querySelector("[data-collection-count]"),U=document.querySelector("[data-item-panel]"),O=document.querySelectorAll("[data-item-panel-close]"),ee=document.querySelector("[data-collection-empty]"),Z=document.querySelector("[data-collection-items-empty]"),w=document.querySelector("[data-item-table-wrapper]"),T=document.querySelector("[data-item-table-body]"),B=document.querySelector("[data-collection-title]"),F=document.querySelector("[data-collection-description]"),j=document.querySelector("[data-item-add]"),R=document.querySelector("[data-item-detail-empty]"),L=document.querySelector("[data-item-form]"),S=L?{title:L.querySelector('[name="item-title"]'),slug:L.querySelector('[name="item-slug"]'),excerpt:L.querySelector('[name="item-excerpt"]'),content:L.querySelector('[name="item-content"]'),image:L.querySelector('[name="item-image"]'),ctaText:L.querySelector('[name="item-cta-text"]'),ctaUrl:L.querySelector('[name="item-cta-url"]'),status:L.querySelector('[name="item-status"]')}:{},v=document.querySelector("[data-item-status-badge]"),A=document.querySelector("[data-item-delete]"),q=document.querySelector("[data-item-delete-modal]"),H=document.querySelector("[data-item-delete-cancel]"),W=document.querySelector("[data-item-delete-confirm]"),Y=document.querySelector("[data-item-cancel]"),K=document.querySelector("[data-item-save]"),be="rounded-full px-3 py-1 text-xs font-semibold",Ce=()=>window.matchMedia("(min-width: 1024px)").matches,Je=i=>{if(!U||Ce())return;let m=U.dataset.itemPanelHidden||"",b=U.dataset.itemPanelVisible||"";i?(Dt(U,b,"remove"),Dt(U,m,"add"),U.classList.add("pointer-events-none"),U.dataset.itemPanelOpen="false"):(Dt(U,m,"remove"),Dt(U,b,"add"),U.classList.remove("pointer-events-none"),U.dataset.itemPanelOpen="true")},xe=()=>{if(U){if(Ce()){let i=U.dataset.itemPanelHidden||"";Dt(U,i,"remove"),U.classList.remove("pointer-events-none"),U.dataset.itemPanelOpen="true";return}L!=null&&L.classList.contains("hidden")?Je(!0):Je(!1)}};window.addEventListener("resize",xe),O.forEach(i=>{i.addEventListener("click",m=>{m.preventDefault(),!Ce()&&$e()})}),xe();let _={logo:document.querySelector('[name="header-logo"]'),logoAlt:document.querySelector('[name="header-logo-alt"]'),logoUrl:document.querySelector('[name="header-logo-url"]'),ctaText:document.querySelector('[name="header-cta-text"]'),ctaUrl:document.querySelector('[name="header-cta-url"]'),ctaStyle:document.querySelector('[name="header-cta-style"]'),position:document.querySelector('[name="header-position"]'),bg:document.querySelector('[name="header-bg"]')},Pe=document.querySelector("[data-header-nav-list]"),Ve=document.querySelector("[data-header-nav-add]"),I=document.querySelector("[data-header-save]"),k=document.querySelector("[data-template-header-nav-item]"),z=document.querySelector("[data-header-pages-list]"),pe=[],C=[],x={linkedin:document.querySelector('[name="footer-social-linkedin"]'),twitter:document.querySelector('[name="footer-social-twitter"]'),instagram:document.querySelector('[name="footer-social-instagram"]'),facebook:document.querySelector('[name="footer-social-facebook"]'),youtube:document.querySelector('[name="footer-social-youtube"]'),github:document.querySelector('[name="footer-social-github"]'),copyright:document.querySelector('[name="footer-copyright"]'),legalUrl:document.querySelector('[name="footer-legal-url"]'),privacyUrl:document.querySelector('[name="footer-privacy-url"]'),bg:document.querySelector('[name="footer-bg"]'),columnsCount:document.querySelector('[name="footer-columns-count"]')},E=document.querySelector("[data-footer-columns-list]"),re=document.querySelector("[data-footer-column-add]"),Q=document.querySelector("[data-footer-save]"),ge=document.querySelector("[data-template-footer-column]"),ae=document.querySelector("[data-template-footer-link]"),we=null,de={nav:[],logo:{},cta:{},style:{}},He={columns:[],socials:{},copyright:"",legal:{},style:{}},Ne=Te((J==null?void 0:J.slugValue)||te.slug||""),ke=Ne,qe=Ne?`/api/sites/${encodeURIComponent(Ne)}/layout`:null,je=i=>{Object.entries(n).forEach(([m,b])=>{b&&b.classList.toggle("hidden",m!==i)}),c.forEach(m=>{m.dataset.contentSection===i?m.dataset.active="true":delete m.dataset.active}),we=i};c.forEach(i=>{i.addEventListener("click",()=>{let m=i.dataset.contentSection;(m==="header"||m==="footer")&&je(m)})}),f.forEach(i=>{i.addEventListener("click",()=>{let m=i.dataset.contentSectionTrigger;m&&je(m)})});let Ht=async()=>{if(!(!ke||!z))try{let i=await fetch(`/api/sites/${ke}/pages`,{credentials:"include"});if(!i.ok)throw new Error("Erreur chargement pages");pe=await i.json(),g()}catch(i){console.error("[header] load pages error",i),z.innerHTML='<p class="text-xs text-red-500">Erreur chargement pages</p>'}},h=i=>{let m=(i||"").toString().trim();if(!m||m==="/"||m==="index")return"/";let b=m.toLowerCase();if(m.startsWith("#")||b.startsWith("mailto:")||b.startsWith("tel:")||/^[a-z]+:\/\//i.test(m))return m;if(m.startsWith("//")){let X=m.slice(2);if(X.includes("."))return m;let ue=X.replace(/^\/+/,"").replace(/\/+$/,"");return ue?`/${ue}`:"/"}let D=m.replace(/^\/+/,"").replace(/\/+$/,"");return D?`/${D}`:"/"},$=(i,m="")=>{let b=(i||"").toString().trim();return b?h(b):m},g=()=>{if(z){if(z.innerHTML="",pe.length===0){z.innerHTML='<p class="text-xs text-slate-400 italic">Aucune page disponible</p>';return}pe.forEach(i=>{let m=i.slug||i.id||"",b=i.name||i.title||m,D=h(m),X=C.some(me=>me.url===D),ue=document.createElement("label");ue.className="flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-200 hover:bg-slate-50 cursor-pointer transition-colors",ue.innerHTML=`
          <input type="checkbox" name="nav-page" value="${D}" data-page-title="${b}"
                 class="w-4 h-4 rounded border-slate-300 text-violet-600 focus:ring-violet-500"
                 ${X?"checked":""}>
          <span class="flex-1 text-sm text-slate-700">${b}</span>
          <span class="text-xs text-slate-400">${D}</span>
        `;let ie=ue.querySelector("input");ie.addEventListener("change",()=>{ie.checked?C.some(me=>me.url===D)||C.push({label:b,url:D}):C=C.filter(me=>me.url!==D)}),z.appendChild(ue)})}},ne=()=>{var m,b,D,X,ue,ie,me,Ee,Se,et,tt;let i=[];return z==null||z.querySelectorAll('input[name="nav-page"]:checked').forEach(Be=>{let ve=h(Be.value),Oe=Be.dataset.pageTitle||ve;i.push({label:Oe,url:ve})}),{logo:{src:((b=(m=_.logo)==null?void 0:m.value)==null?void 0:b.trim())||"",alt:((X=(D=_.logoAlt)==null?void 0:D.value)==null?void 0:X.trim())||"",url:$((ue=_.logoUrl)==null?void 0:ue.value,"/")},nav:i,cta:{text:((me=(ie=_.ctaText)==null?void 0:ie.value)==null?void 0:me.trim())||"",url:$((Ee=_.ctaUrl)==null?void 0:Ee.value,""),style:((Se=_.ctaStyle)==null?void 0:Se.value)||"primary"},style:{position:((et=_.position)==null?void 0:et.value)||"static",bg:((tt=_.bg)==null?void 0:tt.value)||"bg-white"}}},$t=async i=>{var b,D,X,ue,ie,me,Ee,Se,et,tt,Be;if(!i)return;_.logo&&(_.logo.value=((b=i.logo)==null?void 0:b.src)||""),_.logoAlt&&(_.logoAlt.value=((D=i.logo)==null?void 0:D.alt)||""),_.logoUrl&&(_.logoUrl.value=$((X=i.logo)==null?void 0:X.url,"/")),_.ctaText&&(_.ctaText.value=((ue=i.cta)==null?void 0:ue.text)||""),_.ctaUrl&&(_.ctaUrl.value=$((ie=i.cta)==null?void 0:ie.url,"")),_.ctaStyle&&(_.ctaStyle.value=((me=i.cta)==null?void 0:me.style)||"primary"),_.position&&(_.position.value=((Ee=i.style)==null?void 0:Ee.position)||"static"),_.bg&&(_.bg.value=((Se=i.style)==null?void 0:Se.bg)||"bg-white"),C=(i.nav||[]).map(ve=>({...ve,url:h(ve.url)})),await Ht();let m=((et=i.logo)==null?void 0:et.src)||((tt=i.nav)==null?void 0:tt.length)>0||((Be=i.cta)==null?void 0:Be.text);p&&(p.classList.toggle("bg-green-500",!!m),p.classList.toggle("bg-slate-300",!m),p.title=m?"Configur\xE9":"Non configur\xE9")};I==null||I.addEventListener("click",async()=>{if(qe){I.disabled=!0,I.textContent="Enregistrement...";try{let i=ne();if(!(await fetch(`${qe}/header`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok)throw new Error("Erreur serveur");de=i,$t(i),M("Header enregistr\xE9")}catch(i){console.error("[header] save error",i),M("Erreur lors de l'enregistrement","error")}finally{I.disabled=!1,I.textContent="Enregistrer"}}});let Xt=(i,m="",b="")=>{if(!ae||!i)return;let D=ae.content.cloneNode(!0),X=D.querySelector("[data-footer-link]"),ue=D.querySelector('[name="link-label"]'),ie=D.querySelector('[name="link-url"]'),me=D.querySelector("[data-link-remove]");ue&&(ue.value=m),ie&&(ie.value=b),me==null||me.addEventListener("click",()=>X==null?void 0:X.remove()),i.appendChild(D)},oo=(i="",m=[])=>{if(!ge||!E)return;let b=ge.content.cloneNode(!0),D=b.querySelector("[data-footer-column]"),X=b.querySelector('[name="column-title"]'),ue=b.querySelector("[data-column-links]"),ie=b.querySelector("[data-column-link-add]"),me=b.querySelector("[data-column-remove]");X&&(X.value=i),m.forEach(Ee=>Xt(ue,Ee.label,Ee.url)),ie==null||ie.addEventListener("click",()=>Xt(ue)),me==null||me.addEventListener("click",()=>D==null?void 0:D.remove()),E.appendChild(b)},Ho=()=>{var m,b,D,X,ue,ie,me,Ee,Se,et,tt,Be,ve,Oe,Et,st,fs,Ge,Ut,ps;let i=[];return E==null||E.querySelectorAll("[data-footer-column]").forEach(lt=>{var gs,hs;let co=((hs=(gs=lt.querySelector('[name="column-title"]'))==null?void 0:gs.value)==null?void 0:hs.trim())||"",ot=[];lt.querySelectorAll("[data-footer-link]").forEach(Ms=>{var rt,ys,Fs,bs;let Ze=((ys=(rt=Ms.querySelector('[name="link-label"]'))==null?void 0:rt.value)==null?void 0:ys.trim())||"",Ke=((bs=(Fs=Ms.querySelector('[name="link-url"]'))==null?void 0:Fs.value)==null?void 0:bs.trim())||"";(Ze||Ke)&&ot.push({label:Ze,url:Ke})}),(co||ot.length>0)&&i.push({title:co,links:ot})}),{columns:i,socials:{linkedin:((b=(m=x.linkedin)==null?void 0:m.value)==null?void 0:b.trim())||"",twitter:((X=(D=x.twitter)==null?void 0:D.value)==null?void 0:X.trim())||"",instagram:((ie=(ue=x.instagram)==null?void 0:ue.value)==null?void 0:ie.trim())||"",facebook:((Ee=(me=x.facebook)==null?void 0:me.value)==null?void 0:Ee.trim())||"",youtube:((et=(Se=x.youtube)==null?void 0:Se.value)==null?void 0:et.trim())||"",github:((Be=(tt=x.github)==null?void 0:tt.value)==null?void 0:Be.trim())||""},copyright:((Oe=(ve=x.copyright)==null?void 0:ve.value)==null?void 0:Oe.trim())||"",legal:{url:((st=(Et=x.legalUrl)==null?void 0:Et.value)==null?void 0:st.trim())||"",privacyUrl:((Ge=(fs=x.privacyUrl)==null?void 0:fs.value)==null?void 0:Ge.trim())||""},style:{bg:((Ut=x.bg)==null?void 0:Ut.value)||"bg-slate-900 text-white",columnsCount:((ps=x.columnsCount)==null?void 0:ps.value)||"4"}}},Is=i=>{var b,D,X,ue,ie,me,Ee,Se,et,tt,Be;if(!i)return;x.linkedin&&(x.linkedin.value=((b=i.socials)==null?void 0:b.linkedin)||""),x.twitter&&(x.twitter.value=((D=i.socials)==null?void 0:D.twitter)||""),x.instagram&&(x.instagram.value=((X=i.socials)==null?void 0:X.instagram)||""),x.facebook&&(x.facebook.value=((ue=i.socials)==null?void 0:ue.facebook)||""),x.youtube&&(x.youtube.value=((ie=i.socials)==null?void 0:ie.youtube)||""),x.github&&(x.github.value=((me=i.socials)==null?void 0:me.github)||""),x.copyright&&(x.copyright.value=i.copyright||""),x.legalUrl&&(x.legalUrl.value=((Ee=i.legal)==null?void 0:Ee.url)||""),x.privacyUrl&&(x.privacyUrl.value=((Se=i.legal)==null?void 0:Se.privacyUrl)||""),x.bg&&(x.bg.value=((et=i.style)==null?void 0:et.bg)||"bg-slate-900 text-white"),x.columnsCount&&(x.columnsCount.value=((tt=i.style)==null?void 0:tt.columnsCount)||"4"),E&&(E.innerHTML=""),(i.columns||[]).forEach(ve=>oo(ve.title,ve.links));let m=((Be=i.columns)==null?void 0:Be.length)>0||i.copyright||Object.values(i.socials||{}).some(ve=>ve);y&&(y.classList.toggle("bg-green-500",!!m),y.classList.toggle("bg-slate-300",!m),y.title=m?"Configur\xE9":"Non configur\xE9")};re==null||re.addEventListener("click",()=>oo()),Q==null||Q.addEventListener("click",async()=>{if(qe){Q.disabled=!0,Q.textContent="Enregistrement...";try{let i=Ho();if(!(await fetch(`${qe}/footer`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(i)})).ok)throw new Error("Erreur serveur");He=i,Is(i),M("Footer enregistr\xE9")}catch(i){console.error("[footer] save error",i),M("Erreur lors de l'enregistrement","error")}finally{Q.disabled=!1,Q.textContent="Enregistrer"}}}),(async()=>{if(qe)try{let i=await fetch(qe,{credentials:"include"});if(i.ok){let m=await i.json();m.header&&(de=m.header,$t(m.header)),m.footer&&(He=m.footer,Is(m.footer))}}catch(i){console.error("[layout] load error",i)}})();let ro=Te((J==null?void 0:J.slugValue)||te.slug||""),ut=ro?`/api/sites/${encodeURIComponent(ro)}/collections`:null,Bt=[],Ue=[],We=null,Re=null,mt=!1,Vt=!1,Ot=null,$s=i=>{let m=(i||"").trim();if(!m)return"";if(m==="/")return"/";let D=m.replace(/^\//,"").split("/").map(X=>Yt(X||"")).filter(X=>X.length>0);return D.length?`/${D.join("/")}`:""},Bs=i=>{if(!i)return"\u2014";let m=new Date(i);return Number.isNaN(m.getTime())?"\u2014":m.toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})},Jt=()=>{let i=Bt.find(m=>m.id===We);B&&(B.textContent=(i==null?void 0:i.name)||"S\xE9lectionnez une collection"),F&&(F.textContent=(i==null?void 0:i.description)||"")},cs=i=>{Z&&(Z.textContent=i||(We?"Aucun item dans cette collection pour le moment.":"Choisissez une collection dans le panneau de gauche."))},$e=()=>{L&&(L.classList.add("hidden"),L.dataset.itemId=""),R==null||R.classList.remove("hidden"),v&&(v.className=`hidden ${be}`,v.textContent=""),A&&(A.disabled=!0),xe()},es=()=>{L&&(L.classList.remove("hidden"),R==null||R.classList.add("hidden"),xe())},Wt=()=>{j&&(j.disabled=!We,j.disabled?j.classList.add("opacity-60","pointer-events-none"):j.classList.remove("opacity-60","pointer-events-none"))},ds=i=>{if(!v)return;if(!i){v.className=`hidden ${be}`,v.textContent="";return}let m=i.toLowerCase(),b="bg-slate-100 text-slate-600 border border-slate-200";m==="publi\xE9"||m==="publie"?b="bg-emerald-50 text-emerald-700 border border-emerald-100":m==="brouillon"&&(b="bg-amber-50 text-amber-700 border border-amber-100"),v.className=`${be} ${b}`,v.textContent=i},Ps=()=>{if(o.innerHTML="",V&&(V.textContent=Bt.length),!Bt.length){ee==null||ee.classList.remove("hidden");return}ee==null||ee.classList.add("hidden"),Bt.forEach(i=>{let m=i.id===We,b=document.createElement("button");b.type="button",b.dataset.collectionId=i.id,b.className=["w-full rounded-xl border px-3 py-2 text-left transition focus:outline-none focus:ring-2 focus:ring-[#9C6BFF]/40",m?"bg-[#F7F0FF] border-[#9C6BFF]/40 text-slate-900":"border-slate-200 text-slate-700 hover:border-[#9C6BFF]/40"].join(" "),b.setAttribute("role","option"),m?b.setAttribute("aria-current","true"):b.removeAttribute("aria-current"),b.innerHTML=`
          <div class="flex items-center justify-between gap-2">
            <div>
              <p class="text-sm font-semibold">${i.name||i.id}</p>
              <p class="text-xs text-slate-500">${i.description||""}</p>
            </div>
            <span class="text-[11px] uppercase tracking-wide text-slate-400">${i.type||""}</span>
          </div>
        `,b.addEventListener("click",()=>{ms(i.id)}),o.appendChild(b)})},gt=()=>{if(T){if(T.innerHTML="",!Ue.length||!We){Z==null||Z.classList.remove("hidden"),cs(),w==null||w.classList.add("hidden");return}Z==null||Z.classList.add("hidden"),w==null||w.classList.remove("hidden"),Ue.forEach(i=>{let m=document.createElement("tr");m.dataset.itemId=i.id;let b=i.id===Re&&!mt;m.className=["cursor-pointer transition focus-within:bg-[#F7F0FF]/70 focus:outline-none",b?"bg-[#F7F0FF]/70":"hover:bg-slate-50"].join(" "),m.tabIndex=0,m.setAttribute("role","button"),b?m.setAttribute("aria-current","true"):m.removeAttribute("aria-current");let D=i.status||"Brouillon",X=D.toLowerCase(),ue=X==="publi\xE9"||X==="publie"?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-amber-50 text-amber-700 border border-amber-100";m.innerHTML=`
          <td class="px-4 py-3 align-top">
            <div class="flex flex-col">
              <span class="text-sm font-semibold text-slate-900">${i.title||"Sans titre"}</span>
              <span class="text-xs text-slate-500">${i.summary||i.excerpt||""}</span>
            </div>
          </td>
          <td class="px-4 py-3 align-top text-sm text-slate-600">${i.slug||""}</td>
          <td class="px-4 py-3 align-top">
            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${ue}">
              ${D}
            </span>
          </td>
          <td class="px-4 py-3 align-top text-sm text-slate-500">${Bs(i.updatedAt||i.createdAt)}</td>
        `;let ie=()=>{no(i.id)};m.addEventListener("click",ie),m.addEventListener("keydown",me=>{(me.key==="Enter"||me.key===" ")&&(me.preventDefault(),ie())}),T.appendChild(m)})}},no=i=>{let m=Ue.find(b=>b.id===i);m&&(Re=m.id,mt=!1,Vt=!0,us(m),gt())},us=i=>{var m,b;if(!L||!i){$e();return}es(),L.dataset.itemId=i.id,S.title&&(S.title.value=i.title||""),S.slug&&(S.slug.value=i.slug||""),S.excerpt&&(S.excerpt.value=i.summary||i.excerpt||""),S.content&&(S.content.value=i.content||""),S.image&&(S.image.value=i.image||""),S.ctaText&&(S.ctaText.value=((m=i.cta)==null?void 0:m.text)||i.ctaText||""),S.ctaUrl&&(S.ctaUrl.value=((b=i.cta)==null?void 0:b.url)||i.ctaUrl||""),S.status&&(S.status.value=i.status||"Brouillon"),ds(i.status||"Brouillon"),A&&(A.disabled=!1)},Uo=()=>{var i;L&&(mt=!0,Re=null,Vt=!1,L.dataset.itemId="",L.reset(),S.status&&(S.status.value="Brouillon"),S.slug&&(S.slug.value=""),ds("Brouillon"),es(),A&&(A.disabled=!0),(i=S.title)==null||i.focus())},Ro=()=>{var Se,et,tt,Be,ve,Oe,Et,st;let i=(((Se=S.title)==null?void 0:Se.value)||"").trim(),m=(((et=S.slug)==null?void 0:et.value)||"").trim(),b=(((tt=S.excerpt)==null?void 0:tt.value)||"").trim(),D=(((Be=S.content)==null?void 0:Be.value)||"").trim(),X=(((ve=S.image)==null?void 0:ve.value)||"").trim(),ue=(((Oe=S.ctaText)==null?void 0:Oe.value)||"").trim(),ie=(((Et=S.ctaUrl)==null?void 0:Et.value)||"").trim(),me=((st=S.status)==null?void 0:st.value)||"Brouillon",Ee=ue||ie?{text:ue,url:ie}:null;return{title:i,slug:$s(m||i),summary:b,excerpt:b,content:D,image:X,status:me,...Ee&&{cta:Ee}}},js=i=>{K&&(K.disabled=i,K.textContent=i?"Enregistrement\u2026":"Enregistrer"),A&&!mt&&Re&&(A.disabled=i)},ao=async i=>{if(!ut)return[];let m=await fetch(`${ut}/${encodeURIComponent(i)}/items`,{headers:{Accept:"application/json"}});if(!m.ok){let D=await m.json().catch(()=>({}));throw new Error(D.message||"Impossible de charger les items.")}let b=await m.json().catch(()=>({}));return Array.isArray(b.items)?b.items:[]},ms=async i=>{if(i&&(We=i,Re=null,mt=!1,Vt=!1,je("collection"),Jt(),Wt(),Ps(),$e(),Ue=[],gt(),cs("Chargement des items\u2026"),Z==null||Z.classList.remove("hidden"),w==null||w.classList.add("hidden"),!!ut))try{Ue=await ao(i),gt(),Ue.length||cs()}catch(m){console.error("[content] items failed",m),M(m.message||"Impossible de charger les items."),Ue=[],gt()}},zo=async(i,m)=>{if(!ut)throw new Error("Site inconnu.");let b=await fetch(`${ut}/${encodeURIComponent(i)}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!b.ok){let D=await b.json().catch(()=>({}));throw new Error(D.message||"Impossible de cr\xE9er cet item.")}return b.json()},ts=async(i,m,b)=>{if(!ut)throw new Error("Site inconnu.");let D=await fetch(`${ut}/${encodeURIComponent(i)}/items/${encodeURIComponent(m)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!D.ok){let X=await D.json().catch(()=>({}));throw new Error(X.message||"Impossible de sauvegarder cet item.")}return D.json()},Vo=async(i,m)=>{if(!ut)throw new Error("Site inconnu.");let b=await fetch(`${ut}/${encodeURIComponent(i)}/items/${encodeURIComponent(m)}`,{method:"DELETE"});if(!b.ok){let D=await b.json().catch(()=>({}));throw new Error(D.message||"Impossible de supprimer cet item.")}},Oo=async()=>{var i;if(!ut){ee==null||ee.classList.remove("hidden"),We=null,Ue=[],gt(),Jt(),Wt();return}try{let m=await fetch(ut,{headers:{Accept:"application/json"}});if(!m.ok)throw new Error("Impossible de charger les collections.");let b=await m.json().catch(()=>[]);if(Bt=Array.isArray(b)?b:[],Ps(),Bt.length>0){let D=((i=Bt.find(X=>X.id===We))==null?void 0:i.id)||Bt[0].id;ms(D)}else We=null,Ue=[],Jt(),Wt(),gt()}catch(m){console.error("[content] load collections",m),M(m.message||"Impossible de charger les collections.")}};j==null||j.addEventListener("click",()=>{if(!We){M("S\xE9lectionnez d\u2019abord une collection.");return}Uo(),gt()}),Y==null||Y.addEventListener("click",i=>{if(i.preventDefault(),mt){mt=!1,Re=null,$e(),gt();return}if(Re){let m=Ue.find(b=>b.id===Re);us(m)}else $e()}),(ss=S.status)==null||ss.addEventListener("change",()=>{ds(S.status.value)}),(Ct=S.title)==null||Ct.addEventListener("input",()=>{!mt||!S.slug||Vt||(S.slug.value=$s(S.title.value))}),(lo=S.slug)==null||lo.addEventListener("input",()=>{mt&&(Vt=!0)}),L==null||L.addEventListener("submit",async i=>{var b;if(i.preventDefault(),!We){M("S\xE9lectionnez une collection.");return}let m=Ro();if(!m.title){M("Le titre est requis."),(b=S.title)==null||b.focus();return}js(!0);try{let D;mt||!Re?(D=await zo(We,m),Ue=[...Ue,D],M("Item cr\xE9\xE9")):(D=await ts(We,Re,m),Ue=Ue.map(X=>X.id===D.id?D:X),M("Item mis \xE0 jour")),mt=!1,Re=D.id,us(D),gt()}catch(D){console.error("[content] save item failed",D),M(D.message||"Impossible de sauvegarder cet item.")}finally{js(!1)}});let Pt=()=>{q&&(q.classList.add("hidden"),q.classList.remove("flex"),Ot=null)},io=()=>{!q||!Re||(Ot=Re,q.classList.remove("hidden"),q.classList.add("flex"))};A==null||A.addEventListener("click",i=>{i.preventDefault(),Re&&io()}),H==null||H.addEventListener("click",()=>{Pt()}),q==null||q.addEventListener("click",i=>{i.target===q&&Pt()}),W==null||W.addEventListener("click",async()=>{if(!Ot||!We){Pt();return}W.disabled=!0,W.textContent="Suppression\u2026";try{await Vo(We,Ot),Ue=Ue.filter(i=>i.id!==Ot),Re===Ot&&(Re=null,$e()),M("Item supprim\xE9"),gt()}catch(i){console.error("[content] delete item failed",i),M(i.message||"Impossible de supprimer cet item.")}finally{W.disabled=!1,W.textContent="Supprimer",Pt()}}),Jt(),Wt(),Oo()}function Ln(){let o=document.querySelector("[data-deploy-form]");if(!o)return;let n=document.querySelector("[data-deploy-protocol]"),c=document.querySelector("[data-deploy-host]"),f=document.querySelector("[data-deploy-port]"),p=document.querySelector("[data-deploy-user]"),y=document.querySelector("[data-deploy-password]"),V=document.querySelector("[data-deploy-show-password]"),U=document.querySelector("[data-deploy-remote-path]"),O=document.querySelector("[data-deploy-feedback]"),ee=document.querySelector("[data-deploy-save]"),Z=document.querySelector("[data-deploy-test]"),w=document.querySelector("[data-deploy-trigger]"),T=document.querySelector("[data-deploy-history]"),B=document.querySelector("[data-deploy-log]"),F=Te((J==null?void 0:J.slugValue)||te.slug||""),j=F?`/api/sites/${encodeURIComponent(F)}/deploy-config`:null,R=F?`/api/sites/${encodeURIComponent(F)}/deploy`:null,L=F?`/api/sites/${encodeURIComponent(F)}/deploy-log`:null,S=!1,v=null,A=I=>{let k=(I||"").trim();return k?k.startsWith("/")?k:`/${k}`:"/www"},q=(I,k="muted")=>{if(!O)return;let z="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold",pe=k==="success"?"bg-emerald-50 text-emerald-700 border border-emerald-100":k==="error"?"bg-rose-50 text-rose-700 border border-rose-100":"bg-slate-50 text-slate-600 border border-slate-100";if(!I){O.textContent="",O.className="text-sm text-slate-500";return}let C=k==="success"?"\u2705":k==="error"?"\u274C":"\u2139\uFE0F";O.innerHTML=`<span class="${z} ${pe}">${C}<span>${I}</span></span>`,O.className="text-sm"},H=(I=null)=>{v=I;let k=!!I,z='<svg class="h-4 w-4 animate-spin text-white" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>';ee&&(ee.disabled=k,ee.innerHTML=I==="save"?`<span class="inline-flex items-center gap-2">${z}<span>Enregistrement\u2026</span></span>`:"Enregistrer"),Z&&(Z.disabled=k,Z.innerHTML=I==="test"?'<span class="inline-flex items-center gap-2"><span class="h-4 w-4 animate-spin rounded-full border-2 border-slate-200 border-t-slate-600"></span><span>Test en cours\u2026</span></span>':"Tester la connexion"),w&&(w.disabled=k&&I!==null,w.innerHTML=I==="deploy"?'<span class="inline-flex items-center gap-2"><span class="h-4 w-4 animate-spin rounded-full border-2 border-white/60 border-t-white"></span><span>D\xE9ploiement\u2026</span></span>':"D\xE9ployer maintenant")},W=I=>{n&&(n.value=I.protocol||"sftp"),c&&(c.value=I.host||""),f&&(f.value=I.port||""),p&&(p.value=I.user||""),U&&(U.value=I.remotePath||"/www"),S=!!I.hasPassword,y&&(y.value="",y.placeholder=S?"Non affich\xE9":"Mot de passe")},Y=(I=[])=>{if(T){if(T.innerHTML="",!I.length){let k=document.createElement("li");k.className="text-slate-500",k.textContent="Aucun d\xE9ploiement pour le moment.",T.appendChild(k);return}I.forEach(k=>{let z=document.createElement("li");z.className="flex items-center justify-between gap-2 rounded-xl border border-slate-200 px-3 py-2";let pe=k.status==="success"?'<span class="rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700">Succ\xE8s</span>':'<span class="rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold text-rose-700">\xC9chec</span>',C=k.finishedAt||k.startedAt||"",x=k.durationMs&&Number(k.durationMs)>=0?`${Math.round(Number(k.durationMs)/1e3)}s`:"";z.innerHTML=`
          <div class="space-y-1">
            <div class="flex items-center gap-2">${pe}<span class="text-xs text-slate-500">${C}</span></div>
            <p class="text-sm text-slate-800">${k.message||""}</p>
          </div>
          <div class="text-xs text-slate-500">${x}</div>
        `,z.dataset.deployId=k.id||"",z.addEventListener("click",()=>{k.logs&&B&&(B.textContent=k.logs.join(`
`))}),T.appendChild(z)})}},K=(I=[])=>{B&&(B.textContent=I.length?I.join(`
`):"Aucun log pour le moment.")},be=async()=>{var I;if(L)try{let k=await fetch(L,{headers:{Accept:"application/json"}});if(!k.ok){if(k.status===404){Y([]),K(["API d\xE9ploiement indisponible (red\xE9marre le serveur)."]);return}throw new Error("Impossible de charger l\u2019historique.")}let z=await k.json().catch(()=>({})),pe=Array.isArray(z.entries)?z.entries:[];Y(pe),(I=pe[0])!=null&&I.logs&&K(pe[0].logs)}catch(k){console.error("[deploy] history failed",k)}},Ce=async()=>{if(!j){q("Aucun site actif s\xE9lectionn\xE9.","error");return}H("load");try{let I=await fetch(j,{headers:{Accept:"application/json"}}),k=await I.json().catch(()=>({}));I.ok?(W(k||{}),q("Configuration charg\xE9e.","muted")):(W(k||{}),q(k.message||"Configuration par d\xE9faut charg\xE9e.","muted"))}catch(I){console.error("[deploy] load failed",I),q(I.message||"Erreur lors du chargement.","error")}finally{H(null)}},Je=()=>{let I={protocol:(n==null?void 0:n.value)||"sftp",host:(c==null?void 0:c.value.trim())||"",port:Number(f==null?void 0:f.value)||void 0,user:(p==null?void 0:p.value.trim())||"",remotePath:A((U==null?void 0:U.value)||"/www")},k=(y==null?void 0:y.value)||"";return k.trim().length>0&&(I.password=k),I};o.addEventListener("submit",async I=>{if(I.preventDefault(),!j){q("Aucun site actif s\xE9lectionn\xE9.","error");return}let k=Je();H("save");try{let z=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!z.ok){let C=await z.json().catch(()=>({}));throw new Error(C.message||"Sauvegarde impossible.")}let pe=await z.json();W(pe||{}),q("Configuration enregistr\xE9e.","success"),M("Configuration d\xE9ploiement sauvegard\xE9e")}catch(z){console.error("[deploy] save failed",z),q(z.message||"Erreur lors de la sauvegarde.","error")}finally{H(null)}}),Z==null||Z.addEventListener("click",async()=>{if(!j){q("Aucun site actif s\xE9lectionn\xE9.","error");return}let I=Je();if(!I.host||!I.user||!I.remotePath){q("Remplissez les champs requis avant de tester.","error");return}H("test");try{let k=await fetch(`${j}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}),z=await k.json().catch(()=>({}));if(!k.ok||z.success===!1){q(z.message||"Test de connexion \xE9chou\xE9.","error");return}q(z.message||"Connexion OK.","success"),M("Test de connexion r\xE9ussi")}catch(k){console.error("[deploy] test failed",k),q(k.message||"Test de connexion \xE9chou\xE9.","error")}finally{H(null)}}),w==null||w.addEventListener("click",async()=>{if(!R){q("Aucun site actif s\xE9lectionn\xE9.","error");return}H("deploy"),K(["D\xE9ploiement en cours\u2026"]);try{let I=await fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Je())}),k=await I.json().catch(()=>({}));if(!I.ok){if(I.status===404){q("API d\xE9ploiement indisponible (red\xE9marre le serveur).","error"),K(["API d\xE9ploiement indisponible (red\xE9marre le serveur)."]);return}throw K(k.logs||[]),new Error(k.message||"D\xE9ploiement \xE9chou\xE9.")}K(k.logs||[]),await be(),M("D\xE9ploiement termin\xE9")}catch(I){console.error("[deploy] run failed",I),q(I.message||"D\xE9ploiement \xE9chou\xE9.","error")}finally{H(null)}}),V==null||V.addEventListener("change",()=>{y&&(y.type=V.checked?"text":"password")});let xe=document.querySelector("[data-download-build]"),_=document.querySelector("[data-download-feedback]"),Pe=F?`/api/sites/${encodeURIComponent(F)}/download`:null,Ve=(I,k="muted")=>{if(!_)return;let z=k==="success"?"text-emerald-600":k==="error"?"text-rose-600":"text-slate-500";_.textContent=I||"",_.className=`text-sm ${z}`};xe==null||xe.addEventListener("click",async()=>{if(!Pe){Ve("Aucun site actif s\xE9lectionn\xE9.","error");return}xe.disabled=!0;let I=xe.innerHTML;xe.innerHTML=`
        <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
        </svg>
        <span>Build en cours...</span>
      `,Ve("G\xE9n\xE9ration du build en cours...","muted");try{let k=await fetch(Pe);if(!k.ok){let x=await k.json().catch(()=>({}));throw new Error(x.message||"Impossible de g\xE9n\xE9rer le ZIP.")}let z=await k.blob(),pe=window.URL.createObjectURL(z),C=document.createElement("a");C.href=pe,C.download=`${F}-build.zip`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(pe),Ve("T\xE9l\xE9chargement termin\xE9 !","success"),M("Build t\xE9l\xE9charg\xE9 avec succ\xE8s")}catch(k){console.error("[download] failed",k),Ve(k.message||"Erreur lors du t\xE9l\xE9chargement.","error")}finally{xe.disabled=!1,xe.innerHTML=I}}),Ce(),be()}function kn(){let o=document.querySelectorAll("[data-settings-tab]"),n=document.querySelectorAll("[data-settings-panel]"),c=document.querySelector("[data-admin-password-form]"),f=document.querySelector("[data-site-config-form]"),p=document.querySelector("[data-site-config-feedback]"),y=document.querySelector("[data-theme-form]"),V=w=>{o.forEach(T=>{let B=T.dataset.settingsTab===w;T.setAttribute("aria-selected",B?"true":"false"),T.classList.toggle("bg-[#9C6BFF]",B),T.classList.toggle("text-white",B)}),n.forEach(T=>{T.classList.toggle("hidden",T.dataset.settingsPanel!==w)})};if(o.forEach(w=>{w.addEventListener("click",()=>V(w.dataset.settingsTab||"account"))}),V("account"),c){let w=c.querySelector("[data-admin-password-feedback]"),T=c.querySelector("[data-admin-password-submit]"),B=(F,j="muted")=>{if(!w)return;let R=j==="success"?"text-emerald-600":j==="error"?"text-rose-600":"text-slate-500";w.textContent=F||"",w.className=`text-sm ${R}`};c.addEventListener("submit",async F=>{F.preventDefault();let j=new FormData(c),R=j.get("currentPassword")||"",L=j.get("newPassword")||"",S=j.get("confirmPassword")||"";if(!R||!L||!S){B("Compl\xE8te tous les champs.","error");return}T&&(T.disabled=!0),B("");try{let v=await fetch("/api/admin/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:R,newPassword:L,confirmPassword:S})}),A=await v.json().catch(()=>({}));if(!v.ok||A.success===!1)throw new Error(A.message||"Impossible de mettre \xE0 jour le mot de passe.");B(A.message||"Mot de passe mis \xE0 jour.","success"),c.reset()}catch(v){console.error("[settings] change password failed",v),B(v.message||"Erreur lors de la mise \xE0 jour.","error")}finally{T&&(T.disabled=!1)}})}if(f){let w=f.querySelector("[data-site-name]"),T=f.querySelector("[data-site-language]"),B=f.querySelector("[data-site-tagline]"),F=f.querySelector("[data-site-save]"),j=(v,A="muted")=>{if(!p)return;let q=A==="success"?"text-emerald-600":A==="error"?"text-rose-600":"text-slate-500";p.textContent=v||"",p.className=`text-sm ${q}`},R=Te((J==null?void 0:J.slugValue)||te.slug||""),L=R?`/api/sites/${encodeURIComponent(R)}/config/site`:null,S=async()=>{if(L)try{let v=await fetch(L,{headers:{Accept:"application/json"}});if(!v.ok)return;let A=await v.json().catch(()=>({}));w&&(w.value=A.name||""),T&&(T.value=A.language||"fr"),B&&(B.value=A.tagline||"")}catch(v){console.error("[settings] load site config failed",v)}};f.addEventListener("submit",async v=>{if(v.preventDefault(),!L){j("Aucun site actif.","error");return}if(!(w!=null&&w.value.trim())){j("Nom requis.","error");return}F&&(F.disabled=!0),j("");try{let A={name:(w==null?void 0:w.value)||"",language:(T==null?void 0:T.value)||"fr",tagline:(B==null?void 0:B.value)||""},q=await fetch(L,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)}),H=await q.json().catch(()=>({}));if(!q.ok||H.success===!1)throw new Error(H.message||"Sauvegarde impossible.");j(H.message||"Param\xE8tres enregistr\xE9s.","success")}catch(A){console.error("[settings] save site config failed",A),j(A.message||"Erreur lors de la sauvegarde.","error")}finally{F&&(F.disabled=!1)}}),S()}if(y){let w=Te((J==null?void 0:J.slugValue)||te.slug||""),T=w?`/api/sites/${encodeURIComponent(w)}/config/theme`:null,B={primary:y.querySelector("[data-theme-primary]"),secondary:y.querySelector("[data-theme-secondary]"),accent:y.querySelector("[data-theme-accent]"),background:y.querySelector("[data-theme-background]"),text:y.querySelector("[data-theme-text]")},F=y.querySelector("[data-theme-headings]"),j=y.querySelector("[data-theme-body]"),R=y.querySelector("[data-theme-radius-small]"),L=y.querySelector("[data-theme-radius-medium]"),S=y.querySelector("[data-theme-radius-large]"),v=y.querySelector("[data-theme-preview]"),A=y.querySelector("[data-theme-feedback]"),q=y.querySelector("[data-theme-apply]"),H={slate:"#e2e8f0",gray:"#d1d5db",zinc:"#d4d4d8",neutral:"#d4d4d4",stone:"#d6d3d1",red:"#ef4444",orange:"#f97316",amber:"#f59e0b",yellow:"#eab308",lime:"#84cc16",green:"#22c55e",emerald:"#10b981",teal:"#14b8a6",cyan:"#06b6d4",sky:"#0ea5e9",blue:"#3b82f6",indigo:"#6366f1",violet:"#8b5cf6",purple:"#a855f7",fuchsia:"#d946ef",pink:"#ec4899",rose:"#f43f5e"},W=C=>{if(!C)return null;if(C==="white")return"#ffffff";if(C==="black")return"#000000";if(C==="transparent")return"transparent";let[x,E]=C.split("-");if(!x||!E)return null;let re=H[x];if(!re)return null;let Q=Number(E)||500,ge=Math.min(Math.max((Q-50)/900,0),1),ae=ke=>ke.replace("#","").match(/[A-Fa-f0-9]{2}/g).map(qe=>parseInt(qe,16)),[we,de,He]=ae(re),Ne=ke=>Math.round(255-(255-ke)*ge);return`rgb(${Ne(we)}, ${Ne(de)}, ${Ne(He)})`},Y=["slate","gray","zinc","neutral","stone","red","orange","amber","yellow","lime","green","emerald","teal","cyan","sky","blue","indigo","violet","purple","fuchsia","pink","rose"],K=["50","100","200","300","400","500","600","700","800","900"],be=Y.flatMap(C=>K.map(x=>`${C}-${x}`)),Ce=[{value:"white",label:"Blanc",color:"#ffffff",emoji:"\u2B1C"},{value:"transparent",label:"Transparent",color:"transparent",emoji:"\u2B1C"},{value:"black",label:"Noir",color:"#000000",emoji:"\u2B1B"}],Je=(()=>{let C=[];return Ce.forEach(({value:x,label:E,color:re,emoji:Q})=>{C.push({value:x,label:`${Q} ${E}`,color:re})}),be.forEach(x=>{let[E,re]=x.split("-"),Q=W(x)||"#ffffff";C.push({value:x,label:`${E.charAt(0).toUpperCase()+E.slice(1)} ${re}`,color:Q})}),C})(),xe=C=>typeof C=="string"?C.trim().toLowerCase():"",_=(C={})=>{Object.entries(B).forEach(([x,E])=>{var Q;if(!E)return;let re=xe(C[x]);E.innerHTML="",Je.forEach(({value:ge,label:ae,color:we})=>{let de=document.createElement("option");de.value=ge,de.textContent=ae,de.dataset.color=we,re&&re===ge&&(de.selected=!0),E.appendChild(de)}),E.dataset.default=E.dataset.default||((Q=E.options[0])==null?void 0:Q.value)||"",!re&&E.dataset.default&&(E.value=E.dataset.default),Xs(E)})},Pe=(C,x="muted")=>{if(!A)return;let E=x==="success"?"text-emerald-600":x==="error"?"text-rose-600":"text-slate-500";A.textContent=C||"",A.className=`text-sm ${E}`},Ve=()=>{var x,E,re,Q,ge;if(!v)return;let C=ae=>{if(!ae)return null;if(ae==="white")return"#ffffff";if(ae==="black")return"#000000";if(ae==="transparent")return"transparent";let[we,de]=ae.split("-");if(!we||!de)return null;let Ne={slate:"#e2e8f0",gray:"#d1d5db",zinc:"#d4d4d8",neutral:"#d4d4d4",stone:"#d6d3d1",red:"#ef4444",orange:"#f97316",amber:"#f59e0b",yellow:"#eab308",lime:"#84cc16",green:"#22c55e",emerald:"#10b981",teal:"#14b8a6",cyan:"#06b6d4",sky:"#0ea5e9",blue:"#3b82f6",indigo:"#6366f1",violet:"#8b5cf6",purple:"#a855f7",fuchsia:"#d946ef",pink:"#ec4899",rose:"#f43f5e"}[we];if(!Ne)return null;let ke=Number(de)||500,qe=Math.min(Math.max((ke-50)/900,0),1),je=ne=>ne.match(/[A-Fa-f0-9]{2}/g).map($t=>parseInt($t,16)),[Ht,h,$]=je(Ne.replace("#","")),g=ne=>Math.round(255-(255-ne)*qe);return`rgb(${g(Ht)}, ${g(h)}, ${g($)})`};v.style.setProperty("--color-primary",W((x=B.primary)==null?void 0:x.value)||"#9C6BFF"),v.style.setProperty("--color-secondary",W((E=B.secondary)==null?void 0:E.value)||"#0EA5E9"),v.style.setProperty("--color-accent",W((re=B.accent)==null?void 0:re.value)||"#F97316"),v.style.setProperty("--color-background",W((Q=B.background)==null?void 0:Q.value)||"#FFFFFF"),v.style.setProperty("--color-text",W((ge=B.text)==null?void 0:ge.value)||"#0F172A"),v.style.setProperty("--font-headings",(F==null?void 0:F.value)||"Inter, sans-serif"),v.style.setProperty("--font-body",(j==null?void 0:j.value)||"Inter, sans-serif"),v.style.setProperty("--radius-small",(R==null?void 0:R.value)||"8px"),v.style.setProperty("--radius-medium",(L==null?void 0:L.value)||"16px"),v.style.setProperty("--radius-large",(S==null?void 0:S.value)||"24px"),v.style.borderRadius=(L==null?void 0:L.value)||"16px"},I=(C,x)=>{if(C){if(x==="transparent"){C.style.background="repeating-conic-gradient(#ccc 0% 25%, white 0% 50%) 50% / 8px 8px",C.style.borderColor="#cbd5f5",C.style.boxShadow="";return}C.style.background=x,C.style.borderColor=x,C.style.boxShadow="0 0 0 1px rgba(15,23,42,0.15)"}},k=C=>{var ge,ae,we;if(!C)return;let x=C.options[C.selectedIndex],E=((ge=x==null?void 0:x.dataset)==null?void 0:ge.color)||"#ffffff",re=(ae=C.closest(".relative"))==null?void 0:ae.querySelector("[data-color-preview]");re&&(E==="transparent"?re.style.background=Qt:re.style.background=E);let Q=(we=C.closest(".relative"))==null?void 0:we.querySelector("[data-theme-color-chip]");I(Q,E)},z=()=>{Object.values(B).forEach(C=>{C&&(Xs(C),k(C),C.addEventListener("change",()=>k(C)))})};Object.keys(B).forEach(C=>{var x;(x=B[C])==null||x.addEventListener("change",Ve)}),[F,j,R,L,S].forEach(C=>{C==null||C.addEventListener("change",Ve)});let pe=async()=>{var C,x,E,re,Q;if(T)try{let ge=await fetch(T,{headers:{Accept:"application/json"},credentials:"include"});if(!ge.ok)return;let ae=await ge.json().catch(()=>({})),we=ae.colors||{};_(we),Object.entries(B).forEach(([de,He])=>{if(!He)return;let Ne=we[de],ke=xe(Ne);ke?He.value=ke:Ne?He.value=Ne:He.dataset.default&&(He.value=He.dataset.default),k(He)}),F&&(F.value=((C=ae.typography)==null?void 0:C.headings)||"Inter, sans-serif"),j&&(j.value=((x=ae.typography)==null?void 0:x.body)||"Inter, sans-serif"),R&&(R.value=((E=ae.radius)==null?void 0:E.small)||"8px"),L&&(L.value=((re=ae.radius)==null?void 0:re.medium)||"16px"),S&&(S.value=((Q=ae.radius)==null?void 0:Q.large)||"24px"),Ve()}catch(ge){console.error("[settings] load theme failed",ge)}};q==null||q.addEventListener("click",async C=>{var E,re,Q,ge,ae;if(C.preventDefault(),!T){Pe("Aucun site actif.","error");return}let x={colors:{primary:((E=B.primary)==null?void 0:E.value)||"violet-500",secondary:((re=B.secondary)==null?void 0:re.value)||"indigo-400",accent:((Q=B.accent)==null?void 0:Q.value)||"emerald-500",background:((ge=B.background)==null?void 0:ge.value)||"slate-50",text:((ae=B.text)==null?void 0:ae.value)||"slate-900"},typography:{headings:(F==null?void 0:F.value)||"Inter, sans-serif",body:(j==null?void 0:j.value)||"Inter, sans-serif"},radius:{small:(R==null?void 0:R.value)||"8px",medium:(L==null?void 0:L.value)||"16px",large:(S==null?void 0:S.value)||"24px"}};q.disabled=!0,Pe("");try{let we=await fetch(T,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(x)}),de=await we.json().catch(()=>({}));if(!we.ok||de.success===!1)throw new Error(de.message||"Application du th\xE8me \xE9chou\xE9e.");await pe(),Pe(de.message||"Th\xE8me appliqu\xE9.","success")}catch(we){console.error("[settings] apply theme failed",we),Pe(we.message||"Erreur lors de l\u2019application du th\xE8me.","error")}finally{q.disabled=!1}}),_(),z(),pe(),Ve(),document.addEventListener("ai-theme-updated",()=>{pe(),Pe("Th\xE8me mis \xE0 jour.","success")})}let U=document.querySelector("[data-seo-config-form]");if(U){let w=U.querySelector("[data-seo-index-all]"),T=U.querySelector("[data-seo-config-feedback]"),B=U.querySelector("[data-seo-save]"),F=Te((J==null?void 0:J.slugValue)||te.slug||""),j=F?`/api/sites/${encodeURIComponent(F)}/config/site`:null,R=(S,v="muted")=>{if(!T)return;let A=v==="success"?"text-emerald-600":v==="error"?"text-rose-600":"text-slate-500";T.textContent=S||"",T.className=`text-sm ${A}`},L=async()=>{var S;if(j)try{let v=await fetch(j,{headers:{Accept:"application/json"}});if(!v.ok)return;let q=((S=(await v.json().catch(()=>({}))).seo)==null?void 0:S.indexAllPagesByDefault)!==!1;w&&(w.checked=q)}catch(v){console.error("[settings] load seo config failed",v)}};U.addEventListener("submit",async S=>{var v;if(S.preventDefault(),!j){R("Aucun site actif.","error");return}B&&(B.disabled=!0),R("");try{let A=await fetch(j,{headers:{Accept:"application/json"}}),q=A.ok?await A.json().catch(()=>({})):{},H={...q,seo:{...q.seo||{},indexAllPagesByDefault:(v=w==null?void 0:w.checked)!=null?v:!0}},W=await fetch(j,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)}),Y=await W.json().catch(()=>({}));if(!W.ok||Y.success===!1)throw new Error(Y.message||"Sauvegarde impossible.");R(Y.message||"Param\xE8tres SEO enregistr\xE9s.","success")}catch(A){console.error("[settings] save seo config failed",A),R(A.message||"Erreur lors de la sauvegarde.","error")}finally{B&&(B.disabled=!1)}}),L()}let O=document.querySelector("[data-analytics-form]");if(O){let w=O.querySelector("[data-analytics-head]"),T=O.querySelector("[data-analytics-body]"),B=O.querySelector("[data-analytics-feedback]"),F=O.querySelector("[data-analytics-save]"),j=Te((J==null?void 0:J.slugValue)||te.slug||""),R=j?`/api/sites/${encodeURIComponent(j)}/config/site`:null,L=(v,A="muted")=>{if(!B)return;let q=A==="success"?"text-emerald-600":A==="error"?"text-rose-600":"text-slate-500";B.textContent=v||"",B.className=`text-sm ${q}`},S=async()=>{var v,A;if(R)try{let q=await fetch(R,{headers:{Accept:"application/json"}});if(!q.ok)return;let H=await q.json().catch(()=>({}));w&&(w.value=((v=H.analytics)==null?void 0:v.headCode)||""),T&&(T.value=((A=H.analytics)==null?void 0:A.bodyEndCode)||"")}catch(q){console.error("[settings] load analytics config failed",q)}};O.addEventListener("submit",async v=>{if(v.preventDefault(),!R){L("Aucun site actif.","error");return}F&&(F.disabled=!0),L("");try{let A=await fetch(R,{headers:{Accept:"application/json"}}),H={...A.ok?await A.json().catch(()=>({})):{},analytics:{headCode:(w==null?void 0:w.value)||"",bodyEndCode:(T==null?void 0:T.value)||""}},W=await fetch(R,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)}),Y=await W.json().catch(()=>({}));if(!W.ok||Y.success===!1)throw new Error(Y.message||"Sauvegarde impossible.");L(Y.message||"Scripts enregistr\xE9s.","success")}catch(A){console.error("[settings] save analytics config failed",A),L(A.message||"Erreur lors de la sauvegarde.","error")}finally{F&&(F.disabled=!1)}}),S()}let ee=document.querySelector("[data-accessibility-form]");if(ee){let w=ee.querySelector("[data-accessibility-animations]"),T=ee.querySelector("[data-accessibility-contrast]"),B=ee.querySelector("[data-accessibility-feedback]"),F=ee.querySelector("[data-accessibility-save]"),j=Te((J==null?void 0:J.slugValue)||te.slug||""),R=j?`/api/sites/${encodeURIComponent(j)}/config/site`:null,L=(v,A="muted")=>{if(!B)return;let q=A==="success"?"text-emerald-600":A==="error"?"text-rose-600":"text-slate-500";B.textContent=v||"",B.className=`text-sm ${q}`},S=async()=>{var v,A;if(R)try{let q=await fetch(R,{headers:{Accept:"application/json"}});if(!q.ok)return;let H=await q.json().catch(()=>({}));w&&(w.checked=((v=H.accessibility)==null?void 0:v.animationsEnabled)!==!1),T&&(T.checked=((A=H.accessibility)==null?void 0:A.highContrast)===!0)}catch(q){console.error("[settings] load accessibility config failed",q)}};ee.addEventListener("submit",async v=>{var A,q;if(v.preventDefault(),!R){L("Aucun site actif.","error");return}F&&(F.disabled=!0),L("");try{let H=await fetch(R,{headers:{Accept:"application/json"}}),Y={...H.ok?await H.json().catch(()=>({})):{},accessibility:{animationsEnabled:(A=w==null?void 0:w.checked)!=null?A:!0,highContrast:(q=T==null?void 0:T.checked)!=null?q:!1}},K=await fetch(R,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)}),be=await K.json().catch(()=>({}));if(!K.ok||be.success===!1)throw new Error(be.message||"Sauvegarde impossible.");L(be.message||"Pr\xE9f\xE9rences mises \xE0 jour.","success")}catch(H){console.error("[settings] save accessibility config failed",H),L(H.message||"Erreur lors de la sauvegarde.","error")}finally{F&&(F.disabled=!1)}}),S()}let Z=document.querySelector("[data-ai-config-form]");if(Z){let w=Z.querySelector("[data-ai-api-key]"),T=Z.querySelector("[data-ai-model]"),B=Z.querySelector("[data-ai-project-prompt]"),F=Z.querySelector("[data-ai-enabled]"),j=Z.querySelector("[data-ai-feedback]"),R=Z.querySelector("[data-ai-save]"),L=Te((J==null?void 0:J.slugValue)||te.slug||""),S=L?`/api/sites/${encodeURIComponent(L)}/config/ai`:null,v=(q,H="muted")=>{if(!j)return;let W=H==="success"?"text-emerald-600":H==="error"?"text-rose-600":"text-slate-500";j.textContent=q||"",j.className=`text-sm ${W}`},A=async()=>{if(S)try{let q=await fetch(S,{headers:{Accept:"application/json"}});if(!q.ok)return;let H=await q.json().catch(()=>({}));w&&(w.value="",w.placeholder=H.hasApiKey?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"Cl\xE9 API Gemini"),T&&(T.value=H.model||"gemini-2.5-flash"),B&&(B.value=H.projectPrompt||""),F&&(F.checked=H.enabled!==!1)}catch(q){console.error("[settings] load AI config failed",q)}};Z.addEventListener("submit",async q=>{var H,W;if(q.preventDefault(),!S){v("Aucun site actif.","error");return}R&&(R.disabled=!0),v("");try{let Y={model:(T==null?void 0:T.value)||"gemini-2.5-flash",projectPrompt:(B==null?void 0:B.value)||"",enabled:(H=F==null?void 0:F.checked)!=null?H:!0},K=(W=w==null?void 0:w.value)==null?void 0:W.trim();K&&(Y.apiKey=K);let be=await fetch(S,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)}),Ce=await be.json().catch(()=>({}));if(!be.ok||Ce.success===!1)throw new Error(Ce.message||"Sauvegarde impossible.");v(Ce.message||"Configuration IA enregistr\xE9e.","success"),w&&(w.value="",w.placeholder="\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022")}catch(Y){console.error("[settings] save AI config failed",Y),v(Y.message||"Erreur lors de la sauvegarde.","error")}finally{R&&(R.disabled=!1)}}),A()}}function Cn(){let o=document.querySelector("[data-media-grid]");if(!o)return;let n=document.querySelector("[data-media-empty]"),c=document.querySelector("[data-media-count]"),f=document.querySelector("[data-media-filter-type]"),p=document.querySelector("[data-media-detail-empty]"),y=document.querySelector("[data-media-detail]"),V=document.querySelector("[data-media-detail-preview]"),U=document.querySelector("[data-media-detail-name]"),O=document.querySelector("[data-media-detail-type]"),ee=document.querySelector("[data-media-detail-size]"),Z=document.querySelector("[data-media-detail-path]"),w=document.querySelector("[data-media-detail-used]"),T=document.querySelector("[data-media-alt-edit]"),B=document.querySelector("[data-media-save]"),F=document.querySelector("[data-media-delete]"),j=document.querySelector("[data-media-delete-modal]"),R=document.querySelector("[data-media-delete-cancel]"),L=document.querySelector("[data-media-delete-confirm]"),S=document.querySelector("[data-media-upload-open]"),v=document.querySelector("[data-media-file-input]"),A=document.querySelector("[data-media-upload-status]"),q=Te((J==null?void 0:J.slugValue)||te.slug||""),H=q?`/api/sites/${encodeURIComponent(q)}/media`:null,W=[],Y=[],K=null,be=null,Ce=null,Je=!1,xe=!1,_=!1,Pe=null,Ve=h=>{let $=(h.type||"").toLowerCase(),g=(h.filename||"").toLowerCase();return $.includes("image")||/\.(png|jpe?g|webp|svg|gif)$/i.test(g)?"image":$.includes("pdf")||$.includes("doc")||/\.(pdf|docx?)$/i.test(g)?"document":$.includes("video")||/\.(mp4|mov|webm)$/i.test(g)?"video":"other"},I=h=>Ve(h)==="image",k=h=>{if(h.type)return h.type.toUpperCase();let $=(h.filename||"").split(".").pop();return $?$.toUpperCase():"FILE"},z=h=>!h||h<=0?"\u2014":h<1024?`${h} o`:h<1024*1024?`${(h/1024).toFixed(1)} ko`:`${(h/(1024*1024)).toFixed(1)} Mo`,pe=()=>{y==null||y.classList.add("hidden"),p==null||p.classList.remove("hidden"),C(),K=null,xe=!1,Q(!1),V&&(V.innerHTML='<span class="text-slate-400 text-sm">Aucun m\xE9dia s\xE9lectionn\xE9</span>'),U&&(U.textContent=""),O&&(O.textContent=""),ee&&(ee.textContent=""),T&&(T.value=""),Z&&(Z.textContent=""),w&&(w.innerHTML="")},C=()=>{Ce=null,_=!1,Je=!1,Pe&&(URL.revokeObjectURL(Pe),Pe=null),A&&(A.textContent="Aucun fichier s\xE9lectionn\xE9."),v&&(v.value="")},x=()=>{c&&(Y.length?Y.length===1?c.textContent="1 m\xE9dia":c.textContent=`${Y.length} m\xE9dias`:c.textContent="0 m\xE9dia")},E=()=>{if(o.innerHTML="",!Y.length){n==null||n.classList.remove("hidden"),pe();return}n==null||n.classList.add("hidden"),Y.forEach(h=>{let $=document.createElement("button");$.type="button",$.dataset.mediaId=h.id;let g=h.id===K;$.className=["group relative flex flex-col rounded-2xl border px-3 py-3 text-left transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#9C6BFF]",g?"border-[#9C6BFF] bg-[#F7F0FF]/60 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let ne=I(h)?`<img src="${h.path}" alt="${h.alt||h.filename}" class="h-full w-full object-cover" />`:'<div class="flex h-full w-full items-center justify-center text-3xl text-slate-400">\u{1F4C4}</div>';$.innerHTML=`
          <div class="relative aspect-[4/3] overflow-hidden rounded-xl bg-slate-100">
            ${ne}
          </div>
          <div class="mt-2 space-y-1">
            <p class="text-sm font-semibold text-slate-900 truncate">${h.filename}</p>
            <p class="text-xs text-slate-500">
              ${k(h)} \xB7 ${z(h.size)}
            </p>
          </div>
        `,h.id===be&&($.classList.add("ring-2","ring-[#9C6BFF]"),window.setTimeout(()=>{$.classList.remove("ring-2","ring-[#9C6BFF]")},1600)),$.addEventListener("click",()=>ge(h.id)),o.appendChild($)}),be=null},re=h=>{if(w){if(w.innerHTML="",!h.usedIn||h.usedIn.length===0){let $=document.createElement("li");$.textContent="Non utilis\xE9",$.className="text-xs text-slate-400",w.appendChild($);return}h.usedIn.forEach($=>{let g=document.createElement("li");g.textContent=$,g.className="text-xs text-slate-600",w.appendChild(g)})}},Q=h=>{if(B){if(_){B.textContent=h?"T\xE9l\xE9versement\u2026":"T\xE9l\xE9verser",B.disabled=h||!Ce,F&&F.classList.add("hidden");return}B.textContent=h?"Enregistrement\u2026":"Enregistrer",B.disabled=h||!xe,F&&(F.classList.remove("hidden"),F.disabled=!K)}},ge=h=>{let $=W.find(g=>g.id===h);if(!$){pe(),E();return}C(),K=$.id,xe=!1,Q(!1),E(),p==null||p.classList.add("hidden"),y==null||y.classList.remove("hidden"),V&&(I($)?V.innerHTML=`<img src="${$.path}" alt="${$.alt||$.filename}" class="h-full w-full rounded-2xl object-cover" />`:V.innerHTML='<div class="flex h-full w-full flex-col items-center justify-center gap-1 text-slate-400"><span class="text-3xl">\u{1F4C4}</span><span class="text-xs font-semibold">Document</span></div>'),U&&(U.textContent=$.filename||"Fichier"),O&&(O.textContent=k($)),ee&&(ee.textContent=z($.size)),T&&(T.value=$.alt||""),Z&&(Z.textContent=$.path||"\u2014"),re($)},ae=h=>{if(h){if(_=!0,xe=!1,K=null,p==null||p.classList.add("hidden"),y==null||y.classList.remove("hidden"),Pe&&URL.revokeObjectURL(Pe),Pe=URL.createObjectURL(h),V&&(V.innerHTML=`<img src="${Pe}" alt="${h.name}" class="h-full w-full rounded-2xl object-cover" />`),U&&(U.textContent=h.name),O&&(O.textContent=k({type:h.type,filename:h.name})),ee&&(ee.textContent=z(h.size)),T&&!T.value.trim()&&(T.value=h.name.replace(/\.[^.]+$/,"").replace(/[-_]/g," ")),Z&&(Z.textContent="En attente de t\xE9l\xE9versement"),w){w.innerHTML="";let $=document.createElement("li");$.textContent="Non utilis\xE9",$.className="text-xs text-slate-400",w.appendChild($)}Q(!1)}},we=()=>{let h=(f==null?void 0:f.value)||"all";h==="all"?Y=[...W]:Y=W.filter($=>$.groupType===h),Y.some($=>$.id===K)||pe(),x(),E()},de=async()=>{if(!H){n==null||n.classList.remove("hidden");return}try{let h=await fetch(H,{headers:{Accept:"application/json"}});if(!h.ok)throw new Error("Impossible de charger les m\xE9dias.");let $=await h.json().catch(()=>({items:[]}));W=Array.isArray($.items)?$.items.map(g=>({...g,groupType:Ve(g)})):[],we()}catch(h){console.error("[media] load failed",h),M(h.message||"Impossible de charger les m\xE9dias."),W=[],we()}};f==null||f.addEventListener("change",()=>{we()}),T==null||T.addEventListener("input",()=>{if(_){Q(!1);return}K&&(xe=!0,Q(!1))});let He=h=>{if(h){if(!h.type.startsWith("image/")){M("Seules les images sont accept\xE9es pour le moment.");return}if(h.size>4*1024*1024){M("Fichier trop volumineux (4 Mo max).");return}Ce=h,ae(h),A&&(A.textContent=`${h.name} \xB7 ${z(h.size)}`)}},Ne=h=>new Promise(($,g)=>{let ne=new FileReader;ne.onload=()=>{let $t=ne.result||"",[,Xt=""]=String($t).split(",");$(Xt)},ne.onerror=()=>g(new Error("Impossible de lire ce fichier.")),ne.readAsDataURL(h)}),ke=async()=>{if(!(!Ce||!H)){Je=!0,Q(!0);try{let h=await Ne(Ce),$={filename:Ce.name,type:Ce.type,size:Ce.size,alt:(T==null?void 0:T.value)||"",data:h},g=await fetch(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!g.ok){let $t=await g.json().catch(()=>({}));throw new Error($t.message||"Upload impossible.")}let ne=await g.json();ne.groupType=Ve(ne),W=[...W,ne],be=ne.id,we(),ge(ne.id),M("M\xE9dia ajout\xE9"),C()}catch(h){console.error("[media] upload failed",h),M(h.message||"Impossible de t\xE9l\xE9verser ce m\xE9dia.")}finally{Je=!1,Ce=null,Q(!1)}}};S==null||S.addEventListener("click",()=>v==null?void 0:v.click()),v==null||v.addEventListener("change",()=>{v.files&&v.files[0]&&He(v.files[0])});let qe=()=>{j&&(j.classList.add("hidden"),j.classList.remove("flex"))},je=()=>{if(!(!K||_)){if(j){j.classList.remove("hidden"),j.classList.add("flex");return}window.confirm("Supprimer ce m\xE9dia ?")&&Ht()}},Ht=async()=>{if(!K||!H){qe();return}let h=()=>{F&&(F.disabled=!0),L&&(L.disabled=!0,L.textContent="Suppression\u2026")},$=()=>{F&&(F.disabled=!1),L&&(L.disabled=!1,L.textContent="Supprimer")};h();try{let g=await fetch(`${H}/${encodeURIComponent(K)}`,{method:"DELETE"});if(!g.ok){let ne=await g.json().catch(()=>({}));throw new Error(ne.message||"Suppression impossible.")}W=W.filter(ne=>ne.id!==K),Y=Y.filter(ne=>ne.id!==K),M("M\xE9dia supprim\xE9"),pe(),x(),E()}catch(g){console.error("[media] delete failed",g),M(g.message||"Impossible de supprimer ce m\xE9dia.")}finally{$(),qe()}};R==null||R.addEventListener("click",qe),j==null||j.addEventListener("click",h=>{h.target===j&&qe()}),L==null||L.addEventListener("click",()=>Ht()),F==null||F.addEventListener("click",je),B==null||B.addEventListener("click",async()=>{if(_){ke();return}if(!(!K||!H||!T)){Q(!0);try{let h={alt:T.value||""},$=await fetch(`${H}/${encodeURIComponent(K)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!$.ok){let ne=await $.json().catch(()=>({}));throw new Error(ne.message||"Impossible de mettre \xE0 jour ce m\xE9dia.")}let g=await $.json();W=W.map(ne=>ne.id===K?{...ne,...g}:ne),Y=Y.map(ne=>ne.id===K?{...ne,...g}:ne),xe=!1,Q(!1),M("M\xE9dia mis \xE0 jour")}catch(h){console.error("[media] update failed",h),M(h.message||"\xC9chec de la mise \xE0 jour."),Q(!1)}}}),de()}let jo=document.getElementById("ai-chat-toggle"),ls=document.getElementById("ai-chat-panel"),it=document.getElementById("ai-chat-overlay"),Mo=document.getElementById("ai-chat-close"),Fo=document.getElementById("ai-chat-clear"),No=document.getElementById("ai-chat-form"),It=document.getElementById("ai-chat-input"),Le=document.getElementById("ai-chat-messages"),Ea=document.getElementById("ai-chat-status"),xt=document.getElementById("ai-chat-no-api"),En=document.querySelectorAll("[data-ai-quick]"),eo=!1,Do=!1,vr=!1,qn=!1;function An(){ls&&(eo=!0,ls.classList.remove("translate-x-full"),ls.setAttribute("aria-hidden","false"),it==null||it.classList.remove("opacity-0","pointer-events-none"),it==null||it.classList.add("opacity-100"),document.body.classList.add("overflow-hidden"),It==null||It.focus(),vr||Tn())}function to(){ls&&(eo=!1,ls.classList.add("translate-x-full"),ls.setAttribute("aria-hidden","true"),it==null||it.classList.add("opacity-0","pointer-events-none"),it==null||it.classList.remove("opacity-100"),document.body.classList.remove("overflow-hidden"))}async function Tn(){let o=Te(te.slug||"");if(!o){xt==null||xt.classList.remove("hidden");return}try{let n=await fetch(`/api/sites/${encodeURIComponent(o)}/config/ai`);if(!n.ok)throw new Error("Config check failed");let c=await n.json();vr=!0,qn=c.hasApiKey,!c.enabled||!c.hasApiKey?xt==null||xt.classList.remove("hidden"):(xt==null||xt.classList.add("hidden"),In())}catch(n){console.error("[AI] Config check failed:",n),xt==null||xt.classList.remove("hidden")}}async function In(){let o=Te(te.slug||"");if(!(!o||!Le))try{let n=await fetch(`/api/sites/${encodeURIComponent(o)}/ai/history`);if(!n.ok)return;let c=await n.json();if(c.messages&&c.messages.length>0){let f=Le.querySelector("[data-ai-welcome]");f&&f.remove(),c.messages.forEach(p=>{so(p.content,p.role==="user"?"user":"assistant")}),Le.scrollTop=Le.scrollHeight}}catch(n){console.error("[AI] History load failed:",n)}}function so(o,n="assistant"){if(!Le)return;let c=document.createElement("div");if(c.className="flex gap-3",n==="user")c.innerHTML=`
        <div class="flex-1"></div>
        <div class="max-w-[80%] bg-violet-600 text-white rounded-2xl rounded-tr-none p-3">
          <p class="text-sm whitespace-pre-wrap">${pt(o)}</p>
        </div>
        <div class="w-8 h-8 rounded-full bg-slate-200 flex-shrink-0 flex items-center justify-center">
          <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
      `;else{let f=Bn(o);c.innerHTML=`
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-indigo-600 flex-shrink-0 flex items-center justify-center">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
        </div>
        <div class="flex-1 bg-slate-50 rounded-2xl rounded-tl-none p-3 overflow-x-auto">
          <div class="text-sm text-slate-700 prose prose-sm max-w-none [&>pre]:bg-slate-800 [&>pre]:text-slate-100 [&>pre]:rounded-lg [&>pre]:p-3 [&>pre]:overflow-x-auto [&>code]:bg-slate-200 [&>code]:px-1 [&>code]:rounded">${f}</div>
        </div>
      `}Le.appendChild(c),Le.scrollTop=Le.scrollHeight}function $n(){if(!Le)return;let o=document.createElement("div");o.className="flex gap-3",o.id="ai-loading-indicator",o.innerHTML=`
      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-indigo-600 flex-shrink-0 flex items-center justify-center">
        <svg class="w-4 h-4 text-white animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
      </div>
      <div class="flex-1 bg-slate-50 rounded-2xl rounded-tl-none p-3">
        <div class="flex items-center gap-2">
          <div class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
          <div class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
          <div class="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
        </div>
      </div>
    `,Le.appendChild(o),Le.scrollTop=Le.scrollHeight}function xr(){let o=document.getElementById("ai-loading-indicator");o==null||o.remove()}function Bn(o){if(!o)return"";let n=pt(o);return n=n.replace(/```(\w*)\n([\s\S]*?)```/g,(c,f,p)=>`<pre class="language-${f||"text"}"><code>${p.trim()}</code></pre>`),n=n.replace(/`([^`]+)`/g,"<code>$1</code>"),n=n.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),n=n.replace(/\*([^*]+)\*/g,"<em>$1</em>"),n=n.replace(/^### (.+)$/gm,'<h4 class="font-semibold text-slate-900 mt-3 mb-1">$1</h4>'),n=n.replace(/^## (.+)$/gm,'<h3 class="font-semibold text-slate-900 mt-3 mb-1">$1</h3>'),n=n.replace(/^# (.+)$/gm,'<h2 class="font-bold text-slate-900 mt-3 mb-2">$1</h2>'),n=n.replace(/^- (.+)$/gm,'<li class="ml-4">$1</li>'),n=n.replace(/^(\d+)\. (.+)$/gm,'<li class="ml-4">$2</li>'),n=n.replace(/\n\n/g,'</p><p class="mb-2">'),n='<p class="mb-2">'+n+"</p>",n=n.replace(/<p class="mb-2"><\/p>/g,""),n}function pt(o){let n=document.createElement("div");return n.textContent=o,n.innerHTML}async function wr(o){let n=Te(te.slug||"");if(!o||!n||Do)return;Do=!0,It.disabled=!0;let c=Le==null?void 0:Le.querySelector("[data-ai-welcome]");c&&c.remove(),so(o,"user"),$n();try{let f=await fetch(`/api/sites/${encodeURIComponent(n)}/ai/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o})});if(xr(),!f.ok){let y=await f.json().catch(()=>({}));throw new Error(y.message||"Erreur de communication")}let p=await f.json();p.response&&so(p.response,"assistant"),p.editProposal&&Pn(p.editProposal),p.themeProposal&&jn(p.themeProposal)}catch(f){xr(),so(`\u274C Erreur: ${f.message}`,"assistant")}finally{Do=!1,It.disabled=!1,It.focus()}}function Pn(o){var f,p;if(!Le||!o)return;let n=document.createElement("div");n.className="flex gap-3 mt-2",n.dataset.proposalId=o.proposalId;let c="";if(o.changes&&(o.changes.title&&(c+=`<li>Titre \u2192 <strong>${pt(o.changes.title)}</strong></li>`),o.changes.description&&(c+=`<li>Description \u2192 ${pt(o.changes.description.substring(0,80))}...</li>`),o.changes.seo&&(o.changes.seo.metaTitle&&(c+=`<li>Meta title \u2192 ${pt(o.changes.seo.metaTitle)}</li>`),o.changes.seo.metaDescription&&(c+=`<li>Meta description \u2192 ${pt(o.changes.seo.metaDescription.substring(0,60))}...</li>`)),o.changes.blockUpdate&&(c+=`<li>Bloc "${o.changes.blockUpdate.blockId}" modifi\xE9</li>`,o.changes.blockUpdate.settings))){let y=o.changes.blockUpdate.settings;y.title&&(c+=`<li class="ml-4">\u2192 title: ${pt(y.title)}</li>`),y.content&&(c+='<li class="ml-4">\u2192 content modifi\xE9</li>')}n.innerHTML=`
      <div class="w-8 h-8 rounded-full bg-amber-500 flex-shrink-0 flex items-center justify-center">
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
      </div>
      <div class="flex-1 bg-amber-50 border border-amber-200 rounded-2xl rounded-tl-none p-4">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-xs font-semibold text-amber-700 bg-amber-100 px-2 py-0.5 rounded">Proposition d'\xE9dition</span>
        </div>
        <p class="text-sm font-medium text-slate-800 mb-1">Page : ${pt(o.pageTitle||o.pageId)}</p>
        ${o.reason?`<p class="text-sm text-slate-600 mb-2">${pt(o.reason)}</p>`:""}
        <ul class="text-xs text-slate-600 space-y-1 mb-3 list-disc ml-4">
          ${c||"<li>Modifications propos\xE9es</li>"}
        </ul>
        <div class="flex gap-2">
          <button 
            class="ai-apply-edit px-3 py-1.5 text-xs font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition-colors flex items-center gap-1"
            data-proposal-id="${o.proposalId}"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Appliquer
          </button>
          <button 
            class="ai-reject-edit px-3 py-1.5 text-xs font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors flex items-center gap-1"
            data-proposal-id="${o.proposalId}"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Rejeter
          </button>
        </div>
      </div>
    `,Le.appendChild(n),Le.scrollTop=Le.scrollHeight,(f=n.querySelector(".ai-apply-edit"))==null||f.addEventListener("click",Nn),(p=n.querySelector(".ai-reject-edit"))==null||p.addEventListener("click",Sr)}function jn(o){var p,y,V,U;if(!Le||!o)return;let n=document.createElement("div");n.className="flex gap-3 mt-2",n.dataset.proposalId=o.proposalId;let c="";if((p=o.changes)!=null&&p.colors){let O=o.changes.colors;for(let[ee,Z]of Object.entries(O))c+=`<li class="flex items-center gap-2">
          <span class="w-4 h-4 rounded border border-slate-300" style="background: ${Mn(Z)}"></span>
          <span>${ee}: <strong>${pt(Z)}</strong></span>
        </li>`}let f="";if((y=o.changes)!=null&&y.typography){let O=o.changes.typography;O.headings&&(f+=`<li>Titres \u2192 <strong>${pt(O.headings)}</strong></li>`),O.body&&(f+=`<li>Textes \u2192 <strong>${pt(O.body)}</strong></li>`)}n.innerHTML=`
      <div class="w-8 h-8 rounded-full bg-purple-500 flex-shrink-0 flex items-center justify-center">
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/>
        </svg>
      </div>
      <div class="flex-1 bg-purple-50 border border-purple-200 rounded-2xl rounded-tl-none p-4">
        <div class="flex items-center gap-2 mb-2">
          <span class="text-xs font-semibold text-purple-700 bg-purple-100 px-2 py-0.5 rounded">Modification du th\xE8me</span>
        </div>
        ${o.reason?`<p class="text-sm text-slate-600 mb-3">${pt(o.reason)}</p>`:""}
        ${c?`
          <p class="text-xs font-medium text-slate-700 mb-1">Couleurs :</p>
          <ul class="text-xs text-slate-600 space-y-1 mb-3">${c}</ul>
        `:""}
        ${f?`
          <p class="text-xs font-medium text-slate-700 mb-1">Typographies :</p>
          <ul class="text-xs text-slate-600 space-y-1 mb-3 list-disc ml-4">${f}</ul>
        `:""}
        <div class="flex gap-2">
          <button 
            class="ai-apply-theme px-3 py-1.5 text-xs font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors flex items-center gap-1"
            data-proposal-id="${o.proposalId}"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            Appliquer
          </button>
          <button 
            class="ai-reject-theme px-3 py-1.5 text-xs font-medium text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors flex items-center gap-1"
            data-proposal-id="${o.proposalId}"
          >
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Rejeter
          </button>
        </div>
      </div>
    `,Le.appendChild(n),Le.scrollTop=Le.scrollHeight,(V=n.querySelector(".ai-apply-theme"))==null||V.addEventListener("click",Fn),(U=n.querySelector(".ai-reject-theme"))==null||U.addEventListener("click",Sr)}function Mn(o){return{white:"#ffffff",black:"#000000",transparent:"transparent","slate-50":"#f8fafc","slate-100":"#f1f5f9","slate-200":"#e2e8f0","slate-300":"#cbd5e1","slate-400":"#94a3b8","slate-500":"#64748b","slate-600":"#475569","slate-700":"#334155","slate-800":"#1e293b","slate-900":"#0f172a","gray-50":"#f9fafb","gray-100":"#f3f4f6","gray-200":"#e5e7eb","gray-300":"#d1d5db","gray-400":"#9ca3af","gray-500":"#6b7280","gray-600":"#4b5563","gray-700":"#374151","gray-800":"#1f2937","gray-900":"#111827","violet-50":"#f5f3ff","violet-100":"#ede9fe","violet-200":"#ddd6fe","violet-300":"#c4b5fd","violet-400":"#a78bfa","violet-500":"#8b5cf6","violet-600":"#7c3aed","violet-700":"#6d28d9","violet-800":"#5b21b6","violet-900":"#4c1d95","purple-50":"#faf5ff","purple-100":"#f3e8ff","purple-200":"#e9d5ff","purple-300":"#d8b4fe","purple-400":"#c084fc","purple-500":"#a855f7","purple-600":"#9333ea","purple-700":"#7e22ce","purple-800":"#6b21a8","purple-900":"#581c87","blue-50":"#eff6ff","blue-100":"#dbeafe","blue-200":"#bfdbfe","blue-300":"#93c5fd","blue-400":"#60a5fa","blue-500":"#3b82f6","blue-600":"#2563eb","blue-700":"#1d4ed8","blue-800":"#1e40af","blue-900":"#1e3a8a","emerald-50":"#ecfdf5","emerald-100":"#d1fae5","emerald-200":"#a7f3d0","emerald-300":"#6ee7b7","emerald-400":"#34d399","emerald-500":"#10b981","emerald-600":"#059669","emerald-700":"#047857","emerald-800":"#065f46","emerald-900":"#064e3b","teal-50":"#f0fdfa","teal-100":"#ccfbf1","teal-200":"#99f6e4","teal-300":"#5eead4","teal-400":"#2dd4bf","teal-500":"#14b8a6","teal-600":"#0d9488","teal-700":"#0f766e","teal-800":"#115e59","teal-900":"#134e4a","amber-50":"#fffbeb","amber-100":"#fef3c7","amber-200":"#fde68a","amber-300":"#fcd34d","amber-400":"#fbbf24","amber-500":"#f59e0b","amber-600":"#d97706","amber-700":"#b45309","amber-800":"#92400e","amber-900":"#78350f","red-50":"#fef2f2","red-100":"#fee2e2","red-200":"#fecaca","red-300":"#fca5a5","red-400":"#f87171","red-500":"#ef4444","red-600":"#dc2626","red-700":"#b91c1c","red-800":"#991b1b","red-900":"#7f1d1d"}[o]||"#9C6BFF"}async function Fn(o){var p;let n=(p=o.target.closest("[data-proposal-id]"))==null?void 0:p.dataset.proposalId,c=Te(te.slug||"");if(!n||!c)return;let f=o.target.closest("button");f.disabled=!0,f.innerHTML='<span class="animate-spin">\u23F3</span> Application...';try{let y=await fetch(`/api/sites/${encodeURIComponent(c)}/ai/apply-theme`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proposalId:n})}),V=await y.json();if(y.ok&&V.success){let U=document.querySelector(`[data-proposal-id="${n}"]`);U&&(U.innerHTML=`
            <div class="w-8 h-8 rounded-full bg-purple-500 flex-shrink-0 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div class="flex-1 bg-purple-50 border border-purple-200 rounded-2xl rounded-tl-none p-3">
              <p class="text-sm text-purple-700">\u2705 Th\xE8me mis \xE0 jour avec succ\xE8s !</p>
              <p class="text-xs text-purple-600 mt-1">Rechargez la preview pour voir les changements.</p>
            </div>
          `),M("Th\xE8me mis \xE0 jour !"),document.dispatchEvent(new CustomEvent("ai-theme-updated",{detail:{updatedTheme:V.updatedTheme}}))}else throw new Error(V.message||"Erreur lors de l'application")}catch(y){f.disabled=!1,f.innerHTML='<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> R\xE9essayer',M(`Erreur: ${y.message}`)}}async function Nn(o){var p,y;let n=(p=o.target.closest("[data-proposal-id]"))==null?void 0:p.dataset.proposalId,c=Te(te.slug||"");if(!n||!c)return;let f=o.target.closest("button");f.disabled=!0,f.innerHTML='<span class="animate-spin">\u23F3</span> Application...';try{let V=await fetch(`/api/sites/${encodeURIComponent(c)}/ai/apply-edit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proposalId:n})}),U=await V.json();if(V.ok&&U.success){let O=document.querySelector(`[data-proposal-id="${n}"]`);O&&(O.innerHTML=`
            <div class="w-8 h-8 rounded-full bg-emerald-500 flex-shrink-0 flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div class="flex-1 bg-emerald-50 border border-emerald-200 rounded-2xl rounded-tl-none p-3">
              <p class="text-sm text-emerald-700">\u2705 Modifications appliqu\xE9es avec succ\xE8s !</p>
              <p class="text-xs text-emerald-600 mt-1">La preview se met \xE0 jour automatiquement.</p>
            </div>
          `),M("Modifications appliqu\xE9es !");let ee=((y=U.updatedPage)==null?void 0:y.id)||null;document.dispatchEvent(new CustomEvent("ai-page-updated",{detail:{pageId:ee,updatedPage:U.updatedPage}}))}else throw new Error(U.message||"Erreur lors de l'application")}catch(V){f.disabled=!1,f.innerHTML='<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> R\xE9essayer',M(`Erreur: ${V.message}`)}}async function Sr(o){var f;let n=(f=o.target.closest("[data-proposal-id]"))==null?void 0:f.dataset.proposalId,c=Te(te.slug||"");if(!(!n||!c))try{await fetch(`/api/sites/${encodeURIComponent(c)}/ai/proposal/${n}`,{method:"DELETE"});let p=document.querySelector(`[data-proposal-id="${n}"]`);p&&(p.innerHTML=`
          <div class="w-8 h-8 rounded-full bg-slate-400 flex-shrink-0 flex items-center justify-center">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </div>
          <div class="flex-1 bg-slate-100 rounded-2xl rounded-tl-none p-3">
            <p class="text-sm text-slate-500">Proposition rejet\xE9e.</p>
          </div>
        `)}catch(p){console.error("[AI] Reject edit error:",p)}}async function Dn(){let o=Te(te.slug||"");if(!(!o||!Le))try{await fetch(`/api/sites/${encodeURIComponent(o)}/ai/history`,{method:"DELETE"}),Le.innerHTML="",Le.innerHTML=`
        <div class="flex gap-3" data-ai-welcome>
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-violet-500 to-indigo-600 flex-shrink-0 flex items-center justify-center">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <div class="flex-1 bg-slate-50 rounded-2xl rounded-tl-none p-3">
            <p class="text-sm text-slate-700">
              Salut ! \u{1F44B} Je suis ton assistant IA pour ce site. Je peux t'aider \xE0 :
            </p>
            <ul class="mt-2 text-sm text-slate-600 space-y-1">
              <li>\u{1F3A8} Sugg\xE9rer des palettes de couleurs</li>
              <li>\u270D\uFE0F G\xE9n\xE9rer du contenu pour tes blocs</li>
              <li>\u{1F4C4} Cr\xE9er des structures de pages</li>
              <li>\u{1F50D} Am\xE9liorer ton SEO</li>
              <li>\u270F\uFE0F <strong>Analyser et modifier tes pages</strong> (avec validation)</li>
            </ul>
          </div>
        </div>
      `,M("Historique effac\xE9")}catch(n){console.error("[AI] Clear history failed:",n),M("Erreur lors de l'effacement")}}let Hn={colors:"Sugg\xE8re-moi 3 palettes de couleurs harmonieuses pour mon site. Pour chaque palette, donne les couleurs Tailwind: primary, secondary, accent, et background.",hero:"G\xE9n\xE8re un bloc Hero en JSON avec un titre accrocheur, un sous-titre engageant et un CTA.",seo:"Analyse mon site et sugg\xE8re des am\xE9liorations SEO pour le meta title et la meta description de ma page d'accueil.",landing:"G\xE9n\xE8re la structure JSON d'une landing page compl\xE8te avec: Hero, 3 sections de contenu, et un CTA final.",analyze:"Analyse le contenu de toutes mes pages et propose des am\xE9liorations concr\xE8tes. Pour chaque suggestion d'am\xE9lioration de texte ou de structure, utilise le format propose-edit pour que je puisse valider.",improveHome:"Analyse ma page d'accueil et propose une am\xE9lioration du titre ou du Hero pour le rendre plus impactant. Utilise le format propose-edit."};jo==null||jo.addEventListener("click",()=>{eo?to():An()}),Mo==null||Mo.addEventListener("click",to),it==null||it.addEventListener("click",to),Fo==null||Fo.addEventListener("click",()=>{confirm("Effacer tout l'historique de conversation ?")&&Dn()}),No==null||No.addEventListener("submit",o=>{var c;o.preventDefault();let n=(c=It==null?void 0:It.value)==null?void 0:c.trim();n&&(It.value="",wr(n))}),En.forEach(o=>{o.addEventListener("click",()=>{let n=o.dataset.aiQuick,c=Hn[n];c&&wr(c)})}),document.addEventListener("keydown",o=>{o.key==="Escape"&&eo&&to()})});})();
