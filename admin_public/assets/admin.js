(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("[admin] Atelier charg\xE9");let Ct=document.querySelector("[data-logout]");Ct&&Ct.addEventListener("click",async()=>{Ct.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(n){console.error("[admin] Impossible de se d\xE9connecter",n)}finally{window.location.href="/admin/index.html"}});let We=document.querySelector("[data-admin-sidebar]"),fe=document.querySelector("[data-admin-sidebar-overlay]"),Jt=document.querySelectorAll("[data-admin-sidebar-toggle]"),is=document.querySelectorAll("[data-admin-sidebar-close]"),Et=document.body,it=!1,lt=()=>{if(!We)return;if(window.matchMedia("(min-width: 1024px)").matches){We.classList.remove("hidden"),fe==null||fe.classList.add("hidden"),Et.classList.remove("overflow-hidden");return}it?(We.classList.remove("hidden"),fe==null||fe.classList.remove("hidden"),Et.classList.add("overflow-hidden")):(We.classList.add("hidden"),fe==null||fe.classList.add("hidden"),Et.classList.remove("overflow-hidden"))},ls=()=>{it=!0,lt()},qt=()=>{it=!1,lt()};We&&Jt.length>0&&(Jt.forEach(n=>{n.addEventListener("click",ls)}),is.forEach(n=>{n.addEventListener("click",qt)}),fe==null||fe.addEventListener("click",qt),window.addEventListener("resize",lt),window.addEventListener("keydown",n=>{n.key==="Escape"&&it&&qt()}),lt());let Wt="clower:currentSite",Gt="clower:currentSiteName",_={slug:null,name:""};(()=>{try{_.slug=window.localStorage.getItem(Wt),_.name=window.localStorage.getItem(Gt)||""}catch{_.slug=null,_.name=""}})();let kt=document.querySelectorAll("[data-site-card]"),cs=document.querySelectorAll("[data-site-select]"),Ge=document.querySelector("[data-current-site-name]"),_t=document.querySelector("[data-workspace-site-name]"),Yt=document.querySelector("[data-workspace-back-name]"),je=document.querySelector("[data-workspace-back-modal]"),ds=document.querySelectorAll("[data-workspace-back]"),us=document.querySelectorAll("[data-workspace-back-cancel]"),At=document.querySelector("[data-workspace-back-confirm]"),ms=document.querySelectorAll("[data-workspace-tab]"),It=document.querySelector("[data-site-toast]"),Kt=document.querySelector("[data-site-toast-message]"),ps=document.querySelectorAll("[data-site-create]"),le=document.querySelector("[data-site-modal]"),Ie=document.querySelector("[data-site-form]"),xe=document.querySelector("[data-site-name]"),Le=document.querySelector("[data-site-slug]"),me=document.querySelector("[data-site-slug-error]"),Ce=document.querySelector("[data-site-modal-error]"),fs=document.querySelectorAll("[data-site-modal-cancel]"),ze=document.querySelector("[data-site-modal-submit]"),J=ws(),ct=!1,dt=null,Tt=null,gs='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',Xt=n=>{if(!le||le.classList.contains("hidden")||n.key!=="Tab")return;let u=Array.from(le.querySelectorAll(gs)).filter(B=>!B.hasAttribute("disabled")&&!B.getAttribute("aria-hidden"));if(u.length===0)return;let g=u[0],S=u[u.length-1];n.shiftKey?document.activeElement===g&&(n.preventDefault(),S.focus()):document.activeElement===S&&(n.preventDefault(),g.focus())},V=n=>{!It||!Kt||(Kt.textContent=n,It.classList.remove("hidden"),Tt&&clearTimeout(Tt),Tt=setTimeout(()=>{It.classList.add("hidden")},2500))};function Te(n){return n?n.startsWith("/")?n:`/${n}`:""}function Ee(n){return(n==null?void 0:n.replace(/^\//,""))||""}let ut=(n,u)=>{let g=n?Te(n):null;try{g&&(window.localStorage.setItem(Wt,g),_.slug=g),typeof u=="string"&&u.length>0&&(window.localStorage.setItem(Gt,u),_.name=u)}catch{_.slug=g||_.slug,_.name=u||_.name}},Zt=n=>{Ge&&n&&(Ge.textContent=n),_t&&n&&(_t.textContent=n),Yt&&n&&(Yt.textContent=n)},Bt=n=>{ms.forEach(u=>{let g=u.dataset.workspaceTab;if(!g)return;if(!n){u.href="#",u.classList.add("pointer-events-none","opacity-50","text-slate-400"),u.setAttribute("aria-disabled","true");return}let S=encodeURIComponent(Ee(n));u.href=`/admin/site/${S}/${g}`,u.classList.remove("pointer-events-none","opacity-50","text-slate-400"),u.removeAttribute("aria-disabled")})},mt=(n,u={})=>{if(!n)return;let g=Te(n),S=u.siteName||_.name||(Ge==null?void 0:Ge.dataset.defaultSiteName)||"";kt.forEach(y=>{let q=Te(y.dataset.siteCard||"")===g,l=y.querySelector("[data-site-active-badge]");q?(y.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),y.classList.remove("border-slate-200"),l==null||l.classList.remove("hidden"),S=y.dataset.siteName||S):(y.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),y.classList.add("border-slate-200"),l==null||l.classList.add("hidden"))}),u.persist!==!1&&ut(g,u.siteName||S);let B=u.siteName||S;Zt(B),Bt(g)},hs=async(n,u)=>{let g=Te(n);try{let S=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:g})});if(!S.ok){let l=await S.json().catch(()=>({}));V(l.message||"Impossible de s\xE9lectionner ce site.");return}let B=await S.json().catch(()=>({})),y=Te(B.slug||g),z=B.name||u;ut(y,z),mt(y,{siteName:z,persist:!1});let q=encodeURIComponent(Ee(y));window.location.href=`/admin/site/${q}/design`}catch(S){console.error("[admin] Impossible de s\xE9lectionner le site",S),V("Erreur inattendue lors de la s\xE9lection.")}},ys=async()=>{try{let n=await fetch("/api/sites/current",{credentials:"same-origin"});if(!n.ok){n.status===404&&J&&(window.location.href="/admin/sites");return}let u=await n.json(),g=Te(u.slug);ut(g,u.name),mt(g,{siteName:u.name,persist:!1})}catch(n){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",n)}};(()=>{if(_.slug){mt(_.slug,{siteName:_.name,persist:!1});return}let n=document.querySelector('[data-site-card][data-site-default="true"]')||kt[0];n&&mt(n.dataset.siteCard,{siteName:n.dataset.siteName||"",persist:!1})})(),ys(),J?Bt(J.slugValue):_.slug&&Bt(_.slug),cs.forEach(n=>{n.addEventListener("click",()=>{if(n.disabled)return;let u=n.dataset.siteSelect,g=n.dataset.siteSelectName||"Ce site";u&&(n.disabled=!0,hs(u,g).finally(()=>{n.disabled=!1}))})});let _e=n=>n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),vs=n=>{let u=_e(n||"");return u?`/${u}`:""},bs=()=>{le&&(dt=document.activeElement,le.classList.remove("hidden"),le.classList.add("flex"),ct=!1,Ie==null||Ie.reset(),me&&(me.textContent=""),Ce&&(Ce.textContent=""),Le&&xe&&(Le.value=_e(xe.value)),document.addEventListener("keydown",Xt),window.setTimeout(()=>{xe==null||xe.focus()},0))},pt=()=>{le&&(le.classList.add("hidden"),le.classList.remove("flex"),document.removeEventListener("keydown",Xt),ct=!1,Ie==null||Ie.reset(),me&&(me.textContent=""),Ce&&(Ce.textContent=""),dt==null||dt.focus())};ps.forEach(n=>{n.addEventListener("click",bs)}),fs.forEach(n=>{n.addEventListener("click",pt)}),le==null||le.addEventListener("click",n=>{n.target===le&&pt()}),xe==null||xe.addEventListener("input",()=>{Le&&(!ct||Le.value.trim().length===0)&&(Le.value=_e(xe.value))}),Le==null||Le.addEventListener("input",()=>{ct=!0,me&&(me.textContent="")});let xs=()=>new Set(Array.from(kt).map(n=>Te(n.dataset.siteCard||"")));Ie==null||Ie.addEventListener("submit",async n=>{if(n.preventDefault(),!xe||!Le)return;let u=(xe.value||"").trim(),g=Le.value||"";g||(g=u);let S=vs(g);if(!u||!S){me&&(me.textContent="Nom et slug sont requis.");return}if(xs().has(S)){me&&(me.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}me&&(me.textContent=""),Ce&&(Ce.textContent=""),ze&&(ze.disabled=!0,ze.textContent="Cr\xE9ation...");try{let y=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,slug:S})});if(!y.ok){let M=await y.json().catch(()=>({})),v=M.message||"Impossible de cr\xE9er ce site.";Ce&&(Ce.textContent=v),M.field==="slug"&&me&&(me.textContent=v);return}let z=await y.json(),q=Te((z==null?void 0:z.slug)||S),l=(z==null?void 0:z.name)||u;ut(q,l),pt();let C=encodeURIComponent(Ee(q));window.location.href=`/admin/site/${C}/design`}catch(y){console.error("[admin] Impossible de cr\xE9er le site",y),Ce&&(Ce.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{ze&&(ze.disabled=!1,ze.textContent="Cr\xE9er")}}),window.addEventListener("keydown",n=>{n.key==="Escape"&&(le&&!le.classList.contains("hidden")&&pt(),je&&!je.classList.contains("hidden")&&Qt(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function ws(){let n=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return n?{slugPart:decodeURIComponent(n[1]),slugValue:Te(decodeURIComponent(n[1])),section:n[2]||"design"}:null}function Ss(){return document.querySelector("[data-page-list]")?"design":document.querySelector("[data-collection-list]")?"content":document.querySelector("[data-media-grid]")?"media":document.querySelector("[data-deploy-form]")?"deploy":null}function Ls(){if(!je){window.location.href="/admin/sites";return}je.classList.remove("hidden"),je.classList.add("flex")}function Qt(){je&&(je.classList.add("hidden"),je.classList.remove("flex"))}ds.forEach(n=>{n.addEventListener("click",Ls)}),us.forEach(n=>{n.addEventListener("click",Qt)}),At==null||At.addEventListener("click",()=>{window.location.href="/admin/sites"});let Ye=(J==null?void 0:J.section)||Ss();Ye==="design"&&Cs(),Ye==="content"&&Es(),Ye==="media"&&As(),Ye==="deploy"&&qs(),Ye==="settings"&&ks(),J&&_.name&&Zt(_.name);function Cs(){let n=document.querySelectorAll("[data-page-list]");if(n.length===0)return;let u=document.querySelector("[data-active-page-title]"),g=document.querySelector("[data-active-page-slug]"),S=document.querySelector("[data-page-preview-tags]"),B=document.querySelector("[data-page-preview-frame]"),y=document.querySelector("[data-preview-open]"),z=document.querySelector("[data-preview-status]"),q=document.querySelector("[data-preview-highlight]"),l=document.querySelector("[data-blocks-list]"),C=document.querySelector("[data-blocks-empty]"),M=document.querySelector("[data-block-count]"),v=document.querySelector("[data-block-library-toggle]"),L=document.querySelector("[data-block-library]"),x=document.querySelectorAll("[data-block-add]"),d=document.querySelector("[data-block-delete-modal]"),b=document.querySelector("[data-block-delete-confirm]"),P=document.querySelector("[data-block-delete-cancel]"),F=document.querySelector("[data-block-detail-empty]"),K=document.querySelector("[data-block-detail-status]"),H=document.querySelector("[data-block-editor]"),ce=document.querySelector("[data-block-editor-block-name]"),W=document.querySelector("[data-block-editor-block-type]"),D=document.querySelector("[data-block-editor-unsupported]"),p=document.querySelector("[data-block-form]"),R=p?Array.from(p.querySelectorAll("[data-editor-section]")):[],k=p==null?void 0:p.querySelector('[name="collection-grid-collection"]'),w=p==null?void 0:p.querySelector("[data-collection-selection-info]"),E=document.querySelector("[data-block-form-cancel]"),N=p==null?void 0:p.querySelector("[data-group-preview-mobile]"),i=p==null?void 0:p.querySelector("[data-group-preview-desktop]"),c={hero:{section:"hero",labelField:"title",descriptionField:"subtitle",fields:{title:"hero-title",subtitle:"hero-subtitle",ctaLabel:"hero-cta-label",ctaUrl:"hero-cta-url",image:"hero-image",align:"hero-align"}},paragraphe:{section:"paragraph",labelField:"title",descriptionField:"content",fields:{title:"paragraph-title",content:"paragraph-content",align:"paragraph-align"}},image:{section:"image",labelField:"alt",fields:{src:"image-src",alt:"image-alt",showCaption:"image-caption-toggle",caption:"image-caption"}},groupe:{section:"group",fields:{layout:"group-layout",columnsMobile:"group-columns-mobile",columnsDesktop:"group-columns-desktop"}},collectiongrid:{section:"collection",fields:{collectionId:"collection-grid-collection",limit:"collection-grid-limit"}}},A={texte:"paragraphe",paragraph:"paragraphe",paragraphs:"paragraphe",paragraphes:"paragraphe",text:"paragraphe",hero:"hero",image:"image",groupe:"groupe",group:"groupe",collection:"collectiongrid",collectiongrid:"collectiongrid","collection-grid":"collectiongrid"},Y=(e,t)=>{if(!N||!i)return;let s=a=>Array.from({length:Number(a)||1}).map(()=>'<span class="block h-2 w-full rounded-full bg-slate-300"></span>').join("");N.innerHTML=s(e),i.innerHTML=s(t)},X=async()=>{if(!o)return[];let e=await fetch(o,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Impossible de charger les pages.");let t=await e.json().catch(()=>[]);return Array.isArray(t)?t:[]},se=async({title:e,slug:t})=>{if(!o)throw new Error("Site inconnu.");let s=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,slug:t})});if(!s.ok){let a=await s.json().catch(()=>({}));throw new Error(a.message||"Impossible de cr\xE9er la page.")}return s.json().catch(()=>({}))},ge=async e=>{if(!(!o||!(e!=null&&e.id)))try{let t=await fetch(`${o}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let a=await t.json().catch(()=>({}));throw new Error(a.message||"Impossible de sauvegarder la page.")}let s=await t.json().catch(()=>({}));if(s!=null&&s.id){let a=nt(s);return de=de.map(h=>h.id===a.id?a:h),(j==null?void 0:j.id)===a.id&&(j=a),a}return s}catch(t){console.error("[design] Save page failed",t),V(t.message||"Sauvegarde impossible.")}},ne=async()=>{if(!o){de=[],ke=null,j=null,Ft(de,ke),Qe(null),F==null||F.classList.remove("hidden"),H==null||H.classList.add("hidden");return}try{let e=await X();if(de=(Array.isArray(e)?e:[]).map(t=>nt(t)),de.length===0){ke=null,j=null,Ft(de,ke),Qe(null),F==null||F.classList.remove("hidden"),H==null||H.classList.add("hidden"),B&&(B.srcdoc=te());return}ke=Re(de),Me(ke)}catch(e){console.error("[design] Impossible de charger les pages",e),V("Impossible de charger les pages.")}},Q=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),pe=e=>{if(!e)return null;let t=Q(e.type),s=A[t]||t;return c[s]||null},he=e=>{var s,a,h;if(!p||!H)return;e&&!e.settings&&(e.settings={});let t=pe(e);if(ce&&(ce.textContent=(e==null?void 0:e.label)||"Bloc"),W&&(W.textContent=(e==null?void 0:e.type)||"Bloc"),!t){p.classList.add("hidden"),D==null||D.classList.remove("hidden"),p.dataset.blockId="";return}if(D==null||D.classList.add("hidden"),p.classList.remove("hidden"),p.reset(),p.dataset.blockId=e.id,R.forEach(T=>{T.dataset.editorSection===t.section?T.classList.remove("hidden"):T.classList.add("hidden")}),t.section==="collection"){let T=e.collectionId||((s=e.settings)==null?void 0:s.collectionId)||"";wt(T)}if(Object.entries(t.fields).forEach(([T,G])=>{var Ue;let Z=p.querySelector(`[name="${G}"]`);if(!Z)return;let ie=(Ue=e.settings)==null?void 0:Ue[T];Z.type==="checkbox"?Z.checked=!!ie:Z.type==="number"?Z.value=ie!=null?ie:1:(Z.tagName,Z.value=ie!=null?ie:"")}),t.section==="group"){let T=((a=p.querySelector('[name="group-columns-mobile"]'))==null?void 0:a.value)||"1",G=((h=p.querySelector('[name="group-columns-desktop"]'))==null?void 0:h.value)||"3";Y(T,G)}},qe=e=>{if(!p||!e)return{};let t={};return Object.entries(e.fields).forEach(([s,a])=>{let h=p.querySelector(`[name="${a}"]`);if(h)if(h.type==="checkbox")t[s]=h.checked;else if(h.type==="number"){let T=Number(h.value);t[s]=Number.isFinite(T)?T:0}else h.tagName==="TEXTAREA"?t[s]=h.value||"":h.type==="select-one"?t[s]=h.value:t[s]=h.value||""}),t},ee=e=>{if(z){if(!e){z.classList.add("hidden");return}z.classList.remove("hidden"),z.textContent=e}},Be=e=>e?{id:e.id,title:e.title,slug:e.slug,badges:[...e.badges||[]],blocks:(e.blocks||[]).map(t=>{var s;return{id:t.id,type:t.type,label:t.label,status:t.status,description:t.description,props:t.props||[],settings:t.settings||{},collectionId:t.collectionId||((s=t.settings)==null?void 0:s.collectionId)||""}})}:null,te=()=>'<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#475569;background:#fff;">Pr\xE9paration de la pr\xE9visualisation\u2026</body></html>',ye=e=>{if(!B||!e)return;let t=(J==null?void 0:J.slugValue)||_.slug||"",s={page:Be(e),site:{title:_.name||"Site",slug:t}};Rt=!1,ee("Actualisation\u2026"),B.srcdoc=te(),st&&st.abort();let a=new AbortController;st=a,fetch("/api/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:a.signal}).then(h=>{if(!h.ok)throw new Error("Preview error");return h.json()}).then(h=>{a.signal.aborted||(Dt=h.html||"",B.setAttribute("title",`Pr\xE9visualisation de la page ${e.title||""}`.trim()),B.srcdoc=Dt||te(),ee("\xC0 jour"))}).catch(h=>{a.signal.aborted||(console.error("[preview] Impossible de rendre la page",h),ee("Erreur preview"),B.srcdoc='<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#be123c;background:#fff;">Erreur lors du rendu de la pr\xE9visualisation.</body></html>')}).finally(()=>{st===a&&(st=null)})},$e=e=>{if(e.preventDefault(),!j||!ue)return;let t=jt(),s=pe(t);if(!t||!s)return;let a=qe(s);if(s.section==="collection"){if(!a.collectionId){V("S\xE9lectionnez une collection.");return}a.limit=Math.max(1,Number(a.limit)||1)}let h=(j.blocks||[]).map(T=>{if(T.id!==t.id)return T;let G={...T.settings||{},...a},Z={...T,settings:G};return s.labelField&&a[s.labelField]&&(Z.label=a[s.labelField]),s.descriptionField&&a[s.descriptionField]&&(Z.description=a[s.descriptionField]),s.section==="collection"&&(Z.collectionId=a.collectionId,Z.settings.collectionId=a.collectionId,Z.settings.limit=a.limit),Z});et(h),V("Bloc mis \xE0 jour"),Me(j.id,{preserveBlock:!0})},we=document.querySelector("[data-page-drawer]"),ae=document.querySelector("[data-page-drawer-backdrop]"),He=document.querySelectorAll("[data-page-drawer-open]"),Pe=document.querySelectorAll("[data-page-drawer-close]"),ve=document.querySelector("[data-add-page-toggle]"),re=document.querySelector("[data-add-page-form]"),r=document.querySelector("[data-add-page-title]"),m=document.querySelector("[data-add-page-slug]"),U=document.querySelector("[data-add-page-cancel]"),I=document.querySelector("[data-add-page-error]"),be=re==null?void 0:re.querySelector('[type="submit"]'),Oe=Ee((J==null?void 0:J.slugValue)||_.slug||"default")||"default",ft=(J==null?void 0:J.slugValue)||_.slug||"",De=Ee(ft)||"",o=De?`/api/sites/${encodeURIComponent(De)}/pages`:null,f=De?`/api/sites/${encodeURIComponent(De)}/collections`:null,$={active:`clower:activePage:${Oe}`},O=(e,t,s,a,h,T=[],G={})=>{let Z={id:e,label:t,type:s,status:a,description:h,props:T,settings:{...G}};return Z.settings.collectionId&&(Z.collectionId=Z.settings.collectionId),Z},oe={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}],settings:{title:"Titre du hero",subtitle:"",ctaLabel:"D\xE9couvrir",ctaUrl:"#",image:"",align:"center"}},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}],settings:{title:"Titre du paragraphe",content:"",align:"left"}},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}],settings:{src:"",alt:"",showCaption:!1,caption:""}},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}],settings:{layout:"grid",columnsMobile:"1",columnsDesktop:"3"}},collectiongrid:{type:"CollectionGrid",label:"Grille de contenus",description:"Affiche automatiquement les items d\u2019une collection.",status:"Brouillon",settings:{collectionId:"",limit:6}}},Ke=e=>{try{window.localStorage.setItem($.active,e)}catch{}},Re=e=>{var t;try{let s=window.localStorage.getItem($.active);if(s&&e.some(a=>a.id===s))return s}catch{}return((t=e[0])==null?void 0:t.id)||null},Ne=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,Xe=e=>{if(!e||e==="/")return"/";let t=_e(e.replace(/^\//,""));return t?`/${t}`:"/"},Ve=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,$t=(e,t)=>[O(Ve(e,"intro"),"Introduction","Paragraphe","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}],{title:`Introduction \xE0 ${t}`,content:"Ajoutez votre premier paragraphe de pr\xE9sentation.",align:"left"}),O(Ve(e,"content"),"Zone de contenu","Groupe","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})],gt=e=>{u&&(u.textContent=(e==null?void 0:e.title)||"Page"),g&&(g.textContent=(e==null?void 0:e.slug)||"/")},Is=e=>{if(!S)return;S.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(s=>{let a=document.createElement("span");a.className="rounded-full bg-slate-100 px-3 py-1",a.textContent=s,S.appendChild(a)})},Ts=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},ht=e=>{if(!(!F||!H)){if(!e){F.classList.remove("hidden"),H.classList.add("hidden"),D==null||D.classList.add("hidden"),p==null||p.classList.add("hidden"),K==null||K.classList.add("hidden");return}F.classList.add("hidden"),H.classList.remove("hidden"),K&&(e.status?(K.textContent=e.status,K.className=`rounded-full px-3 py-1 text-xs font-semibold ${Ts(e.status)}`,K.classList.remove("hidden")):K.classList.add("hidden")),he(e)}},Ze=e=>{if(!B)return;let t=B.contentDocument;if(!t)return;t.querySelectorAll("[data-preview-block]").forEach(a=>{a.dataset.previewBlock===e?(a.classList.add("preview-block-active"),Rt&&e&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):a.classList.remove("preview-block-active")}),q&&(q.style.borderColor=e?"rgba(156, 107, 255, 0.5)":"transparent")},Qe=e=>{if(!l)return;l.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(M&&(M.textContent=Ne(t.length)),t.length===0){l.classList.add("hidden"),C==null||C.classList.remove("hidden");return}l.classList.remove("hidden"),C==null||C.classList.add("hidden"),t.forEach(s=>{var rs;let a=s.id===ue,h=document.createElement("div");h.dataset.blockItem="true",h.dataset.blockId=s.id,h.setAttribute("role","option"),h.setAttribute("aria-selected",a?"true":"false"),h.tabIndex=0,h.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition",a?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let T=document.createElement("span");T.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${a?"":"hidden"}`,h.appendChild(T);let G=document.createElement("div");G.className="flex flex-1 items-center gap-3";let Z=document.createElement("div");Z.className="hidden lg:flex cursor-grab flex-shrink-0 items-center text-lg text-slate-400",Z.innerHTML="&#8801;",G.appendChild(Z);let ie=document.createElement("div");ie.className="flex-1";let Ue=document.createElement("div");Ue.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let zt=document.createElement("span");zt.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",zt.textContent=s.type;let Ht=document.createElement("span");Ht.className="text-slate-400",Ht.textContent=s.status,Ue.appendChild(zt),Ue.appendChild(Ht);let Ot=document.createElement("p");Ot.className="mt-1 text-sm font-semibold text-slate-900";let Gs=s.settings&&s.settings.title||s.label||"Bloc sans titre";if(Ot.textContent=Gs,ie.appendChild(Ue),ie.appendChild(Ot),(s.type||"").toLowerCase()==="collectiongrid"&&s.collectionId){let Se=((rs=Ae.find(_s=>_s.id===s.collectionId))==null?void 0:rs.name)||s.collectionId,Vt=document.createElement("p");Vt.className="text-xs text-slate-400",Vt.textContent=`Collection : ${Se}`,ie.appendChild(Vt)}G.appendChild(ie),h.appendChild(G);let St=document.createElement("div");St.className="flex flex-col gap-1 text-xs text-slate-400";let Lt=document.createElement("div");Lt.className="flex items-center gap-1 lg:hidden";let ot=document.createElement("button");ot.type="button",ot.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",ot.textContent="\u2191",ot.addEventListener("click",Se=>{Se.stopPropagation(),es(s.id,-1)});let at=document.createElement("button");at.type="button",at.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",at.textContent="\u2193",at.addEventListener("click",Se=>{Se.stopPropagation(),es(s.id,1)}),Lt.appendChild(ot),Lt.appendChild(at),St.appendChild(Lt);let rt=document.createElement("button");rt.type="button",rt.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",rt.innerHTML="\u{1F5D1}\uFE0F",rt.addEventListener("click",Se=>{Se.stopPropagation(),Ps(s.id)}),St.appendChild(rt),h.appendChild(St),h.addEventListener("click",()=>{Je(s.id)}),h.addEventListener("keydown",Se=>{(Se.key==="Enter"||Se.key===" ")&&(Se.preventDefault(),Je(s.id))}),l.appendChild(h)})},Ft=(e,t)=>{n.forEach(s=>{s.innerHTML="",e.forEach(a=>{let h=document.createElement("li"),T=document.createElement("button");T.type="button",T.dataset.pageId=a.id,T.className=["w-full flex items-center justify-between gap-3 px-3 py-2 text-left transition",t===a.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===a.id?T.setAttribute("aria-current","page"):T.removeAttribute("aria-current"),T.innerHTML=`
            <div class="flex items-center gap-3">
              <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
                </svg>
              </span>
              <div class="flex flex-col">
                <span class="text-sm font-semibold">${a.title}</span>
                <span class="text-xs text-slate-500">${a.slug}</span>
              </div>
            </div>
          `,T.addEventListener("click",()=>{Me(a.id),Nt()||Mt()}),h.appendChild(T),s.appendChild(h)})})},jt=()=>!j||!Array.isArray(j.blocks)?null:j.blocks.find(e=>e.id===ue)||null,Je=e=>{if(!j)return;if(!e){ue=null,Qe(j),ht(null),Ze(null);return}let t=j.blocks.find(s=>s.id===e)||j.blocks[0]||null;ue=(t==null?void 0:t.id)||null,Qe(j),ht(t),Ze(ue)},et=e=>{if(!j)return;let t={...j,blocks:e};Ns(t)},yt=()=>window.matchMedia("(min-width: 1024px)").matches;function es(e,t){if(!j||!e||!t)return;let s=[...j.blocks||[]],a=s.findIndex(G=>G.id===e);if(a<0)return;let h=a+t;if(h<0||h>=s.length)return;let[T]=s.splice(a,1);s.splice(h,0,T),et(s),Me(j.id,{preserveBlock:!0}),Je(T.id)}function Bs(e,t){if(!j||!e||!t||e===t)return;let s=[...j.blocks||[]],a=s.findIndex(G=>G.id===e),h=s.findIndex(G=>G.id===t);if(a<0||h<0)return;let[T]=s.splice(a,1);s.splice(h,0,T),et(s),Me(j.id,{preserveBlock:!0}),Je(T.id)}function ts(){if(!l)return;let e=yt();l.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function vt(){L&&(L.classList.add("hidden"),tt=!1)}function $s(){L&&(L.classList.remove("hidden"),tt=!0)}function Fs(){tt?vt():$s()}function js(e){var T;if(!j||!e)return;let t=oe[e];if(!t)return;let s=(j.blocks||[]).filter(G=>G.type===t.type).length+1,a=O(Ve(j.id,e),`${t.label} ${s}`,t.type,t.status,t.description,t.props,t.settings||{});if((t.type||"").toLowerCase()==="collectiongrid"){let G=((T=Ae[0])==null?void 0:T.id)||"";a.collectionId=G,a.settings.collectionId=G,a.settings.limit=a.settings.limit||6}let h=[...j.blocks||[],a];et(h),Me(j.id,{preserveBlock:!0}),Je(a.id),vt(),V("Bloc ajout\xE9")}function ss(e){var a,h;if(!j)return;let t=(j.blocks||[]).filter(T=>T.id!==e),s=e===ue?((a=t[0])==null?void 0:a.id)||null:ue||((h=t[0])==null?void 0:h.id)||null;et(t),ue=s,Me(j.id,{preserveBlock:!0}),ue?Je(ue):(ht(null),Ze(null)),V("Bloc supprim\xE9")}function Pt(){d&&(d.classList.add("hidden"),d.classList.remove("flex"),xt=null)}function Ps(e){if(!d){ss(e);return}xt=e,d.classList.remove("hidden"),d.classList.add("flex")}let Ns=e=>{if(!e)return;let t=nt(e);de=de.map(s=>s.id===t.id?t:s),j=t,ge(t)},Me=(e,t={})=>{var h,T;let s=de.find(G=>G.id===e)||de[0]||null;j=s?nt(s):null,ke=(s==null?void 0:s.id)||null,(!t.preserveBlock||!j||!j.blocks.some(G=>G.id===ue))&&(ue=((T=(h=j==null?void 0:j.blocks)==null?void 0:h[0])==null?void 0:T.id)||null),ke&&Ke(ke),Ft(de,ke),gt(j),Is(j),ye(j),Qe(j),ht(jt()),Ze(ue),ts(),tt&&vt()},Nt=()=>window.matchMedia("(min-width: 1024px)").matches,ns=()=>{we&&(Nt()?(we.classList.add("is-open"),ae==null||ae.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):we.classList.remove("is-open"))},Ms=()=>{!we||Nt()||(we.classList.add("is-open"),ae==null||ae.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Mt=()=>{we&&(we.classList.remove("is-open"),ae==null||ae.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},Ds=()=>{!re||!ve||(re.classList.remove("hidden"),ve.classList.add("hidden"),I&&(I.textContent=""),bt=!1,r&&(r.value="",r.focus()),m&&(m.value=""))},os=()=>{!re||!ve||(re.classList.add("hidden"),ve.classList.remove("hidden"),I&&(I.textContent=""),bt=!1,re.reset())},Rs=()=>{!r||!m||bt&&m.value.trim().length>0||(m.value=Xe(r.value))},de=[],ke=null,bt=!1,j=null,ue=null,tt=!1,xt=null,Dt="",Rt=!1,st=null,Ae=[],Us=e=>{let t={...e,props:Array.isArray(e.props)?e.props:[],settings:{...e.settings||{}}};return(t.type||"").toLowerCase()==="collectiongrid"&&(t.collectionId=t.collectionId||t.settings.collectionId||"",t.settings.collectionId=t.collectionId,t.settings.limit=t.settings.limit||6),t},nt=e=>({...e,blocks:(e.blocks||[]).map(t=>Us(t))}),zs=async()=>{if(!f){Ae=[],wt();return}try{let e=await fetch(f,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error("Impossible de charger les collections.");let t=await e.json().catch(()=>[]);Ae=Array.isArray(t)?t:[];let s=(k==null?void 0:k.value)||"";wt(s)}catch(e){console.error("[design] collections load",e),V("Collections indisponibles."),Ae=[],wt()}},Ut=e=>{if(!w)return;if(!e){w.textContent=Ae.length?"S\xE9lectionnez une collection pour afficher ses informations.":"Aucune collection disponible. Ajoutez-en depuis l\u2019onglet Contenus.";return}let t=Ae.find(a=>a.id===e);if(!t){w.textContent=`Collection ${e}`;return}let s=[];t.description&&s.push(t.description),t.type&&s.push(`Type\xA0: ${t.type}`),w.textContent=s.join(" \xB7 ")||`Collection ${t.name||t.id}`},wt=(e="")=>{if(k){if(k.innerHTML="",!Ae.length){k.disabled=!0;let t=document.createElement("option");t.value="",t.textContent="Aucune collection disponible",k.appendChild(t),Ut("");return}if(k.disabled=!1,e&&!Ae.some(t=>t.id===e)){let t=document.createElement("option");t.value=e,t.textContent=e,k.appendChild(t)}Ae.forEach(t=>{let s=document.createElement("option");s.value=t.id;let a=t.name||t.id;s.textContent=t.type?`${a} \xB7 ${t.type}`:a,s.dataset.description=t.description||"",k.appendChild(s)}),e&&(k.value=e),Ut(k.value||"")}};zs(),ns(),He.forEach(e=>{e.addEventListener("click",Ms)}),Pe.forEach(e=>{e.addEventListener("click",Mt)}),ae==null||ae.addEventListener("click",Mt),window.addEventListener("resize",()=>{ns(),ts()}),ve==null||ve.addEventListener("click",Ds),U==null||U.addEventListener("click",os),r==null||r.addEventListener("input",Rs),m==null||m.addEventListener("input",()=>{I&&(I.textContent=""),bt=!0}),re==null||re.addEventListener("submit",async e=>{if(e.preventDefault(),!o){I&&(I.textContent="Aucun site s\xE9lectionn\xE9.");return}if(!r||!m)return;let t=r.value.trim(),s=Xe(m.value.trim()||t);if(!t||!s){I&&(I.textContent="Titre et slug sont requis.");return}I&&(I.textContent=""),be&&(be.disabled=!0,be.textContent="Cr\xE9ation...");try{let a=await se({title:t,slug:s});if(!a||!a.id)throw new Error("R\xE9ponse invalide.");de=[...de,nt(a)],os(),V("Page cr\xE9\xE9e"),Me(a.id)}catch(a){console.error("[design] create page failed",a),I&&(I.textContent=a.message||"Impossible de cr\xE9er la page.")}finally{be&&(be.disabled=!1,be.textContent="Cr\xE9er")}}),v==null||v.addEventListener("click",e=>{e.stopPropagation(),Fs()}),document.addEventListener("click",e=>{tt&&(L!=null&&L.contains(e.target)||v!=null&&v.contains(e.target)||vt())}),x.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let s=e.dataset.blockAdd;js(s)})}),P==null||P.addEventListener("click",()=>{Pt()}),b==null||b.addEventListener("click",()=>{xt&&ss(xt),Pt()}),d==null||d.addEventListener("click",e=>{e.target===d&&Pt()}),p==null||p.addEventListener("input",e=>{var s,a;let t=e.target;if(!(!t||!t.name)&&(t.name==="group-columns-mobile"||t.name==="group-columns-desktop")){let h=((s=p.querySelector('[name="group-columns-mobile"]'))==null?void 0:s.value)||"1",T=((a=p.querySelector('[name="group-columns-desktop"]'))==null?void 0:a.value)||"3";Y(h,T)}}),k==null||k.addEventListener("change",e=>{let t=e.target;Ut((t==null?void 0:t.value)||"")}),p==null||p.addEventListener("submit",$e),E==null||E.addEventListener("click",e=>{e.preventDefault();let t=jt();t&&he(t)}),B==null||B.addEventListener("load",()=>{Rt=!0,ee("\xC0 jour"),Ze(ue)}),y==null||y.addEventListener("click",()=>{let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Dt||te()),t.close()});let Hs=e=>{let t=e.target.closest("[data-block-item]");!t||!yt()||(Fe=t.dataset.blockId||null,Fe&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",Fe),t.classList.add("opacity-50")))},as=()=>{l==null||l.querySelectorAll("[data-block-item]").forEach(e=>e.classList.remove("opacity-50","ring-2","ring-[#9C6BFF]/50"))},Os=()=>{Fe=null,as()},Vs=e=>{if(!Fe||!yt())return;let t=e.target.closest("[data-block-item]");!t||t.dataset.blockId===Fe||(e.preventDefault(),t.classList.add("ring-2","ring-[#9C6BFF]/50"))},Js=e=>{let t=e.target.closest("[data-block-item]");t&&t.classList.remove("ring-2","ring-[#9C6BFF]/50")},Ws=e=>{if(!Fe||!yt())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),s=Fe;Fe=null,as();let a=(t==null?void 0:t.dataset.blockId)||null;a&&Bs(s,a)},Fe=null;l==null||l.addEventListener("dragstart",Hs),l==null||l.addEventListener("dragend",Os),l==null||l.addEventListener("dragover",Vs),l==null||l.addEventListener("dragleave",Js),l==null||l.addEventListener("drop",Ws),ne()}function Es(){var Oe,ft,De;let n=document.querySelector("[data-collection-list]");if(!n)return;let u=document.querySelector("[data-collection-empty]"),g=document.querySelector("[data-collection-items-empty]"),S=document.querySelector("[data-item-table-wrapper]"),B=document.querySelector("[data-item-table-body]"),y=document.querySelector("[data-collection-title]"),z=document.querySelector("[data-collection-description]"),q=document.querySelector("[data-collection-drawer]"),l=document.querySelector("[data-collection-drawer-backdrop]"),C=document.querySelectorAll("[data-collection-drawer-open]"),M=document.querySelectorAll("[data-collection-drawer-close]"),v=document.querySelector("[data-item-add]"),L=document.querySelector("[data-item-detail-empty]"),x=document.querySelector("[data-item-form]"),d=x?{title:x.querySelector('[name="item-title"]'),slug:x.querySelector('[name="item-slug"]'),excerpt:x.querySelector('[name="item-excerpt"]'),content:x.querySelector('[name="item-content"]'),image:x.querySelector('[name="item-image"]'),status:x.querySelector('[name="item-status"]')}:{},b=document.querySelector("[data-item-status-badge]"),P=document.querySelector("[data-item-delete]"),F=document.querySelector("[data-item-delete-modal]"),K=document.querySelector("[data-item-delete-cancel]"),H=document.querySelector("[data-item-delete-confirm]"),ce=document.querySelector("[data-item-cancel]"),W=document.querySelector("[data-item-save]"),D="rounded-full px-3 py-1 text-xs font-semibold",p=Ee((J==null?void 0:J.slugValue)||_.slug||""),R=p?`/api/sites/${encodeURIComponent(p)}/collections`:null,k=[],w=[],E=null,N=null,i=!1,c=!1,A=null,Y=()=>{q&&(q.classList.add("is-open"),q.style.transform="translateX(0)",l==null||l.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},X=()=>{q&&(q.classList.remove("is-open"),q.style.transform="",l==null||l.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))};C.forEach(o=>{o.addEventListener("click",Y)}),M.forEach(o=>{o.addEventListener("click",X)}),l==null||l.addEventListener("click",X);let se=o=>{let f=(o||"").trim();if(!f)return"";if(f==="/")return"/";let O=f.replace(/^\//,"").split("/").map(oe=>_e(oe||"")).filter(oe=>oe.length>0);return O.length?`/${O.join("/")}`:""},ge=o=>{if(!o)return"\u2014";let f=new Date(o);return Number.isNaN(f.getTime())?"\u2014":f.toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric"})},ne=()=>{let o=k.find(f=>f.id===E);y&&(y.textContent=(o==null?void 0:o.name)||"S\xE9lectionnez une collection"),z&&(z.textContent=(o==null?void 0:o.description)||"")},Q=o=>{g&&(g.textContent=o||(E?"Aucun item dans cette collection pour le moment.":"Choisissez une collection dans le panneau de gauche."))},pe=()=>{x&&(x.classList.add("hidden"),x.dataset.itemId=""),L==null||L.classList.remove("hidden"),b&&(b.className=`hidden ${D}`,b.textContent=""),P&&(P.disabled=!0)},he=()=>{x&&(x.classList.remove("hidden"),L==null||L.classList.add("hidden"))},qe=()=>{v&&(v.disabled=!E,v.disabled?v.classList.add("opacity-60","pointer-events-none"):v.classList.remove("opacity-60","pointer-events-none"))},ee=o=>{if(!b)return;if(!o){b.className=`hidden ${D}`,b.textContent="";return}let f=o.toLowerCase(),$="bg-slate-100 text-slate-600 border border-slate-200";f==="publi\xE9"||f==="publie"?$="bg-emerald-50 text-emerald-700 border border-emerald-100":f==="brouillon"&&($="bg-amber-50 text-amber-700 border border-amber-100"),b.className=`${D} ${$}`,b.textContent=o},Be=()=>{if(n.innerHTML="",!k.length){u==null||u.classList.remove("hidden");return}u==null||u.classList.add("hidden"),k.forEach(o=>{let f=o.id===E,$=document.createElement("button");$.type="button",$.dataset.collectionId=o.id,$.className=["w-full rounded-xl border px-3 py-2 text-left transition focus:outline-none focus:ring-2 focus:ring-[#9C6BFF]/40",f?"bg-[#F7F0FF] border-[#9C6BFF]/40 text-slate-900":"border-slate-200 text-slate-700 hover:border-[#9C6BFF]/40"].join(" "),$.setAttribute("role","option"),f?$.setAttribute("aria-current","true"):$.removeAttribute("aria-current"),$.innerHTML=`
          <div class="flex items-center justify-between gap-2">
            <div>
              <p class="text-sm font-semibold">${o.name||o.id}</p>
              <p class="text-xs text-slate-500">${o.description||""}</p>
            </div>
            <span class="text-[11px] uppercase tracking-wide text-slate-400">${o.type||""}</span>
          </div>
        `,$.addEventListener("click",()=>{ve(o.id),window.matchMedia("(min-width: 1024px)").matches||X()}),n.appendChild($)})},te=()=>{if(B){if(B.innerHTML="",!w.length||!E){g==null||g.classList.remove("hidden"),Q(),S==null||S.classList.add("hidden");return}g==null||g.classList.add("hidden"),S==null||S.classList.remove("hidden"),w.forEach(o=>{let f=document.createElement("tr");f.dataset.itemId=o.id;let $=o.id===N&&!i;f.className=["cursor-pointer transition focus-within:bg-[#F7F0FF]/70 focus:outline-none",$?"bg-[#F7F0FF]/70":"hover:bg-slate-50"].join(" "),f.tabIndex=0,f.setAttribute("role","button"),$?f.setAttribute("aria-current","true"):f.removeAttribute("aria-current");let O=o.status||"Brouillon",oe=O.toLowerCase(),Ke=oe==="publi\xE9"||oe==="publie"?"bg-emerald-50 text-emerald-700 border border-emerald-100":"bg-amber-50 text-amber-700 border border-amber-100";f.innerHTML=`
          <td class="px-4 py-3 align-top">
            <div class="flex flex-col">
              <span class="text-sm font-semibold text-slate-900">${o.title||"Sans titre"}</span>
              <span class="text-xs text-slate-500">${o.summary||o.excerpt||""}</span>
            </div>
          </td>
          <td class="px-4 py-3 align-top text-sm text-slate-600">${o.slug||""}</td>
          <td class="px-4 py-3 align-top">
            <span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${Ke}">
              ${O}
            </span>
          </td>
          <td class="px-4 py-3 align-top text-sm text-slate-500">${ge(o.updatedAt||o.createdAt)}</td>
        `;let Re=()=>{ye(o.id)};f.addEventListener("click",Re),f.addEventListener("keydown",Ne=>{(Ne.key==="Enter"||Ne.key===" ")&&(Ne.preventDefault(),Re())}),B.appendChild(f)})}},ye=o=>{let f=w.find($=>$.id===o);f&&(N=f.id,i=!1,c=!0,$e(f),te())},$e=o=>{if(!x||!o){pe();return}he(),x.dataset.itemId=o.id,d.title&&(d.title.value=o.title||""),d.slug&&(d.slug.value=o.slug||""),d.excerpt&&(d.excerpt.value=o.summary||o.excerpt||""),d.content&&(d.content.value=o.content||""),d.image&&(d.image.value=o.image||""),d.status&&(d.status.value=o.status||"Brouillon"),ee(o.status||"Brouillon"),P&&(P.disabled=!1)},we=()=>{var o;x&&(i=!0,N=null,c=!1,x.dataset.itemId="",x.reset(),d.status&&(d.status.value="Brouillon"),d.slug&&(d.slug.value=""),ee("Brouillon"),he(),P&&(P.disabled=!0),(o=d.title)==null||o.focus())},ae=()=>{var Re,Ne,Xe,Ve,$t,gt;let o=(((Re=d.title)==null?void 0:Re.value)||"").trim(),f=(((Ne=d.slug)==null?void 0:Ne.value)||"").trim(),$=(((Xe=d.excerpt)==null?void 0:Xe.value)||"").trim(),O=(((Ve=d.content)==null?void 0:Ve.value)||"").trim(),oe=((($t=d.image)==null?void 0:$t.value)||"").trim(),Ke=((gt=d.status)==null?void 0:gt.value)||"Brouillon";return{title:o,slug:se(f||o),summary:$,excerpt:$,content:O,image:oe,status:Ke}},He=o=>{W&&(W.disabled=o,W.textContent=o?"Enregistrement\u2026":"Enregistrer"),P&&!i&&N&&(P.disabled=o)},Pe=async o=>{if(!R)return[];let f=await fetch(`${R}/${encodeURIComponent(o)}/items`,{headers:{Accept:"application/json"}});if(!f.ok){let O=await f.json().catch(()=>({}));throw new Error(O.message||"Impossible de charger les items.")}let $=await f.json().catch(()=>({}));return Array.isArray($.items)?$.items:[]},ve=async o=>{if(o&&(E=o,N=null,i=!1,c=!1,ne(),qe(),Be(),pe(),w=[],te(),Q("Chargement des items\u2026"),g==null||g.classList.remove("hidden"),S==null||S.classList.add("hidden"),!!R))try{w=await Pe(o),te(),w.length||Q()}catch(f){console.error("[content] items failed",f),V(f.message||"Impossible de charger les items."),w=[],te()}},re=async(o,f)=>{if(!R)throw new Error("Site inconnu.");let $=await fetch(`${R}/${encodeURIComponent(o)}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!$.ok){let O=await $.json().catch(()=>({}));throw new Error(O.message||"Impossible de cr\xE9er cet item.")}return $.json()},r=async(o,f,$)=>{if(!R)throw new Error("Site inconnu.");let O=await fetch(`${R}/${encodeURIComponent(o)}/items/${encodeURIComponent(f)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!O.ok){let oe=await O.json().catch(()=>({}));throw new Error(oe.message||"Impossible de sauvegarder cet item.")}return O.json()},m=async(o,f)=>{if(!R)throw new Error("Site inconnu.");let $=await fetch(`${R}/${encodeURIComponent(o)}/items/${encodeURIComponent(f)}`,{method:"DELETE"});if(!$.ok){let O=await $.json().catch(()=>({}));throw new Error(O.message||"Impossible de supprimer cet item.")}},U=async()=>{var o;if(!R){u==null||u.classList.remove("hidden"),E=null,w=[],te(),ne(),qe();return}try{let f=await fetch(R,{headers:{Accept:"application/json"}});if(!f.ok)throw new Error("Impossible de charger les collections.");let $=await f.json().catch(()=>[]);if(k=Array.isArray($)?$:[],Be(),k.length>0){let O=((o=k.find(oe=>oe.id===E))==null?void 0:o.id)||k[0].id;ve(O)}else E=null,w=[],ne(),qe(),te()}catch(f){console.error("[content] load collections",f),V(f.message||"Impossible de charger les collections.")}};v==null||v.addEventListener("click",()=>{if(!E){V("S\xE9lectionnez d\u2019abord une collection.");return}we(),te()}),ce==null||ce.addEventListener("click",o=>{if(o.preventDefault(),i){i=!1,N=null,pe(),te();return}if(N){let f=w.find($=>$.id===N);$e(f)}else pe()}),(Oe=d.status)==null||Oe.addEventListener("change",()=>{ee(d.status.value)}),(ft=d.title)==null||ft.addEventListener("input",()=>{!i||!d.slug||c||(d.slug.value=se(d.title.value))}),(De=d.slug)==null||De.addEventListener("input",()=>{i&&(c=!0)}),x==null||x.addEventListener("submit",async o=>{var $;if(o.preventDefault(),!E){V("S\xE9lectionnez une collection.");return}let f=ae();if(!f.title){V("Le titre est requis."),($=d.title)==null||$.focus();return}He(!0);try{let O;i||!N?(O=await re(E,f),w=[...w,O],V("Item cr\xE9\xE9")):(O=await r(E,N,f),w=w.map(oe=>oe.id===O.id?O:oe),V("Item mis \xE0 jour")),i=!1,N=O.id,$e(O),te()}catch(O){console.error("[content] save item failed",O),V(O.message||"Impossible de sauvegarder cet item.")}finally{He(!1)}});let I=()=>{F&&(F.classList.add("hidden"),F.classList.remove("flex"),A=null)},be=()=>{!F||!N||(A=N,F.classList.remove("hidden"),F.classList.add("flex"))};P==null||P.addEventListener("click",o=>{o.preventDefault(),N&&be()}),K==null||K.addEventListener("click",()=>{I()}),F==null||F.addEventListener("click",o=>{o.target===F&&I()}),H==null||H.addEventListener("click",async()=>{if(!A||!E){I();return}H.disabled=!0,H.textContent="Suppression\u2026";try{await m(E,A),w=w.filter(o=>o.id!==A),N===A&&(N=null,pe()),V("Item supprim\xE9"),te()}catch(o){console.error("[content] delete item failed",o),V(o.message||"Impossible de supprimer cet item.")}finally{H.disabled=!1,H.textContent="Supprimer",I()}}),ne(),qe(),U()}function qs(){let n=document.querySelector("[data-deploy-form]");if(!n)return;let u=document.querySelector("[data-deploy-protocol]"),g=document.querySelector("[data-deploy-host]"),S=document.querySelector("[data-deploy-port]"),B=document.querySelector("[data-deploy-user]"),y=document.querySelector("[data-deploy-password]"),z=document.querySelector("[data-deploy-show-password]"),q=document.querySelector("[data-deploy-remote-path]"),l=document.querySelector("[data-deploy-feedback]"),C=document.querySelector("[data-deploy-save]"),M=document.querySelector("[data-deploy-test]"),v=document.querySelector("[data-deploy-trigger]"),L=document.querySelector("[data-deploy-history]"),x=document.querySelector("[data-deploy-log]"),d=Ee((J==null?void 0:J.slugValue)||_.slug||""),b=d?`/api/sites/${encodeURIComponent(d)}/deploy-config`:null,P=d?`/api/sites/${encodeURIComponent(d)}/deploy`:null,F=d?`/api/sites/${encodeURIComponent(d)}/deploy-log`:null,K=!1,H=null,ce=i=>{let c=(i||"").trim();return c?c.startsWith("/")?c:`/${c}`:"/www"},W=(i,c="muted")=>{if(!l)return;let A="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold",Y=c==="success"?"bg-emerald-50 text-emerald-700 border border-emerald-100":c==="error"?"bg-rose-50 text-rose-700 border border-rose-100":"bg-slate-50 text-slate-600 border border-slate-100";if(!i){l.textContent="",l.className="text-sm text-slate-500";return}let X=c==="success"?"\u2705":c==="error"?"\u274C":"\u2139\uFE0F";l.innerHTML=`<span class="${A} ${Y}">${X}<span>${i}</span></span>`,l.className="text-sm"},D=(i=null)=>{H=i;let c=!!i,A='<svg class="h-4 w-4 animate-spin text-white" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>';C&&(C.disabled=c,C.innerHTML=i==="save"?`<span class="inline-flex items-center gap-2">${A}<span>Enregistrement\u2026</span></span>`:"Enregistrer"),M&&(M.disabled=c,M.innerHTML=i==="test"?'<span class="inline-flex items-center gap-2"><span class="h-4 w-4 animate-spin rounded-full border-2 border-slate-200 border-t-slate-600"></span><span>Test en cours\u2026</span></span>':"Tester la connexion"),v&&(v.disabled=c&&i!==null,v.innerHTML=i==="deploy"?'<span class="inline-flex items-center gap-2"><span class="h-4 w-4 animate-spin rounded-full border-2 border-white/60 border-t-white"></span><span>D\xE9ploiement\u2026</span></span>':"D\xE9ployer maintenant")},p=i=>{u&&(u.value=i.protocol||"sftp"),g&&(g.value=i.host||""),S&&(S.value=i.port||""),B&&(B.value=i.user||""),q&&(q.value=i.remotePath||"/www"),K=!!i.hasPassword,y&&(y.value="",y.placeholder=K?"Non affich\xE9":"Mot de passe")},R=(i=[])=>{if(L){if(L.innerHTML="",!i.length){let c=document.createElement("li");c.className="text-slate-500",c.textContent="Aucun d\xE9ploiement pour le moment.",L.appendChild(c);return}i.forEach(c=>{let A=document.createElement("li");A.className="flex items-center justify-between gap-2 rounded-xl border border-slate-200 px-3 py-2";let Y=c.status==="success"?'<span class="rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700">Succ\xE8s</span>':'<span class="rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold text-rose-700">\xC9chec</span>',X=c.finishedAt||c.startedAt||"",se=c.durationMs&&Number(c.durationMs)>=0?`${Math.round(Number(c.durationMs)/1e3)}s`:"";A.innerHTML=`
          <div class="space-y-1">
            <div class="flex items-center gap-2">${Y}<span class="text-xs text-slate-500">${X}</span></div>
            <p class="text-sm text-slate-800">${c.message||""}</p>
          </div>
          <div class="text-xs text-slate-500">${se}</div>
        `,A.dataset.deployId=c.id||"",A.addEventListener("click",()=>{c.logs&&x&&(x.textContent=c.logs.join(`
`))}),L.appendChild(A)})}},k=(i=[])=>{x&&(x.textContent=i.length?i.join(`
`):"Aucun log pour le moment.")},w=async()=>{var i;if(F)try{let c=await fetch(F,{headers:{Accept:"application/json"}});if(!c.ok){if(c.status===404){R([]),k(["API d\xE9ploiement indisponible (red\xE9marre le serveur)."]);return}throw new Error("Impossible de charger l\u2019historique.")}let A=await c.json().catch(()=>({})),Y=Array.isArray(A.entries)?A.entries:[];R(Y),(i=Y[0])!=null&&i.logs&&k(Y[0].logs)}catch(c){console.error("[deploy] history failed",c)}},E=async()=>{if(!b){W("Aucun site actif s\xE9lectionn\xE9.","error");return}D("load");try{let i=await fetch(b,{headers:{Accept:"application/json"}}),c=await i.json().catch(()=>({}));i.ok?(p(c||{}),W("Configuration charg\xE9e.","muted")):(p(c||{}),W(c.message||"Configuration par d\xE9faut charg\xE9e.","muted"))}catch(i){console.error("[deploy] load failed",i),W(i.message||"Erreur lors du chargement.","error")}finally{D(null)}},N=()=>{let i={protocol:(u==null?void 0:u.value)||"sftp",host:(g==null?void 0:g.value.trim())||"",port:Number(S==null?void 0:S.value)||void 0,user:(B==null?void 0:B.value.trim())||"",remotePath:ce((q==null?void 0:q.value)||"/www")},c=(y==null?void 0:y.value)||"";return c.trim().length>0&&(i.password=c),i};n.addEventListener("submit",async i=>{if(i.preventDefault(),!b){W("Aucun site actif s\xE9lectionn\xE9.","error");return}let c=N();D("save");try{let A=await fetch(b,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!A.ok){let X=await A.json().catch(()=>({}));throw new Error(X.message||"Sauvegarde impossible.")}let Y=await A.json();p(Y||{}),W("Configuration enregistr\xE9e.","success"),V("Configuration d\xE9ploiement sauvegard\xE9e")}catch(A){console.error("[deploy] save failed",A),W(A.message||"Erreur lors de la sauvegarde.","error")}finally{D(null)}}),M==null||M.addEventListener("click",async()=>{if(!b){W("Aucun site actif s\xE9lectionn\xE9.","error");return}let i=N();if(!i.host||!i.user||!i.remotePath){W("Remplissez les champs requis avant de tester.","error");return}D("test");try{let c=await fetch(`${b}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),A=await c.json().catch(()=>({}));if(!c.ok||A.success===!1){W(A.message||"Test de connexion \xE9chou\xE9.","error");return}W(A.message||"Connexion OK.","success"),V("Test de connexion r\xE9ussi")}catch(c){console.error("[deploy] test failed",c),W(c.message||"Test de connexion \xE9chou\xE9.","error")}finally{D(null)}}),v==null||v.addEventListener("click",async()=>{if(!P){W("Aucun site actif s\xE9lectionn\xE9.","error");return}D("deploy"),k(["D\xE9ploiement en cours\u2026"]);try{let i=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N())}),c=await i.json().catch(()=>({}));if(!i.ok){if(i.status===404){W("API d\xE9ploiement indisponible (red\xE9marre le serveur).","error"),k(["API d\xE9ploiement indisponible (red\xE9marre le serveur)."]);return}throw k(c.logs||[]),new Error(c.message||"D\xE9ploiement \xE9chou\xE9.")}k(c.logs||[]),await w(),V("D\xE9ploiement termin\xE9")}catch(i){console.error("[deploy] run failed",i),W(i.message||"D\xE9ploiement \xE9chou\xE9.","error")}finally{D(null)}}),z==null||z.addEventListener("change",()=>{y&&(y.type=z.checked?"text":"password")}),E(),w()}function ks(){let n=document.querySelectorAll("[data-settings-tab]"),u=document.querySelectorAll("[data-settings-panel]"),g=document.querySelector("[data-admin-password-form]"),S=document.querySelector("[data-site-config-form]"),B=document.querySelector("[data-site-config-feedback]"),y=document.querySelector("[data-theme-form]"),z=q=>{n.forEach(l=>{let C=l.dataset.settingsTab===q;l.setAttribute("aria-selected",C?"true":"false"),l.classList.toggle("bg-[#9C6BFF]",C),l.classList.toggle("text-white",C)}),u.forEach(l=>{l.classList.toggle("hidden",l.dataset.settingsPanel!==q)})};if(n.forEach(q=>{q.addEventListener("click",()=>z(q.dataset.settingsTab||"account"))}),z("account"),g){let q=g.querySelector("[data-admin-password-feedback]"),l=g.querySelector("[data-admin-password-submit]"),C=(M,v="muted")=>{if(!q)return;let L=v==="success"?"text-emerald-600":v==="error"?"text-rose-600":"text-slate-500";q.textContent=M||"",q.className=`text-sm ${L}`};g.addEventListener("submit",async M=>{M.preventDefault();let v=new FormData(g),L=v.get("currentPassword")||"",x=v.get("newPassword")||"",d=v.get("confirmPassword")||"";if(!L||!x||!d){C("Compl\xE8te tous les champs.","error");return}l&&(l.disabled=!0),C("");try{let b=await fetch("/api/admin/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:L,newPassword:x,confirmPassword:d})}),P=await b.json().catch(()=>({}));if(!b.ok||P.success===!1)throw new Error(P.message||"Impossible de mettre \xE0 jour le mot de passe.");C(P.message||"Mot de passe mis \xE0 jour.","success"),g.reset()}catch(b){console.error("[settings] change password failed",b),C(b.message||"Erreur lors de la mise \xE0 jour.","error")}finally{l&&(l.disabled=!1)}})}if(S){let q=S.querySelector("[data-site-name]"),l=S.querySelector("[data-site-language]"),C=S.querySelector("[data-site-tagline]"),M=S.querySelector("[data-site-save]"),v=(b,P="muted")=>{if(!B)return;let F=P==="success"?"text-emerald-600":P==="error"?"text-rose-600":"text-slate-500";B.textContent=b||"",B.className=`text-sm ${F}`},L=Ee((J==null?void 0:J.slugValue)||_.slug||""),x=L?`/api/sites/${encodeURIComponent(L)}/config/site`:null,d=async()=>{if(x)try{let b=await fetch(x,{headers:{Accept:"application/json"}});if(!b.ok)return;let P=await b.json().catch(()=>({}));q&&(q.value=P.name||""),l&&(l.value=P.language||"fr"),C&&(C.value=P.tagline||"")}catch(b){console.error("[settings] load site config failed",b)}};S.addEventListener("submit",async b=>{if(b.preventDefault(),!x){v("Aucun site actif.","error");return}if(!(q!=null&&q.value.trim())){v("Nom requis.","error");return}M&&(M.disabled=!0),v("");try{let P={name:(q==null?void 0:q.value)||"",language:(l==null?void 0:l.value)||"fr",tagline:(C==null?void 0:C.value)||""},F=await fetch(x,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)}),K=await F.json().catch(()=>({}));if(!F.ok||K.success===!1)throw new Error(K.message||"Sauvegarde impossible.");v(K.message||"Param\xE8tres enregistr\xE9s.","success")}catch(P){console.error("[settings] save site config failed",P),v(P.message||"Erreur lors de la sauvegarde.","error")}finally{M&&(M.disabled=!1)}}),d()}if(y){let q=Ee((J==null?void 0:J.slugValue)||_.slug||""),l=q?`/api/sites/${encodeURIComponent(q)}/config/theme`:null,C={primary:y.querySelector("[data-theme-primary]"),secondary:y.querySelector("[data-theme-secondary]"),accent:y.querySelector("[data-theme-accent]"),background:y.querySelector("[data-theme-background]"),text:y.querySelector("[data-theme-text]")},M=y.querySelector("[data-theme-headings]"),v=y.querySelector("[data-theme-body]"),L=y.querySelector("[data-theme-radius-small]"),x=y.querySelector("[data-theme-radius-medium]"),d=y.querySelector("[data-theme-radius-large]"),b=y.querySelector("[data-theme-preview]"),P=y.querySelector("[data-theme-feedback]"),F=y.querySelector("[data-theme-apply]"),K=["slate","gray","zinc","neutral","stone","red","orange","amber","yellow","lime","green","emerald","teal","cyan","sky","blue","indigo","violet","purple","fuchsia","pink","rose"],H=["50","100","200","300","400","500","600","700","800","900"],ce=K.flatMap(w=>H.map(E=>`${w}-${E}`)),W=()=>{Object.values(C).forEach(w=>{!w||w.options.length||ce.forEach(E=>{let N=document.createElement("option");N.value=E;let[i,c]=E.split("-");N.textContent=`${i.charAt(0).toUpperCase()+i.slice(1)} ${c}`,w.appendChild(N)})})},D=(w,E="muted")=>{if(!P)return;let N=E==="success"?"text-emerald-600":E==="error"?"text-rose-600":"text-slate-500";P.textContent=w||"",P.className=`text-sm ${N}`},p=()=>{var E,N,i,c,A;if(!b)return;let w=Y=>{if(!Y)return null;let[X,se]=Y.split("-"),ne={slate:"#e2e8f0",gray:"#d1d5db",zinc:"#d4d4d8",neutral:"#d4d4d4",stone:"#d6d3d1",red:"#ef4444",orange:"#f97316",amber:"#f59e0b",yellow:"#eab308",lime:"#84cc16",green:"#22c55e",emerald:"#10b981",teal:"#14b8a6",cyan:"#06b6d4",sky:"#0ea5e9",blue:"#3b82f6",indigo:"#6366f1",violet:"#8b5cf6",purple:"#a855f7",fuchsia:"#d946ef",pink:"#ec4899",rose:"#f43f5e"}[X];if(!ne)return null;let Q=Number(se)||500,pe=Math.min(Math.max((Q-50)/900,0),1),he=ye=>ye.match(/[A-Fa-f0-9]{2}/g).map($e=>parseInt($e,16)),[qe,ee,Be]=he(ne.replace("#","")),te=ye=>Math.round(255-(255-ye)*pe);return`rgb(${te(qe)}, ${te(ee)}, ${te(Be)})`};b.style.setProperty("--color-primary",w((E=C.primary)==null?void 0:E.value)||"#9C6BFF"),b.style.setProperty("--color-secondary",w((N=C.secondary)==null?void 0:N.value)||"#0EA5E9"),b.style.setProperty("--color-accent",w((i=C.accent)==null?void 0:i.value)||"#F97316"),b.style.setProperty("--color-background",w((c=C.background)==null?void 0:c.value)||"#FFFFFF"),b.style.setProperty("--color-text",w((A=C.text)==null?void 0:A.value)||"#0F172A"),b.style.setProperty("--font-headings",(M==null?void 0:M.value)||"Inter, sans-serif"),b.style.setProperty("--font-body",(v==null?void 0:v.value)||"Inter, sans-serif"),b.style.setProperty("--radius-small",(L==null?void 0:L.value)||"8px"),b.style.setProperty("--radius-medium",(x==null?void 0:x.value)||"16px"),b.style.setProperty("--radius-large",(d==null?void 0:d.value)||"24px"),b.style.borderRadius=(x==null?void 0:x.value)||"16px"},R=(w,E)=>{C[w]&&(C[w].value=E)};Object.keys(C).forEach(w=>{var E;(E=C[w])==null||E.addEventListener("change",p)}),[M,v,L,x,d].forEach(w=>{w==null||w.addEventListener("change",p)});let k=async()=>{var w,E,N,i,c,A,Y,X,se,ge;if(l)try{let ne=await fetch(l,{headers:{Accept:"application/json"}});if(!ne.ok)return;let Q=await ne.json().catch(()=>({}));R("primary",((w=Q.colors)==null?void 0:w.primary)||"violet-500"),R("secondary",((E=Q.colors)==null?void 0:E.secondary)||"indigo-400"),R("accent",((N=Q.colors)==null?void 0:N.accent)||"emerald-500"),R("background",((i=Q.colors)==null?void 0:i.background)||"slate-50"),R("text",((c=Q.colors)==null?void 0:c.text)||"slate-900"),M&&(M.value=((A=Q.typography)==null?void 0:A.headings)||"Inter, sans-serif"),v&&(v.value=((Y=Q.typography)==null?void 0:Y.body)||"Inter, sans-serif"),L&&(L.value=((X=Q.radius)==null?void 0:X.small)||"8px"),x&&(x.value=((se=Q.radius)==null?void 0:se.medium)||"16px"),d&&(d.value=((ge=Q.radius)==null?void 0:ge.large)||"24px"),p()}catch(ne){console.error("[settings] load theme failed",ne)}};W(),F==null||F.addEventListener("click",async w=>{var N,i,c,A,Y;if(w.preventDefault(),!l){D("Aucun site actif.","error");return}let E={colors:{primary:((N=C.primary)==null?void 0:N.value)||"violet-500",secondary:((i=C.secondary)==null?void 0:i.value)||"indigo-400",accent:((c=C.accent)==null?void 0:c.value)||"emerald-500",background:((A=C.background)==null?void 0:A.value)||"slate-50",text:((Y=C.text)==null?void 0:Y.value)||"slate-900"},typography:{headings:(M==null?void 0:M.value)||"Inter, sans-serif",body:(v==null?void 0:v.value)||"Inter, sans-serif"},radius:{small:(L==null?void 0:L.value)||"8px",medium:(x==null?void 0:x.value)||"16px",large:(d==null?void 0:d.value)||"24px"}};F.disabled=!0,D("");try{let X=await fetch(l,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)}),se=await X.json().catch(()=>({}));if(!X.ok||se.success===!1)throw new Error(se.message||"Application du th\xE8me \xE9chou\xE9e.");D(se.message||"Th\xE8me appliqu\xE9.","success"),p()}catch(X){console.error("[settings] apply theme failed",X),D(X.message||"Erreur lors de l\u2019application du th\xE8me.","error")}finally{F.disabled=!1}}),W(),k(),p()}}function As(){let n=document.querySelector("[data-media-grid]");if(!n)return;let u=document.querySelector("[data-media-empty]"),g=document.querySelector("[data-media-count]"),S=document.querySelector("[data-media-filter-type]"),B=document.querySelector("[data-media-detail-empty]"),y=document.querySelector("[data-media-detail]"),z=document.querySelector("[data-media-detail-preview]"),q=document.querySelector("[data-media-detail-name]"),l=document.querySelector("[data-media-detail-type]"),C=document.querySelector("[data-media-detail-size]"),M=document.querySelector("[data-media-detail-path]"),v=document.querySelector("[data-media-detail-used]"),L=document.querySelector("[data-media-alt-edit]"),x=document.querySelector("[data-media-save]"),d=document.querySelector("[data-media-delete]"),b=document.querySelector("[data-media-delete-modal]"),P=document.querySelector("[data-media-delete-cancel]"),F=document.querySelector("[data-media-delete-confirm]"),K=document.querySelector("[data-media-upload-open]"),H=document.querySelector("[data-media-file-input]"),ce=document.querySelector("[data-media-upload-status]"),W=Ee((J==null?void 0:J.slugValue)||_.slug||""),D=W?`/api/sites/${encodeURIComponent(W)}/media`:null,p=[],R=[],k=null,w=null,E=null,N=!1,i=!1,c=!1,A=null,Y=r=>{let m=(r.type||"").toLowerCase(),U=(r.filename||"").toLowerCase();return m.includes("image")||/\.(png|jpe?g|webp|svg|gif)$/i.test(U)?"image":m.includes("pdf")||m.includes("doc")||/\.(pdf|docx?)$/i.test(U)?"document":m.includes("video")||/\.(mp4|mov|webm)$/i.test(U)?"video":"other"},X=r=>Y(r)==="image",se=r=>{if(r.type)return r.type.toUpperCase();let m=(r.filename||"").split(".").pop();return m?m.toUpperCase():"FILE"},ge=r=>!r||r<=0?"\u2014":r<1024?`${r} o`:r<1024*1024?`${(r/1024).toFixed(1)} ko`:`${(r/(1024*1024)).toFixed(1)} Mo`,ne=()=>{y==null||y.classList.add("hidden"),B==null||B.classList.remove("hidden"),Q(),k=null,i=!1,ee(!1),z&&(z.innerHTML='<span class="text-slate-400 text-sm">Aucun m\xE9dia s\xE9lectionn\xE9</span>'),q&&(q.textContent=""),l&&(l.textContent=""),C&&(C.textContent=""),L&&(L.value=""),M&&(M.textContent=""),v&&(v.innerHTML="")},Q=()=>{E=null,c=!1,N=!1,A&&(URL.revokeObjectURL(A),A=null),ce&&(ce.textContent="Aucun fichier s\xE9lectionn\xE9."),H&&(H.value="")},pe=()=>{g&&(R.length?R.length===1?g.textContent="1 m\xE9dia":g.textContent=`${R.length} m\xE9dias`:g.textContent="0 m\xE9dia")},he=()=>{if(n.innerHTML="",!R.length){u==null||u.classList.remove("hidden"),ne();return}u==null||u.classList.add("hidden"),R.forEach(r=>{let m=document.createElement("button");m.type="button",m.dataset.mediaId=r.id;let U=r.id===k;m.className=["group relative flex flex-col rounded-2xl border px-3 py-3 text-left transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#9C6BFF]",U?"border-[#9C6BFF] bg-[#F7F0FF]/60 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let I=X(r)?`<img src="${r.path}" alt="${r.alt||r.filename}" class="h-full w-full object-cover" />`:'<div class="flex h-full w-full items-center justify-center text-3xl text-slate-400">\u{1F4C4}</div>';m.innerHTML=`
          <div class="relative aspect-[4/3] overflow-hidden rounded-xl bg-slate-100">
            ${I}
          </div>
          <div class="mt-2 space-y-1">
            <p class="text-sm font-semibold text-slate-900 truncate">${r.filename}</p>
            <p class="text-xs text-slate-500">
              ${se(r)} \xB7 ${ge(r.size)}
            </p>
          </div>
        `,r.id===w&&(m.classList.add("ring-2","ring-[#9C6BFF]"),window.setTimeout(()=>{m.classList.remove("ring-2","ring-[#9C6BFF]")},1600)),m.addEventListener("click",()=>Be(r.id)),n.appendChild(m)}),w=null},qe=r=>{if(v){if(v.innerHTML="",!r.usedIn||r.usedIn.length===0){let m=document.createElement("li");m.textContent="Non utilis\xE9",m.className="text-xs text-slate-400",v.appendChild(m);return}r.usedIn.forEach(m=>{let U=document.createElement("li");U.textContent=m,U.className="text-xs text-slate-600",v.appendChild(U)})}},ee=r=>{if(x){if(c){x.textContent=r?"T\xE9l\xE9versement\u2026":"T\xE9l\xE9verser",x.disabled=r||!E,d&&d.classList.add("hidden");return}x.textContent=r?"Enregistrement\u2026":"Enregistrer",x.disabled=r||!i,d&&(d.classList.remove("hidden"),d.disabled=!k)}},Be=r=>{let m=p.find(U=>U.id===r);if(!m){ne(),he();return}Q(),k=m.id,i=!1,ee(!1),he(),B==null||B.classList.add("hidden"),y==null||y.classList.remove("hidden"),z&&(X(m)?z.innerHTML=`<img src="${m.path}" alt="${m.alt||m.filename}" class="h-full w-full rounded-2xl object-cover" />`:z.innerHTML='<div class="flex h-full w-full flex-col items-center justify-center gap-1 text-slate-400"><span class="text-3xl">\u{1F4C4}</span><span class="text-xs font-semibold">Document</span></div>'),q&&(q.textContent=m.filename||"Fichier"),l&&(l.textContent=se(m)),C&&(C.textContent=ge(m.size)),L&&(L.value=m.alt||""),M&&(M.textContent=m.path||"\u2014"),qe(m)},te=r=>{if(r){if(c=!0,i=!1,k=null,B==null||B.classList.add("hidden"),y==null||y.classList.remove("hidden"),A&&URL.revokeObjectURL(A),A=URL.createObjectURL(r),z&&(z.innerHTML=`<img src="${A}" alt="${r.name}" class="h-full w-full rounded-2xl object-cover" />`),q&&(q.textContent=r.name),l&&(l.textContent=se({type:r.type,filename:r.name})),C&&(C.textContent=ge(r.size)),L&&!L.value.trim()&&(L.value=r.name.replace(/\.[^.]+$/,"").replace(/[-_]/g," ")),M&&(M.textContent="En attente de t\xE9l\xE9versement"),v){v.innerHTML="";let m=document.createElement("li");m.textContent="Non utilis\xE9",m.className="text-xs text-slate-400",v.appendChild(m)}ee(!1)}},ye=()=>{let r=(S==null?void 0:S.value)||"all";r==="all"?R=[...p]:R=p.filter(m=>m.groupType===r),R.some(m=>m.id===k)||ne(),pe(),he()},$e=async()=>{if(!D){u==null||u.classList.remove("hidden");return}try{let r=await fetch(D,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error("Impossible de charger les m\xE9dias.");let m=await r.json().catch(()=>({items:[]}));p=Array.isArray(m.items)?m.items.map(U=>({...U,groupType:Y(U)})):[],ye()}catch(r){console.error("[media] load failed",r),V(r.message||"Impossible de charger les m\xE9dias."),p=[],ye()}};S==null||S.addEventListener("change",()=>{ye()}),L==null||L.addEventListener("input",()=>{if(c){ee(!1);return}k&&(i=!0,ee(!1))});let we=r=>{if(r){if(!r.type.startsWith("image/")){V("Seules les images sont accept\xE9es pour le moment.");return}if(r.size>4*1024*1024){V("Fichier trop volumineux (4 Mo max).");return}E=r,te(r),ce&&(ce.textContent=`${r.name} \xB7 ${ge(r.size)}`)}},ae=r=>new Promise((m,U)=>{let I=new FileReader;I.onload=()=>{let be=I.result||"",[,Oe=""]=String(be).split(",");m(Oe)},I.onerror=()=>U(new Error("Impossible de lire ce fichier.")),I.readAsDataURL(r)}),He=async()=>{if(!(!E||!D)){N=!0,ee(!0);try{let r=await ae(E),m={filename:E.name,type:E.type,size:E.size,alt:(L==null?void 0:L.value)||"",data:r},U=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(!U.ok){let be=await U.json().catch(()=>({}));throw new Error(be.message||"Upload impossible.")}let I=await U.json();I.groupType=Y(I),p=[...p,I],w=I.id,ye(),Be(I.id),V("M\xE9dia ajout\xE9"),Q()}catch(r){console.error("[media] upload failed",r),V(r.message||"Impossible de t\xE9l\xE9verser ce m\xE9dia.")}finally{N=!1,E=null,ee(!1)}}};K==null||K.addEventListener("click",()=>H==null?void 0:H.click()),H==null||H.addEventListener("change",()=>{H.files&&H.files[0]&&we(H.files[0])});let Pe=()=>{b&&(b.classList.add("hidden"),b.classList.remove("flex"))},ve=()=>{if(!(!k||c)){if(b){b.classList.remove("hidden"),b.classList.add("flex");return}window.confirm("Supprimer ce m\xE9dia ?")&&re()}},re=async()=>{if(!k||!D){Pe();return}let r=()=>{d&&(d.disabled=!0),F&&(F.disabled=!0,F.textContent="Suppression\u2026")},m=()=>{d&&(d.disabled=!1),F&&(F.disabled=!1,F.textContent="Supprimer")};r();try{let U=await fetch(`${D}/${encodeURIComponent(k)}`,{method:"DELETE"});if(!U.ok){let I=await U.json().catch(()=>({}));throw new Error(I.message||"Suppression impossible.")}p=p.filter(I=>I.id!==k),R=R.filter(I=>I.id!==k),V("M\xE9dia supprim\xE9"),ne(),pe(),he()}catch(U){console.error("[media] delete failed",U),V(U.message||"Impossible de supprimer ce m\xE9dia.")}finally{m(),Pe()}};P==null||P.addEventListener("click",Pe),b==null||b.addEventListener("click",r=>{r.target===b&&Pe()}),F==null||F.addEventListener("click",()=>re()),d==null||d.addEventListener("click",ve),x==null||x.addEventListener("click",async()=>{if(c){He();return}if(!(!k||!D||!L)){ee(!0);try{let r={alt:L.value||""},m=await fetch(`${D}/${encodeURIComponent(k)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!m.ok){let I=await m.json().catch(()=>({}));throw new Error(I.message||"Impossible de mettre \xE0 jour ce m\xE9dia.")}let U=await m.json();p=p.map(I=>I.id===k?{...I,...U}:I),R=R.map(I=>I.id===k?{...I,...U}:I),i=!1,ee(!1),V("M\xE9dia mis \xE0 jour")}catch(r){console.error("[media] update failed",r),V(r.message||"\xC9chec de la mise \xE0 jour."),ee(!1)}}}),$e()}});})();
