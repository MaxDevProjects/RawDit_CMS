(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("[admin] Atelier charg\xE9");let Ie=document.querySelector("[data-logout]");Ie&&Ie.addEventListener("click",async()=>{Ie.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("[admin] Impossible de se d\xE9connecter",s)}finally{window.location.href="/admin/index.html"}});let ne=document.querySelector("[data-admin-sidebar]"),L=document.querySelector("[data-admin-sidebar-overlay]"),Qe=document.querySelectorAll("[data-admin-sidebar-toggle]"),Ct=document.querySelectorAll("[data-admin-sidebar-close]"),Te=document.body,me=!1,ge=()=>{if(!ne)return;if(window.matchMedia("(min-width: 1024px)").matches){ne.classList.remove("hidden"),L==null||L.classList.add("hidden"),Te.classList.remove("overflow-hidden");return}me?(ne.classList.remove("hidden"),L==null||L.classList.remove("hidden"),Te.classList.add("overflow-hidden")):(ne.classList.add("hidden"),L==null||L.classList.add("hidden"),Te.classList.remove("overflow-hidden"))},Et=()=>{me=!0,ge()},Pe=()=>{me=!1,ge()};ne&&Qe.length>0&&(Qe.forEach(s=>{s.addEventListener("click",Et)}),Ct.forEach(s=>{s.addEventListener("click",Pe)}),L==null||L.addEventListener("click",Pe),window.addEventListener("resize",ge),window.addEventListener("keydown",s=>{s.key==="Escape"&&me&&Pe()}),ge());let et="clower:currentSite",tt="clower:currentSiteName",g={slug:null,name:""};(()=>{try{g.slug=window.localStorage.getItem(et),g.name=window.localStorage.getItem(tt)||""}catch{g.slug=null,g.name=""}})();let Ne=document.querySelectorAll("[data-site-card]"),Bt=document.querySelectorAll("[data-site-select]"),ae=document.querySelector("[data-current-site-name]"),st=document.querySelector("[data-workspace-site-name]"),nt=document.querySelector("[data-workspace-back-name]"),V=document.querySelector("[data-workspace-back-modal]"),qt=document.querySelectorAll("[data-workspace-back]"),At=document.querySelectorAll("[data-workspace-back-cancel]"),Fe=document.querySelector("[data-workspace-back-confirm]"),$t=document.querySelectorAll("[data-workspace-tab]"),Me=document.querySelector("[data-site-toast]"),at=document.querySelector("[data-site-toast-message]"),Dt=document.querySelectorAll("[data-site-create]"),v=document.querySelector("[data-site-modal]"),N=document.querySelector("[data-site-form]"),B=document.querySelector("[data-site-name]"),q=document.querySelector("[data-site-slug]"),x=document.querySelector("[data-site-slug-error]"),A=document.querySelector("[data-site-modal-error]"),It=document.querySelectorAll("[data-site-modal-cancel]"),X=document.querySelector("[data-site-modal-submit]"),$=_t(),fe=!1,he=null,je=null,Tt='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',ot=s=>{if(!v||v.classList.contains("hidden")||s.key!=="Tab")return;let i=Array.from(v.querySelectorAll(Tt)).filter(f=>!f.hasAttribute("disabled")&&!f.getAttribute("aria-hidden"));if(i.length===0)return;let d=i[0],u=i[i.length-1];s.shiftKey?document.activeElement===d&&(s.preventDefault(),u.focus()):document.activeElement===u&&(s.preventDefault(),d.focus())},oe=s=>{!Me||!at||(at.textContent=s,Me.classList.remove("hidden"),je&&clearTimeout(je),je=setTimeout(()=>{Me.classList.add("hidden")},2500))};function F(s){return s?s.startsWith("/")?s:`/${s}`:""}function ve(s){return(s==null?void 0:s.replace(/^\//,""))||""}let be=(s,i)=>{let d=s?F(s):null;try{d&&(window.localStorage.setItem(et,d),g.slug=d),typeof i=="string"&&i.length>0&&(window.localStorage.setItem(tt,i),g.name=i)}catch{g.slug=d||g.slug,g.name=i||g.name}},rt=s=>{ae&&s&&(ae.textContent=s),st&&s&&(st.textContent=s),nt&&s&&(nt.textContent=s)},_e=s=>{$t.forEach(i=>{let d=i.dataset.workspaceTab;if(!d)return;if(!s){i.href="#",i.classList.add("pointer-events-none","opacity-50","text-slate-400"),i.setAttribute("aria-disabled","true");return}let u=encodeURIComponent(ve(s));i.href=`/admin/site/${u}/${d}`,i.classList.remove("pointer-events-none","opacity-50","text-slate-400"),i.removeAttribute("aria-disabled")})},we=(s,i={})=>{if(!s)return;let d=F(s),u=i.siteName||g.name||(ae==null?void 0:ae.dataset.defaultSiteName)||"";Ne.forEach(p=>{let M=F(p.dataset.siteCard||"")===d,c=p.querySelector("[data-site-active-badge]");M?(p.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.remove("border-slate-200"),c==null||c.classList.remove("hidden"),u=p.dataset.siteName||u):(p.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.add("border-slate-200"),c==null||c.classList.add("hidden"))}),i.persist!==!1&&be(d,i.siteName||u);let f=i.siteName||u;rt(f),_e(d)},Pt=async(s,i)=>{let d=F(s);try{let u=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:d})});if(!u.ok){let c=await u.json().catch(()=>({}));oe(c.message||"Impossible de s\xE9lectionner ce site.");return}let f=await u.json().catch(()=>({})),p=F(f.slug||d),b=f.name||i;be(p,b),we(p,{siteName:b,persist:!1});let M=encodeURIComponent(ve(p));window.location.href=`/admin/site/${M}/design`}catch(u){console.error("[admin] Impossible de s\xE9lectionner le site",u),oe("Erreur inattendue lors de la s\xE9lection.")}},Nt=async()=>{try{let s=await fetch("/api/sites/current",{credentials:"same-origin"});if(!s.ok){s.status===404&&$&&(window.location.href="/admin/sites");return}let i=await s.json(),d=F(i.slug);be(d,i.name),we(d,{siteName:i.name,persist:!1})}catch(s){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",s)}};(()=>{if(g.slug){we(g.slug,{siteName:g.name,persist:!1});return}let s=document.querySelector('[data-site-card][data-site-default="true"]')||Ne[0];s&&we(s.dataset.siteCard,{siteName:s.dataset.siteName||"",persist:!1})})(),Nt(),$?_e($.slugValue):g.slug&&_e(g.slug),Bt.forEach(s=>{s.addEventListener("click",()=>{if(s.disabled)return;let i=s.dataset.siteSelect,d=s.dataset.siteSelectName||"Ce site";i&&(s.disabled=!0,Pt(i,d).finally(()=>{s.disabled=!1}))})});let ye=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),Ft=s=>{let i=ye(s||"");return i?`/${i}`:""},Mt=()=>{v&&(he=document.activeElement,v.classList.remove("hidden"),v.classList.add("flex"),fe=!1,N==null||N.reset(),x&&(x.textContent=""),A&&(A.textContent=""),q&&B&&(q.value=ye(B.value)),document.addEventListener("keydown",ot),window.setTimeout(()=>{B==null||B.focus()},0))},xe=()=>{v&&(v.classList.add("hidden"),v.classList.remove("flex"),document.removeEventListener("keydown",ot),fe=!1,N==null||N.reset(),x&&(x.textContent=""),A&&(A.textContent=""),he==null||he.focus())};Dt.forEach(s=>{s.addEventListener("click",Mt)}),It.forEach(s=>{s.addEventListener("click",xe)}),v==null||v.addEventListener("click",s=>{s.target===v&&xe()}),B==null||B.addEventListener("input",()=>{q&&(!fe||q.value.trim().length===0)&&(q.value=ye(B.value))}),q==null||q.addEventListener("input",()=>{fe=!0,x&&(x.textContent="")});let jt=()=>new Set(Array.from(Ne).map(s=>F(s.dataset.siteCard||"")));N==null||N.addEventListener("submit",async s=>{if(s.preventDefault(),!B||!q)return;let i=(B.value||"").trim(),d=q.value||"";d||(d=i);let u=Ft(d);if(!i||!u){x&&(x.textContent="Nom et slug sont requis.");return}if(jt().has(u)){x&&(x.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}x&&(x.textContent=""),A&&(A.textContent=""),X&&(X.disabled=!0,X.textContent="Cr\xE9ation...");try{let p=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,slug:u})});if(!p.ok){let re=await p.json().catch(()=>({})),j=re.message||"Impossible de cr\xE9er ce site.";A&&(A.textContent=j),re.field==="slug"&&x&&(x.textContent=j);return}let b=await p.json(),M=F((b==null?void 0:b.slug)||u),c=(b==null?void 0:b.name)||i;be(M,c),xe();let O=encodeURIComponent(ve(M));window.location.href=`/admin/site/${O}/design`}catch(p){console.error("[admin] Impossible de cr\xE9er le site",p),A&&(A.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{X&&(X.disabled=!1,X.textContent="Cr\xE9er")}}),window.addEventListener("keydown",s=>{s.key==="Escape"&&(v&&!v.classList.contains("hidden")&&xe(),V&&!V.classList.contains("hidden")&&it(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function _t(){let s=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return s?{slugPart:decodeURIComponent(s[1]),slugValue:F(decodeURIComponent(s[1])),section:s[2]||"design"}:null}function zt(){if(!V){window.location.href="/admin/sites";return}V.classList.remove("hidden"),V.classList.add("flex")}function it(){V&&(V.classList.add("hidden"),V.classList.remove("flex"))}qt.forEach(s=>{s.addEventListener("click",zt)}),At.forEach(s=>{s.addEventListener("click",it)}),Fe==null||Fe.addEventListener("click",()=>{window.location.href="/admin/sites"}),($==null?void 0:$.section)==="design"&&Ht(),$&&g.name&&rt(g.name);function Ht(){let s=document.querySelectorAll("[data-page-list]");if(s.length===0)return;let i=document.querySelector("[data-active-page-title]"),d=document.querySelector("[data-active-page-slug]"),u=document.querySelector("[data-page-preview-tags]"),f=document.querySelector("[data-page-preview-frame]"),p=document.querySelector("[data-preview-open]"),b=document.querySelector("[data-preview-status]"),M=document.querySelector("[data-preview-highlight]"),c=document.querySelector("[data-blocks-list]"),O=document.querySelector("[data-blocks-empty]"),re=document.querySelector("[data-block-count]"),j=document.querySelector("[data-block-library-toggle]"),J=document.querySelector("[data-block-library]"),Vt=document.querySelectorAll("[data-block-add]"),D=document.querySelector("[data-block-delete-modal]"),ze=document.querySelector("[data-block-delete-confirm]"),He=document.querySelector("[data-block-delete-cancel]"),Ve=document.querySelector("[data-block-detail-empty]"),R=document.querySelector("[data-block-detail-status]"),ke=document.querySelector("[data-block-editor]"),lt=document.querySelector("[data-block-editor-block-name]"),ct=document.querySelector("[data-block-editor-block-type]"),_=document.querySelector("[data-block-editor-unsupported]"),h=document.querySelector("[data-block-form]"),Ot=h?Array.from(h.querySelectorAll("[data-editor-section]")):[],Oe=document.querySelector("[data-block-form-cancel]"),Rt={hero:{section:"hero",labelField:"title",descriptionField:"subtitle",fields:{title:"hero-title",subtitle:"hero-subtitle",ctaLabel:"hero-cta-label",ctaUrl:"hero-cta-url",image:"hero-image",align:"hero-align"}},paragraphe:{section:"paragraph",labelField:"title",descriptionField:"content",fields:{title:"paragraph-title",content:"paragraph-content",align:"paragraph-align"}},image:{section:"image",labelField:"alt",fields:{src:"image-src",alt:"image-alt",showCaption:"image-caption-toggle",caption:"image-caption"}},groupe:{section:"group",fields:{layout:"group-layout",columnsMobile:"group-columns-mobile",columnsDesktop:"group-columns-desktop"}}},Ut={texte:"paragraphe",paragraph:"paragraphe",paragraphs:"paragraphe",paragraphes:"paragraphe",text:"paragraphe",hero:"hero",image:"image",groupe:"groupe",group:"groupe"},Wt=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),dt=e=>{if(!e)return null;let t=Wt(e.type),n=Ut[t]||t;return Rt[n]||null},ut=e=>{if(!h||!ke)return;e&&!e.settings&&(e.settings={});let t=dt(e);if(lt&&(lt.textContent=(e==null?void 0:e.label)||"Bloc"),ct&&(ct.textContent=(e==null?void 0:e.type)||"Bloc"),!t){h.classList.add("hidden"),_==null||_.classList.remove("hidden"),h.dataset.blockId="";return}_==null||_.classList.add("hidden"),h.classList.remove("hidden"),h.reset(),h.dataset.blockId=e.id,Ot.forEach(n=>{n.dataset.editorSection===t.section?n.classList.remove("hidden"):n.classList.add("hidden")}),Object.entries(t.fields).forEach(([n,a])=>{var m;let o=h.querySelector(`[name="${a}"]`);if(!o)return;let r=(m=e.settings)==null?void 0:m[n];o.type==="checkbox"?o.checked=!!r:(o.tagName,o.value=r!=null?r:"")})},Gt=e=>{if(!h||!e)return{};let t={};return Object.entries(e.fields).forEach(([n,a])=>{let o=h.querySelector(`[name="${a}"]`);o&&(o.type==="checkbox"?t[n]=o.checked:o.tagName==="TEXTAREA"?t[n]=o.value||"":o.type==="select-one"?t[n]=o.value:t[n]=o.value||"")}),t},Jt=e=>{if(e.preventDefault(),!l||!y)return;let t=Ge(),n=dt(t);if(!t||!n)return;let a=Gt(n),o=(l.blocks||[]).map(r=>{if(r.id!==t.id)return r;let m={...r.settings||{},...a},S={...r,settings:m};return n.labelField&&a[n.labelField]&&(S.label=a[n.labelField]),n.descriptionField&&a[n.descriptionField]&&(S.description=a[n.descriptionField]),S});le(o),oe("Bloc mis \xE0 jour"),W(l.id,{preserveBlock:!0})},K=document.querySelector("[data-page-drawer]"),C=document.querySelector("[data-page-drawer-backdrop]"),Kt=document.querySelectorAll("[data-page-drawer-open]"),Yt=document.querySelectorAll("[data-page-drawer-close]"),Y=document.querySelector("[data-add-page-toggle]"),U=document.querySelector("[data-add-page-form]"),I=document.querySelector("[data-add-page-title]"),T=document.querySelector("[data-add-page-slug]"),Re=document.querySelector("[data-add-page-cancel]"),P=document.querySelector("[data-add-page-error]"),pt=ve(($==null?void 0:$.slugValue)||g.slug||"default")||"default",Se={pages:`clower:pages:${pt}`,active:`clower:activePage:${pt}`},w=(e,t,n,a,o,r=[],m={})=>({id:e,label:t,type:n,status:a,description:o,props:r,settings:{...m}}),Xt=[{id:"home",title:"Accueil",slug:"/",description:"Hero immersif avec CTA, mise en avant des services et preuve sociale.",badges:["Hero","Services","CTA"],blocks:[w("home-hero","Hero principal","Hero","En ligne","Section immersive avec visuel plein \xE9cran et CTA principal.",[{label:"CTA",value:"Commencer"},{label:"Visuel",value:"Photo plein \xE9cran"}],{title:"Cr\xE9ez des exp\xE9riences m\xE9morables",subtitle:"Une \xE9quipe de designers pour construire vos pages en quelques minutes.",ctaLabel:"Commencer",ctaUrl:"#contact",image:"",align:"center"}),w("home-paragraph","Texte \xE9ditorial","Paragraphe","En ligne","Paragraphe d\u2019introduction.",[],{title:"Pitch \xE9ditorial",content:"Nous aidons les studios \xE0 cr\xE9er des exp\xE9riences immersives align\xE9es sur leur identit\xE9 de marque.",align:"left"}),w("home-group","Section services","Groupe","En ligne","Pr\xE9sentation synth\xE9tique des offres principales.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"services",title:"Services",slug:"/services",description:"D\xE9tail des offres avec mise en page \xE9ditoriale et appels \xE0 l\u2019action.",badges:["Offres","Storytelling","CTA"],blocks:[w("services-hero","Accroche services","Hero","En ligne","Section introductive d\xE9di\xE9e aux offres.",[],{title:"Des offres taill\xE9es pour vos \xE9quipes",subtitle:"Workshop de d\xE9marrage, design system personnalis\xE9, accompagnement \xE9ditorial continu.",ctaLabel:"Parler \xE0 un expert",ctaUrl:"#demo",image:"",align:"left"}),w("services-description","Description","Paragraphe","En ligne","Paragraphe d\xE9taillant la promesse.",[],{title:"Notre approche",content:"Chaque pack inclut un lead designer d\xE9di\xE9, des cycles courts et des revues en direct.",align:"left"}),w("services-layout","Layouts dynamiques","Groupe","En ligne","Cartes d\xE9taill\xE9es pour chaque service propos\xE9.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})]},{id:"realisations",title:"R\xE9alisations",slug:"/realisations",description:"S\xE9lection de projets r\xE9cents avec focus sur les r\xE9sultats.",badges:["Portfolio","Stats","Confiance"],blocks:[w("work-paragraph","Introduction portfolio","Paragraphe","En ligne","Intro du portfolio.",[],{title:"Nos r\xE9alisations",content:"Un aper\xE7u des exp\xE9riences livr\xE9es ces 12 derniers mois.",align:"center"}),w("work-image","Visuel signature","Image","En ligne","Image cl\xE9 d\u2019un projet.",[],{src:"",alt:"Visuel du projet phare",showCaption:!1,caption:""}),w("work-group","Grille de projets","Groupe","En ligne","Grille des projets r\xE9cents.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"contact",title:"Contact",slug:"/contact",description:"Formulaire de prise de contact simple et acc\xE8s aux coordonn\xE9es.",badges:["Formulaire","CTA","Infos"],blocks:[w("contact-hero","Hero contact","Hero","En ligne","Intro pour inciter \xE0 prendre contact.",[],{title:"Discutons de votre prochain projet",subtitle:"Partagez vos objectifs, nous proposons une approche personnalis\xE9e.",ctaLabel:"Planifier un call",ctaUrl:"#call",image:"",align:"center"}),w("contact-text","Informations pratiques","Paragraphe","En ligne","Texte practical.",[],{title:"Nous \xE9crire",content:"hello@clower.studio \xB7 +33 1 84 25 12 00 \xB7 Fuseau CET",align:"left"}),w("contact-image","Illustration","Image","En ligne","Illustration inspirante.",[],{src:"",alt:"Illustration \xE9quipe",showCaption:!0,caption:"Studio Clower, Paris"})]}],Zt={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}],settings:{title:"Titre du hero",subtitle:"",ctaLabel:"D\xE9couvrir",ctaUrl:"#",image:"",align:"center"}},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}],settings:{title:"Titre du paragraphe",content:"",align:"left"}},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}],settings:{src:"",alt:"",showCaption:!1,caption:""}},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}],settings:{layout:"grid",columnsMobile:"1",columnsDesktop:"3"}}},mt=e=>e.map(t=>({...t,badges:[...t.badges||[]],blocks:(t.blocks||[]).map(n=>({...n,props:(n.props||[]).map(a=>({...a})),settings:{...n.settings||{}}}))})),Qt=()=>{try{let e=window.localStorage.getItem(Se.pages);if(e){let t=JSON.parse(e);if(Array.isArray(t))return mt(t)}}catch{}return mt(Xt)},gt=e=>{try{window.localStorage.setItem(Se.pages,JSON.stringify(e))}catch{}},es=e=>{try{window.localStorage.setItem(Se.active,e)}catch{}},ts=e=>{var t;try{let n=window.localStorage.getItem(Se.active);if(n&&e.some(a=>a.id===n))return n}catch{}return((t=e[0])==null?void 0:t.id)||null},ss=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,ft=e=>{if(!e||e==="/")return"/";let t=ye(e.replace(/^\//,""));return t?`/${t}`:"/"},Ue=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,ns=(e,t)=>[w(Ue(e,"intro"),"Introduction","Paragraphe","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}],{title:`Introduction \xE0 ${t}`,content:"Ajoutez votre premier paragraphe de pr\xE9sentation.",align:"left"}),w(Ue(e,"content"),"Zone de contenu","Groupe","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})],as=e=>{i&&(i.textContent=(e==null?void 0:e.title)||"Page"),d&&(d.textContent=(e==null?void 0:e.slug)||"/")},os=e=>{if(!u)return;u.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(n=>{let a=document.createElement("span");a.className="rounded-full bg-slate-100 px-3 py-1",a.textContent=n,u.appendChild(a)})},rs=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},Le=e=>{if(!(!Ve||!ke)){if(!e){Ve.classList.remove("hidden"),ke.classList.add("hidden"),_==null||_.classList.add("hidden"),h==null||h.classList.add("hidden"),R==null||R.classList.add("hidden");return}Ve.classList.add("hidden"),ke.classList.remove("hidden"),R&&(e.status?(R.textContent=e.status,R.className=`rounded-full px-3 py-1 text-xs font-semibold ${rs(e.status)}`,R.classList.remove("hidden")):R.classList.add("hidden")),ut(e)}},is=(e,t)=>{let n=(e.type||"").toLowerCase(),a=e.settings||{},o=a.title||e.label||`Bloc ${t+1}`,r=a.subtitle||a.content||e.description||"",m=e.props&&e.props.length>0?e.props.map(k=>`<li>${k.label}: <strong>${k.value}</strong></li>`).join(""):"",S=`
        <div class="preview-block__header">
          <span class="preview-type">${e.type||"Bloc"}</span>
          <span class="preview-status">${e.status||""}</span>
        </div>
        <h3>${o}</h3>
        <p class="preview-desc">${r}</p>
        ${m?`<ul class="preview-props">
            ${m}
          </ul>`:""}
      `;switch(n){case"hero":return`<section class="preview-block ${a.align==="left"?"preview-hero align-left":a.align==="right"?"preview-hero align-right":"preview-hero"}" data-preview-block="${e.id}">
            ${S}
            <button class="preview-cta">${a.ctaLabel||"D\xE9couvrir"}</button>
          </section>`;case"paragraphe":case"texte":{let k=a.align||"left";return`<section class="preview-block preview-text" data-preview-block="${e.id}" style="text-align:${k};">
            ${S}
          </section>`}case"image":{let k=a.src?`style="background-image:url('${a.src}');"`:"",G=a.showCaption&&a.caption?`<figcaption>${a.caption}</figcaption>`:"";return`<figure class="preview-block preview-image" data-preview-block="${e.id}">
            <div class="preview-image__media" ${k}></div>
            ${S}
            ${G}
          </figure>`}case"groupe":case"sections":case"grid":{let k=a.columnsMobile||"1",G=a.columnsDesktop||"3",ee=Number(k),te=Number(G),se=Ze=>Array.from({length:Ze}).map(()=>"<div></div>").join("");return`<section class="preview-block preview-group" data-preview-block="${e.id}">
            ${S}
            <div class="preview-group__rows mobile">${se(ee)}</div>
            <div class="preview-group__rows desktop">${se(te)}</div>
            <p class="preview-layout">Mobile ${ee} col. \xB7 Desktop ${te} col.</p>
          </section>`}default:return`<section class="preview-block" data-preview-block="${e.id}">${S}</section>`}},ht=e=>{let t=(e==null?void 0:e.title)||"Page",n=(e==null?void 0:e.blocks)||[],a=n.length>0?n.map((o,r)=>is(o,r)).join(""):`<section class="preview-block preview-empty" data-preview-block="none">
              <p>Ajoutez vos premiers blocs pour voir la preview se construire.</p>
            </section>`;return`<!DOCTYPE html>
      <html lang="fr">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <title>Pr\xE9visualisation \u2013 ${t}</title>
          <style>
            :root {
              font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              background-color: #f8fafc;
              color: #0f172a;
            }
            body {
              margin: 0;
              padding: 48px 24px 80px;
              background-color: #f8fafc;
              color: #0f172a;
            }
            .preview-page {
              max-width: 960px;
              margin: 0 auto;
              display: flex;
              flex-direction: column;
              gap: 24px;
            }
            .preview-block {
              border-radius: 24px;
              padding: 24px;
              border: 1px solid rgba(15, 23, 42, 0.08);
              background: white;
              box-shadow: 0 20px 30px rgba(15, 23, 42, 0.04);
              transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            }
            .preview-block h3 {
              margin: 4px 0 6px;
              font-size: 20px;
            }
            .preview-block p {
              margin: 0;
              font-size: 15px;
              color: #475569;
            }
            .preview-block__header {
              display: flex;
              align-items: center;
              gap: 12px;
              font-size: 12px;
              text-transform: uppercase;
              letter-spacing: 0.06em;
              color: #94a3b8;
            }
            .preview-type {
              padding: 2px 8px;
              border-radius: 999px;
              background: #f1f5f9;
              color: #475569;
            }
            .preview-status {
              color: #94a3b8;
            }
            .preview-block-active {
              border-color: rgba(156, 107, 255, 0.6) !important;
              background: rgba(156, 107, 255, 0.05);
              box-shadow: 0 0 0 1px rgba(156, 107, 255, 0.2);
            }
            .preview-hero {
              padding: 48px;
              text-align: center;
              background: linear-gradient(120deg, #ede9fe, #f8fafc);
            }
            .preview-hero.align-left {
              text-align: left;
            }
            .preview-hero.align-right {
              text-align: right;
            }
            .preview-hero h3 {
              font-size: 28px;
            }
            .preview-hero .preview-cta {
              margin-top: 16px;
              border: none;
              background: #9c6bff;
              color: white;
              font-weight: 600;
              padding: 12px 24px;
              border-radius: 999px;
            }
            .preview-image__media {
              width: 100%;
              height: 220px;
              border-radius: 20px;
              background: linear-gradient(130deg, #c084fc, #a855f7);
              margin-bottom: 16px;
              opacity: 0.8;
              background-size: cover;
              background-position: center;
            }
            .preview-image figcaption {
              margin-top: 12px;
              font-size: 13px;
              color: #64748b;
            }
            .preview-group__rows {
              display: grid;
              gap: 12px;
              margin-top: 16px;
            }
            .preview-group__rows.mobile {
              grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            .preview-group__rows.desktop {
              grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            .preview-group__rows div {
              height: 80px;
              border-radius: 16px;
              background: #f1f5f9;
            }
            .preview-layout {
              margin-top: 12px;
              font-size: 13px;
              color: #475569;
            }
            .preview-props {
              margin: 12px 0 0;
              padding-left: 18px;
              color: #475569;
              font-size: 13px;
            }
            .preview-empty {
              text-align: center;
              border-style: dashed;
              border-color: rgba(15, 23, 42, 0.2);
              color: #64748b;
            }
          </style>
        </head>
        <body>
          <div class="preview-page">
            ${a}
          </div>
        </body>
      </html>`},vt=e=>{if(b){if(!e){b.classList.add("hidden");return}b.classList.remove("hidden"),b.textContent=e}},ls=e=>{if(!f)return;let t=ht(e);Ae=t,vt("Actualisation\u2026"),f.setAttribute("title",`Pr\xE9visualisation de la page ${(e==null?void 0:e.title)||""}`.trim()),f.srcdoc=t,Xe=!1},ie=e=>{if(!f)return;let t=f.contentDocument;if(!t)return;t.querySelectorAll("[data-preview-block]").forEach(a=>{a.dataset.previewBlock===e?(a.classList.add("preview-block-active"),Xe&&e&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):a.classList.remove("preview-block-active")}),M&&(M.style.borderColor=e?"rgba(156, 107, 255, 0.5)":"transparent")},We=e=>{if(!c)return;c.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(re&&(re.textContent=ss(t.length)),t.length===0){c.classList.add("hidden"),O==null||O.classList.remove("hidden");return}c.classList.remove("hidden"),O==null||O.classList.add("hidden"),t.forEach(n=>{let a=n.id===y,o=document.createElement("div");o.dataset.blockItem="true",o.dataset.blockId=n.id,o.setAttribute("role","option"),o.setAttribute("aria-selected",a?"true":"false"),o.tabIndex=0,o.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition",a?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let r=document.createElement("span");r.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${a?"":"hidden"}`,o.appendChild(r);let m=document.createElement("div");m.className="flex flex-1 items-center gap-3";let S=document.createElement("div");S.className="hidden lg:flex cursor-grab flex-shrink-0 items-center text-lg text-slate-400",S.innerHTML="&#8801;",m.appendChild(S);let k=document.createElement("div");k.className="flex-1";let G=document.createElement("div");G.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let ee=document.createElement("span");ee.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",ee.textContent=n.type;let te=document.createElement("span");te.className="text-slate-400",te.textContent=n.status,G.appendChild(ee),G.appendChild(te);let se=document.createElement("p");se.className="mt-1 text-sm font-semibold text-slate-900";let Ze=n.settings&&n.settings.title||n.label||"Bloc sans titre";se.textContent=Ze,k.appendChild(G),k.appendChild(se),m.appendChild(k),o.appendChild(m);let $e=document.createElement("div");$e.className="flex flex-col gap-1 text-xs text-slate-400";let De=document.createElement("div");De.className="flex items-center gap-1 lg:hidden";let de=document.createElement("button");de.type="button",de.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",de.textContent="\u2191",de.addEventListener("click",H=>{H.stopPropagation(),wt(n.id,-1)});let ue=document.createElement("button");ue.type="button",ue.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",ue.textContent="\u2193",ue.addEventListener("click",H=>{H.stopPropagation(),wt(n.id,1)}),De.appendChild(de),De.appendChild(ue),$e.appendChild(De);let pe=document.createElement("button");pe.type="button",pe.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",pe.innerHTML="\u{1F5D1}\uFE0F",pe.addEventListener("click",H=>{H.stopPropagation(),ms(n.id)}),$e.appendChild(pe),o.appendChild($e),o.addEventListener("click",()=>{Z(n.id)}),o.addEventListener("keydown",H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),Z(n.id))}),c.appendChild(o)})},bt=(e,t)=>{s.forEach(n=>{n.innerHTML="",e.forEach(a=>{let o=document.createElement("li"),r=document.createElement("button");r.type="button",r.dataset.pageId=a.id,r.className=["w-full flex items-center justify-between gap-3 px-3 py-2 text-left transition",t===a.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===a.id?r.setAttribute("aria-current","page"):r.removeAttribute("aria-current"),r.innerHTML=`
            <div class="flex items-center gap-3">
              <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
                </svg>
              </span>
              <div class="flex flex-col">
                <span class="text-sm font-semibold">${a.title}</span>
                <span class="text-xs text-slate-500">${a.slug}</span>
              </div>
            </div>
          `,r.addEventListener("click",()=>{W(a.id),Ke()||Ye()}),o.appendChild(r),n.appendChild(o)})})},Ge=()=>!l||!Array.isArray(l.blocks)?null:l.blocks.find(e=>e.id===y)||null,Z=e=>{if(!l)return;if(!e){y=null,We(l),Le(null),ie(null);return}let t=l.blocks.find(n=>n.id===e)||l.blocks[0]||null;y=(t==null?void 0:t.id)||null,We(l),Le(t),ie(y)},le=e=>{if(!l)return;let t={...l,blocks:e};gs(t)},Ce=()=>window.matchMedia("(min-width: 1024px)").matches;function wt(e,t){if(!l||!e||!t)return;let n=[...l.blocks||[]],a=n.findIndex(m=>m.id===e);if(a<0)return;let o=a+t;if(o<0||o>=n.length)return;let[r]=n.splice(a,1);n.splice(o,0,r),le(n),W(l.id,{preserveBlock:!0}),Z(r.id)}function cs(e,t){if(!l||!e||!t||e===t)return;let n=[...l.blocks||[]],a=n.findIndex(m=>m.id===e),o=n.findIndex(m=>m.id===t);if(a<0||o<0)return;let[r]=n.splice(a,1);n.splice(o,0,r),le(n),W(l.id,{preserveBlock:!0}),Z(r.id)}function yt(){if(!c)return;let e=Ce();c.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function Ee(){J&&(J.classList.add("hidden"),ce=!1)}function ds(){J&&(J.classList.remove("hidden"),ce=!0)}function us(){ce?Ee():ds()}function ps(e){if(!l||!e)return;let t=Zt[e];if(!t)return;let n=(l.blocks||[]).filter(r=>r.type===t.type).length+1,a=w(Ue(l.id,e),`${t.label} ${n}`,t.type,t.status,t.description,t.props,t.settings||{}),o=[...l.blocks||[],a];le(o),W(l.id,{preserveBlock:!0}),Z(a.id),Ee(),oe("Bloc ajout\xE9")}function xt(e){var a,o;if(!l)return;let t=(l.blocks||[]).filter(r=>r.id!==e),n=e===y?((a=t[0])==null?void 0:a.id)||null:y||((o=t[0])==null?void 0:o.id)||null;le(t),y=n,W(l.id,{preserveBlock:!0}),y?Z(y):(Le(null),ie(null)),oe("Bloc supprim\xE9")}function Je(){D&&(D.classList.add("hidden"),D.classList.remove("flex"),qe=null)}function ms(e){if(!D){xt(e);return}qe=e,D.classList.remove("hidden"),D.classList.add("flex")}let gs=e=>{e&&(E=E.map(t=>t.id===e.id?e:t),l=e,gt(E))},W=(e,t={})=>{var a,o;let n=E.find(r=>r.id===e)||E[0]||null;l=n,Q=(n==null?void 0:n.id)||null,(!t.preserveBlock||!l||!l.blocks.some(r=>r.id===y))&&(y=((o=(a=l==null?void 0:l.blocks)==null?void 0:a[0])==null?void 0:o.id)||null),Q&&es(Q),bt(E,Q),as(l),os(l),ls(l),We(l),Le(Ge()),ie(y),yt(),ce&&Ee()},Ke=()=>window.matchMedia("(min-width: 1024px)").matches,kt=()=>{K&&(Ke()?(K.classList.add("is-open"),C==null||C.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):K.classList.remove("is-open"))},fs=()=>{!K||Ke()||(K.classList.add("is-open"),C==null||C.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Ye=()=>{K&&(K.classList.remove("is-open"),C==null||C.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},hs=()=>{!U||!Y||(U.classList.remove("hidden"),Y.classList.add("hidden"),P&&(P.textContent=""),Be=!1,I&&(I.value="",I.focus()),T&&(T.value=""))},St=()=>{!U||!Y||(U.classList.add("hidden"),Y.classList.remove("hidden"),P&&(P.textContent=""),Be=!1,U.reset())},vs=()=>{!I||!T||Be&&T.value.trim().length>0||(T.value=ft(I.value))},E=Qt(),Q=ts(E),Be=!1,l=null,y=null,ce=!1,qe=null,Ae="",Xe=!1;bt(E,Q),W(Q),kt(),Kt.forEach(e=>{e.addEventListener("click",fs)}),Yt.forEach(e=>{e.addEventListener("click",Ye)}),C==null||C.addEventListener("click",Ye),window.addEventListener("resize",()=>{kt(),yt()}),Y==null||Y.addEventListener("click",hs),Re==null||Re.addEventListener("click",St),I==null||I.addEventListener("input",vs),T==null||T.addEventListener("input",()=>{P&&(P.textContent=""),Be=!0}),U==null||U.addEventListener("submit",e=>{if(e.preventDefault(),!I||!T)return;let t=I.value.trim(),n=ft(T.value.trim()||t);if(!t||!n){P&&(P.textContent="Titre et slug sont requis.");return}if(E.some(r=>r.slug===n)){P&&(P.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}let a=`page-${Date.now().toString(36)}`,o={id:a,title:t,slug:n,description:`Nouvelle page "${t}" pr\xEAte \xE0 \xEAtre maquett\xE9e.`,badges:["Layout","Texte"],blocks:ns(a,t)};E=[...E,o],gt(E),St(),W(o.id)}),j==null||j.addEventListener("click",e=>{e.stopPropagation(),us()}),document.addEventListener("click",e=>{ce&&(J!=null&&J.contains(e.target)||j!=null&&j.contains(e.target)||Ee())}),Vt.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let n=e.dataset.blockAdd;ps(n)})}),He==null||He.addEventListener("click",()=>{Je()}),ze==null||ze.addEventListener("click",()=>{qe&&xt(qe),Je()}),D==null||D.addEventListener("click",e=>{e.target===D&&Je()}),h==null||h.addEventListener("submit",Jt),Oe==null||Oe.addEventListener("click",e=>{e.preventDefault();let t=Ge();t&&ut(t)}),f==null||f.addEventListener("load",()=>{Xe=!0,vt("\xC0 jour"),ie(y)}),p==null||p.addEventListener("click",()=>{Ae||(Ae=ht(l));let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Ae),t.close()});let bs=e=>{let t=e.target.closest("[data-block-item]");!t||!Ce()||(z=t.dataset.blockId||null,z&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",z),t.classList.add("opacity-50")))},Lt=()=>{c==null||c.querySelectorAll("[data-block-item]").forEach(e=>e.classList.remove("opacity-50","ring-2","ring-[#9C6BFF]/50"))},ws=()=>{z=null,Lt()},ys=e=>{if(!z||!Ce())return;let t=e.target.closest("[data-block-item]");!t||t.dataset.blockId===z||(e.preventDefault(),t.classList.add("ring-2","ring-[#9C6BFF]/50"))},xs=e=>{let t=e.target.closest("[data-block-item]");t&&t.classList.remove("ring-2","ring-[#9C6BFF]/50")},ks=e=>{if(!z||!Ce())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),n=z;z=null,Lt();let a=(t==null?void 0:t.dataset.blockId)||null;a&&cs(n,a)},z=null;c==null||c.addEventListener("dragstart",bs),c==null||c.addEventListener("dragend",ws),c==null||c.addEventListener("dragover",ys),c==null||c.addEventListener("dragleave",xs),c==null||c.addEventListener("drop",ks)}});})();
