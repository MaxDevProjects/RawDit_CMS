(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("[admin] Atelier charg\xE9");let Be=document.querySelector("[data-logout]");Be&&Be.addEventListener("click",async()=>{Be.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("[admin] Impossible de se d\xE9connecter",s)}finally{window.location.href="/admin/index.html"}});let Y=document.querySelector("[data-admin-sidebar]"),y=document.querySelector("[data-admin-sidebar-overlay]"),Ge=document.querySelectorAll("[data-admin-sidebar-toggle]"),xt=document.querySelectorAll("[data-admin-sidebar-close]"),qe=document.body,ae=!1,oe=()=>{if(!Y)return;if(window.matchMedia("(min-width: 1024px)").matches){Y.classList.remove("hidden"),y==null||y.classList.add("hidden"),qe.classList.remove("overflow-hidden");return}ae?(Y.classList.remove("hidden"),y==null||y.classList.remove("hidden"),qe.classList.add("overflow-hidden")):(Y.classList.add("hidden"),y==null||y.classList.add("hidden"),qe.classList.remove("overflow-hidden"))},yt=()=>{ae=!0,oe()},Ae=()=>{ae=!1,oe()};Y&&Ge.length>0&&(Ge.forEach(s=>{s.addEventListener("click",yt)}),xt.forEach(s=>{s.addEventListener("click",Ae)}),y==null||y.addEventListener("click",Ae),window.addEventListener("resize",oe),window.addEventListener("keydown",s=>{s.key==="Escape"&&ae&&Ae()}),oe());let Ye="clower:currentSite",Ze="clower:currentSiteName",m={slug:null,name:""};(()=>{try{m.slug=window.localStorage.getItem(Ye),m.name=window.localStorage.getItem(Ze)||""}catch{m.slug=null,m.name=""}})();let De=document.querySelectorAll("[data-site-card]"),St=document.querySelectorAll("[data-site-select]"),Z=document.querySelector("[data-current-site-name]"),Qe=document.querySelector("[data-workspace-site-name]"),Xe=document.querySelector("[data-workspace-back-name]"),j=document.querySelector("[data-workspace-back-modal]"),kt=document.querySelectorAll("[data-workspace-back]"),Lt=document.querySelectorAll("[data-workspace-back-cancel]"),Pe=document.querySelector("[data-workspace-back-confirm]"),Ct=document.querySelectorAll("[data-workspace-tab]"),Te=document.querySelector("[data-site-toast]"),et=document.querySelector("[data-site-toast-message]"),Et=document.querySelectorAll("[data-site-create]"),v=document.querySelector("[data-site-modal]"),T=document.querySelector("[data-site-form]"),L=document.querySelector("[data-site-name]"),C=document.querySelector("[data-site-slug]"),w=document.querySelector("[data-site-slug-error]"),E=document.querySelector("[data-site-modal-error]"),Bt=document.querySelectorAll("[data-site-modal-cancel]"),W=document.querySelector("[data-site-modal-submit]"),B=Nt(),re=!1,ie=null,$e=null,qt='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',tt=s=>{if(!v||v.classList.contains("hidden")||s.key!=="Tab")return;let o=Array.from(v.querySelectorAll(qt)).filter(f=>!f.hasAttribute("disabled")&&!f.getAttribute("aria-hidden"));if(o.length===0)return;let d=o[0],u=o[o.length-1];s.shiftKey?document.activeElement===d&&(s.preventDefault(),u.focus()):document.activeElement===u&&(s.preventDefault(),d.focus())},le=s=>{!Te||!et||(et.textContent=s,Te.classList.remove("hidden"),$e&&clearTimeout($e),$e=setTimeout(()=>{Te.classList.add("hidden")},2500))};function $(s){return s?s.startsWith("/")?s:`/${s}`:""}function ce(s){return(s==null?void 0:s.replace(/^\//,""))||""}let de=(s,o)=>{let d=s?$(s):null;try{d&&(window.localStorage.setItem(Ye,d),m.slug=d),typeof o=="string"&&o.length>0&&(window.localStorage.setItem(Ze,o),m.name=o)}catch{m.slug=d||m.slug,m.name=o||m.name}},st=s=>{Z&&s&&(Z.textContent=s),Qe&&s&&(Qe.textContent=s),Xe&&s&&(Xe.textContent=s)},Ne=s=>{Ct.forEach(o=>{let d=o.dataset.workspaceTab;if(!d)return;if(!s){o.href="#",o.classList.add("pointer-events-none","opacity-50","text-slate-400"),o.setAttribute("aria-disabled","true");return}let u=encodeURIComponent(ce(s));o.href=`/admin/site/${u}/${d}`,o.classList.remove("pointer-events-none","opacity-50","text-slate-400"),o.removeAttribute("aria-disabled")})},ue=(s,o={})=>{if(!s)return;let d=$(s),u=o.siteName||m.name||(Z==null?void 0:Z.dataset.defaultSiteName)||"";De.forEach(p=>{let N=$(p.dataset.siteCard||"")===d,i=p.querySelector("[data-site-active-badge]");N?(p.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.remove("border-slate-200"),i==null||i.classList.remove("hidden"),u=p.dataset.siteName||u):(p.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.add("border-slate-200"),i==null||i.classList.add("hidden"))}),o.persist!==!1&&de(d,o.siteName||u);let f=o.siteName||u;st(f),Ne(d)},At=async(s,o)=>{let d=$(s);try{let u=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:d})});if(!u.ok){let i=await u.json().catch(()=>({}));le(i.message||"Impossible de s\xE9lectionner ce site.");return}let f=await u.json().catch(()=>({})),p=$(f.slug||d),h=f.name||o;de(p,h),ue(p,{siteName:h,persist:!1});let N=encodeURIComponent(ce(p));window.location.href=`/admin/site/${N}/design`}catch(u){console.error("[admin] Impossible de s\xE9lectionner le site",u),le("Erreur inattendue lors de la s\xE9lection.")}},Dt=async()=>{try{let s=await fetch("/api/sites/current",{credentials:"same-origin"});if(!s.ok){s.status===404&&B&&(window.location.href="/admin/sites");return}let o=await s.json(),d=$(o.slug);de(d,o.name),ue(d,{siteName:o.name,persist:!1})}catch(s){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",s)}};(()=>{if(m.slug){ue(m.slug,{siteName:m.name,persist:!1});return}let s=document.querySelector('[data-site-card][data-site-default="true"]')||De[0];s&&ue(s.dataset.siteCard,{siteName:s.dataset.siteName||"",persist:!1})})(),Dt(),B?Ne(B.slugValue):m.slug&&Ne(m.slug),St.forEach(s=>{s.addEventListener("click",()=>{if(s.disabled)return;let o=s.dataset.siteSelect,d=s.dataset.siteSelectName||"Ce site";o&&(s.disabled=!0,At(o,d).finally(()=>{s.disabled=!1}))})});let pe=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),Pt=s=>{let o=pe(s||"");return o?`/${o}`:""},Tt=()=>{v&&(ie=document.activeElement,v.classList.remove("hidden"),v.classList.add("flex"),re=!1,T==null||T.reset(),w&&(w.textContent=""),E&&(E.textContent=""),C&&L&&(C.value=pe(L.value)),document.addEventListener("keydown",tt),window.setTimeout(()=>{L==null||L.focus()},0))},me=()=>{v&&(v.classList.add("hidden"),v.classList.remove("flex"),document.removeEventListener("keydown",tt),re=!1,T==null||T.reset(),w&&(w.textContent=""),E&&(E.textContent=""),ie==null||ie.focus())};Et.forEach(s=>{s.addEventListener("click",Tt)}),Bt.forEach(s=>{s.addEventListener("click",me)}),v==null||v.addEventListener("click",s=>{s.target===v&&me()}),L==null||L.addEventListener("input",()=>{C&&(!re||C.value.trim().length===0)&&(C.value=pe(L.value))}),C==null||C.addEventListener("input",()=>{re=!0,w&&(w.textContent="")});let $t=()=>new Set(Array.from(De).map(s=>$(s.dataset.siteCard||"")));T==null||T.addEventListener("submit",async s=>{if(s.preventDefault(),!L||!C)return;let o=(L.value||"").trim(),d=C.value||"";d||(d=o);let u=Pt(d);if(!o||!u){w&&(w.textContent="Nom et slug sont requis.");return}if($t().has(u)){w&&(w.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}w&&(w.textContent=""),E&&(E.textContent=""),W&&(W.disabled=!0,W.textContent="Cr\xE9ation...");try{let p=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,slug:u})});if(!p.ok){let Q=await p.json().catch(()=>({})),I=Q.message||"Impossible de cr\xE9er ce site.";E&&(E.textContent=I),Q.field==="slug"&&w&&(w.textContent=I);return}let h=await p.json(),N=$((h==null?void 0:h.slug)||u),i=(h==null?void 0:h.name)||o;de(N,i),me();let H=encodeURIComponent(ce(N));window.location.href=`/admin/site/${H}/design`}catch(p){console.error("[admin] Impossible de cr\xE9er le site",p),E&&(E.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{W&&(W.disabled=!1,W.textContent="Cr\xE9er")}}),window.addEventListener("keydown",s=>{s.key==="Escape"&&(v&&!v.classList.contains("hidden")&&me(),j&&!j.classList.contains("hidden")&&nt(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function Nt(){let s=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return s?{slugPart:decodeURIComponent(s[1]),slugValue:$(decodeURIComponent(s[1])),section:s[2]||"design"}:null}function It(){if(!j){window.location.href="/admin/sites";return}j.classList.remove("hidden"),j.classList.add("flex")}function nt(){j&&(j.classList.add("hidden"),j.classList.remove("flex"))}kt.forEach(s=>{s.addEventListener("click",It)}),Lt.forEach(s=>{s.addEventListener("click",nt)}),Pe==null||Pe.addEventListener("click",()=>{window.location.href="/admin/sites"}),(B==null?void 0:B.section)==="design"&&Mt(),B&&m.name&&st(m.name);function Mt(){let s=document.querySelectorAll("[data-page-list]");if(s.length===0)return;let o=document.querySelector("[data-active-page-title]"),d=document.querySelector("[data-active-page-slug]"),u=document.querySelector("[data-page-preview-tags]"),f=document.querySelector("[data-page-preview-frame]"),p=document.querySelector("[data-preview-open]"),h=document.querySelector("[data-preview-status]"),N=document.querySelector("[data-preview-highlight]"),i=document.querySelector("[data-blocks-list]"),H=document.querySelector("[data-blocks-empty]"),Q=document.querySelector("[data-block-count]"),I=document.querySelector("[data-block-library-toggle]"),z=document.querySelector("[data-block-library]"),Ft=document.querySelectorAll("[data-block-add]"),q=document.querySelector("[data-block-delete-modal]"),Ie=document.querySelector("[data-block-delete-confirm]"),Me=document.querySelector("[data-block-delete-cancel]"),Fe=document.querySelector("[data-block-detail]"),je=document.querySelector("[data-block-detail-empty]"),at=document.querySelector("[data-block-detail-title]"),ot=document.querySelector("[data-block-detail-type]"),rt=document.querySelector("[data-block-detail-description]"),fe=document.querySelector("[data-block-detail-props]"),O=document.querySelector("[data-block-detail-status]"),V=document.querySelector("[data-page-drawer]"),S=document.querySelector("[data-page-drawer-backdrop]"),jt=document.querySelectorAll("[data-page-drawer-open]"),Ht=document.querySelectorAll("[data-page-drawer-close]"),R=document.querySelector("[data-add-page-toggle]"),_=document.querySelector("[data-add-page-form]"),A=document.querySelector("[data-add-page-title]"),D=document.querySelector("[data-add-page-slug]"),He=document.querySelector("[data-add-page-cancel]"),P=document.querySelector("[data-add-page-error]"),it=ce((B==null?void 0:B.slugValue)||m.slug||"default")||"default",ge={pages:`clower:pages:${it}`,active:`clower:activePage:${it}`},b=(e,t,n,a,r,c=[])=>({id:e,label:t,type:n,status:a,description:r,props:c}),_t=[{id:"home",title:"Accueil",slug:"/",description:"Hero immersif avec CTA, mise en avant des services et preuve sociale.",badges:["Hero","Services","CTA"],blocks:[b("home-hero","Hero principal","Hero","En ligne","Section immersive avec visuel plein \xE9cran et CTA principal.",[{label:"CTA",value:"Commencer"},{label:"Visuel",value:"Photo plein \xE9cran"}]),b("home-services","Services cl\xE9s","Sections","En ligne","Pr\xE9sentation synth\xE9tique des offres principales.",[{label:"Colonnes",value:"3"},{label:"Style",value:"Cards"}]),b("home-social","Preuves clients","Logos","En ligne","Logos et t\xE9moignages courts pour rassurer.",[{label:"Logos",value:"8"},{label:"Notes",value:"4.9/5"}])]},{id:"services",title:"Services",slug:"/services",description:"D\xE9tail des offres avec mise en page \xE9ditoriale et appels \xE0 l\u2019action.",badges:["Offres","Storytelling","CTA"],blocks:[b("services-intro","Introduction","Texte","En ligne","Paragraphe d\u2019ouverture qui pose la promesse.",[{label:"Longueur",value:"120 mots"}]),b("services-grid","Offres d\xE9taill\xE9es","Cards","En ligne","Cartes d\xE9taill\xE9es pour chaque service propos\xE9.",[{label:"Cartes",value:"4"},{label:"CTA",value:"D\xE9couvrir"}]),b("services-cases","\xC9tudes de cas","Portfolio","Brouillon","S\xE9lection de projets marquants.",[{label:"Projets",value:"3"}])]},{id:"realisations",title:"R\xE9alisations",slug:"/realisations",description:"S\xE9lection de projets r\xE9cents avec focus sur les r\xE9sultats.",badges:["Portfolio","Stats","Confiance"],blocks:[b("work-hero","Projets vedettes","Grid","En ligne","Mosa\xEFque des r\xE9alisations \xE0 mettre en avant.",[{label:"Layouts",value:"Masonry"}]),b("work-stats","Chiffres cl\xE9s","Stats","En ligne","Bloc m\xE9triques pour parler r\xE9sultats.",[{label:"KPI",value:"6"}]),b("work-reviews","Avis clients","Quotes","Brouillon","Citations extraites des entretiens clients.",[{label:"Avis",value:"2"}])]},{id:"contact",title:"Contact",slug:"/contact",description:"Formulaire de prise de contact simple et acc\xE8s aux coordonn\xE9es.",badges:["Formulaire","CTA","Infos"],blocks:[b("contact-header","Header court","Texte","En ligne","Intro concise pour inciter \xE0 prendre contact.",[{label:"Ton",value:"Direct"}]),b("contact-form","Formulaire","Form","En ligne","Formulaire de contact avec 4 champs.",[{label:"Champs",value:"Nom, Email, Projet, Budget"}]),b("contact-infos","Coordonn\xE9es","Infos","En ligne","Bloc avec adresse, t\xE9l\xE9phone et r\xE9seaux.",[{label:"Fuseau",value:"CET"}])]}],zt={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}]},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}]},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}]},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}]}},lt=e=>e.map(t=>({...t,badges:[...t.badges||[]],blocks:(t.blocks||[]).map(n=>({...n,props:(n.props||[]).map(a=>({...a}))}))})),Ot=()=>{try{let e=window.localStorage.getItem(ge.pages);if(e){let t=JSON.parse(e);if(Array.isArray(t))return lt(t)}}catch{}return lt(_t)},ct=e=>{try{window.localStorage.setItem(ge.pages,JSON.stringify(e))}catch{}},Vt=e=>{try{window.localStorage.setItem(ge.active,e)}catch{}},Rt=e=>{var t;try{let n=window.localStorage.getItem(ge.active);if(n&&e.some(a=>a.id===n))return n}catch{}return((t=e[0])==null?void 0:t.id)||null},Ut=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,dt=e=>{if(!e||e==="/")return"/";let t=pe(e.replace(/^\//,""));return t?`/${t}`:"/"},_e=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,Wt=(e,t)=>[b(_e(e,"intro"),"Introduction","Texte","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}]),b(_e(e,"content"),"Zone de contenu","Section","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}])],Kt=e=>{o&&(o.textContent=(e==null?void 0:e.title)||"Page"),d&&(d.textContent=(e==null?void 0:e.slug)||"/")},Jt=e=>{if(!u)return;u.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(n=>{let a=document.createElement("span");a.className="rounded-full bg-slate-100 px-3 py-1",a.textContent=n,u.appendChild(a)})},Gt=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},ve=e=>{if(!(!Fe||!je)){if(!e){Fe.classList.add("hidden"),je.classList.remove("hidden"),O==null||O.classList.add("hidden");return}if(Fe.classList.remove("hidden"),je.classList.add("hidden"),at&&(at.textContent=e.label),ot&&(ot.textContent=e.type),rt&&(rt.textContent=e.description||"Aucune description pour ce bloc."),fe)if(fe.innerHTML="",e.props&&e.props.length>0)e.props.forEach(t=>{let n=document.createElement("div");n.className="flex items-center justify-between gap-3 rounded-xl border border-slate-200 px-3 py-2 text-sm",n.innerHTML=`
              <span class="text-xs uppercase tracking-wide text-slate-500">${t.label}</span>
              <span class="font-semibold text-slate-900">${t.value}</span>
            `,fe.appendChild(n)});else{let t=document.createElement("div");t.className="rounded-xl border border-dashed border-slate-200 px-3 py-2 text-sm text-slate-500",t.textContent="Aucune propri\xE9t\xE9 d\xE9clar\xE9e.",fe.appendChild(t)}O&&(O.textContent=e.status,O.className=`rounded-full px-3 py-1 text-xs font-semibold ${Gt(e.status)}`,O.classList.remove("hidden"))}},Yt=(e,t)=>{let n=(e.type||"").toLowerCase(),a=e.label||`Bloc ${t+1}`,r=e.description||"",c=e.props&&e.props.length>0?e.props.map(G=>`<li>${G.label}: <strong>${G.value}</strong></li>`).join(""):"",g=`
        <div class="preview-block__header">
          <span class="preview-type">${e.type||"Bloc"}</span>
          <span class="preview-status">${e.status||""}</span>
        </div>
        <h3>${a}</h3>
        <p class="preview-desc">${r}</p>
        ${c?`<ul class="preview-props">
            ${c}
          </ul>`:""}
      `;switch(n){case"hero":return`<section class="preview-block preview-hero" data-preview-block="${e.id}">
            ${g}
            <button class="preview-cta">Appeler \xE0 l'action</button>
          </section>`;case"paragraphe":case"texte":return`<section class="preview-block preview-text" data-preview-block="${e.id}">${g}</section>`;case"image":return`<figure class="preview-block preview-image" data-preview-block="${e.id}">
            <div class="preview-image__media"></div>
            ${g}
          </figure>`;case"groupe":case"sections":case"grid":return`<section class="preview-block preview-group" data-preview-block="${e.id}">
            ${g}
            <div class="preview-group__rows">
              <div></div>
              <div></div>
              <div></div>
            </div>
          </section>`;default:return`<section class="preview-block" data-preview-block="${e.id}">${g}</section>`}},ut=e=>{let t=(e==null?void 0:e.title)||"Page",n=(e==null?void 0:e.blocks)||[],a=n.length>0?n.map((r,c)=>Yt(r,c)).join(""):`<section class="preview-block preview-empty" data-preview-block="none">
              <p>Ajoutez vos premiers blocs pour voir la preview se construire.</p>
            </section>`;return`<!DOCTYPE html>
      <html lang="fr">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <title>Pr\xE9visualisation \u2013 ${t}</title>
          <style>
            :root {
              font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              background-color: #f8fafc;
              color: #0f172a;
            }
            body {
              margin: 0;
              padding: 48px 24px 80px;
              background-color: #f8fafc;
              color: #0f172a;
            }
            .preview-page {
              max-width: 960px;
              margin: 0 auto;
              display: flex;
              flex-direction: column;
              gap: 24px;
            }
            .preview-block {
              border-radius: 24px;
              padding: 24px;
              border: 1px solid rgba(15, 23, 42, 0.08);
              background: white;
              box-shadow: 0 20px 30px rgba(15, 23, 42, 0.04);
              transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            }
            .preview-block h3 {
              margin: 4px 0 6px;
              font-size: 20px;
            }
            .preview-block p {
              margin: 0;
              font-size: 15px;
              color: #475569;
            }
            .preview-block__header {
              display: flex;
              align-items: center;
              gap: 12px;
              font-size: 12px;
              text-transform: uppercase;
              letter-spacing: 0.06em;
              color: #94a3b8;
            }
            .preview-type {
              padding: 2px 8px;
              border-radius: 999px;
              background: #f1f5f9;
              color: #475569;
            }
            .preview-status {
              color: #94a3b8;
            }
            .preview-block-active {
              border-color: rgba(156, 107, 255, 0.6) !important;
              background: rgba(156, 107, 255, 0.05);
              box-shadow: 0 0 0 1px rgba(156, 107, 255, 0.2);
            }
            .preview-hero {
              padding: 48px;
              text-align: center;
              background: linear-gradient(120deg, #ede9fe, #f8fafc);
            }
            .preview-hero h3 {
              font-size: 28px;
            }
            .preview-hero .preview-cta {
              margin-top: 16px;
              border: none;
              background: #9c6bff;
              color: white;
              font-weight: 600;
              padding: 12px 24px;
              border-radius: 999px;
            }
            .preview-image__media {
              width: 100%;
              height: 220px;
              border-radius: 20px;
              background: linear-gradient(130deg, #c084fc, #a855f7);
              margin-bottom: 16px;
              opacity: 0.8;
            }
            .preview-group__rows {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
              gap: 12px;
              margin-top: 16px;
            }
            .preview-group__rows div {
              height: 80px;
              border-radius: 16px;
              background: #f1f5f9;
            }
            .preview-props {
              margin: 12px 0 0;
              padding-left: 18px;
              color: #475569;
              font-size: 13px;
            }
            .preview-empty {
              text-align: center;
              border-style: dashed;
              border-color: rgba(15, 23, 42, 0.2);
              color: #64748b;
            }
          </style>
        </head>
        <body>
          <div class="preview-page">
            ${a}
          </div>
        </body>
      </html>`},pt=e=>{if(h){if(!e){h.classList.add("hidden");return}h.classList.remove("hidden"),h.textContent=e}},Zt=e=>{if(!f)return;let t=ut(e);Se=t,pt("Actualisation\u2026"),f.setAttribute("title",`Pr\xE9visualisation de la page ${(e==null?void 0:e.title)||""}`.trim()),f.srcdoc=t,Ue=!1},X=e=>{if(!f)return;let t=f.contentDocument;if(!t)return;t.querySelectorAll("[data-preview-block]").forEach(a=>{a.dataset.previewBlock===e?(a.classList.add("preview-block-active"),Ue&&e&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):a.classList.remove("preview-block-active")}),N&&(N.style.borderColor=e?"rgba(156, 107, 255, 0.5)":"transparent")},ze=e=>{if(!i)return;i.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(Q&&(Q.textContent=Ut(t.length)),t.length===0){i.classList.add("hidden"),H==null||H.classList.remove("hidden");return}i.classList.remove("hidden"),H==null||H.classList.add("hidden"),t.forEach(n=>{let a=n.id===x,r=document.createElement("div");r.dataset.blockItem="true",r.dataset.blockId=n.id,r.setAttribute("role","option"),r.setAttribute("aria-selected",a?"true":"false"),r.tabIndex=0,r.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition",a?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let c=document.createElement("span");c.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${a?"":"hidden"}`,r.appendChild(c);let g=document.createElement("div");g.className="flex flex-1 items-center gap-3";let G=document.createElement("div");G.className="hidden lg:flex cursor-grab flex-shrink-0 items-center text-lg text-slate-400",G.innerHTML="&#8801;",g.appendChild(G);let ke=document.createElement("div");ke.className="flex-1";let Le=document.createElement("div");Le.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let We=document.createElement("span");We.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",We.textContent=n.type;let Ke=document.createElement("span");Ke.className="text-slate-400",Ke.textContent=n.status,Le.appendChild(We),Le.appendChild(Ke);let Je=document.createElement("p");Je.className="mt-1 text-sm font-semibold text-slate-900",Je.textContent=n.label,ke.appendChild(Le),ke.appendChild(Je),g.appendChild(ke),r.appendChild(g);let Ce=document.createElement("div");Ce.className="flex flex-col gap-1 text-xs text-slate-400";let Ee=document.createElement("div");Ee.className="flex items-center gap-1 lg:hidden";let te=document.createElement("button");te.type="button",te.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",te.textContent="\u2191",te.addEventListener("click",F=>{F.stopPropagation(),ft(n.id,-1)});let se=document.createElement("button");se.type="button",se.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",se.textContent="\u2193",se.addEventListener("click",F=>{F.stopPropagation(),ft(n.id,1)}),Ee.appendChild(te),Ee.appendChild(se),Ce.appendChild(Ee);let ne=document.createElement("button");ne.type="button",ne.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",ne.innerHTML="\u{1F5D1}\uFE0F",ne.addEventListener("click",F=>{F.stopPropagation(),ns(n.id)}),Ce.appendChild(ne),r.appendChild(Ce),r.addEventListener("click",()=>{K(n.id)}),r.addEventListener("keydown",F=>{(F.key==="Enter"||F.key===" ")&&(F.preventDefault(),K(n.id))}),i.appendChild(r)})},mt=(e,t)=>{s.forEach(n=>{n.innerHTML="",e.forEach(a=>{let r=document.createElement("li"),c=document.createElement("button");c.type="button",c.dataset.pageId=a.id,c.className=["w-full flex items-center justify-between gap-3 px-3 py-2 text-left transition",t===a.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===a.id?c.setAttribute("aria-current","page"):c.removeAttribute("aria-current"),c.innerHTML=`
            <div class="flex items-center gap-3">
              <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
                </svg>
              </span>
              <div class="flex flex-col">
                <span class="text-sm font-semibold">${a.title}</span>
                <span class="text-xs text-slate-500">${a.slug}</span>
              </div>
            </div>
          `,c.addEventListener("click",()=>{U(a.id),Ve()||Re()}),r.appendChild(c),n.appendChild(r)})})},Qt=()=>!l||!Array.isArray(l.blocks)?null:l.blocks.find(e=>e.id===x)||null,K=e=>{if(!l)return;if(!e){x=null,ze(l),ve(null),X(null);return}let t=l.blocks.find(n=>n.id===e)||l.blocks[0]||null;x=(t==null?void 0:t.id)||null,ze(l),ve(t),X(x)},he=e=>{if(!l)return;let t={...l,blocks:e};as(t)},be=()=>window.matchMedia("(min-width: 1024px)").matches;function ft(e,t){if(!l||!e||!t)return;let n=[...l.blocks||[]],a=n.findIndex(g=>g.id===e);if(a<0)return;let r=a+t;if(r<0||r>=n.length)return;let[c]=n.splice(a,1);n.splice(r,0,c),he(n),U(l.id,{preserveBlock:!0}),K(c.id)}function Xt(e,t){if(!l||!e||!t||e===t)return;let n=[...l.blocks||[]],a=n.findIndex(g=>g.id===e),r=n.findIndex(g=>g.id===t);if(a<0||r<0)return;let[c]=n.splice(a,1);n.splice(r,0,c),he(n),U(l.id,{preserveBlock:!0}),K(c.id)}function gt(){if(!i)return;let e=be();i.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function we(){z&&(z.classList.add("hidden"),ee=!1)}function es(){z&&(z.classList.remove("hidden"),ee=!0)}function ts(){ee?we():es()}function ss(e){if(!l||!e)return;let t=zt[e];if(!t)return;let n=(l.blocks||[]).filter(c=>c.type===t.type).length+1,a=b(_e(l.id,e),`${t.label} ${n}`,t.type,t.status,t.description,t.props),r=[...l.blocks||[],a];he(r),U(l.id,{preserveBlock:!0}),K(a.id),we(),le("Bloc ajout\xE9")}function vt(e){var a,r;if(!l)return;let t=(l.blocks||[]).filter(c=>c.id!==e),n=e===x?((a=t[0])==null?void 0:a.id)||null:x||((r=t[0])==null?void 0:r.id)||null;he(t),x=n,U(l.id,{preserveBlock:!0}),x?K(x):(ve(null),X(null)),le("Bloc supprim\xE9")}function Oe(){q&&(q.classList.add("hidden"),q.classList.remove("flex"),ye=null)}function ns(e){if(!q){vt(e);return}ye=e,q.classList.remove("hidden"),q.classList.add("flex")}let as=e=>{e&&(k=k.map(t=>t.id===e.id?e:t),l=e,ct(k))},U=(e,t={})=>{var a,r;let n=k.find(c=>c.id===e)||k[0]||null;l=n,J=(n==null?void 0:n.id)||null,(!t.preserveBlock||!l||!l.blocks.some(c=>c.id===x))&&(x=((r=(a=l==null?void 0:l.blocks)==null?void 0:a[0])==null?void 0:r.id)||null),J&&Vt(J),mt(k,J),Kt(l),Jt(l),Zt(l),ze(l),ve(Qt()),X(x),gt(),ee&&we()},Ve=()=>window.matchMedia("(min-width: 1024px)").matches,ht=()=>{V&&(Ve()?(V.classList.add("is-open"),S==null||S.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):V.classList.remove("is-open"))},os=()=>{!V||Ve()||(V.classList.add("is-open"),S==null||S.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Re=()=>{V&&(V.classList.remove("is-open"),S==null||S.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},rs=()=>{!_||!R||(_.classList.remove("hidden"),R.classList.add("hidden"),P&&(P.textContent=""),xe=!1,A&&(A.value="",A.focus()),D&&(D.value=""))},bt=()=>{!_||!R||(_.classList.add("hidden"),R.classList.remove("hidden"),P&&(P.textContent=""),xe=!1,_.reset())},is=()=>{!A||!D||xe&&D.value.trim().length>0||(D.value=dt(A.value))},k=Ot(),J=Rt(k),xe=!1,l=null,x=null,ee=!1,ye=null,Se="",Ue=!1;mt(k,J),U(J),ht(),jt.forEach(e=>{e.addEventListener("click",os)}),Ht.forEach(e=>{e.addEventListener("click",Re)}),S==null||S.addEventListener("click",Re),window.addEventListener("resize",()=>{ht(),gt()}),R==null||R.addEventListener("click",rs),He==null||He.addEventListener("click",bt),A==null||A.addEventListener("input",is),D==null||D.addEventListener("input",()=>{P&&(P.textContent=""),xe=!0}),_==null||_.addEventListener("submit",e=>{if(e.preventDefault(),!A||!D)return;let t=A.value.trim(),n=dt(D.value.trim()||t);if(!t||!n){P&&(P.textContent="Titre et slug sont requis.");return}if(k.some(c=>c.slug===n)){P&&(P.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}let a=`page-${Date.now().toString(36)}`,r={id:a,title:t,slug:n,description:`Nouvelle page "${t}" pr\xEAte \xE0 \xEAtre maquett\xE9e.`,badges:["Layout","Texte"],blocks:Wt(a,t)};k=[...k,r],ct(k),bt(),U(r.id)}),I==null||I.addEventListener("click",e=>{e.stopPropagation(),ts()}),document.addEventListener("click",e=>{ee&&(z!=null&&z.contains(e.target)||I!=null&&I.contains(e.target)||we())}),Ft.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let n=e.dataset.blockAdd;ss(n)})}),Me==null||Me.addEventListener("click",()=>{Oe()}),Ie==null||Ie.addEventListener("click",()=>{ye&&vt(ye),Oe()}),q==null||q.addEventListener("click",e=>{e.target===q&&Oe()}),f==null||f.addEventListener("load",()=>{Ue=!0,pt("\xC0 jour"),X(x)}),p==null||p.addEventListener("click",()=>{Se||(Se=ut(l));let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Se),t.close()});let ls=e=>{let t=e.target.closest("[data-block-item]");!t||!be()||(M=t.dataset.blockId||null,M&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",M),t.classList.add("opacity-50")))},wt=()=>{i==null||i.querySelectorAll("[data-block-item]").forEach(e=>e.classList.remove("opacity-50","ring-2","ring-[#9C6BFF]/50"))},cs=()=>{M=null,wt()},ds=e=>{if(!M||!be())return;let t=e.target.closest("[data-block-item]");!t||t.dataset.blockId===M||(e.preventDefault(),t.classList.add("ring-2","ring-[#9C6BFF]/50"))},us=e=>{let t=e.target.closest("[data-block-item]");t&&t.classList.remove("ring-2","ring-[#9C6BFF]/50")},ps=e=>{if(!M||!be())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),n=M;M=null,wt();let a=(t==null?void 0:t.dataset.blockId)||null;a&&Xt(n,a)},M=null;i==null||i.addEventListener("dragstart",ls),i==null||i.addEventListener("dragend",cs),i==null||i.addEventListener("dragover",ds),i==null||i.addEventListener("dragleave",us),i==null||i.addEventListener("drop",ps)}});})();
