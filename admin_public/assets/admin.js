(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("[admin] Atelier charg\xE9");let Pe=document.querySelector("[data-logout]");Pe&&Pe.addEventListener("click",async()=>{Pe.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("[admin] Impossible de se d\xE9connecter",s)}finally{window.location.href="/admin/index.html"}});let Q=document.querySelector("[data-admin-sidebar]"),x=document.querySelector("[data-admin-sidebar-overlay]"),tt=document.querySelectorAll("[data-admin-sidebar-toggle]"),Bt=document.querySelectorAll("[data-admin-sidebar-close]"),De=document.body,de=!1,ue=()=>{if(!Q)return;if(window.matchMedia("(min-width: 1024px)").matches){Q.classList.remove("hidden"),x==null||x.classList.add("hidden"),De.classList.remove("overflow-hidden");return}de?(Q.classList.remove("hidden"),x==null||x.classList.remove("hidden"),De.classList.add("overflow-hidden")):(Q.classList.add("hidden"),x==null||x.classList.add("hidden"),De.classList.remove("overflow-hidden"))},At=()=>{de=!0,ue()},Te=()=>{de=!1,ue()};Q&&tt.length>0&&(tt.forEach(s=>{s.addEventListener("click",At)}),Bt.forEach(s=>{s.addEventListener("click",Te)}),x==null||x.addEventListener("click",Te),window.addEventListener("resize",ue),window.addEventListener("keydown",s=>{s.key==="Escape"&&de&&Te()}),ue());let nt="clower:currentSite",st="clower:currentSiteName",m={slug:null,name:""};(()=>{try{m.slug=window.localStorage.getItem(nt),m.name=window.localStorage.getItem(st)||""}catch{m.slug=null,m.name=""}})();let Ie=document.querySelectorAll("[data-site-card]"),Pt=document.querySelectorAll("[data-site-select]"),ee=document.querySelector("[data-current-site-name]"),at=document.querySelector("[data-workspace-site-name]"),ot=document.querySelector("[data-workspace-back-name]"),z=document.querySelector("[data-workspace-back-modal]"),Dt=document.querySelectorAll("[data-workspace-back]"),Tt=document.querySelectorAll("[data-workspace-back-cancel]"),Ne=document.querySelector("[data-workspace-back-confirm]"),It=document.querySelectorAll("[data-workspace-tab]"),Me=document.querySelector("[data-site-toast]"),rt=document.querySelector("[data-site-toast-message]"),Nt=document.querySelectorAll("[data-site-create]"),v=document.querySelector("[data-site-modal]"),N=document.querySelector("[data-site-form]"),C=document.querySelector("[data-site-name]"),q=document.querySelector("[data-site-slug]"),L=document.querySelector("[data-site-slug-error]"),B=document.querySelector("[data-site-modal-error]"),Mt=document.querySelectorAll("[data-site-modal-cancel]"),K=document.querySelector("[data-site-modal-submit]"),A=Ot(),pe=!1,me=null,Fe=null,Ft='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',it=s=>{if(!v||v.classList.contains("hidden")||s.key!=="Tab")return;let r=Array.from(v.querySelectorAll(Ft)).filter(h=>!h.hasAttribute("disabled")&&!h.getAttribute("aria-hidden"));if(r.length===0)return;let u=r[0],p=r[r.length-1];s.shiftKey?document.activeElement===u&&(s.preventDefault(),p.focus()):document.activeElement===p&&(s.preventDefault(),u.focus())},te=s=>{!Me||!rt||(rt.textContent=s,Me.classList.remove("hidden"),Fe&&clearTimeout(Fe),Fe=setTimeout(()=>{Me.classList.add("hidden")},2500))};function M(s){return s?s.startsWith("/")?s:`/${s}`:""}function fe(s){return(s==null?void 0:s.replace(/^\//,""))||""}let ge=(s,r)=>{let u=s?M(s):null;try{u&&(window.localStorage.setItem(nt,u),m.slug=u),typeof r=="string"&&r.length>0&&(window.localStorage.setItem(st,r),m.name=r)}catch{m.slug=u||m.slug,m.name=r||m.name}},lt=s=>{ee&&s&&(ee.textContent=s),at&&s&&(at.textContent=s),ot&&s&&(ot.textContent=s)},je=s=>{It.forEach(r=>{let u=r.dataset.workspaceTab;if(!u)return;if(!s){r.href="#",r.classList.add("pointer-events-none","opacity-50","text-slate-400"),r.setAttribute("aria-disabled","true");return}let p=encodeURIComponent(fe(s));r.href=`/admin/site/${p}/${u}`,r.classList.remove("pointer-events-none","opacity-50","text-slate-400"),r.removeAttribute("aria-disabled")})},he=(s,r={})=>{if(!s)return;let u=M(s),p=r.siteName||m.name||(ee==null?void 0:ee.dataset.defaultSiteName)||"";Ie.forEach(f=>{let F=M(f.dataset.siteCard||"")===u,c=f.querySelector("[data-site-active-badge]");F?(f.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),f.classList.remove("border-slate-200"),c==null||c.classList.remove("hidden"),p=f.dataset.siteName||p):(f.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),f.classList.add("border-slate-200"),c==null||c.classList.add("hidden"))}),r.persist!==!1&&ge(u,r.siteName||p);let h=r.siteName||p;lt(h),je(u)},jt=async(s,r)=>{let u=M(s);try{let p=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:u})});if(!p.ok){let c=await p.json().catch(()=>({}));te(c.message||"Impossible de s\xE9lectionner ce site.");return}let h=await p.json().catch(()=>({})),f=M(h.slug||u),b=h.name||r;ge(f,b),he(f,{siteName:b,persist:!1});let F=encodeURIComponent(fe(f));window.location.href=`/admin/site/${F}/design`}catch(p){console.error("[admin] Impossible de s\xE9lectionner le site",p),te("Erreur inattendue lors de la s\xE9lection.")}},$t=async()=>{try{let s=await fetch("/api/sites/current",{credentials:"same-origin"});if(!s.ok){s.status===404&&A&&(window.location.href="/admin/sites");return}let r=await s.json(),u=M(r.slug);ge(u,r.name),he(u,{siteName:r.name,persist:!1})}catch(s){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",s)}};(()=>{if(m.slug){he(m.slug,{siteName:m.name,persist:!1});return}let s=document.querySelector('[data-site-card][data-site-default="true"]')||Ie[0];s&&he(s.dataset.siteCard,{siteName:s.dataset.siteName||"",persist:!1})})(),$t(),A?je(A.slugValue):m.slug&&je(m.slug),Pt.forEach(s=>{s.addEventListener("click",()=>{if(s.disabled)return;let r=s.dataset.siteSelect,u=s.dataset.siteSelectName||"Ce site";r&&(s.disabled=!0,jt(r,u).finally(()=>{s.disabled=!1}))})});let ve=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),Ht=s=>{let r=ve(s||"");return r?`/${r}`:""},Vt=()=>{v&&(me=document.activeElement,v.classList.remove("hidden"),v.classList.add("flex"),pe=!1,N==null||N.reset(),L&&(L.textContent=""),B&&(B.textContent=""),q&&C&&(q.value=ve(C.value)),document.addEventListener("keydown",it),window.setTimeout(()=>{C==null||C.focus()},0))},be=()=>{v&&(v.classList.add("hidden"),v.classList.remove("flex"),document.removeEventListener("keydown",it),pe=!1,N==null||N.reset(),L&&(L.textContent=""),B&&(B.textContent=""),me==null||me.focus())};Nt.forEach(s=>{s.addEventListener("click",Vt)}),Mt.forEach(s=>{s.addEventListener("click",be)}),v==null||v.addEventListener("click",s=>{s.target===v&&be()}),C==null||C.addEventListener("input",()=>{q&&(!pe||q.value.trim().length===0)&&(q.value=ve(C.value))}),q==null||q.addEventListener("input",()=>{pe=!0,L&&(L.textContent="")});let zt=()=>new Set(Array.from(Ie).map(s=>M(s.dataset.siteCard||"")));N==null||N.addEventListener("submit",async s=>{if(s.preventDefault(),!C||!q)return;let r=(C.value||"").trim(),u=q.value||"";u||(u=r);let p=Ht(u);if(!r||!p){L&&(L.textContent="Nom et slug sont requis.");return}if(zt().has(p)){L&&(L.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}L&&(L.textContent=""),B&&(B.textContent=""),K&&(K.disabled=!0,K.textContent="Cr\xE9ation...");try{let f=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,slug:p})});if(!f.ok){let ne=await f.json().catch(()=>({})),j=ne.message||"Impossible de cr\xE9er ce site.";B&&(B.textContent=j),ne.field==="slug"&&L&&(L.textContent=j);return}let b=await f.json(),F=M((b==null?void 0:b.slug)||p),c=(b==null?void 0:b.name)||r;ge(F,c),be();let O=encodeURIComponent(fe(F));window.location.href=`/admin/site/${O}/design`}catch(f){console.error("[admin] Impossible de cr\xE9er le site",f),B&&(B.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{K&&(K.disabled=!1,K.textContent="Cr\xE9er")}}),window.addEventListener("keydown",s=>{s.key==="Escape"&&(v&&!v.classList.contains("hidden")&&be(),z&&!z.classList.contains("hidden")&&ct(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function Ot(){let s=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return s?{slugPart:decodeURIComponent(s[1]),slugValue:M(decodeURIComponent(s[1])),section:s[2]||"design"}:null}function Rt(){if(!z){window.location.href="/admin/sites";return}z.classList.remove("hidden"),z.classList.add("flex")}function ct(){z&&(z.classList.add("hidden"),z.classList.remove("flex"))}Dt.forEach(s=>{s.addEventListener("click",Rt)}),Tt.forEach(s=>{s.addEventListener("click",ct)}),Ne==null||Ne.addEventListener("click",()=>{window.location.href="/admin/sites"}),(A==null?void 0:A.section)==="design"&&Gt(),A&&m.name&&lt(m.name);function Gt(){let s=document.querySelectorAll("[data-page-list]");if(s.length===0)return;let r=document.querySelector("[data-active-page-title]"),u=document.querySelector("[data-active-page-slug]"),p=document.querySelector("[data-page-preview-tags]"),h=document.querySelector("[data-page-preview-frame]"),f=document.querySelector("[data-preview-open]"),b=document.querySelector("[data-preview-status]"),F=document.querySelector("[data-preview-highlight]"),c=document.querySelector("[data-blocks-list]"),O=document.querySelector("[data-blocks-empty]"),ne=document.querySelector("[data-block-count]"),j=document.querySelector("[data-block-library-toggle]"),U=document.querySelector("[data-block-library]"),Wt=document.querySelectorAll("[data-block-add]"),P=document.querySelector("[data-block-delete-modal]"),$e=document.querySelector("[data-block-delete-confirm]"),He=document.querySelector("[data-block-delete-cancel]"),Ve=document.querySelector("[data-block-detail-empty]"),R=document.querySelector("[data-block-detail-status]"),ye=document.querySelector("[data-block-editor]"),dt=document.querySelector("[data-block-editor-block-name]"),ut=document.querySelector("[data-block-editor-block-type]"),$=document.querySelector("[data-block-editor-unsupported]"),d=document.querySelector("[data-block-form]"),Ut=d?Array.from(d.querySelectorAll("[data-editor-section]")):[],ze=document.querySelector("[data-block-form-cancel]"),pt=d==null?void 0:d.querySelector("[data-group-preview-mobile]"),mt=d==null?void 0:d.querySelector("[data-group-preview-desktop]"),_t={hero:{section:"hero",labelField:"title",descriptionField:"subtitle",fields:{title:"hero-title",subtitle:"hero-subtitle",ctaLabel:"hero-cta-label",ctaUrl:"hero-cta-url",image:"hero-image",align:"hero-align"}},paragraphe:{section:"paragraph",labelField:"title",descriptionField:"content",fields:{title:"paragraph-title",content:"paragraph-content",align:"paragraph-align"}},image:{section:"image",labelField:"alt",fields:{src:"image-src",alt:"image-alt",showCaption:"image-caption-toggle",caption:"image-caption"}},groupe:{section:"group",fields:{layout:"group-layout",columnsMobile:"group-columns-mobile",columnsDesktop:"group-columns-desktop"}}},Jt={texte:"paragraphe",paragraph:"paragraphe",paragraphs:"paragraphe",paragraphes:"paragraphe",text:"paragraphe",hero:"hero",image:"image",groupe:"groupe",group:"groupe"},ft=(e,t)=>{if(!pt||!mt)return;let n=a=>Array.from({length:Number(a)||1}).map(()=>'<span class="block h-2 w-full rounded-full bg-slate-300"></span>').join("");pt.innerHTML=n(e),mt.innerHTML=n(t)},Yt=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),gt=e=>{if(!e)return null;let t=Yt(e.type),n=Jt[t]||t;return _t[n]||null},ht=e=>{var n,a;if(!d||!ye)return;e&&!e.settings&&(e.settings={});let t=gt(e);if(dt&&(dt.textContent=(e==null?void 0:e.label)||"Bloc"),ut&&(ut.textContent=(e==null?void 0:e.type)||"Bloc"),!t){d.classList.add("hidden"),$==null||$.classList.remove("hidden"),d.dataset.blockId="";return}if($==null||$.classList.add("hidden"),d.classList.remove("hidden"),d.reset(),d.dataset.blockId=e.id,Ut.forEach(o=>{o.dataset.editorSection===t.section?o.classList.remove("hidden"):o.classList.add("hidden")}),Object.entries(t.fields).forEach(([o,i])=>{var Y;let g=d.querySelector(`[name="${i}"]`);if(!g)return;let w=(Y=e.settings)==null?void 0:Y[o];g.type==="checkbox"?g.checked=!!w:(g.tagName,g.value=w!=null?w:"")}),t.section==="group"){let o=((n=d.querySelector('[name="group-columns-mobile"]'))==null?void 0:n.value)||"1",i=((a=d.querySelector('[name="group-columns-desktop"]'))==null?void 0:a.value)||"3";ft(o,i)}},Kt=e=>{if(!d||!e)return{};let t={};return Object.entries(e.fields).forEach(([n,a])=>{let o=d.querySelector(`[name="${a}"]`);o&&(o.type==="checkbox"?t[n]=o.checked:o.tagName==="TEXTAREA"?t[n]=o.value||"":o.type==="select-one"?t[n]=o.value:t[n]=o.value||"")}),t},Se=e=>{if(b){if(!e){b.classList.add("hidden");return}b.classList.remove("hidden"),b.textContent=e}},Xt=e=>e?{id:e.id,title:e.title,slug:e.slug,badges:[...e.badges||[]],blocks:(e.blocks||[]).map(t=>({id:t.id,type:t.type,label:t.label,status:t.status,description:t.description,props:t.props||[],settings:t.settings||{}}))}:null,Oe=()=>'<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#475569;background:#fff;">Pr\xE9paration de la pr\xE9visualisation\u2026</body></html>',Zt=e=>{if(!h||!e)return;let t={page:Xt(e),site:{title:m.name||"Site",slug:m.slug||""}};Xe=!1,Se("Actualisation\u2026"),h.srcdoc=Oe(),re&&re.abort();let n=new AbortController;re=n,fetch("/api/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:n.signal}).then(a=>{if(!a.ok)throw new Error("Preview error");return a.json()}).then(a=>{n.signal.aborted||(Ke=a.html||"",h.setAttribute("title",`Pr\xE9visualisation de la page ${e.title||""}`.trim()),h.srcdoc=Ke||Oe(),Se("\xC0 jour"))}).catch(a=>{n.signal.aborted||(console.error("[preview] Impossible de rendre la page",a),Se("Erreur preview"),h.srcdoc='<!DOCTYPE html><html><body style="font-family:Inter,sans-serif;padding:40px;color:#be123c;background:#fff;">Erreur lors du rendu de la pr\xE9visualisation.</body></html>')}).finally(()=>{re===n&&(re=null)})},Qt=e=>{if(e.preventDefault(),!l||!S)return;let t=Ue(),n=gt(t);if(!t||!n)return;let a=Kt(n),o=(l.blocks||[]).map(i=>{if(i.id!==t.id)return i;let g={...i.settings||{},...a},w={...i,settings:g};return n.labelField&&a[n.labelField]&&(w.label=a[n.labelField]),n.descriptionField&&a[n.descriptionField]&&(w.description=a[n.descriptionField]),w});ae(o),te("Bloc mis \xE0 jour"),W(l.id,{preserveBlock:!0})},_=document.querySelector("[data-page-drawer]"),k=document.querySelector("[data-page-drawer-backdrop]"),en=document.querySelectorAll("[data-page-drawer-open]"),tn=document.querySelectorAll("[data-page-drawer-close]"),J=document.querySelector("[data-add-page-toggle]"),G=document.querySelector("[data-add-page-form]"),D=document.querySelector("[data-add-page-title]"),T=document.querySelector("[data-add-page-slug]"),Re=document.querySelector("[data-add-page-cancel]"),I=document.querySelector("[data-add-page-error]"),vt=fe((A==null?void 0:A.slugValue)||m.slug||"default")||"default",we={pages:`clower:pages:${vt}`,active:`clower:activePage:${vt}`},y=(e,t,n,a,o,i=[],g={})=>({id:e,label:t,type:n,status:a,description:o,props:i,settings:{...g}}),nn=[{id:"home",title:"Accueil",slug:"/",description:"Hero immersif avec CTA, mise en avant des services et preuve sociale.",badges:["Hero","Services","CTA"],blocks:[y("home-hero","Hero principal","Hero","En ligne","Section immersive avec visuel plein \xE9cran et CTA principal.",[{label:"CTA",value:"Commencer"},{label:"Visuel",value:"Photo plein \xE9cran"}],{title:"Cr\xE9ez des exp\xE9riences m\xE9morables",subtitle:"Une \xE9quipe de designers pour construire vos pages en quelques minutes.",ctaLabel:"Commencer",ctaUrl:"#contact",image:"",align:"center"}),y("home-paragraph","Texte \xE9ditorial","Paragraphe","En ligne","Paragraphe d\u2019introduction.",[],{title:"Pitch \xE9ditorial",content:"Nous aidons les studios \xE0 cr\xE9er des exp\xE9riences immersives align\xE9es sur leur identit\xE9 de marque.",align:"left"}),y("home-group","Section services","Groupe","En ligne","Pr\xE9sentation synth\xE9tique des offres principales.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"services",title:"Services",slug:"/services",description:"D\xE9tail des offres avec mise en page \xE9ditoriale et appels \xE0 l\u2019action.",badges:["Offres","Storytelling","CTA"],blocks:[y("services-hero","Accroche services","Hero","En ligne","Section introductive d\xE9di\xE9e aux offres.",[],{title:"Des offres taill\xE9es pour vos \xE9quipes",subtitle:"Workshop de d\xE9marrage, design system personnalis\xE9, accompagnement \xE9ditorial continu.",ctaLabel:"Parler \xE0 un expert",ctaUrl:"#demo",image:"",align:"left"}),y("services-description","Description","Paragraphe","En ligne","Paragraphe d\xE9taillant la promesse.",[],{title:"Notre approche",content:"Chaque pack inclut un lead designer d\xE9di\xE9, des cycles courts et des revues en direct.",align:"left"}),y("services-layout","Layouts dynamiques","Groupe","En ligne","Cartes d\xE9taill\xE9es pour chaque service propos\xE9.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})]},{id:"realisations",title:"R\xE9alisations",slug:"/realisations",description:"S\xE9lection de projets r\xE9cents avec focus sur les r\xE9sultats.",badges:["Portfolio","Stats","Confiance"],blocks:[y("work-paragraph","Introduction portfolio","Paragraphe","En ligne","Intro du portfolio.",[],{title:"Nos r\xE9alisations",content:"Un aper\xE7u des exp\xE9riences livr\xE9es ces 12 derniers mois.",align:"center"}),y("work-image","Visuel signature","Image","En ligne","Image cl\xE9 d\u2019un projet.",[],{src:"",alt:"Visuel du projet phare",showCaption:!1,caption:""}),y("work-group","Grille de projets","Groupe","En ligne","Grille des projets r\xE9cents.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"contact",title:"Contact",slug:"/contact",description:"Formulaire de prise de contact simple et acc\xE8s aux coordonn\xE9es.",badges:["Formulaire","CTA","Infos"],blocks:[y("contact-hero","Hero contact","Hero","En ligne","Intro pour inciter \xE0 prendre contact.",[],{title:"Discutons de votre prochain projet",subtitle:"Partagez vos objectifs, nous proposons une approche personnalis\xE9e.",ctaLabel:"Planifier un call",ctaUrl:"#call",image:"",align:"center"}),y("contact-text","Informations pratiques","Paragraphe","En ligne","Texte practical.",[],{title:"Nous \xE9crire",content:"hello@clower.studio \xB7 +33 1 84 25 12 00 \xB7 Fuseau CET",align:"left"}),y("contact-image","Illustration","Image","En ligne","Illustration inspirante.",[],{src:"",alt:"Illustration \xE9quipe",showCaption:!0,caption:"Studio Clower, Paris"})]}],sn={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}],settings:{title:"Titre du hero",subtitle:"",ctaLabel:"D\xE9couvrir",ctaUrl:"#",image:"",align:"center"}},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}],settings:{title:"Titre du paragraphe",content:"",align:"left"}},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}],settings:{src:"",alt:"",showCaption:!1,caption:""}},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}],settings:{layout:"grid",columnsMobile:"1",columnsDesktop:"3"}}},bt=e=>e.map(t=>({...t,badges:[...t.badges||[]],blocks:(t.blocks||[]).map(n=>({...n,props:(n.props||[]).map(a=>({...a})),settings:{...n.settings||{}}}))})),an=()=>{try{let e=window.localStorage.getItem(we.pages);if(e){let t=JSON.parse(e);if(Array.isArray(t))return bt(t)}}catch{}return bt(nn)},yt=e=>{try{window.localStorage.setItem(we.pages,JSON.stringify(e))}catch{}},on=e=>{try{window.localStorage.setItem(we.active,e)}catch{}},rn=e=>{var t;try{let n=window.localStorage.getItem(we.active);if(n&&e.some(a=>a.id===n))return n}catch{}return((t=e[0])==null?void 0:t.id)||null},ln=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,St=e=>{if(!e||e==="/")return"/";let t=ve(e.replace(/^\//,""));return t?`/${t}`:"/"},Ge=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,cn=(e,t)=>[y(Ge(e,"intro"),"Introduction","Paragraphe","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}],{title:`Introduction \xE0 ${t}`,content:"Ajoutez votre premier paragraphe de pr\xE9sentation.",align:"left"}),y(Ge(e,"content"),"Zone de contenu","Groupe","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})],dn=e=>{r&&(r.textContent=(e==null?void 0:e.title)||"Page"),u&&(u.textContent=(e==null?void 0:e.slug)||"/")},un=e=>{if(!p)return;p.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(n=>{let a=document.createElement("span");a.className="rounded-full bg-slate-100 px-3 py-1",a.textContent=n,p.appendChild(a)})},pn=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},Le=e=>{if(!(!Ve||!ye)){if(!e){Ve.classList.remove("hidden"),ye.classList.add("hidden"),$==null||$.classList.add("hidden"),d==null||d.classList.add("hidden"),R==null||R.classList.add("hidden");return}Ve.classList.add("hidden"),ye.classList.remove("hidden"),R&&(e.status?(R.textContent=e.status,R.className=`rounded-full px-3 py-1 text-xs font-semibold ${pn(e.status)}`,R.classList.remove("hidden")):R.classList.add("hidden")),ht(e)}},se=e=>{if(!h)return;let t=h.contentDocument;if(!t)return;t.querySelectorAll("[data-preview-block]").forEach(a=>{a.dataset.previewBlock===e?(a.classList.add("preview-block-active"),Xe&&e&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):a.classList.remove("preview-block-active")}),F&&(F.style.borderColor=e?"rgba(156, 107, 255, 0.5)":"transparent")},We=e=>{if(!c)return;c.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(ne&&(ne.textContent=ln(t.length)),t.length===0){c.classList.add("hidden"),O==null||O.classList.remove("hidden");return}c.classList.remove("hidden"),O==null||O.classList.add("hidden"),t.forEach(n=>{let a=n.id===S,o=document.createElement("div");o.dataset.blockItem="true",o.dataset.blockId=n.id,o.setAttribute("role","option"),o.setAttribute("aria-selected",a?"true":"false"),o.tabIndex=0,o.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition",a?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let i=document.createElement("span");i.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${a?"":"hidden"}`,o.appendChild(i);let g=document.createElement("div");g.className="flex flex-1 items-center gap-3";let w=document.createElement("div");w.className="hidden lg:flex cursor-grab flex-shrink-0 items-center text-lg text-slate-400",w.innerHTML="&#8801;",g.appendChild(w);let Y=document.createElement("div");Y.className="flex-1";let qe=document.createElement("div");qe.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let Ze=document.createElement("span");Ze.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",Ze.textContent=n.type;let Qe=document.createElement("span");Qe.className="text-slate-400",Qe.textContent=n.status,qe.appendChild(Ze),qe.appendChild(Qe);let et=document.createElement("p");et.className="mt-1 text-sm font-semibold text-slate-900";let qn=n.settings&&n.settings.title||n.label||"Bloc sans titre";et.textContent=qn,Y.appendChild(qe),Y.appendChild(et),g.appendChild(Y),o.appendChild(g);let Be=document.createElement("div");Be.className="flex flex-col gap-1 text-xs text-slate-400";let Ae=document.createElement("div");Ae.className="flex items-center gap-1 lg:hidden";let ie=document.createElement("button");ie.type="button",ie.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",ie.textContent="\u2191",ie.addEventListener("click",V=>{V.stopPropagation(),Lt(n.id,-1)});let le=document.createElement("button");le.type="button",le.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",le.textContent="\u2193",le.addEventListener("click",V=>{V.stopPropagation(),Lt(n.id,1)}),Ae.appendChild(ie),Ae.appendChild(le),Be.appendChild(Ae);let ce=document.createElement("button");ce.type="button",ce.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",ce.innerHTML="\u{1F5D1}\uFE0F",ce.addEventListener("click",V=>{V.stopPropagation(),vn(n.id)}),Be.appendChild(ce),o.appendChild(Be),o.addEventListener("click",()=>{X(n.id)}),o.addEventListener("keydown",V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),X(n.id))}),c.appendChild(o)})},wt=(e,t)=>{s.forEach(n=>{n.innerHTML="",e.forEach(a=>{let o=document.createElement("li"),i=document.createElement("button");i.type="button",i.dataset.pageId=a.id,i.className=["w-full flex items-center justify-between gap-3 px-3 py-2 text-left transition",t===a.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===a.id?i.setAttribute("aria-current","page"):i.removeAttribute("aria-current"),i.innerHTML=`
            <div class="flex items-center gap-3">
              <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
                </svg>
              </span>
              <div class="flex flex-col">
                <span class="text-sm font-semibold">${a.title}</span>
                <span class="text-xs text-slate-500">${a.slug}</span>
              </div>
            </div>
          `,i.addEventListener("click",()=>{W(a.id),Je()||Ye()}),o.appendChild(i),n.appendChild(o)})})},Ue=()=>!l||!Array.isArray(l.blocks)?null:l.blocks.find(e=>e.id===S)||null,X=e=>{if(!l)return;if(!e){S=null,We(l),Le(null),se(null);return}let t=l.blocks.find(n=>n.id===e)||l.blocks[0]||null;S=(t==null?void 0:t.id)||null,We(l),Le(t),se(S)},ae=e=>{if(!l)return;let t={...l,blocks:e};bn(t)},xe=()=>window.matchMedia("(min-width: 1024px)").matches;function Lt(e,t){if(!l||!e||!t)return;let n=[...l.blocks||[]],a=n.findIndex(g=>g.id===e);if(a<0)return;let o=a+t;if(o<0||o>=n.length)return;let[i]=n.splice(a,1);n.splice(o,0,i),ae(n),W(l.id,{preserveBlock:!0}),X(i.id)}function mn(e,t){if(!l||!e||!t||e===t)return;let n=[...l.blocks||[]],a=n.findIndex(g=>g.id===e),o=n.findIndex(g=>g.id===t);if(a<0||o<0)return;let[i]=n.splice(a,1);n.splice(o,0,i),ae(n),W(l.id,{preserveBlock:!0}),X(i.id)}function xt(){if(!c)return;let e=xe();c.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function ke(){U&&(U.classList.add("hidden"),oe=!1)}function fn(){U&&(U.classList.remove("hidden"),oe=!0)}function gn(){oe?ke():fn()}function hn(e){if(!l||!e)return;let t=sn[e];if(!t)return;let n=(l.blocks||[]).filter(i=>i.type===t.type).length+1,a=y(Ge(l.id,e),`${t.label} ${n}`,t.type,t.status,t.description,t.props,t.settings||{}),o=[...l.blocks||[],a];ae(o),W(l.id,{preserveBlock:!0}),X(a.id),ke(),te("Bloc ajout\xE9")}function kt(e){var a,o;if(!l)return;let t=(l.blocks||[]).filter(i=>i.id!==e),n=e===S?((a=t[0])==null?void 0:a.id)||null:S||((o=t[0])==null?void 0:o.id)||null;ae(t),S=n,W(l.id,{preserveBlock:!0}),S?X(S):(Le(null),se(null)),te("Bloc supprim\xE9")}function _e(){P&&(P.classList.add("hidden"),P.classList.remove("flex"),Ce=null)}function vn(e){if(!P){kt(e);return}Ce=e,P.classList.remove("hidden"),P.classList.add("flex")}let bn=e=>{e&&(E=E.map(t=>t.id===e.id?e:t),l=e,yt(E))},W=(e,t={})=>{var a,o;let n=E.find(i=>i.id===e)||E[0]||null;l=n,Z=(n==null?void 0:n.id)||null,(!t.preserveBlock||!l||!l.blocks.some(i=>i.id===S))&&(S=((o=(a=l==null?void 0:l.blocks)==null?void 0:a[0])==null?void 0:o.id)||null),Z&&on(Z),wt(E,Z),dn(l),un(l),Zt(l),We(l),Le(Ue()),se(S),xt(),oe&&ke()},Je=()=>window.matchMedia("(min-width: 1024px)").matches,Et=()=>{_&&(Je()?(_.classList.add("is-open"),k==null||k.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):_.classList.remove("is-open"))},yn=()=>{!_||Je()||(_.classList.add("is-open"),k==null||k.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Ye=()=>{_&&(_.classList.remove("is-open"),k==null||k.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},Sn=()=>{!G||!J||(G.classList.remove("hidden"),J.classList.add("hidden"),I&&(I.textContent=""),Ee=!1,D&&(D.value="",D.focus()),T&&(T.value=""))},Ct=()=>{!G||!J||(G.classList.add("hidden"),J.classList.remove("hidden"),I&&(I.textContent=""),Ee=!1,G.reset())},wn=()=>{!D||!T||Ee&&T.value.trim().length>0||(T.value=St(D.value))},E=an(),Z=rn(E),Ee=!1,l=null,S=null,oe=!1,Ce=null,Ke="",Xe=!1,re=null;wt(E,Z),W(Z),Et(),en.forEach(e=>{e.addEventListener("click",yn)}),tn.forEach(e=>{e.addEventListener("click",Ye)}),k==null||k.addEventListener("click",Ye),window.addEventListener("resize",()=>{Et(),xt()}),J==null||J.addEventListener("click",Sn),Re==null||Re.addEventListener("click",Ct),D==null||D.addEventListener("input",wn),T==null||T.addEventListener("input",()=>{I&&(I.textContent=""),Ee=!0}),G==null||G.addEventListener("submit",e=>{if(e.preventDefault(),!D||!T)return;let t=D.value.trim(),n=St(T.value.trim()||t);if(!t||!n){I&&(I.textContent="Titre et slug sont requis.");return}if(E.some(i=>i.slug===n)){I&&(I.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}let a=`page-${Date.now().toString(36)}`,o={id:a,title:t,slug:n,description:`Nouvelle page "${t}" pr\xEAte \xE0 \xEAtre maquett\xE9e.`,badges:["Layout","Texte"],blocks:cn(a,t)};E=[...E,o],yt(E),Ct(),W(o.id)}),j==null||j.addEventListener("click",e=>{e.stopPropagation(),gn()}),document.addEventListener("click",e=>{oe&&(U!=null&&U.contains(e.target)||j!=null&&j.contains(e.target)||ke())}),Wt.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let n=e.dataset.blockAdd;hn(n)})}),He==null||He.addEventListener("click",()=>{_e()}),$e==null||$e.addEventListener("click",()=>{Ce&&kt(Ce),_e()}),P==null||P.addEventListener("click",e=>{e.target===P&&_e()}),d==null||d.addEventListener("input",e=>{var n,a;let t=e.target;if(!(!t||!t.name)&&(t.name==="group-columns-mobile"||t.name==="group-columns-desktop")){let o=((n=d.querySelector('[name="group-columns-mobile"]'))==null?void 0:n.value)||"1",i=((a=d.querySelector('[name="group-columns-desktop"]'))==null?void 0:a.value)||"3";ft(o,i)}}),d==null||d.addEventListener("submit",Qt),ze==null||ze.addEventListener("click",e=>{e.preventDefault();let t=Ue();t&&ht(t)}),h==null||h.addEventListener("load",()=>{Xe=!0,Se("\xC0 jour"),se(S)}),f==null||f.addEventListener("click",()=>{let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Ke||Oe()),t.close()});let Ln=e=>{let t=e.target.closest("[data-block-item]");!t||!xe()||(H=t.dataset.blockId||null,H&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",H),t.classList.add("opacity-50")))},qt=()=>{c==null||c.querySelectorAll("[data-block-item]").forEach(e=>e.classList.remove("opacity-50","ring-2","ring-[#9C6BFF]/50"))},xn=()=>{H=null,qt()},kn=e=>{if(!H||!xe())return;let t=e.target.closest("[data-block-item]");!t||t.dataset.blockId===H||(e.preventDefault(),t.classList.add("ring-2","ring-[#9C6BFF]/50"))},En=e=>{let t=e.target.closest("[data-block-item]");t&&t.classList.remove("ring-2","ring-[#9C6BFF]/50")},Cn=e=>{if(!H||!xe())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),n=H;H=null,qt();let a=(t==null?void 0:t.dataset.blockId)||null;a&&mn(n,a)},H=null;c==null||c.addEventListener("dragstart",Ln),c==null||c.addEventListener("dragend",xn),c==null||c.addEventListener("dragover",kn),c==null||c.addEventListener("dragleave",En),c==null||c.addEventListener("drop",Cn)}});})();
