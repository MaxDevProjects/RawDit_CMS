(()=>{document.addEventListener("DOMContentLoaded",()=>{console.log("[admin] Atelier charg\xE9");let Ae=document.querySelector("[data-logout]");Ae&&Ae.addEventListener("click",async()=>{Ae.disabled=!0;try{await fetch("/api/logout",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("[admin] Impossible de se d\xE9connecter",s)}finally{window.location.href="/admin/index.html"}});let ee=document.querySelector("[data-admin-sidebar]"),k=document.querySelector("[data-admin-sidebar-overlay]"),Ze=document.querySelectorAll("[data-admin-sidebar-toggle]"),Lt=document.querySelectorAll("[data-admin-sidebar-close]"),$e=document.body,de=!1,ue=()=>{if(!ee)return;if(window.matchMedia("(min-width: 1024px)").matches){ee.classList.remove("hidden"),k==null||k.classList.add("hidden"),$e.classList.remove("overflow-hidden");return}de?(ee.classList.remove("hidden"),k==null||k.classList.remove("hidden"),$e.classList.add("overflow-hidden")):(ee.classList.add("hidden"),k==null||k.classList.add("hidden"),$e.classList.remove("overflow-hidden"))},Ct=()=>{de=!0,ue()},De=()=>{de=!1,ue()};ee&&Ze.length>0&&(Ze.forEach(s=>{s.addEventListener("click",Ct)}),Lt.forEach(s=>{s.addEventListener("click",De)}),k==null||k.addEventListener("click",De),window.addEventListener("resize",ue),window.addEventListener("keydown",s=>{s.key==="Escape"&&de&&De()}),ue());let Qe="clower:currentSite",et="clower:currentSiteName",g={slug:null,name:""};(()=>{try{g.slug=window.localStorage.getItem(Qe),g.name=window.localStorage.getItem(et)||""}catch{g.slug=null,g.name=""}})();let Ie=document.querySelectorAll("[data-site-card]"),Et=document.querySelectorAll("[data-site-select]"),te=document.querySelector("[data-current-site-name]"),tt=document.querySelector("[data-workspace-site-name]"),st=document.querySelector("[data-workspace-back-name]"),V=document.querySelector("[data-workspace-back-modal]"),Bt=document.querySelectorAll("[data-workspace-back]"),qt=document.querySelectorAll("[data-workspace-back-cancel]"),Te=document.querySelector("[data-workspace-back-confirm]"),At=document.querySelectorAll("[data-workspace-tab]"),Pe=document.querySelector("[data-site-toast]"),nt=document.querySelector("[data-site-toast-message]"),$t=document.querySelectorAll("[data-site-create]"),v=document.querySelector("[data-site-modal]"),N=document.querySelector("[data-site-form]"),B=document.querySelector("[data-site-name]"),q=document.querySelector("[data-site-slug]"),x=document.querySelector("[data-site-slug-error]"),A=document.querySelector("[data-site-modal-error]"),Dt=document.querySelectorAll("[data-site-modal-cancel]"),Y=document.querySelector("[data-site-modal-submit]"),$=jt(),pe=!1,me=null,Ne=null,It='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])',at=s=>{if(!v||v.classList.contains("hidden")||s.key!=="Tab")return;let i=Array.from(v.querySelectorAll(It)).filter(f=>!f.hasAttribute("disabled")&&!f.getAttribute("aria-hidden"));if(i.length===0)return;let d=i[0],u=i[i.length-1];s.shiftKey?document.activeElement===d&&(s.preventDefault(),u.focus()):document.activeElement===u&&(s.preventDefault(),d.focus())},se=s=>{!Pe||!nt||(nt.textContent=s,Pe.classList.remove("hidden"),Ne&&clearTimeout(Ne),Ne=setTimeout(()=>{Pe.classList.add("hidden")},2500))};function F(s){return s?s.startsWith("/")?s:`/${s}`:""}function ge(s){return(s==null?void 0:s.replace(/^\//,""))||""}let fe=(s,i)=>{let d=s?F(s):null;try{d&&(window.localStorage.setItem(Qe,d),g.slug=d),typeof i=="string"&&i.length>0&&(window.localStorage.setItem(et,i),g.name=i)}catch{g.slug=d||g.slug,g.name=i||g.name}},ot=s=>{te&&s&&(te.textContent=s),tt&&s&&(tt.textContent=s),st&&s&&(st.textContent=s)},Fe=s=>{At.forEach(i=>{let d=i.dataset.workspaceTab;if(!d)return;if(!s){i.href="#",i.classList.add("pointer-events-none","opacity-50","text-slate-400"),i.setAttribute("aria-disabled","true");return}let u=encodeURIComponent(ge(s));i.href=`/admin/site/${u}/${d}`,i.classList.remove("pointer-events-none","opacity-50","text-slate-400"),i.removeAttribute("aria-disabled")})},he=(s,i={})=>{if(!s)return;let d=F(s),u=i.siteName||g.name||(te==null?void 0:te.dataset.defaultSiteName)||"";Ie.forEach(p=>{let M=F(p.dataset.siteCard||"")===d,c=p.querySelector("[data-site-active-badge]");M?(p.classList.add("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.remove("border-slate-200"),c==null||c.classList.remove("hidden"),u=p.dataset.siteName||u):(p.classList.remove("border-[#9C6BFF]","ring-2","ring-[#9C6BFF]","shadow-md"),p.classList.add("border-slate-200"),c==null||c.classList.add("hidden"))}),i.persist!==!1&&fe(d,i.siteName||u);let f=i.siteName||u;ot(f),Fe(d)},Tt=async(s,i)=>{let d=F(s);try{let u=await fetch("/api/sites/select",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slug:d})});if(!u.ok){let c=await u.json().catch(()=>({}));se(c.message||"Impossible de s\xE9lectionner ce site.");return}let f=await u.json().catch(()=>({})),p=F(f.slug||d),b=f.name||i;fe(p,b),he(p,{siteName:b,persist:!1});let M=encodeURIComponent(ge(p));window.location.href=`/admin/site/${M}/design`}catch(u){console.error("[admin] Impossible de s\xE9lectionner le site",u),se("Erreur inattendue lors de la s\xE9lection.")}},Pt=async()=>{try{let s=await fetch("/api/sites/current",{credentials:"same-origin"});if(!s.ok){s.status===404&&$&&(window.location.href="/admin/sites");return}let i=await s.json(),d=F(i.slug);fe(d,i.name),he(d,{siteName:i.name,persist:!1})}catch(s){console.warn("[admin] Impossible de r\xE9cup\xE9rer le site actif",s)}};(()=>{if(g.slug){he(g.slug,{siteName:g.name,persist:!1});return}let s=document.querySelector('[data-site-card][data-site-default="true"]')||Ie[0];s&&he(s.dataset.siteCard,{siteName:s.dataset.siteName||"",persist:!1})})(),Pt(),$?Fe($.slugValue):g.slug&&Fe(g.slug),Et.forEach(s=>{s.addEventListener("click",()=>{if(s.disabled)return;let i=s.dataset.siteSelect,d=s.dataset.siteSelectName||"Ce site";i&&(s.disabled=!0,Tt(i,d).finally(()=>{s.disabled=!1}))})});let ve=s=>s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),Nt=s=>{let i=ve(s||"");return i?`/${i}`:""},Ft=()=>{v&&(me=document.activeElement,v.classList.remove("hidden"),v.classList.add("flex"),pe=!1,N==null||N.reset(),x&&(x.textContent=""),A&&(A.textContent=""),q&&B&&(q.value=ve(B.value)),document.addEventListener("keydown",at),window.setTimeout(()=>{B==null||B.focus()},0))},be=()=>{v&&(v.classList.add("hidden"),v.classList.remove("flex"),document.removeEventListener("keydown",at),pe=!1,N==null||N.reset(),x&&(x.textContent=""),A&&(A.textContent=""),me==null||me.focus())};$t.forEach(s=>{s.addEventListener("click",Ft)}),Dt.forEach(s=>{s.addEventListener("click",be)}),v==null||v.addEventListener("click",s=>{s.target===v&&be()}),B==null||B.addEventListener("input",()=>{q&&(!pe||q.value.trim().length===0)&&(q.value=ve(B.value))}),q==null||q.addEventListener("input",()=>{pe=!0,x&&(x.textContent="")});let Mt=()=>new Set(Array.from(Ie).map(s=>F(s.dataset.siteCard||"")));N==null||N.addEventListener("submit",async s=>{if(s.preventDefault(),!B||!q)return;let i=(B.value||"").trim(),d=q.value||"";d||(d=i);let u=Nt(d);if(!i||!u){x&&(x.textContent="Nom et slug sont requis.");return}if(Mt().has(u)){x&&(x.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}x&&(x.textContent=""),A&&(A.textContent=""),Y&&(Y.disabled=!0,Y.textContent="Cr\xE9ation...");try{let p=await fetch("/api/sites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,slug:u})});if(!p.ok){let ne=await p.json().catch(()=>({})),j=ne.message||"Impossible de cr\xE9er ce site.";A&&(A.textContent=j),ne.field==="slug"&&x&&(x.textContent=j);return}let b=await p.json(),M=F((b==null?void 0:b.slug)||u),c=(b==null?void 0:b.name)||i;fe(M,c),be();let O=encodeURIComponent(ge(M));window.location.href=`/admin/site/${O}/design`}catch(p){console.error("[admin] Impossible de cr\xE9er le site",p),A&&(A.textContent="Erreur inattendue. R\xE9essaie dans un instant.")}finally{Y&&(Y.disabled=!1,Y.textContent="Cr\xE9er")}}),window.addEventListener("keydown",s=>{s.key==="Escape"&&(v&&!v.classList.contains("hidden")&&be(),V&&!V.classList.contains("hidden")&&rt(),blockDeleteModal&&!blockDeleteModal.classList.contains("hidden")&&closeBlockDeleteModal(),blockLibraryOpen&&closeBlockLibrary())});function jt(){let s=window.location.pathname.match(/^\/admin\/site\/([^/]+)(?:\/([^/]+))?/);return s?{slugPart:decodeURIComponent(s[1]),slugValue:F(decodeURIComponent(s[1])),section:s[2]||"design"}:null}function zt(){if(!V){window.location.href="/admin/sites";return}V.classList.remove("hidden"),V.classList.add("flex")}function rt(){V&&(V.classList.add("hidden"),V.classList.remove("flex"))}Bt.forEach(s=>{s.addEventListener("click",zt)}),qt.forEach(s=>{s.addEventListener("click",rt)}),Te==null||Te.addEventListener("click",()=>{window.location.href="/admin/sites"}),($==null?void 0:$.section)==="design"&&Ht(),$&&g.name&&ot(g.name);function Ht(){let s=document.querySelectorAll("[data-page-list]");if(s.length===0)return;let i=document.querySelector("[data-active-page-title]"),d=document.querySelector("[data-active-page-slug]"),u=document.querySelector("[data-page-preview-tags]"),f=document.querySelector("[data-page-preview-frame]"),p=document.querySelector("[data-preview-open]"),b=document.querySelector("[data-preview-status]"),M=document.querySelector("[data-preview-highlight]"),c=document.querySelector("[data-blocks-list]"),O=document.querySelector("[data-blocks-empty]"),ne=document.querySelector("[data-block-count]"),j=document.querySelector("[data-block-library-toggle]"),G=document.querySelector("[data-block-library]"),_t=document.querySelectorAll("[data-block-add]"),D=document.querySelector("[data-block-delete-modal]"),Me=document.querySelector("[data-block-delete-confirm]"),je=document.querySelector("[data-block-delete-cancel]"),ze=document.querySelector("[data-block-detail-empty]"),R=document.querySelector("[data-block-detail-status]"),we=document.querySelector("[data-block-editor]"),it=document.querySelector("[data-block-editor-block-name]"),lt=document.querySelector("[data-block-editor-block-type]"),z=document.querySelector("[data-block-editor-unsupported]"),h=document.querySelector("[data-block-form]"),Vt=h?Array.from(h.querySelectorAll("[data-editor-section]")):[],He=document.querySelector("[data-block-form-cancel]"),Ot={hero:{section:"hero",labelField:"title",descriptionField:"subtitle",fields:{title:"hero-title",subtitle:"hero-subtitle",ctaLabel:"hero-cta-label",ctaUrl:"hero-cta-url",image:"hero-image",align:"hero-align"}},paragraphe:{section:"paragraph",labelField:"title",descriptionField:"content",fields:{title:"paragraph-title",content:"paragraph-content",align:"paragraph-align"}},image:{section:"image",labelField:"alt",fields:{src:"image-src",alt:"image-alt",showCaption:"image-caption-toggle",caption:"image-caption"}},groupe:{section:"group",fields:{layout:"group-layout",columnsMobile:"group-columns-mobile",columnsDesktop:"group-columns-desktop"}}},Rt={texte:"paragraphe",paragraph:"paragraphe",paragraphs:"paragraphe",paragraphes:"paragraphe",text:"paragraphe",hero:"hero",image:"image",groupe:"groupe",group:"groupe"},Ut=e=>(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),ct=e=>{if(!e)return null;let t=Ut(e.type),n=Rt[t]||t;return Ot[n]||null},dt=e=>{if(!h||!we)return;e&&!e.settings&&(e.settings={});let t=ct(e);if(it&&(it.textContent=(e==null?void 0:e.label)||"Bloc"),lt&&(lt.textContent=(e==null?void 0:e.type)||"Bloc"),!t){h.classList.add("hidden"),z==null||z.classList.remove("hidden"),h.dataset.blockId="";return}z==null||z.classList.add("hidden"),h.classList.remove("hidden"),h.reset(),h.dataset.blockId=e.id,Vt.forEach(n=>{n.dataset.editorSection===t.section?n.classList.remove("hidden"):n.classList.add("hidden")}),Object.entries(t.fields).forEach(([n,a])=>{var m;let o=h.querySelector(`[name="${a}"]`);if(!o)return;let r=(m=e.settings)==null?void 0:m[n];o.type==="checkbox"?o.checked=!!r:(o.tagName,o.value=r!=null?r:"")})},Wt=e=>{if(!h||!e)return{};let t={};return Object.entries(e.fields).forEach(([n,a])=>{let o=h.querySelector(`[name="${a}"]`);o&&(o.type==="checkbox"?t[n]=o.checked:o.tagName==="TEXTAREA"?t[n]=o.value||"":o.type==="select-one"?t[n]=o.value:t[n]=o.value||"")}),t},Gt=e=>{if(e.preventDefault(),!l||!y)return;let t=Re(),n=ct(t);if(!t||!n)return;let a=Wt(n),o=(l.blocks||[]).map(r=>{if(r.id!==t.id)return r;let m={...r.settings||{},...a},S={...r,settings:m};return n.labelField&&a[n.labelField]&&(S.label=a[n.labelField]),n.descriptionField&&a[n.descriptionField]&&(S.description=a[n.descriptionField]),S});oe(o),se("Bloc mis \xE0 jour"),W(l.id,{preserveBlock:!0})},J=document.querySelector("[data-page-drawer]"),L=document.querySelector("[data-page-drawer-backdrop]"),Jt=document.querySelectorAll("[data-page-drawer-open]"),Kt=document.querySelectorAll("[data-page-drawer-close]"),K=document.querySelector("[data-add-page-toggle]"),U=document.querySelector("[data-add-page-form]"),I=document.querySelector("[data-add-page-title]"),T=document.querySelector("[data-add-page-slug]"),_e=document.querySelector("[data-add-page-cancel]"),P=document.querySelector("[data-add-page-error]"),ut=ge(($==null?void 0:$.slugValue)||g.slug||"default")||"default",ye={pages:`clower:pages:${ut}`,active:`clower:activePage:${ut}`},w=(e,t,n,a,o,r=[],m={})=>({id:e,label:t,type:n,status:a,description:o,props:r,settings:{...m}}),Yt=[{id:"home",title:"Accueil",slug:"/",description:"Hero immersif avec CTA, mise en avant des services et preuve sociale.",badges:["Hero","Services","CTA"],blocks:[w("home-hero","Hero principal","Hero","En ligne","Section immersive avec visuel plein \xE9cran et CTA principal.",[{label:"CTA",value:"Commencer"},{label:"Visuel",value:"Photo plein \xE9cran"}],{title:"Cr\xE9ez des exp\xE9riences m\xE9morables",subtitle:"Une \xE9quipe de designers pour construire vos pages en quelques minutes.",ctaLabel:"Commencer",ctaUrl:"#contact",image:"",align:"center"}),w("home-paragraph","Texte \xE9ditorial","Paragraphe","En ligne","Paragraphe d\u2019introduction.",[],{title:"Pitch \xE9ditorial",content:"Nous aidons les studios \xE0 cr\xE9er des exp\xE9riences immersives align\xE9es sur leur identit\xE9 de marque.",align:"left"}),w("home-group","Section services","Groupe","En ligne","Pr\xE9sentation synth\xE9tique des offres principales.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"services",title:"Services",slug:"/services",description:"D\xE9tail des offres avec mise en page \xE9ditoriale et appels \xE0 l\u2019action.",badges:["Offres","Storytelling","CTA"],blocks:[w("services-hero","Accroche services","Hero","En ligne","Section introductive d\xE9di\xE9e aux offres.",[],{title:"Des offres taill\xE9es pour vos \xE9quipes",subtitle:"Workshop de d\xE9marrage, design system personnalis\xE9, accompagnement \xE9ditorial continu.",ctaLabel:"Parler \xE0 un expert",ctaUrl:"#demo",image:"",align:"left"}),w("services-description","Description","Paragraphe","En ligne","Paragraphe d\xE9taillant la promesse.",[],{title:"Notre approche",content:"Chaque pack inclut un lead designer d\xE9di\xE9, des cycles courts et des revues en direct.",align:"left"}),w("services-layout","Layouts dynamiques","Groupe","En ligne","Cartes d\xE9taill\xE9es pour chaque service propos\xE9.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})]},{id:"realisations",title:"R\xE9alisations",slug:"/realisations",description:"S\xE9lection de projets r\xE9cents avec focus sur les r\xE9sultats.",badges:["Portfolio","Stats","Confiance"],blocks:[w("work-paragraph","Introduction portfolio","Paragraphe","En ligne","Intro du portfolio.",[],{title:"Nos r\xE9alisations",content:"Un aper\xE7u des exp\xE9riences livr\xE9es ces 12 derniers mois.",align:"center"}),w("work-image","Visuel signature","Image","En ligne","Image cl\xE9 d\u2019un projet.",[],{src:"",alt:"Visuel du projet phare",showCaption:!1,caption:""}),w("work-group","Grille de projets","Groupe","En ligne","Grille des projets r\xE9cents.",[],{layout:"grid",columnsMobile:"1",columnsDesktop:"3"})]},{id:"contact",title:"Contact",slug:"/contact",description:"Formulaire de prise de contact simple et acc\xE8s aux coordonn\xE9es.",badges:["Formulaire","CTA","Infos"],blocks:[w("contact-hero","Hero contact","Hero","En ligne","Intro pour inciter \xE0 prendre contact.",[],{title:"Discutons de votre prochain projet",subtitle:"Partagez vos objectifs, nous proposons une approche personnalis\xE9e.",ctaLabel:"Planifier un call",ctaUrl:"#call",image:"",align:"center"}),w("contact-text","Informations pratiques","Paragraphe","En ligne","Texte practical.",[],{title:"Nous \xE9crire",content:"hello@clower.studio \xB7 +33 1 84 25 12 00 \xB7 Fuseau CET",align:"left"}),w("contact-image","Illustration","Image","En ligne","Illustration inspirante.",[],{src:"",alt:"Illustration \xE9quipe",showCaption:!0,caption:"Studio Clower, Paris"})]}],Xt={hero:{type:"Hero",label:"Hero de page",description:"Section pleine largeur avec CTA principal.",status:"Brouillon",props:[{label:"CTA",value:"D\xE9couvrir"},{label:"Hauteur",value:"80vh"}],settings:{title:"Titre du hero",subtitle:"",ctaLabel:"D\xE9couvrir",ctaUrl:"#",image:"",align:"center"}},paragraph:{type:"Paragraphe",label:"Bloc \xE9ditorial",description:"Paragraphe libre pour raconter votre histoire.",status:"Brouillon",props:[{label:"Longueur",value:"150 mots"}],settings:{title:"Titre du paragraphe",content:"",align:"left"}},image:{type:"Image",label:"Bloc image",description:"Visuel seul avec l\xE9gende optionnelle.",status:"Brouillon",props:[{label:"Ratio",value:"16:9"},{label:"L\xE9gende",value:"Inactive"}],settings:{src:"",alt:"",showCaption:!1,caption:""}},group:{type:"Groupe",label:"Groupe de sections",description:"Conteneur pour imbriquer plusieurs sous-blocs.",status:"Brouillon",props:[{label:"Disposition",value:"Verticale"}],settings:{layout:"grid",columnsMobile:"1",columnsDesktop:"3"}}},pt=e=>e.map(t=>({...t,badges:[...t.badges||[]],blocks:(t.blocks||[]).map(n=>({...n,props:(n.props||[]).map(a=>({...a})),settings:{...n.settings||{}}}))})),Zt=()=>{try{let e=window.localStorage.getItem(ye.pages);if(e){let t=JSON.parse(e);if(Array.isArray(t))return pt(t)}}catch{}return pt(Yt)},mt=e=>{try{window.localStorage.setItem(ye.pages,JSON.stringify(e))}catch{}},Qt=e=>{try{window.localStorage.setItem(ye.active,e)}catch{}},es=e=>{var t;try{let n=window.localStorage.getItem(ye.active);if(n&&e.some(a=>a.id===n))return n}catch{}return((t=e[0])==null?void 0:t.id)||null},ts=e=>!e||e<=0?"0 bloc":e===1?"1 bloc":`${e} blocs`,gt=e=>{if(!e||e==="/")return"/";let t=ve(e.replace(/^\//,""));return t?`/${t}`:"/"},Ve=(e="page",t="block")=>`${e}-${t}-${Date.now().toString(36)}-${Math.floor(Math.random()*1e3)}`,ss=(e,t)=>[w(Ve(e,"intro"),"Introduction","Paragraphe","Brouillon",`Paragraphe introductif pour "${t}".`,[{label:"Longueur",value:"2 paragraphes"}],{title:`Introduction \xE0 ${t}`,content:"Ajoutez votre premier paragraphe de pr\xE9sentation.",align:"left"}),w(Ve(e,"content"),"Zone de contenu","Groupe","Brouillon","Section principale \xE0 composer avec textes et visuels.",[{label:"Colonnes",value:"Auto"}],{layout:"grid",columnsMobile:"1",columnsDesktop:"2"})],ns=e=>{i&&(i.textContent=(e==null?void 0:e.title)||"Page"),d&&(d.textContent=(e==null?void 0:e.slug)||"/")},as=e=>{if(!u)return;u.innerHTML="",(e&&e.badges&&e.badges.length>0?e.badges:["Structure en cours"]).forEach(n=>{let a=document.createElement("span");a.className="rounded-full bg-slate-100 px-3 py-1",a.textContent=n,u.appendChild(a)})},os=e=>{switch((e||"").toLowerCase()){case"en ligne":return"bg-emerald-50 text-emerald-700";case"brouillon":return"bg-amber-50 text-amber-700";default:return"bg-slate-100 text-slate-600"}},xe=e=>{if(!(!ze||!we)){if(!e){ze.classList.remove("hidden"),we.classList.add("hidden"),z==null||z.classList.add("hidden"),h==null||h.classList.add("hidden"),R==null||R.classList.add("hidden");return}ze.classList.add("hidden"),we.classList.remove("hidden"),R&&(e.status?(R.textContent=e.status,R.className=`rounded-full px-3 py-1 text-xs font-semibold ${os(e.status)}`,R.classList.remove("hidden")):R.classList.add("hidden")),dt(e)}},rs=(e,t)=>{let n=(e.type||"").toLowerCase(),a=e.settings||{},o=a.title||e.label||`Bloc ${t+1}`,r=a.subtitle||a.content||e.description||"",m=e.props&&e.props.length>0?e.props.map(E=>`<li>${E.label}: <strong>${E.value}</strong></li>`).join(""):"",S=`
        <div class="preview-block__header">
          <span class="preview-type">${e.type||"Bloc"}</span>
          <span class="preview-status">${e.status||""}</span>
        </div>
        <h3>${o}</h3>
        <p class="preview-desc">${r}</p>
        ${m?`<ul class="preview-props">
            ${m}
          </ul>`:""}
      `;switch(n){case"hero":return`<section class="preview-block ${a.align==="left"?"preview-hero align-left":a.align==="right"?"preview-hero align-right":"preview-hero"}" data-preview-block="${e.id}">
            ${S}
            <button class="preview-cta">${a.ctaLabel||"D\xE9couvrir"}</button>
          </section>`;case"paragraphe":case"texte":{let E=a.align||"left";return`<section class="preview-block preview-text" data-preview-block="${e.id}" style="text-align:${E};">
            ${S}
          </section>`}case"image":{let E=a.src?`style="background-image:url('${a.src}');"`:"",Q=a.showCaption&&a.caption?`<figcaption>${a.caption}</figcaption>`:"";return`<figure class="preview-block preview-image" data-preview-block="${e.id}">
            <div class="preview-image__media" ${E}></div>
            ${S}
            ${Q}
          </figure>`}case"groupe":case"sections":case"grid":return`<section class="preview-block preview-group" data-preview-block="${e.id}">
            ${S}
            <div class="preview-group__rows">
              <div></div>
              <div></div>
              <div></div>
            </div>
            <p class="preview-layout">Layout : ${a.layout||"grid"} \xB7 Colonnes mobiles ${a.columnsMobile||"1"} / desktop ${a.columnsDesktop||"3"}</p>
          </section>`;default:return`<section class="preview-block" data-preview-block="${e.id}">${S}</section>`}},ft=e=>{let t=(e==null?void 0:e.title)||"Page",n=(e==null?void 0:e.blocks)||[],a=n.length>0?n.map((o,r)=>rs(o,r)).join(""):`<section class="preview-block preview-empty" data-preview-block="none">
              <p>Ajoutez vos premiers blocs pour voir la preview se construire.</p>
            </section>`;return`<!DOCTYPE html>
      <html lang="fr">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <title>Pr\xE9visualisation \u2013 ${t}</title>
          <style>
            :root {
              font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              background-color: #f8fafc;
              color: #0f172a;
            }
            body {
              margin: 0;
              padding: 48px 24px 80px;
              background-color: #f8fafc;
              color: #0f172a;
            }
            .preview-page {
              max-width: 960px;
              margin: 0 auto;
              display: flex;
              flex-direction: column;
              gap: 24px;
            }
            .preview-block {
              border-radius: 24px;
              padding: 24px;
              border: 1px solid rgba(15, 23, 42, 0.08);
              background: white;
              box-shadow: 0 20px 30px rgba(15, 23, 42, 0.04);
              transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
            }
            .preview-block h3 {
              margin: 4px 0 6px;
              font-size: 20px;
            }
            .preview-block p {
              margin: 0;
              font-size: 15px;
              color: #475569;
            }
            .preview-block__header {
              display: flex;
              align-items: center;
              gap: 12px;
              font-size: 12px;
              text-transform: uppercase;
              letter-spacing: 0.06em;
              color: #94a3b8;
            }
            .preview-type {
              padding: 2px 8px;
              border-radius: 999px;
              background: #f1f5f9;
              color: #475569;
            }
            .preview-status {
              color: #94a3b8;
            }
            .preview-block-active {
              border-color: rgba(156, 107, 255, 0.6) !important;
              background: rgba(156, 107, 255, 0.05);
              box-shadow: 0 0 0 1px rgba(156, 107, 255, 0.2);
            }
            .preview-hero {
              padding: 48px;
              text-align: center;
              background: linear-gradient(120deg, #ede9fe, #f8fafc);
            }
            .preview-hero.align-left {
              text-align: left;
            }
            .preview-hero.align-right {
              text-align: right;
            }
            .preview-hero h3 {
              font-size: 28px;
            }
            .preview-hero .preview-cta {
              margin-top: 16px;
              border: none;
              background: #9c6bff;
              color: white;
              font-weight: 600;
              padding: 12px 24px;
              border-radius: 999px;
            }
            .preview-image__media {
              width: 100%;
              height: 220px;
              border-radius: 20px;
              background: linear-gradient(130deg, #c084fc, #a855f7);
              margin-bottom: 16px;
              opacity: 0.8;
              background-size: cover;
              background-position: center;
            }
            .preview-image figcaption {
              margin-top: 12px;
              font-size: 13px;
              color: #64748b;
            }
            .preview-group__rows {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
              gap: 12px;
              margin-top: 16px;
            }
            .preview-group__rows div {
              height: 80px;
              border-radius: 16px;
              background: #f1f5f9;
            }
            .preview-layout {
              margin-top: 12px;
              font-size: 13px;
              color: #475569;
            }
            .preview-props {
              margin: 12px 0 0;
              padding-left: 18px;
              color: #475569;
              font-size: 13px;
            }
            .preview-empty {
              text-align: center;
              border-style: dashed;
              border-color: rgba(15, 23, 42, 0.2);
              color: #64748b;
            }
          </style>
        </head>
        <body>
          <div class="preview-page">
            ${a}
          </div>
        </body>
      </html>`},ht=e=>{if(b){if(!e){b.classList.add("hidden");return}b.classList.remove("hidden"),b.textContent=e}},is=e=>{if(!f)return;let t=ft(e);Ee=t,ht("Actualisation\u2026"),f.setAttribute("title",`Pr\xE9visualisation de la page ${(e==null?void 0:e.title)||""}`.trim()),f.srcdoc=t,Je=!1},ae=e=>{if(!f)return;let t=f.contentDocument;if(!t)return;t.querySelectorAll("[data-preview-block]").forEach(a=>{a.dataset.previewBlock===e?(a.classList.add("preview-block-active"),Je&&e&&a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})):a.classList.remove("preview-block-active")}),M&&(M.style.borderColor=e?"rgba(156, 107, 255, 0.5)":"transparent")},Oe=e=>{if(!c)return;c.innerHTML="";let t=(e==null?void 0:e.blocks)||[];if(ne&&(ne.textContent=ts(t.length)),t.length===0){c.classList.add("hidden"),O==null||O.classList.remove("hidden");return}c.classList.remove("hidden"),O==null||O.classList.add("hidden"),t.forEach(n=>{let a=n.id===y,o=document.createElement("div");o.dataset.blockItem="true",o.dataset.blockId=n.id,o.setAttribute("role","option"),o.setAttribute("aria-selected",a?"true":"false"),o.tabIndex=0,o.className=["relative flex items-center gap-3 rounded-2xl border px-3 py-2 text-left transition",a?"bg-slate-100 border-[#9C6BFF]/40 shadow-sm":"border-slate-200 hover:border-[#9C6BFF]/40"].join(" ");let r=document.createElement("span");r.className=`absolute inset-y-2 left-0 w-1 rounded-full bg-[#9C6BFF] ${a?"":"hidden"}`,o.appendChild(r);let m=document.createElement("div");m.className="flex flex-1 items-center gap-3";let S=document.createElement("div");S.className="hidden lg:flex cursor-grab flex-shrink-0 items-center text-lg text-slate-400",S.innerHTML="&#8801;",m.appendChild(S);let E=document.createElement("div");E.className="flex-1";let Q=document.createElement("div");Q.className="flex items-center gap-2 text-[11px] uppercase tracking-wide text-slate-500";let Ke=document.createElement("span");Ke.className="rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-semibold text-slate-600",Ke.textContent=n.type;let Ye=document.createElement("span");Ye.className="text-slate-400",Ye.textContent=n.status,Q.appendChild(Ke),Q.appendChild(Ye);let Xe=document.createElement("p");Xe.className="mt-1 text-sm font-semibold text-slate-900";let Ss=n.settings&&n.settings.title||n.label||"Bloc sans titre";Xe.textContent=Ss,E.appendChild(Q),E.appendChild(Xe),m.appendChild(E),o.appendChild(m);let Be=document.createElement("div");Be.className="flex flex-col gap-1 text-xs text-slate-400";let qe=document.createElement("div");qe.className="flex items-center gap-1 lg:hidden";let ie=document.createElement("button");ie.type="button",ie.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",ie.textContent="\u2191",ie.addEventListener("click",_=>{_.stopPropagation(),bt(n.id,-1)});let le=document.createElement("button");le.type="button",le.className="rounded-lg border border-slate-200 px-2 py-1 text-[11px] font-semibold text-slate-500",le.textContent="\u2193",le.addEventListener("click",_=>{_.stopPropagation(),bt(n.id,1)}),qe.appendChild(ie),qe.appendChild(le),Be.appendChild(qe);let ce=document.createElement("button");ce.type="button",ce.className="inline-flex items-center justify-center rounded-lg border border-transparent px-2 py-1 text-[12px] text-rose-500 hover:text-rose-700",ce.innerHTML="\u{1F5D1}\uFE0F",ce.addEventListener("click",_=>{_.stopPropagation(),ps(n.id)}),Be.appendChild(ce),o.appendChild(Be),o.addEventListener("click",()=>{X(n.id)}),o.addEventListener("keydown",_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),X(n.id))}),c.appendChild(o)})},vt=(e,t)=>{s.forEach(n=>{n.innerHTML="",e.forEach(a=>{let o=document.createElement("li"),r=document.createElement("button");r.type="button",r.dataset.pageId=a.id,r.className=["w-full flex items-center justify-between gap-3 px-3 py-2 text-left transition",t===a.id?"bg-[#9C6BFF]/10 text-slate-900 border border-[#9C6BFF]/40 rounded-xl shadow-sm":"text-slate-700 hover:bg-slate-50 rounded-xl"].join(" "),t===a.id?r.setAttribute("aria-current","page"):r.removeAttribute("aria-current"),r.innerHTML=`
            <div class="flex items-center gap-3">
              <span class="flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-slate-500">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6.5 4.5h7l4 4v11a1 1 0 0 1-1 1h-10a1 1 0 0 1-1-1v-14a1 1 0 0 1 1-1Z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M13.5 4.5v4a1 1 0 0 0 1 1h3" stroke="currentColor" stroke-width="1.4"/>
                </svg>
              </span>
              <div class="flex flex-col">
                <span class="text-sm font-semibold">${a.title}</span>
                <span class="text-xs text-slate-500">${a.slug}</span>
              </div>
            </div>
          `,r.addEventListener("click",()=>{W(a.id),We()||Ge()}),o.appendChild(r),n.appendChild(o)})})},Re=()=>!l||!Array.isArray(l.blocks)?null:l.blocks.find(e=>e.id===y)||null,X=e=>{if(!l)return;if(!e){y=null,Oe(l),xe(null),ae(null);return}let t=l.blocks.find(n=>n.id===e)||l.blocks[0]||null;y=(t==null?void 0:t.id)||null,Oe(l),xe(t),ae(y)},oe=e=>{if(!l)return;let t={...l,blocks:e};ms(t)},Se=()=>window.matchMedia("(min-width: 1024px)").matches;function bt(e,t){if(!l||!e||!t)return;let n=[...l.blocks||[]],a=n.findIndex(m=>m.id===e);if(a<0)return;let o=a+t;if(o<0||o>=n.length)return;let[r]=n.splice(a,1);n.splice(o,0,r),oe(n),W(l.id,{preserveBlock:!0}),X(r.id)}function ls(e,t){if(!l||!e||!t||e===t)return;let n=[...l.blocks||[]],a=n.findIndex(m=>m.id===e),o=n.findIndex(m=>m.id===t);if(a<0||o<0)return;let[r]=n.splice(a,1);n.splice(o,0,r),oe(n),W(l.id,{preserveBlock:!0}),X(r.id)}function wt(){if(!c)return;let e=Se();c.querySelectorAll("[data-block-item]").forEach(t=>{t.setAttribute("draggable",e?"true":"false")})}function ke(){G&&(G.classList.add("hidden"),re=!1)}function cs(){G&&(G.classList.remove("hidden"),re=!0)}function ds(){re?ke():cs()}function us(e){if(!l||!e)return;let t=Xt[e];if(!t)return;let n=(l.blocks||[]).filter(r=>r.type===t.type).length+1,a=w(Ve(l.id,e),`${t.label} ${n}`,t.type,t.status,t.description,t.props,t.settings||{}),o=[...l.blocks||[],a];oe(o),W(l.id,{preserveBlock:!0}),X(a.id),ke(),se("Bloc ajout\xE9")}function yt(e){var a,o;if(!l)return;let t=(l.blocks||[]).filter(r=>r.id!==e),n=e===y?((a=t[0])==null?void 0:a.id)||null:y||((o=t[0])==null?void 0:o.id)||null;oe(t),y=n,W(l.id,{preserveBlock:!0}),y?X(y):(xe(null),ae(null)),se("Bloc supprim\xE9")}function Ue(){D&&(D.classList.add("hidden"),D.classList.remove("flex"),Ce=null)}function ps(e){if(!D){yt(e);return}Ce=e,D.classList.remove("hidden"),D.classList.add("flex")}let ms=e=>{e&&(C=C.map(t=>t.id===e.id?e:t),l=e,mt(C))},W=(e,t={})=>{var a,o;let n=C.find(r=>r.id===e)||C[0]||null;l=n,Z=(n==null?void 0:n.id)||null,(!t.preserveBlock||!l||!l.blocks.some(r=>r.id===y))&&(y=((o=(a=l==null?void 0:l.blocks)==null?void 0:a[0])==null?void 0:o.id)||null),Z&&Qt(Z),vt(C,Z),ns(l),as(l),is(l),Oe(l),xe(Re()),ae(y),wt(),re&&ke()},We=()=>window.matchMedia("(min-width: 1024px)").matches,xt=()=>{J&&(We()?(J.classList.add("is-open"),L==null||L.classList.add("hidden"),document.body.classList.remove("overflow-hidden")):J.classList.remove("is-open"))},gs=()=>{!J||We()||(J.classList.add("is-open"),L==null||L.classList.remove("hidden"),document.body.classList.add("overflow-hidden"))},Ge=()=>{J&&(J.classList.remove("is-open"),L==null||L.classList.add("hidden"),document.body.classList.remove("overflow-hidden"))},fs=()=>{!U||!K||(U.classList.remove("hidden"),K.classList.add("hidden"),P&&(P.textContent=""),Le=!1,I&&(I.value="",I.focus()),T&&(T.value=""))},St=()=>{!U||!K||(U.classList.add("hidden"),K.classList.remove("hidden"),P&&(P.textContent=""),Le=!1,U.reset())},hs=()=>{!I||!T||Le&&T.value.trim().length>0||(T.value=gt(I.value))},C=Zt(),Z=es(C),Le=!1,l=null,y=null,re=!1,Ce=null,Ee="",Je=!1;vt(C,Z),W(Z),xt(),Jt.forEach(e=>{e.addEventListener("click",gs)}),Kt.forEach(e=>{e.addEventListener("click",Ge)}),L==null||L.addEventListener("click",Ge),window.addEventListener("resize",()=>{xt(),wt()}),K==null||K.addEventListener("click",fs),_e==null||_e.addEventListener("click",St),I==null||I.addEventListener("input",hs),T==null||T.addEventListener("input",()=>{P&&(P.textContent=""),Le=!0}),U==null||U.addEventListener("submit",e=>{if(e.preventDefault(),!I||!T)return;let t=I.value.trim(),n=gt(T.value.trim()||t);if(!t||!n){P&&(P.textContent="Titre et slug sont requis.");return}if(C.some(r=>r.slug===n)){P&&(P.textContent="Ce slug est d\xE9j\xE0 utilis\xE9.");return}let a=`page-${Date.now().toString(36)}`,o={id:a,title:t,slug:n,description:`Nouvelle page "${t}" pr\xEAte \xE0 \xEAtre maquett\xE9e.`,badges:["Layout","Texte"],blocks:ss(a,t)};C=[...C,o],mt(C),St(),W(o.id)}),j==null||j.addEventListener("click",e=>{e.stopPropagation(),ds()}),document.addEventListener("click",e=>{re&&(G!=null&&G.contains(e.target)||j!=null&&j.contains(e.target)||ke())}),_t.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();let n=e.dataset.blockAdd;us(n)})}),je==null||je.addEventListener("click",()=>{Ue()}),Me==null||Me.addEventListener("click",()=>{Ce&&yt(Ce),Ue()}),D==null||D.addEventListener("click",e=>{e.target===D&&Ue()}),h==null||h.addEventListener("submit",Gt),He==null||He.addEventListener("click",e=>{e.preventDefault();let t=Re();t&&dt(t)}),f==null||f.addEventListener("load",()=>{Je=!0,ht("\xC0 jour"),ae(y)}),p==null||p.addEventListener("click",()=>{Ee||(Ee=ft(l));let e=window.open("","_blank");if(!e)return;e.opener=null;let t=e.document;t.open(),t.write(Ee),t.close()});let vs=e=>{let t=e.target.closest("[data-block-item]");!t||!Se()||(H=t.dataset.blockId||null,H&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",H),t.classList.add("opacity-50")))},kt=()=>{c==null||c.querySelectorAll("[data-block-item]").forEach(e=>e.classList.remove("opacity-50","ring-2","ring-[#9C6BFF]/50"))},bs=()=>{H=null,kt()},ws=e=>{if(!H||!Se())return;let t=e.target.closest("[data-block-item]");!t||t.dataset.blockId===H||(e.preventDefault(),t.classList.add("ring-2","ring-[#9C6BFF]/50"))},ys=e=>{let t=e.target.closest("[data-block-item]");t&&t.classList.remove("ring-2","ring-[#9C6BFF]/50")},xs=e=>{if(!H||!Se())return;e.preventDefault();let t=e.target.closest("[data-block-item]"),n=H;H=null,kt();let a=(t==null?void 0:t.dataset.blockId)||null;a&&ls(n,a)},H=null;c==null||c.addEventListener("dragstart",vs),c==null||c.addEventListener("dragend",bs),c==null||c.addEventListener("dragover",ws),c==null||c.addEventListener("dragleave",ys),c==null||c.addEventListener("drop",xs)}});})();
